54d25d92bc76b0171d5aecad7cc6fa16
"use strict";
/**
 * MCP Filesystem Module Tests
 * 파일 경로 검증 및 확장자 검증 테스트
 */
Object.defineProperty(exports, "__esModule", { value: true });
// UserSandbox 모킹
jest.mock('../mcp/user-sandbox', () => ({
    UserSandbox: {
        resolvePath: jest.fn((userId, filePath) => {
            // 기본 동작: 단순 경로 반환 (테스트용)
            if (filePath.includes('..'))
                return null; // 경로 탈출 시도
            if (filePath.startsWith('/'))
                return filePath;
            return `/home/user${userId}/workspace/${filePath}`;
        })
    },
    UserContext: {}
}));
const filesystem_1 = require("../mcp/filesystem");
describe('MCP Filesystem Module', () => {
    describe('validateFilePath', () => {
        it('should validate a simple relative path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'test.txt');
            expect(result.valid).toBe(true);
            expect(result.resolvedPath).toBe('/home/user1/workspace/test.txt');
            expect(result.error).toBeUndefined();
        });
        it('should validate an absolute path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '/home/user1/workspace/file.md');
            expect(result.valid).toBe(true);
            expect(result.resolvedPath).toBe('/home/user1/workspace/file.md');
        });
        it('should reject path traversal attempts', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '../../../etc/passwd');
            expect(result.valid).toBe(false);
            expect(result.resolvedPath).toBeNull();
            expect(result.error).toBe('접근 권한이 없는 경로입니다');
        });
        it('should reject node_modules path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'node_modules/package.json');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
        it('should reject .git path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '.git/config');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
        it('should reject .env file', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '.env');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
        it('should reject files with password in name', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'my_password.txt');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
        it('should reject files with secret in name', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'api_secret.json');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
        it('should reject files with credentials in name', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'credentials.yaml');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
    });
    describe('isAllowedExtension', () => {
        describe('allowed extensions', () => {
            const allowedExtensions = [
                '.txt', '.md', '.json', '.yaml', '.yml', '.xml',
                '.js', '.ts', '.jsx', '.tsx', '.css', '.html',
                '.py', '.java', '.go', '.rs', '.c', '.cpp', '.h',
                '.sh', '.bash', '.zsh', '.fish',
                '.csv', '.log'
                // Note: .env.example은 path.extname이 .example을 반환하므로 별도 테스트
            ];
            allowedExtensions.forEach(ext => {
                it(`should allow ${ext} extension`, () => {
                    expect((0, filesystem_1.isAllowedExtension)(`file${ext}`)).toBe(true);
                });
            });
        });
        it('should allow files without extension', () => {
            expect((0, filesystem_1.isAllowedExtension)('Makefile')).toBe(true);
            expect((0, filesystem_1.isAllowedExtension)('Dockerfile')).toBe(true);
        });
        it('should deny binary extensions', () => {
            expect((0, filesystem_1.isAllowedExtension)('file.exe')).toBe(false);
            expect((0, filesystem_1.isAllowedExtension)('file.dll')).toBe(false);
            expect((0, filesystem_1.isAllowedExtension)('file.so')).toBe(false);
        });
        it('should deny image extensions', () => {
            expect((0, filesystem_1.isAllowedExtension)('image.png')).toBe(false);
            expect((0, filesystem_1.isAllowedExtension)('photo.jpg')).toBe(false);
            expect((0, filesystem_1.isAllowedExtension)('icon.gif')).toBe(false);
        });
        it('should be case insensitive', () => {
            expect((0, filesystem_1.isAllowedExtension)('FILE.TXT')).toBe(true);
            expect((0, filesystem_1.isAllowedExtension)('file.MD')).toBe(true);
            expect((0, filesystem_1.isAllowedExtension)('script.JS')).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL19fdGVzdHNfXy9tY3AtZmlsZXN5c3RlbS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBSUgsaUJBQWlCO0FBQ2pCLElBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNwQyxXQUFXLEVBQUU7UUFDVCxXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQXVCLEVBQUUsUUFBZ0IsRUFBRSxFQUFFO1lBQy9ELHlCQUF5QjtZQUN6QixJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO2dCQUFFLE9BQU8sSUFBSSxDQUFDLENBQUMsV0FBVztZQUNyRCxJQUFJLFFBQVEsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDO2dCQUFFLE9BQU8sUUFBUSxDQUFDO1lBQzlDLE9BQU8sYUFBYSxNQUFNLGNBQWMsUUFBUSxFQUFFLENBQUM7UUFDdkQsQ0FBQyxDQUFDO0tBQ0w7SUFDRCxXQUFXLEVBQUUsRUFBRTtDQUNsQixDQUFDLENBQUMsQ0FBQztBQWJKLGtEQUF5RTtBQWV6RSxRQUFRLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEdBQUcsRUFBRTtZQUM5QyxNQUFNLE1BQU0sR0FBRyxJQUFBLDZCQUFnQixFQUFDLENBQUMsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUUvQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNoQyxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1lBQ25FLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7UUFD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QUFNLENBQUMsSUFBQSwrQkFBa0IsRUFBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsRCxNQUFNLENBQUMsSUFBQSwrQkFBa0IsRUFBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNqRCxNQUFNLENBQUMsSUFBQSwrQkFBa0IsRUFBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2RCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL19fdGVzdHNfXy9tY3AtZmlsZXN5c3RlbS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTUNQIEZpbGVzeXN0ZW0gTW9kdWxlIFRlc3RzXG4gKiDtjIzsnbwg6rK966GcIOqygOymnSDrsI8g7ZmV7J6l7J6QIOqygOymnSDthYzsiqTtirhcbiAqL1xuXG5pbXBvcnQgeyB2YWxpZGF0ZUZpbGVQYXRoLCBpc0FsbG93ZWRFeHRlbnNpb24gfSBmcm9tICcuLi9tY3AvZmlsZXN5c3RlbSc7XG5cbi8vIFVzZXJTYW5kYm94IOuqqO2CuVxuamVzdC5tb2NrKCcuLi9tY3AvdXNlci1zYW5kYm94JywgKCkgPT4gKHtcbiAgICBVc2VyU2FuZGJveDoge1xuICAgICAgICByZXNvbHZlUGF0aDogamVzdC5mbigodXNlcklkOiBzdHJpbmcgfCBudW1iZXIsIGZpbGVQYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIC8vIOq4sOuzuCDrj5nsnpE6IOuLqOyInCDqsr3roZwg67CY7ZmYICjthYzsiqTtirjsmqkpXG4gICAgICAgICAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJy4uJykpIHJldHVybiBudWxsOyAvLyDqsr3roZwg7YOI7LacIOyLnOuPhFxuICAgICAgICAgICAgaWYgKGZpbGVQYXRoLnN0YXJ0c1dpdGgoJy8nKSkgcmV0dXJuIGZpbGVQYXRoO1xuICAgICAgICAgICAgcmV0dXJuIGAvaG9tZS91c2VyJHt1c2VySWR9L3dvcmtzcGFjZS8ke2ZpbGVQYXRofWA7XG4gICAgICAgIH0pXG4gICAgfSxcbiAgICBVc2VyQ29udGV4dDoge31cbn0pKTtcblxuZGVzY3JpYmUoJ01DUCBGaWxlc3lzdGVtIE1vZHVsZScsICgpID0+IHtcbiAgICBkZXNjcmliZSgndmFsaWRhdGVGaWxlUGF0aCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhIHNpbXBsZSByZWxhdGl2ZSBwYXRoJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVGaWxlUGF0aCgxLCAndGVzdC50eHQnKTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQucmVzb2x2ZWRQYXRoKS50b0JlKCcvaG9tZS91c2VyMS93b3Jrc3BhY2UvdGVzdC50eHQnKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhbiBhYnNvbHV0ZSBwYXRoJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVGaWxlUGF0aCgxLCAnL2hvbWUvdXNlcjEvd29ya3NwYWNlL2ZpbGUubWQnKTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQucmVzb2x2ZWRQYXRoKS50b0JlKCcvaG9tZS91c2VyMS93b3Jrc3BhY2UvZmlsZS5tZCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlamVjdCBwYXRoIHRyYXZlcnNhbCBhdHRlbXB0cycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZVBhdGgoMSwgJy4uLy4uLy4uL2V0Yy9wYXNzd2QnKTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnJlc29sdmVkUGF0aCkudG9CZU51bGwoKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ+ygkeq3vCDqtoztlZzsnbQg7JeG64qUIOqyveuhnOyeheuLiOuLpCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlamVjdCBub2RlX21vZHVsZXMgcGF0aCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZVBhdGgoMSwgJ25vZGVfbW9kdWxlcy9wYWNrYWdlLmpzb24nKTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKCfsoJHqt7zsnbQg6riI7KeA65CcIOqyveuhnOyeheuLiOuLpCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlamVjdCAuZ2l0IHBhdGgnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGVQYXRoKDEsICcuZ2l0L2NvbmZpZycpO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ+ygkeq3vOydtCDquIjsp4DrkJwg6rK966Gc7J6F64uI64ukJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IC5lbnYgZmlsZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZVBhdGgoMSwgJy5lbnYnKTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKCfsoJHqt7zsnbQg6riI7KeA65CcIOqyveuhnOyeheuLiOuLpCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlamVjdCBmaWxlcyB3aXRoIHBhc3N3b3JkIGluIG5hbWUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGVQYXRoKDEsICdteV9wYXNzd29yZC50eHQnKTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKCfsoJHqt7zsnbQg6riI7KeA65CcIOqyveuhnOyeheuLiOuLpCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlamVjdCBmaWxlcyB3aXRoIHNlY3JldCBpbiBuYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVGaWxlUGF0aCgxLCAnYXBpX3NlY3JldC5qc29uJyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgn7KCR6re87J20IOq4iOyngOuQnCDqsr3roZzsnoXri4jri6QnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZWplY3QgZmlsZXMgd2l0aCBjcmVkZW50aWFscyBpbiBuYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVGaWxlUGF0aCgxLCAnY3JlZGVudGlhbHMueWFtbCcpO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ+ygkeq3vOydtCDquIjsp4DrkJwg6rK966Gc7J6F64uI64ukJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2lzQWxsb3dlZEV4dGVuc2lvbicsICgpID0+IHtcbiAgICAgICAgZGVzY3JpYmUoJ2FsbG93ZWQgZXh0ZW5zaW9ucycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGFsbG93ZWRFeHRlbnNpb25zID0gW1xuICAgICAgICAgICAgICAgICcudHh0JywgJy5tZCcsICcuanNvbicsICcueWFtbCcsICcueW1sJywgJy54bWwnLFxuICAgICAgICAgICAgICAgICcuanMnLCAnLnRzJywgJy5qc3gnLCAnLnRzeCcsICcuY3NzJywgJy5odG1sJyxcbiAgICAgICAgICAgICAgICAnLnB5JywgJy5qYXZhJywgJy5nbycsICcucnMnLCAnLmMnLCAnLmNwcCcsICcuaCcsXG4gICAgICAgICAgICAgICAgJy5zaCcsICcuYmFzaCcsICcuenNoJywgJy5maXNoJyxcbiAgICAgICAgICAgICAgICAnLmNzdicsICcubG9nJ1xuICAgICAgICAgICAgICAgIC8vIE5vdGU6IC5lbnYuZXhhbXBsZeydgCBwYXRoLmV4dG5hbWXsnbQgLmV4YW1wbGXsnYQg67CY7ZmY7ZWY66+A66GcIOuzhOuPhCDthYzsiqTtirhcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIGFsbG93ZWRFeHRlbnNpb25zLmZvckVhY2goZXh0ID0+IHtcbiAgICAgICAgICAgICAgICBpdChgc2hvdWxkIGFsbG93ICR7ZXh0fSBleHRlbnNpb25gLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oYGZpbGUke2V4dH1gKSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGFsbG93IGZpbGVzIHdpdGhvdXQgZXh0ZW5zaW9uJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbignTWFrZWZpbGUnKSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oJ0RvY2tlcmZpbGUnKSkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBkZW55IGJpbmFyeSBleHRlbnNpb25zJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbignZmlsZS5leGUnKSkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKCdmaWxlLmRsbCcpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oJ2ZpbGUuc28nKSkudG9CZShmYWxzZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgZGVueSBpbWFnZSBleHRlbnNpb25zJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbignaW1hZ2UucG5nJykpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbigncGhvdG8uanBnJykpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbignaWNvbi5naWYnKSkudG9CZShmYWxzZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgYmUgY2FzZSBpbnNlbnNpdGl2ZScsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oJ0ZJTEUuVFhUJykpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKCdmaWxlLk1EJykpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKCdzY3JpcHQuSlMnKSkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==