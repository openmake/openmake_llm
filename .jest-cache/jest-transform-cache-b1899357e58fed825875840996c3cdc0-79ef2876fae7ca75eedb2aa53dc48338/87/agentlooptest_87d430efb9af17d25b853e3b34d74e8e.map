{"file":"/Volumes/MAC_APP/openmake_llm/tests/unit/__tests__/agent-loop.test.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/tests/unit/__tests__/agent-loop.test.ts"],"sourcesContent":["/**\n * Ollama Agent Loop 유닛 테스트\n */\n\nimport {\n    runAgentLoop,\n    executeSingleToolCall,\n    mcpToolToOllamaTool,\n    mcpToolsToOllamaTools,\n    AgentLoopOptions,\n    AgentLoopResult\n} from '../../../backend/api/src/ollama/agent-loop';\nimport { ToolDefinition, ChatMessage } from '../../../backend/api/src/ollama/types';\n\n// Mock Tools\nconst addTool: ToolDefinition = {\n    type: 'function',\n    function: {\n        name: 'add',\n        description: 'Add two numbers',\n        parameters: {\n            type: 'object',\n            properties: {\n                a: { type: 'integer', description: 'First number' },\n                b: { type: 'integer', description: 'Second number' }\n            },\n            required: ['a', 'b']\n        }\n    }\n};\n\nconst multiplyTool: ToolDefinition = {\n    type: 'function',\n    function: {\n        name: 'multiply',\n        description: 'Multiply two numbers',\n        parameters: {\n            type: 'object',\n            properties: {\n                a: { type: 'integer', description: 'First number' },\n                b: { type: 'integer', description: 'Second number' }\n            },\n            required: ['a', 'b']\n        }\n    }\n};\n\n// Mock Functions\nconst availableFunctions = {\n    add: (args: { a: number; b: number }) => args.a + args.b,\n    multiply: (args: { a: number; b: number }) => args.a * args.b\n};\n\ndescribe('Ollama Agent Loop', () => {\n    describe('mcpToolToOllamaTool', () => {\n        it('should convert MCP tool to Ollama tool format', () => {\n            const mcpTool = {\n                tool: {\n                    name: 'test_tool',\n                    description: 'A test tool',\n                    inputSchema: {\n                        type: 'object',\n                        properties: {\n                            input: { type: 'string', description: 'Input value' }\n                        },\n                        required: ['input']\n                    }\n                }\n            };\n\n            const result = mcpToolToOllamaTool(mcpTool);\n\n            expect(result.type).toBe('function');\n            expect(result.function.name).toBe('test_tool');\n            expect(result.function.description).toBe('A test tool');\n            expect(result.function.parameters).toEqual(mcpTool.tool.inputSchema);\n        });\n    });\n\n    describe('mcpToolsToOllamaTools', () => {\n        it('should convert multiple MCP tools', () => {\n            const mcpTools = [\n                {\n                    tool: {\n                        name: 'tool1',\n                        description: 'Tool 1',\n                        inputSchema: { type: 'object', properties: {} }\n                    }\n                },\n                {\n                    tool: {\n                        name: 'tool2',\n                        description: 'Tool 2',\n                        inputSchema: { type: 'object', properties: {} }\n                    }\n                }\n            ];\n\n            const result = mcpToolsToOllamaTools(mcpTools);\n\n            expect(result).toHaveLength(2);\n            expect(result[0].function.name).toBe('tool1');\n            expect(result[1].function.name).toBe('tool2');\n        });\n    });\n\n    // Note: 아래 테스트는 실제 Ollama 서버가 필요하므로 integration test로 분류해야 합니다.\n    // 여기서는 구조 테스트만 수행합니다.\n\n    describe('AgentLoopOptions interface', () => {\n        it('should accept valid options', () => {\n            const options: AgentLoopOptions = {\n                model: 'gemini-3-flash-preview:cloud',\n                messages: [{ role: 'user', content: 'Test' }],\n                tools: [addTool, multiplyTool],\n                availableFunctions,\n                think: true,\n                stream: false,\n                maxIterations: 5\n            };\n\n            expect(options.model).toBe('gemini-3-flash-preview:cloud');\n            expect(options.tools).toHaveLength(2);\n            expect(options.maxIterations).toBe(5);\n        });\n\n        it('should have default values for optional fields', () => {\n            const options: AgentLoopOptions = {\n                messages: [{ role: 'user', content: 'Test' }],\n                tools: [],\n                availableFunctions: {}\n            };\n\n            expect(options.model).toBeUndefined();\n            expect(options.think).toBeUndefined();\n            expect(options.stream).toBeUndefined();\n            expect(options.maxIterations).toBeUndefined();\n        });\n    });\n\n    describe('Tool Definitions', () => {\n        it('should have correct structure for add tool', () => {\n            expect(addTool.type).toBe('function');\n            expect(addTool.function.name).toBe('add');\n            expect(addTool.function.parameters.required).toContain('a');\n            expect(addTool.function.parameters.required).toContain('b');\n        });\n\n        it('should have correct structure for multiply tool', () => {\n            expect(multiplyTool.type).toBe('function');\n            expect(multiplyTool.function.name).toBe('multiply');\n        });\n    });\n\n    describe('Available Functions', () => {\n        it('should correctly execute add function', () => {\n            const result = availableFunctions.add({ a: 5, b: 3 });\n            expect(result).toBe(8);\n        });\n\n        it('should correctly execute multiply function', () => {\n            const result = availableFunctions.multiply({ a: 4, b: 7 });\n            expect(result).toBe(28);\n        });\n    });\n});\n"],"version":3}