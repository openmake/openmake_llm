{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/auth.test.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/auth.test.ts"],"sourcesContent":["/**\n * Auth Module Tests\n * JWT í† í° ìƒì„±/ê²€ì¦ ë° ê¶Œí•œ ì²´í¬ í…ŒìŠ¤íŠ¸\n */\n\n// í…ŒìŠ¤íŠ¸ìš© í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ë‹¤ë¥¸ import ì „ì— ì„¤ì •)\nprocess.env.JWT_SECRET = 'test-secret-key-for-testing-purposes-only';\n// ðŸ”’ ë³´ì•ˆ íŒ¨ì¹˜ 2026-02-07: í•˜ë“œì½”ë”©ëœ DB ì¸ì¦ì •ë³´ ì œê±° â€” í™˜ê²½ë³€ìˆ˜ í•„ìˆ˜\nif (!process.env.DATABASE_URL) {\n    process.env.DATABASE_URL = `postgresql://${process.env.POSTGRES_USER || 'openmake'}:${process.env.POSTGRES_PASSWORD || 'test'}@localhost:5432/${process.env.POSTGRES_DB || 'openmake_llm'}`;\n}\n\nimport {\n    generateToken,\n    verifyToken,\n    extractToken,\n    hasPermission,\n    isAdmin\n} from '../auth';\nimport { PublicUser } from '../data/user-manager';\n\ndescribe('Auth Module', () => {\n    // í…ŒìŠ¤íŠ¸ìš© ì‚¬ìš©ìž ë°ì´í„°\n    const mockUser: PublicUser = {\n        id: 1,\n        email: 'test@example.com',\n        role: 'user',\n        tier: 'free',\n        is_active: true,\n        created_at: new Date().toISOString()\n    };\n\n    const mockAdminUser: PublicUser = {\n        id: 2,\n        email: 'admin@example.com',\n        role: 'admin',\n        tier: 'enterprise',\n        is_active: true,\n        created_at: new Date().toISOString()\n    };\n\n    describe('generateToken', () => {\n        it('should generate a valid JWT token', () => {\n            const token = generateToken(mockUser);\n\n            expect(token).toBeDefined();\n            expect(typeof token).toBe('string');\n            expect(token.split('.')).toHaveLength(3); // JWTëŠ” 3ê°œ ì„¸ê·¸ë¨¼íŠ¸\n        });\n\n        it('should generate different tokens for different users', () => {\n            const token1 = generateToken(mockUser);\n            const token2 = generateToken(mockAdminUser);\n\n            expect(token1).not.toBe(token2);\n        });\n    });\n\n    describe('verifyToken', () => {\n        it('should verify a valid token', async () => {\n            const token = generateToken(mockUser);\n            const payload = await verifyToken(token);\n\n            expect(payload).not.toBeNull();\n            expect(payload?.userId).toBe(mockUser.id);\n            expect(payload?.email).toBe(mockUser.email);\n            expect(payload?.role).toBe(mockUser.role);\n        });\n\n        it('should return null for invalid token', async () => {\n            const payload = await verifyToken('invalid-token');\n\n            expect(payload).toBeNull();\n        });\n\n        it('should return null for empty token', async () => {\n            const payload = await verifyToken('');\n\n            expect(payload).toBeNull();\n        });\n\n        it('should return null for malformed JWT', async () => {\n            const payload = await verifyToken('a.b.c');\n\n            expect(payload).toBeNull();\n        });\n    });\n\n    describe('extractToken', () => {\n        it('should extract token from Bearer header', () => {\n            const token = extractToken('Bearer mytoken123');\n\n            expect(token).toBe('mytoken123');\n        });\n\n        it('should return raw token if no Bearer prefix', () => {\n            const token = extractToken('rawtoken456');\n\n            expect(token).toBe('rawtoken456');\n        });\n\n        it('should return null for undefined header', () => {\n            const token = extractToken(undefined);\n\n            expect(token).toBeNull();\n        });\n\n        it('should return null for empty header', () => {\n            const token = extractToken('');\n\n            expect(token).toBeNull();\n        });\n    });\n\n    describe('hasPermission', () => {\n        it('should allow admin to access admin resources', () => {\n            expect(hasPermission('admin', 'admin')).toBe(true);\n        });\n\n        it('should allow admin to access user resources', () => {\n            expect(hasPermission('admin', 'user')).toBe(true);\n        });\n\n        it('should allow admin to access guest resources', () => {\n            expect(hasPermission('admin', 'guest')).toBe(true);\n        });\n\n        it('should allow user to access user resources', () => {\n            expect(hasPermission('user', 'user')).toBe(true);\n        });\n\n        it('should allow user to access guest resources', () => {\n            expect(hasPermission('user', 'guest')).toBe(true);\n        });\n\n        it('should deny user access to admin resources', () => {\n            expect(hasPermission('user', 'admin')).toBe(false);\n        });\n\n        it('should allow guest to access guest resources', () => {\n            expect(hasPermission('guest', 'guest')).toBe(true);\n        });\n\n        it('should deny guest access to user resources', () => {\n            expect(hasPermission('guest', 'user')).toBe(false);\n        });\n\n        it('should deny guest access to admin resources', () => {\n            expect(hasPermission('guest', 'admin')).toBe(false);\n        });\n    });\n\n    describe('isAdmin', () => {\n        it('should return true for admin role', () => {\n            expect(isAdmin('admin')).toBe(true);\n        });\n\n        it('should return false for user role', () => {\n            expect(isAdmin('user')).toBe(false);\n        });\n\n        it('should return false for guest role', () => {\n            expect(isAdmin('guest')).toBe(false);\n        });\n    });\n});\n\n// Add at the end of the file, after existing tests\nimport { AuthService } from '../services/AuthService';\n\ndescribe('Password Policy', () => {\n    const authService = new AuthService();\n    \n    it('should reject password shorter than 8 characters', async () => {\n        const result = await authService.register({ email: 'test@test.com', password: 'Aa1!' });\n        expect(result.success).toBe(false);\n        expect(result.error).toContain('8ìž');\n    });\n    \n    it('should reject password without uppercase', async () => {\n        const result = await authService.register({ email: 'test@test.com', password: 'abcd1234!' });\n        expect(result.success).toBe(false);\n        expect(result.error).toContain('ëŒ€ë¬¸ìž');\n    });\n    \n    it('should reject password without lowercase', async () => {\n        const result = await authService.register({ email: 'test@test.com', password: 'ABCD1234!' });\n        expect(result.success).toBe(false);\n        expect(result.error).toContain('ì†Œë¬¸ìž');\n    });\n    \n    it('should reject password without number', async () => {\n        const result = await authService.register({ email: 'test@test.com', password: 'Abcdefgh!' });\n        expect(result.success).toBe(false);\n        expect(result.error).toContain('ìˆ«ìž');\n    });\n    \n    it('should reject password without special character', async () => {\n        const result = await authService.register({ email: 'test@test.com', password: 'Abcd1234' });\n        expect(result.success).toBe(false);\n        expect(result.error).toContain('íŠ¹ìˆ˜ë¬¸ìž');\n    });\n    \n    it('should accept valid password', async () => {\n        const result = await authService.register({ email: 'newuser@test.com', password: 'ValidPass1!' });\n        // Success depends on whether user already exists, but should NOT fail on password\n        if (!result.success) {\n            expect(result.error).not.toContain('ë¹„ë°€ë²ˆí˜¸');\n        }\n    });\n});\n\ndescribe('Token Blacklist', () => {\n    // In-memory êµ¬í˜„ìœ¼ë¡œ PostgreSQL ì—†ì´ ITokenBlacklist ì¸í„°íŽ˜ì´ìŠ¤ ë™ìž‘ ê²€ì¦\n    type BlacklistEntry = { jti: string; expiresAt: number };\n    let store: BlacklistEntry[];\n\n    const blacklist = {\n        add: async (jti: string, expiresAt: number) => {\n            const idx = store.findIndex(e => e.jti === jti);\n            if (idx >= 0) { store[idx].expiresAt = expiresAt; }\n            else { store.push({ jti, expiresAt }); }\n        },\n        has: async (jti: string) => {\n            return store.some(e => e.jti === jti && e.expiresAt > Date.now());\n        },\n        cleanup: async () => {\n            const now = Date.now();\n            const before = store.length;\n            store = store.filter(e => e.expiresAt >= now);\n            return before - store.length;\n        },\n        getStats: async () => {\n            const now = Date.now();\n            return { count: store.filter(e => e.expiresAt > now).length };\n        },\n    };\n\n    beforeEach(() => {\n        store = [];\n    });\n\n    it('should add token to blacklist', async () => {\n        await blacklist.add('test-jti-1', Date.now() + 60000);\n        expect(await blacklist.has('test-jti-1')).toBe(true);\n    });\n\n    it('should return false for non-existent token', async () => {\n        expect(await blacklist.has('non-existent')).toBe(false);\n    });\n\n    it('should return false for expired token', async () => {\n        await blacklist.add('expired-jti', Date.now() - 1000);\n        expect(await blacklist.has('expired-jti')).toBe(false);\n    });\n\n    it('should cleanup expired tokens', async () => {\n        await blacklist.add('expired-1', Date.now() - 1000);\n        await blacklist.add('expired-2', Date.now() - 2000);\n        await blacklist.add('valid', Date.now() + 60000);\n\n        const cleaned = await blacklist.cleanup();\n        expect(cleaned).toBe(2);\n        const stats = await blacklist.getStats();\n        expect(stats.count).toBe(1);\n    });\n\n    it('should return correct stats', async () => {\n        await blacklist.add('jti-1', Date.now() + 60000);\n        await blacklist.add('jti-2', Date.now() + 60000);\n\n        const stats = await blacklist.getStats();\n        expect(stats.count).toBe(2);\n    });\n});\n"],"version":3}