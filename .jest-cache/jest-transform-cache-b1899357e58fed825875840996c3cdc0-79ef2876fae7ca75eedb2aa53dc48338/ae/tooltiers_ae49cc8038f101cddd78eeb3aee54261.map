{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/tool-tiers.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/tool-tiers.ts"],"sourcesContent":["/**\n * MCP 도구 등급별 접근 제어\n * \n * 사용자 tier에 따라 접근 가능한 도구를 정의합니다.\n */\n\nimport { UserTier } from '../data/user-manager';\nimport { MCP_NAMESPACE_SEPARATOR } from './types';\n\n/**\n * 등급별 허용 도구 목록\n * - '*' 는 모든 도구 허용\n * - 'tool_*' 패턴은 해당 접두사로 시작하는 모든 도구 허용\n */\nexport const TOOL_TIERS: Record<UserTier, string[]> = {\n    free: [\n        'web_search',           // 웹 검색\n        'vision_ocr',           // 이미지 OCR\n        'analyze_image',        // 이미지 분석\n    ],\n    pro: [\n        'web_search',\n        'vision_ocr',\n        'analyze_image',\n        'run_command',          // 명령어 실행\n        'firecrawl_*',          // Firecrawl 관련 모든 도구\n        'sequential_thinking',  // Sequential Thinking\n    ],\n    enterprise: [\n        '*',                    // 모든 도구 허용\n    ]\n};\n\n/**\n * 특정 tier가 특정 도구에 접근 가능한지 확인\n */\nexport function canUseTool(tier: UserTier, toolName: string): boolean {\n    const allowedTools = TOOL_TIERS[tier];\n\n    // 모든 도구 허용\n    if (allowedTools.includes('*')) {\n        return true;\n    }\n\n    // 외부 도구 (:: 네임스페이스) — free 등급에서는 접근 불가\n    if (toolName.includes(MCP_NAMESPACE_SEPARATOR)) {\n        if (tier === 'free') {\n            return false;\n        }\n        // pro/enterprise: 와일드카드 패턴으로 서버 단위 접근 제어 가능\n        // 예: TOOL_TIERS.pro에 \"postgres::*\" 추가 가능\n        for (const pattern of allowedTools) {\n            if (pattern.endsWith('*')) {\n                const prefix = pattern.slice(0, -1);\n                if (toolName.startsWith(prefix)) {\n                    return true;\n                }\n            }\n            if (pattern === toolName) {\n                return true;\n            }\n        }\n        // pro 등급: 기본적으로 모든 외부 도구 허용\n        if (tier === 'pro') {\n            return true;\n        }\n        return false;\n    }\n\n    // 정확한 매칭\n    if (allowedTools.includes(toolName)) {\n        return true;\n    }\n\n    // 와일드카드 패턴 매칭 (예: 'firecrawl_*')\n    for (const pattern of allowedTools) {\n        if (pattern.endsWith('*')) {\n            const prefix = pattern.slice(0, -1);\n            if (toolName.startsWith(prefix)) {\n                return true;\n            }\n        }\n    }\n\n    return false;\n}\n\n/**\n * 특정 tier가 접근 가능한 도구 목록 반환\n */\nexport function getToolsForTier(tier: UserTier, allTools: string[]): string[] {\n    const allowedTools = TOOL_TIERS[tier];\n\n    // 모든 도구 허용\n    if (allowedTools.includes('*')) {\n        return allTools;\n    }\n\n    return allTools.filter(toolName => canUseTool(tier, toolName));\n}\n\n/**\n * 기본 tier 반환 (role 기반)\n */\nexport function getDefaultTierForRole(role: 'admin' | 'user' | 'guest'): UserTier {\n    switch (role) {\n        case 'admin':\n            return 'enterprise';\n        case 'user':\n            return 'free';\n        case 'guest':\n            return 'free';\n        default:\n            return 'free';\n    }\n}\n"],"version":3}