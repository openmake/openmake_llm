94e4351dc1a1e798835959d46a0d8e37
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateConfig = validateConfig;
exports.loadConfig = loadConfig;
exports.getConfig = getConfig;
exports.resetConfig = resetConfig;
// 환경 설정 로더
const fs = require("fs");
const path = require("path");
const DEFAULT_CONFIG = {
    ollamaBaseUrl: 'http://localhost:11434',
    ollamaDefaultModel: 'gemini-3-flash-preview:cloud',
    ollamaKoreanModel: 'gemini-3-flash-preview:cloud',
    ollamaTimeout: 120000,
    logLevel: 'info',
    // Gemini 전용 설정
    geminiThinkEnabled: true,
    geminiThinkLevel: 'high',
    geminiNumCtx: 32768,
    geminiEmbeddingModel: 'gemini-3-flash-preview:cloud',
    geminiWebSearchEnabled: true,
};
function parseEnvFile(filePath) {
    const env = {};
    if (!fs.existsSync(filePath)) {
        return env;
    }
    const content = fs.readFileSync(filePath, 'utf-8');
    const lines = content.split('\n');
    for (const line of lines) {
        const trimmed = line.trim();
        // 빈 줄이나 주석 건너뛰기
        if (!trimmed || trimmed.startsWith('#')) {
            continue;
        }
        const equalIndex = trimmed.indexOf('=');
        if (equalIndex > 0) {
            const key = trimmed.substring(0, equalIndex).trim();
            const value = trimmed.substring(equalIndex + 1).trim();
            env[key] = value;
        }
    }
    return env;
}
function parseLogLevel(value) {
    const level = (value || '').toLowerCase();
    if (level === 'debug' || level === 'info' || level === 'warn' || level === 'error') {
        return level;
    }
    return DEFAULT_CONFIG.logLevel;
}
/**
 * 필수 환경 변수 검증
 * 런타임 시작 전에 호출하여 설정 오류를 조기에 발견
 */
function validateConfig(config) {
    const errors = [];
    // URL 검증
    if (!config.ollamaBaseUrl || !config.ollamaBaseUrl.startsWith('http')) {
        errors.push(`Invalid OLLAMA_BASE_URL: ${config.ollamaBaseUrl}`);
    }
    // 모델 이름 검증
    if (!config.ollamaDefaultModel || config.ollamaDefaultModel.trim() === '') {
        errors.push('OLLAMA_DEFAULT_MODEL is required');
    }
    // 타임아웃 검증
    if (config.ollamaTimeout <= 0 || config.ollamaTimeout > 600000) {
        errors.push(`Invalid OLLAMA_TIMEOUT: ${config.ollamaTimeout} (must be between 1-600000ms)`);
    }
    if (errors.length > 0) {
        throw new Error(`Configuration validation failed:\n${errors.join('\n')}`);
    }
}
function loadConfig() {
    // 프로젝트 루트에서 .env 파일 찾기
    const envPath = path.resolve(process.cwd(), '.env');
    const projectEnvPath = path.resolve(__dirname, '../../.env');
    // 환경변수 우선순위: process.env > .env 파일 > 기본값
    const fileEnv = parseEnvFile(fs.existsSync(envPath) ? envPath : projectEnvPath);
    return {
        ollamaBaseUrl: process.env.OLLAMA_BASE_URL || fileEnv.OLLAMA_BASE_URL || DEFAULT_CONFIG.ollamaBaseUrl,
        ollamaDefaultModel: process.env.OLLAMA_DEFAULT_MODEL || fileEnv.OLLAMA_DEFAULT_MODEL || DEFAULT_CONFIG.ollamaDefaultModel,
        ollamaKoreanModel: process.env.OLLAMA_KOREAN_MODEL || fileEnv.OLLAMA_KOREAN_MODEL || DEFAULT_CONFIG.ollamaKoreanModel,
        ollamaTimeout: parseInt(process.env.OLLAMA_TIMEOUT || fileEnv.OLLAMA_TIMEOUT || String(DEFAULT_CONFIG.ollamaTimeout), 10),
        logLevel: parseLogLevel(process.env.LOG_LEVEL || fileEnv.LOG_LEVEL),
        // Gemini 전용 설정
        geminiThinkEnabled: (process.env.GEMINI_THINK_ENABLED || fileEnv.GEMINI_THINK_ENABLED || 'true') === 'true',
        geminiThinkLevel: (process.env.GEMINI_THINK_LEVEL || fileEnv.GEMINI_THINK_LEVEL || 'high'),
        geminiNumCtx: parseInt(process.env.GEMINI_NUM_CTX || fileEnv.GEMINI_NUM_CTX || '32768', 10),
        geminiEmbeddingModel: process.env.GEMINI_EMBEDDING_MODEL || fileEnv.GEMINI_EMBEDDING_MODEL || 'gemini-3-flash-preview:cloud',
        geminiWebSearchEnabled: (process.env.GEMINI_WEB_SEARCH_ENABLED || fileEnv.GEMINI_WEB_SEARCH_ENABLED || 'true') === 'true'
    };
}
// 싱글톤 설정 인스턴스
let cachedConfig = null;
function getConfig() {
    if (!cachedConfig) {
        cachedConfig = loadConfig();
        // 설정 검증
        validateConfig(cachedConfig);
    }
    return cachedConfig;
}
function resetConfig() {
    cachedConfig = null;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL2NvbmZpZy9lbnYudHMiLCJtYXBwaW5ncyI6Ijs7QUEwRUEsd0NBcUJDO0FBRUQsZ0NBMEJDO0FBS0QsOEJBT0M7QUFFRCxrQ0FFQztBQTNJRCxXQUFXO0FBQ1gseUJBQXlCO0FBQ3pCLDZCQUE2QjtBQWlCN0IsTUFBTSxjQUFjLEdBQWM7SUFDOUIsYUFBYSxFQUFFLHdCQUF3QjtJQUN2QyxrQkFBa0IsRUFBRSw4QkFBOEI7SUFDbEQsaUJBQWlCLEVBQUUsOEJBQThCO0lBQ2pELGFBQWEsRUFBRSxNQUFNO0lBQ3JCLFFBQVEsRUFBRSxNQUFNO0lBQ2hCLGVBQWU7SUFDZixrQkFBa0IsRUFBRSxJQUFJO0lBQ3hCLGdCQUFnQixFQUFFLE1BQWU7SUFDakMsWUFBWSxFQUFFLEtBQUs7SUFDbkIsb0JBQW9CLEVBQUUsOEJBQThCO0lBQ3BELHNCQUFzQixFQUFFLElBQUk7Q0FDL0IsQ0FBQztBQUVGLFNBQVMsWUFBWSxDQUFDLFFBQWdCO0lBQ2xDLE1BQU0sR0FBRyxHQUEyQixFQUFFLENBQUM7SUFFdkMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztRQUMzQixPQUFPLEdBQUcsQ0FBQztJQUNmLENBQUM7SUFFRCxNQUFNLE9BQU8sR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNuRCxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRWxDLEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxFQUFFLENBQUM7UUFDdkIsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBRTVCLGdCQUFnQjtRQUNoQixJQUFJLENBQUMsT0FBTyxJQUFJLE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUN0QyxTQUFTO1FBQ2IsQ0FBQztRQUVELE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDeEMsSUFBSSxVQUFVLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDakIsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsVUFBVSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDcEQsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDdkQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUNyQixDQUFDO0lBQ0wsQ0FBQztJQUVELE9BQU8sR0FBRyxDQUFDO0FBQ2YsQ0FBQztBQUVELFNBQVMsYUFBYSxDQUFDLEtBQXlCO0lBQzVDLE1BQU0sS0FBSyxHQUFHLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQzFDLElBQUksS0FBSyxLQUFLLE9BQU8sSUFBSSxLQUFLLEtBQUssTUFBTSxJQUFJLEtBQUssS0FBSyxNQUFNLElBQUksS0FBSyxLQUFLLE9BQU8sRUFBRSxDQUFDO1FBQ2pGLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFDRCxPQUFPLGNBQWMsQ0FBQyxRQUFRLENBQUM7QUFDbkMsQ0FBQztBQUVEOzs7R0FHRztBQUNILFNBQWdCLGNBQWMsQ0FBQyxNQUFpQjtJQUM1QyxNQUFNLE1BQU0sR0FBYSxFQUFFLENBQUM7SUFFNUIsU0FBUztJQUNULElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUNwRSxNQUFNLENBQUMsSUFBSSxDQUFDLDRCQUE0QixNQUFNLENBQUMsYUFBYSxFQUFFLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRUQsV0FBVztJQUNYLElBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLElBQUksTUFBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDO1FBQ3hFLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0NBQWtDLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRUQsVUFBVTtJQUNWLElBQUksTUFBTSxDQUFDLGFBQWEsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLGFBQWEsR0FBRyxNQUFNLEVBQUUsQ0FBQztRQUM3RCxNQUFNLENBQUMsSUFBSSxDQUFDLDJCQUEyQixNQUFNLENBQUMsYUFBYSwrQkFBK0IsQ0FBQyxDQUFDO0lBQ2hHLENBQUM7SUFFRCxJQUFJLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDcEIsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQ0FBcUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDOUUsQ0FBQztBQUNMLENBQUM7QUFFRCxTQUFnQixVQUFVO0lBQ3RCLHVCQUF1QjtJQUN2QixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNwRCxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsQ0FBQztJQUU3RCx5Q0FBeUM7SUFDekMsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUM7SUFFaEYsT0FBTztRQUNILGFBQWEsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsSUFBSSxPQUFPLENBQUMsZUFBZSxJQUFJLGNBQWMsQ0FBQyxhQUFhO1FBQ3JHLGtCQUFrQixFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLElBQUksT0FBTyxDQUFDLG9CQUFvQixJQUFJLGNBQWMsQ0FBQyxrQkFBa0I7UUFDekgsaUJBQWlCLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsSUFBSSxPQUFPLENBQUMsbUJBQW1CLElBQUksY0FBYyxDQUFDLGlCQUFpQjtRQUNySCxhQUFhLEVBQUUsUUFBUSxDQUNuQixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsSUFBSSxPQUFPLENBQUMsY0FBYyxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLEVBQzVGLEVBQUUsQ0FDTDtRQUNELFFBQVEsRUFBRSxhQUFhLENBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQzdDO1FBQ0QsZUFBZTtRQUNmLGtCQUFrQixFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsSUFBSSxPQUFPLENBQUMsb0JBQW9CLElBQUksTUFBTSxDQUFDLEtBQUssTUFBTTtRQUMzRyxnQkFBZ0IsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLElBQUksT0FBTyxDQUFDLGtCQUFrQixJQUFJLE1BQU0sQ0FBOEI7UUFDdkgsWUFBWSxFQUFFLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsSUFBSSxPQUFPLENBQUMsY0FBYyxJQUFJLE9BQU8sRUFBRSxFQUFFLENBQUM7UUFDM0Ysb0JBQW9CLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsSUFBSSxPQUFPLENBQUMsc0JBQXNCLElBQUksOEJBQThCO1FBQzVILHNCQUFzQixFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5QkFBeUIsSUFBSSxPQUFPLENBQUMseUJBQXlCLElBQUksTUFBTSxDQUFDLEtBQUssTUFBTTtLQUM1SCxDQUFDO0FBQ04sQ0FBQztBQUVELGNBQWM7QUFDZCxJQUFJLFlBQVksR0FBcUIsSUFBSSxDQUFDO0FBRTFDLFNBQWdCLFNBQVM7SUFDckIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ2hCLFlBQVksR0FBRyxVQUFVLEVBQUUsQ0FBQztRQUM1QixRQUFRO1FBQ1IsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFDRCxPQUFPLFlBQVksQ0FBQztBQUN4QixDQUFDO0FBRUQsU0FBZ0IsV0FBVztJQUN2QixZQUFZLEdBQUcsSUFBSSxDQUFDO0FBQ3hCLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL2NvbmZpZy9lbnYudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8g7ZmY6rK9IOyEpOyglSDroZzrjZRcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRW52Q29uZmlnIHtcbiAgICBvbGxhbWFCYXNlVXJsOiBzdHJpbmc7XG4gICAgb2xsYW1hRGVmYXVsdE1vZGVsOiBzdHJpbmc7XG4gICAgb2xsYW1hS29yZWFuTW9kZWw6IHN0cmluZzsgIC8vIO2VnOq1reyWtCDtirntmZQg66qo6424XG4gICAgb2xsYW1hVGltZW91dDogbnVtYmVyO1xuICAgIC8vIOuhnOq3uCDroIjrsqhcbiAgICBsb2dMZXZlbDogJ2RlYnVnJyB8ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcic7XG4gICAgLy8gR2VtaW5pIOyghOyaqSDshKTsoJVcbiAgICBnZW1pbmlUaGlua0VuYWJsZWQ6IGJvb2xlYW47XG4gICAgZ2VtaW5pVGhpbmtMZXZlbDogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJztcbiAgICBnZW1pbmlOdW1DdHg6IG51bWJlcjtcbiAgICBnZW1pbmlFbWJlZGRpbmdNb2RlbDogc3RyaW5nO1xuICAgIGdlbWluaVdlYlNlYXJjaEVuYWJsZWQ6IGJvb2xlYW47XG59XG5cbmNvbnN0IERFRkFVTFRfQ09ORklHOiBFbnZDb25maWcgPSB7XG4gICAgb2xsYW1hQmFzZVVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MTE0MzQnLFxuICAgIG9sbGFtYURlZmF1bHRNb2RlbDogJ2dlbWluaS0zLWZsYXNoLXByZXZpZXc6Y2xvdWQnLFxuICAgIG9sbGFtYUtvcmVhbk1vZGVsOiAnZ2VtaW5pLTMtZmxhc2gtcHJldmlldzpjbG91ZCcsXG4gICAgb2xsYW1hVGltZW91dDogMTIwMDAwLFxuICAgIGxvZ0xldmVsOiAnaW5mbycsXG4gICAgLy8gR2VtaW5pIOyghOyaqSDshKTsoJVcbiAgICBnZW1pbmlUaGlua0VuYWJsZWQ6IHRydWUsXG4gICAgZ2VtaW5pVGhpbmtMZXZlbDogJ2hpZ2gnIGFzIGNvbnN0LFxuICAgIGdlbWluaU51bUN0eDogMzI3NjgsXG4gICAgZ2VtaW5pRW1iZWRkaW5nTW9kZWw6ICdnZW1pbmktMy1mbGFzaC1wcmV2aWV3OmNsb3VkJyxcbiAgICBnZW1pbmlXZWJTZWFyY2hFbmFibGVkOiB0cnVlLFxufTtcblxuZnVuY3Rpb24gcGFyc2VFbnZGaWxlKGZpbGVQYXRoOiBzdHJpbmcpOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHtcbiAgICBjb25zdCBlbnY6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcblxuICAgIGlmICghZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHtcbiAgICAgICAgcmV0dXJuIGVudjtcbiAgICB9XG5cbiAgICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoLCAndXRmLTgnKTtcbiAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpO1xuXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgIGNvbnN0IHRyaW1tZWQgPSBsaW5lLnRyaW0oKTtcblxuICAgICAgICAvLyDruYgg7KSE7J2064KYIOyjvOyEnSDqsbTrhIjrm7DquLBcbiAgICAgICAgaWYgKCF0cmltbWVkIHx8IHRyaW1tZWQuc3RhcnRzV2l0aCgnIycpKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGVxdWFsSW5kZXggPSB0cmltbWVkLmluZGV4T2YoJz0nKTtcbiAgICAgICAgaWYgKGVxdWFsSW5kZXggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSB0cmltbWVkLnN1YnN0cmluZygwLCBlcXVhbEluZGV4KS50cmltKCk7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRyaW1tZWQuc3Vic3RyaW5nKGVxdWFsSW5kZXggKyAxKS50cmltKCk7XG4gICAgICAgICAgICBlbnZba2V5XSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVudjtcbn1cblxuZnVuY3Rpb24gcGFyc2VMb2dMZXZlbCh2YWx1ZTogc3RyaW5nIHwgdW5kZWZpbmVkKTogJ2RlYnVnJyB8ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcicge1xuICAgIGNvbnN0IGxldmVsID0gKHZhbHVlIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChsZXZlbCA9PT0gJ2RlYnVnJyB8fCBsZXZlbCA9PT0gJ2luZm8nIHx8IGxldmVsID09PSAnd2FybicgfHwgbGV2ZWwgPT09ICdlcnJvcicpIHtcbiAgICAgICAgcmV0dXJuIGxldmVsO1xuICAgIH1cbiAgICByZXR1cm4gREVGQVVMVF9DT05GSUcubG9nTGV2ZWw7XG59XG5cbi8qKlxuICog7ZWE7IiYIO2ZmOqyvSDrs4DsiJgg6rKA7KadXG4gKiDrn7Dtg4DsnoQg7Iuc7J6RIOyghOyXkCDtmLjstpztlZjsl6wg7ISk7KCVIOyYpOulmOulvCDsobDquLDsl5Ag67Cc6rKsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUNvbmZpZyhjb25maWc6IEVudkNvbmZpZyk6IHZvaWQge1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIFVSTCDqsoDspp1cbiAgICBpZiAoIWNvbmZpZy5vbGxhbWFCYXNlVXJsIHx8ICFjb25maWcub2xsYW1hQmFzZVVybC5zdGFydHNXaXRoKCdodHRwJykpIHtcbiAgICAgICAgZXJyb3JzLnB1c2goYEludmFsaWQgT0xMQU1BX0JBU0VfVVJMOiAke2NvbmZpZy5vbGxhbWFCYXNlVXJsfWApO1xuICAgIH1cblxuICAgIC8vIOuqqOuNuCDsnbTrpoQg6rKA7KadXG4gICAgaWYgKCFjb25maWcub2xsYW1hRGVmYXVsdE1vZGVsIHx8IGNvbmZpZy5vbGxhbWFEZWZhdWx0TW9kZWwudHJpbSgpID09PSAnJykge1xuICAgICAgICBlcnJvcnMucHVzaCgnT0xMQU1BX0RFRkFVTFRfTU9ERUwgaXMgcmVxdWlyZWQnKTtcbiAgICB9XG5cbiAgICAvLyDtg4DsnoTslYTsm4Mg6rKA7KadXG4gICAgaWYgKGNvbmZpZy5vbGxhbWFUaW1lb3V0IDw9IDAgfHwgY29uZmlnLm9sbGFtYVRpbWVvdXQgPiA2MDAwMDApIHtcbiAgICAgICAgZXJyb3JzLnB1c2goYEludmFsaWQgT0xMQU1BX1RJTUVPVVQ6ICR7Y29uZmlnLm9sbGFtYVRpbWVvdXR9IChtdXN0IGJlIGJldHdlZW4gMS02MDAwMDBtcylgKTtcbiAgICB9XG5cbiAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb25maWd1cmF0aW9uIHZhbGlkYXRpb24gZmFpbGVkOlxcbiR7ZXJyb3JzLmpvaW4oJ1xcbicpfWApO1xuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRDb25maWcoKTogRW52Q29uZmlnIHtcbiAgICAvLyDtlITroZzsoJ3tirgg66Oo7Yq47JeQ7IScIC5lbnYg7YyM7J28IOywvuq4sFxuICAgIGNvbnN0IGVudlBhdGggPSBwYXRoLnJlc29sdmUocHJvY2Vzcy5jd2QoKSwgJy5lbnYnKTtcbiAgICBjb25zdCBwcm9qZWN0RW52UGF0aCA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi8uLi8uZW52Jyk7XG5cbiAgICAvLyDtmZjqsr3rs4DsiJgg7Jqw7ISg7Iic7JyEOiBwcm9jZXNzLmVudiA+IC5lbnYg7YyM7J28ID4g6riw67O46rCSXG4gICAgY29uc3QgZmlsZUVudiA9IHBhcnNlRW52RmlsZShmcy5leGlzdHNTeW5jKGVudlBhdGgpID8gZW52UGF0aCA6IHByb2plY3RFbnZQYXRoKTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIG9sbGFtYUJhc2VVcmw6IHByb2Nlc3MuZW52Lk9MTEFNQV9CQVNFX1VSTCB8fCBmaWxlRW52Lk9MTEFNQV9CQVNFX1VSTCB8fCBERUZBVUxUX0NPTkZJRy5vbGxhbWFCYXNlVXJsLFxuICAgICAgICBvbGxhbWFEZWZhdWx0TW9kZWw6IHByb2Nlc3MuZW52Lk9MTEFNQV9ERUZBVUxUX01PREVMIHx8IGZpbGVFbnYuT0xMQU1BX0RFRkFVTFRfTU9ERUwgfHwgREVGQVVMVF9DT05GSUcub2xsYW1hRGVmYXVsdE1vZGVsLFxuICAgICAgICBvbGxhbWFLb3JlYW5Nb2RlbDogcHJvY2Vzcy5lbnYuT0xMQU1BX0tPUkVBTl9NT0RFTCB8fCBmaWxlRW52Lk9MTEFNQV9LT1JFQU5fTU9ERUwgfHwgREVGQVVMVF9DT05GSUcub2xsYW1hS29yZWFuTW9kZWwsXG4gICAgICAgIG9sbGFtYVRpbWVvdXQ6IHBhcnNlSW50KFxuICAgICAgICAgICAgcHJvY2Vzcy5lbnYuT0xMQU1BX1RJTUVPVVQgfHwgZmlsZUVudi5PTExBTUFfVElNRU9VVCB8fCBTdHJpbmcoREVGQVVMVF9DT05GSUcub2xsYW1hVGltZW91dCksXG4gICAgICAgICAgICAxMFxuICAgICAgICApLFxuICAgICAgICBsb2dMZXZlbDogcGFyc2VMb2dMZXZlbChcbiAgICAgICAgICAgIHByb2Nlc3MuZW52LkxPR19MRVZFTCB8fCBmaWxlRW52LkxPR19MRVZFTFxuICAgICAgICApLFxuICAgICAgICAvLyBHZW1pbmkg7KCE7JqpIOyEpOyglVxuICAgICAgICBnZW1pbmlUaGlua0VuYWJsZWQ6IChwcm9jZXNzLmVudi5HRU1JTklfVEhJTktfRU5BQkxFRCB8fCBmaWxlRW52LkdFTUlOSV9USElOS19FTkFCTEVEIHx8ICd0cnVlJykgPT09ICd0cnVlJyxcbiAgICAgICAgZ2VtaW5pVGhpbmtMZXZlbDogKHByb2Nlc3MuZW52LkdFTUlOSV9USElOS19MRVZFTCB8fCBmaWxlRW52LkdFTUlOSV9USElOS19MRVZFTCB8fCAnaGlnaCcpIGFzICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcsXG4gICAgICAgIGdlbWluaU51bUN0eDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuR0VNSU5JX05VTV9DVFggfHwgZmlsZUVudi5HRU1JTklfTlVNX0NUWCB8fCAnMzI3NjgnLCAxMCksXG4gICAgICAgIGdlbWluaUVtYmVkZGluZ01vZGVsOiBwcm9jZXNzLmVudi5HRU1JTklfRU1CRURESU5HX01PREVMIHx8IGZpbGVFbnYuR0VNSU5JX0VNQkVERElOR19NT0RFTCB8fCAnZ2VtaW5pLTMtZmxhc2gtcHJldmlldzpjbG91ZCcsXG4gICAgICAgIGdlbWluaVdlYlNlYXJjaEVuYWJsZWQ6IChwcm9jZXNzLmVudi5HRU1JTklfV0VCX1NFQVJDSF9FTkFCTEVEIHx8IGZpbGVFbnYuR0VNSU5JX1dFQl9TRUFSQ0hfRU5BQkxFRCB8fCAndHJ1ZScpID09PSAndHJ1ZSdcbiAgICB9O1xufVxuXG4vLyDsi7HquIDthqQg7ISk7KCVIOyduOyKpO2EtOyKpFxubGV0IGNhY2hlZENvbmZpZzogRW52Q29uZmlnIHwgbnVsbCA9IG51bGw7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb25maWcoKTogRW52Q29uZmlnIHtcbiAgICBpZiAoIWNhY2hlZENvbmZpZykge1xuICAgICAgICBjYWNoZWRDb25maWcgPSBsb2FkQ29uZmlnKCk7XG4gICAgICAgIC8vIOyEpOyglSDqsoDspp1cbiAgICAgICAgdmFsaWRhdGVDb25maWcoY2FjaGVkQ29uZmlnKTtcbiAgICB9XG4gICAgcmV0dXJuIGNhY2hlZENvbmZpZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0Q29uZmlnKCk6IHZvaWQge1xuICAgIGNhY2hlZENvbmZpZyA9IG51bGw7XG59XG4iXSwidmVyc2lvbiI6M30=