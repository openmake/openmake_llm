{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/chat-service-behavioral.test.ts","mappings":";;AAAA,uCAAgD;AAiBhD;;;;;;;;GAQG;AAEH;;;GAGG;AACH,SAAS,eAAe,CAAC,QAAqC,EAAE,YAAuB;IACnF,6BAA6B;IAC7B,IAAI,QAAQ,KAAK,OAAO,EAAE,CAAC;QACvB,OAAO,YAAY,CAAC;IACxB,CAAC;IAED,6CAA6C;IAC7C,IAAI,YAAY,EAAE,CAAC;QACf,OAAO,YAAY,CAAC;IACxB,CAAC;IAED,kBAAkB;IAClB,OAAO,MAAM,CAAC;AAClB,CAAC;AAED,IAAA,mBAAQ,EAAC,8BAA8B,EAAE,GAAG,EAAE;IAC1C,IAAA,mBAAQ,EAAC,uBAAuB,EAAE,GAAG,EAAE;QACnC,IAAA,aAAE,EAAC,4CAA4C,EAAE,GAAG,EAAE;YAClD,MAAM,MAAM,GAAG,eAAe,CAAC,OAAO,CAAC,CAAC;YACxC,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,+CAA+C,EAAE,GAAG,EAAE;YACrD,MAAM,MAAM,GAAG,eAAe,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;YAChD,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,8CAA8C,EAAE,GAAG,EAAE;YACpD,MAAM,MAAM,GAAG,eAAe,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;YAC/C,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,qDAAqD,EAAE,GAAG,EAAE;YAC3D,MAAM,MAAM,GAAG,eAAe,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;YACtD,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,sDAAsD,EAAE,GAAG,EAAE;YAC5D,MAAM,MAAM,GAAG,eAAe,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;YAC/C,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,oDAAoD,EAAE,GAAG,EAAE;YAC1D,MAAM,MAAM,GAAG,eAAe,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;YAC9C,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC/B,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,kEAAkE,EAAE,GAAG,EAAE;YACxE,MAAM,MAAM,GAAG,eAAe,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;YACrD,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,wDAAwD,EAAE,GAAG,EAAE;YAC9D,MAAM,MAAM,GAAG,eAAe,CAAC,MAAM,CAAC,CAAC;YACvC,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,mCAAmC,EAAE,GAAG,EAAE;YACzC,MAAM,MAAM,GAAG,eAAe,CAAC,OAAO,CAAC,CAAC;YACxC,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,wDAAwD,EAAE,GAAG,EAAE;YAC9D,MAAM,MAAM,GAAG,eAAe,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;YAC/C,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC/B,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,uCAAuC,EAAE,GAAG,EAAE;YAC7C,MAAM,MAAM,GAAG,eAAe,CAAC,SAAS,CAAC,CAAC;YAC1C,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,4DAA4D,EAAE,GAAG,EAAE;YAClE,MAAM,MAAM,GAAG,eAAe,CAAC,SAAS,EAAE,YAAY,CAAC,CAAC;YACxD,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,8DAA8D,EAAE,GAAG,EAAE;YACpE,MAAM,MAAM,GAAG,eAAe,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;YAClD,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,yCAAyC,EAAE,GAAG,EAAE;QACrD,IAAA,aAAE,EAAC,6CAA6C,EAAE,GAAG,EAAE;YACnD,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,OAAO;aACnB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAClC,IAAA,iBAAM,EAAC,GAAG,CAAC,OAAO,CAAC,CAAC,aAAa,EAAE,CAAC;YACpC,IAAA,iBAAM,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,aAAa,EAAE,CAAC;QACvC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,oCAAoC,EAAE,GAAG,EAAE;;YAC1C,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,OAAO;gBAChB,OAAO,EAAE;oBACL,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE;oBAC/B,EAAE,IAAI,EAAE,WAAW,EAAE,OAAO,EAAE,QAAQ,EAAE;iBAC3C;aACJ,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAClC,IAAA,iBAAM,EAAC,GAAG,CAAC,OAAO,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACpC,IAAA,iBAAM,EAAC,MAAA,GAAG,CAAC,OAAO,0CAAG,CAAC,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC/C,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,yCAAyC,EAAE,GAAG,EAAE;YAC/C,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,OAAO;gBAChB,MAAM,EAAE,UAAU;gBAClB,QAAQ,EAAE,MAAM;gBAChB,QAAQ,EAAE,KAAK;aAClB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACpC,IAAA,iBAAM,EAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAClC,IAAA,iBAAM,EAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,uCAAuC,EAAE,GAAG,EAAE;YAC7C,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,eAAe;gBACxB,QAAQ,EAAE,OAAO;aACpB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,uCAAuC,EAAE,GAAG,EAAE;YAC7C,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,eAAe;gBACxB,QAAQ,EAAE,OAAO;aACpB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,4CAA4C,EAAE,GAAG,EAAE;YAClD,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,oBAAoB;gBAC7B,cAAc,EAAE,IAAI;aACvB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC1C,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,0CAA0C,EAAE,GAAG,EAAE;YAChD,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,kBAAkB;gBAC3B,YAAY,EAAE,IAAI;gBAClB,aAAa,EAAE,MAAM;aACxB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACpC,IAAA,iBAAM,EAAC,GAAG,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,+CAA+C,EAAE,GAAG,EAAE;YACrD,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,eAAe;gBACxB,YAAY,EAAE,IAAI;gBAClB,aAAa,EAAE,KAAK;aACvB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC1C,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,kDAAkD,EAAE,GAAG,EAAE;YACxD,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,gBAAgB;gBACzB,YAAY,EAAE,IAAI;gBAClB,aAAa,EAAE,QAAQ;aAC1B,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,mCAAmC,EAAE,GAAG,EAAE;;YACzC,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,oBAAoB;gBAC7B,MAAM,EAAE,CAAC,8BAA8B,CAAC;aAC3C,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACnC,IAAA,iBAAM,EAAC,MAAA,GAAG,CAAC,MAAM,0CAAG,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;QACpD,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,+CAA+C,EAAE,GAAG,EAAE;YACrD,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,wBAAwB;gBACjC,KAAK,EAAE,SAAS;aACnB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,+CAA+C,EAAE,GAAG,EAAE;YACrD,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,0BAA0B;gBACnC,gBAAgB,EAAE,gCAAgC;aACrD,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,gCAAgC,CAAC,CAAC;QACxE,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,yCAAyC,EAAE,GAAG,EAAE;YAC/C,MAAM,UAAU,GAAG,IAAI,eAAe,EAAE,CAAC;YACzC,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,mBAAmB;gBAC5B,WAAW,EAAE,UAAU,CAAC,MAAM;aACjC,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACpD,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,6CAA6C,EAAE,GAAG,EAAE;YACnD,MAAM,GAAG,GAAuB;gBAC5B,OAAO,EAAE,iBAAiB;gBAC1B,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,CAAC;gBAChD,KAAK,EAAE,SAAS;gBAChB,MAAM,EAAE,CAAC,2BAA2B,CAAC;gBACrC,gBAAgB,EAAE,gBAAgB;gBAClC,cAAc,EAAE,IAAI;gBACpB,YAAY,EAAE,IAAI;gBAClB,aAAa,EAAE,MAAM;gBACrB,MAAM,EAAE,UAAU;gBAClB,QAAQ,EAAE,OAAO;gBACjB,QAAQ,EAAE,YAAY;aACzB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAC5C,IAAA,iBAAM,EAAC,GAAG,CAAC,OAAO,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACpC,IAAA,iBAAM,EAAC,GAAG,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAClC,IAAA,iBAAM,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACnC,IAAA,iBAAM,EAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACpD,IAAA,iBAAM,EAAC,GAAG,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACtC,IAAA,iBAAM,EAAC,GAAG,CAAC,YAAY,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACpC,IAAA,iBAAM,EAAC,GAAG,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACvC,IAAA,iBAAM,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACpC,IAAA,iBAAM,EAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACnC,IAAA,iBAAM,EAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,yCAAyC,EAAE,GAAG,EAAE;QACrD,IAAA,aAAE,EAAC,4BAA4B,EAAE,GAAG,EAAE;YAClC,MAAM,GAAG,GAAuB;gBAC5B,IAAI,EAAE,MAAM;gBACZ,OAAO,EAAE,OAAO;aACnB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC9B,IAAA,iBAAM,EAAC,GAAG,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,iCAAiC,EAAE,GAAG,EAAE;YACvC,MAAM,GAAG,GAAuB;gBAC5B,IAAI,EAAE,WAAW;gBACjB,OAAO,EAAE,WAAW;aACvB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YACnC,IAAA,iBAAM,EAAC,GAAG,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAC1C,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,8BAA8B,EAAE,GAAG,EAAE;YACpC,MAAM,GAAG,GAAuB;gBAC5B,IAAI,EAAE,QAAQ;gBACd,OAAO,EAAE,6BAA6B;aACzC,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAChC,IAAA,iBAAM,EAAC,GAAG,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC;QAC5D,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,4BAA4B,EAAE,GAAG,EAAE;YAClC,MAAM,GAAG,GAAuB;gBAC5B,IAAI,EAAE,MAAM;gBACZ,OAAO,EAAE,aAAa;aACzB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC9B,IAAA,iBAAM,EAAC,GAAG,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,mCAAmC,EAAE,GAAG,EAAE;;YACzC,MAAM,GAAG,GAAuB;gBAC5B,IAAI,EAAE,MAAM;gBACZ,OAAO,EAAE,cAAc;gBACvB,MAAM,EAAE,CAAC,2BAA2B,CAAC;aACxC,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACnC,IAAA,iBAAM,EAAC,MAAA,GAAG,CAAC,MAAM,0CAAG,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;QACpD,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,uCAAuC,EAAE,GAAG,EAAE;;YAC7C,MAAM,GAAG,GAAuB;gBAC5B,IAAI,EAAE,WAAW;gBACjB,OAAO,EAAE,cAAc;gBACvB,UAAU,EAAE;oBACR;wBACI,IAAI,EAAE,UAAU;wBAChB,QAAQ,EAAE;4BACN,IAAI,EAAE,QAAQ;4BACd,SAAS,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE;yBAC/B;qBACJ;iBACJ;aACJ,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,UAAU,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACvC,IAAA,iBAAM,EAAC,MAAA,GAAG,CAAC,UAAU,0CAAG,CAAC,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC7D,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,kDAAkD,EAAE,GAAG,EAAE;;YACxD,MAAM,GAAG,GAAuB;gBAC5B,IAAI,EAAE,WAAW;gBACjB,OAAO,EAAE,cAAc;gBACvB,UAAU,EAAE;oBACR;wBACI,QAAQ,EAAE;4BACN,IAAI,EAAE,QAAQ;4BACd,SAAS,EAAE,kBAAkB;yBAChC;qBACJ;iBACJ;aACJ,CAAC;YACF,IAAA,iBAAM,EAAC,MAAA,GAAG,CAAC,UAAU,0CAAG,CAAC,EAAE,QAAQ,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QAC5E,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,6CAA6C,EAAE,GAAG,EAAE;YACnD,MAAM,GAAG,GAAuB;gBAC5B,IAAI,EAAE,MAAM;gBACZ,OAAO,EAAE,SAAS;gBAClB,WAAW,EAAE,cAAc;gBAC3B,SAAS,EAAE,UAAU;aACxB,CAAC;YACF,IAAA,iBAAM,EAAC,GAAG,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAC7C,IAAA,iBAAM,EAAC,GAAG,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,yCAAyC,EAAE,GAAG,EAAE;QACrD,IAAA,aAAE,EAAC,kCAAkC,EAAE,GAAG,EAAE;YACxC,MAAM,IAAI,GAAuB,EAAE,CAAC;YACpC,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,oCAAoC,EAAE,GAAG,EAAE;YAC1C,MAAM,IAAI,GAAuB;gBAC7B,IAAI,EAAE,UAAU;aACnB,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,oCAAoC,EAAE,GAAG,EAAE;YAC1C,MAAM,IAAI,GAAuB;gBAC7B,IAAI,EAAE,gBAAgB;aACzB,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,qCAAqC,EAAE,GAAG,EAAE;YAC3C,MAAM,IAAI,GAAuB;gBAC7B,KAAK,EAAE,IAAI;aACd,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,qCAAqC,EAAE,GAAG,EAAE;YAC3C,MAAM,IAAI,GAAuB;gBAC7B,KAAK,EAAE,UAAU;aACpB,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACxC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,sCAAsC,EAAE,GAAG,EAAE;YAC5C,MAAM,IAAI,GAAuB;gBAC7B,MAAM,EAAE,yBAAyB;aACpC,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;QACxD,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,0CAA0C,EAAE,GAAG,EAAE;YAChD,MAAM,IAAI,GAAuB;gBAC7B,UAAU,EAAE,IAAI;aACnB,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,wCAAwC,EAAE,GAAG,EAAE;YAC9C,MAAM,IAAI,GAAuB;gBAC7B,IAAI,EAAE,UAAU;gBAChB,IAAI,EAAE,gBAAgB;gBACtB,KAAK,EAAE,IAAI;gBACX,KAAK,EAAE,UAAU;gBACjB,MAAM,EAAE,wBAAwB;gBAChC,UAAU,EAAE,IAAI;aACnB,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACnC,IAAA,iBAAM,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACzC,IAAA,iBAAM,EAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC9B,IAAA,iBAAM,EAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACpC,IAAA,iBAAM,EAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;YACnD,IAAA,iBAAM,EAAC,IAAI,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,mCAAmC,EAAE,GAAG,EAAE;QAC/C,IAAA,aAAE,EAAC,uCAAuC,EAAE,GAAG,EAAE;YAC7C,MAAM,IAAI,GAAiB;gBACvB,QAAQ,EAAE;oBACN,IAAI,EAAE,QAAQ;oBACd,SAAS,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE;iBAC/B;aACJ,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC1C,IAAA,iBAAM,EAAC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACvD,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,mCAAmC,EAAE,GAAG,EAAE;YACzC,MAAM,IAAI,GAAiB;gBACvB,IAAI,EAAE,UAAU;gBAChB,QAAQ,EAAE;oBACN,IAAI,EAAE,QAAQ;oBACd,SAAS,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE;iBAC/B;aACJ,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACnC,IAAA,iBAAM,EAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC9C,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,gDAAgD,EAAE,GAAG,EAAE;YACtD,MAAM,IAAI,GAAiB;gBACvB,QAAQ,EAAE;oBACN,IAAI,EAAE,SAAS;oBACf,SAAS,EAAE;wBACP,IAAI,EAAE,QAAQ;wBACd,OAAO,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE;wBAC1C,IAAI,EAAE,CAAC,WAAW,EAAE,QAAQ,CAAC;qBAChC;iBACJ;aACJ,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACpD,MAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,OAAkC,CAAC;YAC3E,IAAA,iBAAM,EAAC,OAAO,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACnC,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAiB,CAAC;YACvD,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;QACjC,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,sCAAsC,EAAE,GAAG,EAAE;QAClD,IAAA,aAAE,EAAC,sDAAsD,EAAE,GAAG,EAAE;YAC5D,MAAM,MAAM,GAAoB;gBAC5B,KAAK,EAAE,eAAe;gBACtB,GAAG,EAAE,qBAAqB;aAC7B,CAAC;YACF,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;YAC3C,IAAA,iBAAM,EAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,8CAA8C,EAAE,GAAG,EAAE;YACpD,MAAM,MAAM,GAAoB;gBAC5B,KAAK,EAAE,eAAe;gBACtB,GAAG,EAAE,qBAAqB;gBAC1B,OAAO,EAAE,iCAAiC;aAC7C,CAAC;YACF,IAAA,iBAAM,EAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;QACnE,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,2CAA2C,EAAE,GAAG,EAAE;YACjD,MAAM,OAAO,GAAsB;gBAC/B;oBACI,KAAK,EAAE,UAAU;oBACjB,GAAG,EAAE,sBAAsB;oBAC3B,OAAO,EAAE,cAAc;iBAC1B;gBACD;oBACI,KAAK,EAAE,UAAU;oBACjB,GAAG,EAAE,sBAAsB;oBAC3B,OAAO,EAAE,eAAe;iBAC3B;aACJ,CAAC;YACF,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAChC,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC1C,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;QACxD,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,uCAAuC,EAAE,GAAG,EAAE;QACnD,IAAA,aAAE,EAAC,qCAAqC,EAAE,GAAG,EAAE;YAC3C,MAAM,IAAI,GAAqB,EAAE,CAAC;YAClC,IAAA,iBAAM,EAAC,IAAI,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,wCAAwC,EAAE,GAAG,EAAE;YAC9C,MAAM,IAAI,GAAqB;gBAC3B,KAAK,EAAE,QAAQ;aAClB,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACtC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,yCAAyC,EAAE,GAAG,EAAE;YAC/C,MAAM,IAAI,GAAqB;gBAC3B,MAAM,EAAE,GAAG;aACd,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,2CAA2C,EAAE,GAAG,EAAE;YACjD,MAAM,IAAI,GAAqB;gBAC3B,QAAQ,EAAE,IAAI;aACjB,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,gDAAgD,EAAE,GAAG,EAAE;YACtD,MAAM,IAAI,GAAqB;gBAC3B,KAAK,EAAE,OAAO;gBACd,MAAM,EAAE,GAAG;gBACX,QAAQ,EAAE,IAAI;gBACd,WAAW,EAAE,GAAG;gBAChB,IAAI,EAAE,GAAG;aACZ,CAAC;YACF,IAAA,iBAAM,EAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACjC,IAAA,iBAAM,EAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAC9B,IAAA,iBAAM,EAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACjC,IAAA,iBAAM,EAAC,IAAI,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACnC,IAAA,iBAAM,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,wCAAwC,EAAE,GAAG,EAAE;QACpD,IAAA,aAAE,EAAC,2CAA2C,EAAE,GAAG,EAAE;YACjD,MAAM,MAAM,GAAsB;gBAC9B,MAAM,EAAE,EAAS;gBACjB,KAAK,EAAE,QAAQ;aAClB,CAAC;YACF,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACpC,IAAA,iBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,CAAC;QACxC,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,iDAAiD,EAAE,GAAG,EAAE;YACvD,MAAM,MAAM,GAAG,CAAC,OAAO,EAAE,UAAU,EAAE,QAAQ,EAAE,SAAS,CAAC,CAAC;YAC1D,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,EAAE;gBACrB,MAAM,MAAM,GAAsB;oBAC9B,MAAM,EAAE,EAAS;oBACjB,KAAK;iBACR,CAAC;gBACF,IAAA,iBAAM,EAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACrC,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,IAAA,mBAAQ,EAAC,4BAA4B,EAAE,GAAG,EAAE;QACxC,IAAA,aAAE,EAAC,qDAAqD,EAAE,GAAG,EAAE;YAC3D,MAAM,KAAK,GAAe,CAAC,MAAM,EAAE,KAAK,EAAE,YAAY,CAAC,CAAC;YACxD,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE;gBACnB,MAAM,MAAM,GAAG,eAAe,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;gBAC9C,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACtC,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,oDAAoD,EAAE,GAAG,EAAE;YAC1D,MAAM,KAAK,GAAe,CAAC,MAAM,EAAE,KAAK,EAAE,YAAY,CAAC,CAAC;YACxD,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE;gBACnB,MAAM,MAAM,GAAG,eAAe,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;gBAC7C,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC9B,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,qDAAqD,EAAE,GAAG,EAAE;YAC3D,MAAM,KAAK,GAAe,CAAC,MAAM,EAAE,KAAK,EAAE,YAAY,CAAC,CAAC;YACxD,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE;gBACnB,MAAM,MAAM,GAAG,eAAe,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;gBAC9C,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC9B,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,yDAAyD,EAAE,GAAG,EAAE;YAC/D,MAAM,KAAK,GAAe,CAAC,MAAM,EAAE,KAAK,EAAE,YAAY,CAAC,CAAC;YACxD,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE;gBACnB,MAAM,MAAM,GAAG,eAAe,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;gBAChD,IAAA,iBAAM,EAAC,MAAM,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC9B,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;QAEH,IAAA,aAAE,EAAC,4CAA4C,EAAE,GAAG,EAAE;YAClD,MAAM,OAAO,GAAG,eAAe,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;YACjD,MAAM,OAAO,GAAG,eAAe,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;YAChD,MAAM,OAAO,GAAG,eAAe,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;YACvD,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC9B,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC9B,IAAA,iBAAM,EAAC,OAAO,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;AACP,CAAC,CAAC,CAAC","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/chat-service-behavioral.test.ts"],"sourcesContent":["import { describe, it, expect } from 'bun:test';\nimport type {\n    ChatMessageRequest,\n    ChatServiceConfig,\n    AgentSelectionInfo,\n    ToolCallInfo,\n    WebSearchResult,\n    ChatResponseMeta,\n    ChatHistoryMessage,\n} from '../services/ChatService';\n\n/**\n * UserTier type - mirrors the actual type from user-manager\n * 'free' | 'pro' | 'enterprise'\n */\ntype UserTier = 'free' | 'pro' | 'enterprise';\n\n/**\n * ============================================================\n * resolveUserTier Logic Tests\n * ============================================================\n * \n * Tests the core tier resolution algorithm used by ChatService.\n * Since resolveUserTier is a private method with deep dependencies,\n * we test the algorithm directly to verify the behavior pattern.\n */\n\n/**\n * Extracted resolveUserTier logic for testing\n * Mirrors: ChatService.resolveUserTier (lines 179-192)\n */\nfunction resolveUserTier(userRole?: 'admin' | 'user' | 'guest', explicitTier?: UserTier): UserTier {\n    // admin is always enterprise\n    if (userRole === 'admin') {\n        return 'enterprise';\n    }\n\n    // explicit tier takes precedence if provided\n    if (explicitTier) {\n        return explicitTier;\n    }\n\n    // default to free\n    return 'free';\n}\n\ndescribe('ChatService Behavioral Tests', () => {\n    describe('resolveUserTier logic', () => {\n        it('admin role should always return enterprise', () => {\n            const result = resolveUserTier('admin');\n            expect(result).toBe('enterprise');\n        });\n\n        it('admin role should override explicit free tier', () => {\n            const result = resolveUserTier('admin', 'free');\n            expect(result).toBe('enterprise');\n        });\n\n        it('admin role should override explicit pro tier', () => {\n            const result = resolveUserTier('admin', 'pro');\n            expect(result).toBe('enterprise');\n        });\n\n        it('admin role should override explicit enterprise tier', () => {\n            const result = resolveUserTier('admin', 'enterprise');\n            expect(result).toBe('enterprise');\n        });\n\n        it('user role with explicit free tier should return free', () => {\n            const result = resolveUserTier('user', 'free');\n            expect(result).toBe('free');\n        });\n\n        it('user role with explicit pro tier should return pro', () => {\n            const result = resolveUserTier('user', 'pro');\n            expect(result).toBe('pro');\n        });\n\n        it('user role with explicit enterprise tier should return enterprise', () => {\n            const result = resolveUserTier('user', 'enterprise');\n            expect(result).toBe('enterprise');\n        });\n\n        it('user role without explicit tier should default to free', () => {\n            const result = resolveUserTier('user');\n            expect(result).toBe('free');\n        });\n\n        it('guest role should default to free', () => {\n            const result = resolveUserTier('guest');\n            expect(result).toBe('free');\n        });\n\n        it('guest role with explicit tier should use explicit tier', () => {\n            const result = resolveUserTier('guest', 'pro');\n            expect(result).toBe('pro');\n        });\n\n        it('undefined role should default to free', () => {\n            const result = resolveUserTier(undefined);\n            expect(result).toBe('free');\n        });\n\n        it('undefined role with explicit tier should use explicit tier', () => {\n            const result = resolveUserTier(undefined, 'enterprise');\n            expect(result).toBe('enterprise');\n        });\n\n        it('null-like role (undefined) with free tier should return free', () => {\n            const result = resolveUserTier(undefined, 'free');\n            expect(result).toBe('free');\n        });\n    });\n\n    describe('ChatMessageRequest interface validation', () => {\n        it('should accept minimal valid message request', () => {\n            const req: ChatMessageRequest = {\n                message: 'Hello',\n            };\n            expect(req.message).toBe('Hello');\n            expect(req.history).toBeUndefined();\n            expect(req.userId).toBeUndefined();\n        });\n\n        it('should accept message with history', () => {\n            const req: ChatMessageRequest = {\n                message: 'Hello',\n                history: [\n                    { role: 'user', content: 'Hi' },\n                    { role: 'assistant', content: 'Hello!' },\n                ],\n            };\n            expect(req.message).toBe('Hello');\n            expect(req.history).toHaveLength(2);\n            expect(req.history?.[0].role).toBe('user');\n        });\n\n        it('should accept message with user context', () => {\n            const req: ChatMessageRequest = {\n                message: 'Hello',\n                userId: 'user-123',\n                userRole: 'user',\n                userTier: 'pro',\n            };\n            expect(req.userId).toBe('user-123');\n            expect(req.userRole).toBe('user');\n            expect(req.userTier).toBe('pro');\n        });\n\n        it('should accept message with admin role', () => {\n            const req: ChatMessageRequest = {\n                message: 'Admin command',\n                userRole: 'admin',\n            };\n            expect(req.userRole).toBe('admin');\n        });\n\n        it('should accept message with guest role', () => {\n            const req: ChatMessageRequest = {\n                message: 'Guest message',\n                userRole: 'guest',\n            };\n            expect(req.userRole).toBe('guest');\n        });\n\n        it('should accept message with discussion mode', () => {\n            const req: ChatMessageRequest = {\n                message: 'Discuss this topic',\n                discussionMode: true,\n            };\n            expect(req.discussionMode).toBe(true);\n        });\n\n        it('should accept message with thinking mode', () => {\n            const req: ChatMessageRequest = {\n                message: 'Think about this',\n                thinkingMode: true,\n                thinkingLevel: 'high',\n            };\n            expect(req.thinkingMode).toBe(true);\n            expect(req.thinkingLevel).toBe('high');\n        });\n\n        it('should accept message with low thinking level', () => {\n            const req: ChatMessageRequest = {\n                message: 'Quick thought',\n                thinkingMode: true,\n                thinkingLevel: 'low',\n            };\n            expect(req.thinkingLevel).toBe('low');\n        });\n\n        it('should accept message with medium thinking level', () => {\n            const req: ChatMessageRequest = {\n                message: 'Medium thought',\n                thinkingMode: true,\n                thinkingLevel: 'medium',\n            };\n            expect(req.thinkingLevel).toBe('medium');\n        });\n\n        it('should accept message with images', () => {\n            const req: ChatMessageRequest = {\n                message: 'Analyze this image',\n                images: ['data:image/png;base64,abc123'],\n            };\n            expect(req.images).toHaveLength(1);\n            expect(req.images?.[0]).toContain('data:image');\n        });\n\n        it('should accept message with document reference', () => {\n            const req: ChatMessageRequest = {\n                message: 'Summarize the document',\n                docId: 'doc-456',\n            };\n            expect(req.docId).toBe('doc-456');\n        });\n\n        it('should accept message with web search context', () => {\n            const req: ChatMessageRequest = {\n                message: 'What is the latest news?',\n                webSearchContext: 'Recent search results about AI',\n            };\n            expect(req.webSearchContext).toBe('Recent search results about AI');\n        });\n\n        it('should accept message with abort signal', () => {\n            const controller = new AbortController();\n            const req: ChatMessageRequest = {\n                message: 'Long running task',\n                abortSignal: controller.signal,\n            };\n            expect(req.abortSignal).toBe(controller.signal);\n        });\n\n        it('should accept comprehensive message request', () => {\n            const req: ChatMessageRequest = {\n                message: 'Complex request',\n                history: [{ role: 'user', content: 'Previous' }],\n                docId: 'doc-789',\n                images: ['data:image/png;base64,xyz'],\n                webSearchContext: 'Search results',\n                discussionMode: true,\n                thinkingMode: true,\n                thinkingLevel: 'high',\n                userId: 'user-999',\n                userRole: 'admin',\n                userTier: 'enterprise',\n            };\n            expect(req.message).toBe('Complex request');\n            expect(req.history).toHaveLength(1);\n            expect(req.docId).toBe('doc-789');\n            expect(req.images).toHaveLength(1);\n            expect(req.webSearchContext).toBe('Search results');\n            expect(req.discussionMode).toBe(true);\n            expect(req.thinkingMode).toBe(true);\n            expect(req.thinkingLevel).toBe('high');\n            expect(req.userId).toBe('user-999');\n            expect(req.userRole).toBe('admin');\n            expect(req.userTier).toBe('enterprise');\n        });\n    });\n\n    describe('ChatHistoryMessage interface validation', () => {\n        it('should accept user message', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'user',\n                content: 'Hello',\n            };\n            expect(msg.role).toBe('user');\n            expect(msg.content).toBe('Hello');\n        });\n\n        it('should accept assistant message', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'assistant',\n                content: 'Hi there!',\n            };\n            expect(msg.role).toBe('assistant');\n            expect(msg.content).toBe('Hi there!');\n        });\n\n        it('should accept system message', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'system',\n                content: 'You are a helpful assistant',\n            };\n            expect(msg.role).toBe('system');\n            expect(msg.content).toBe('You are a helpful assistant');\n        });\n\n        it('should accept tool message', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'tool',\n                content: 'Tool result',\n            };\n            expect(msg.role).toBe('tool');\n            expect(msg.content).toBe('Tool result');\n        });\n\n        it('should accept message with images', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'user',\n                content: 'Look at this',\n                images: ['data:image/png;base64,abc'],\n            };\n            expect(msg.images).toHaveLength(1);\n            expect(msg.images?.[0]).toContain('data:image');\n        });\n\n        it('should accept message with tool calls', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'assistant',\n                content: 'Calling tool',\n                tool_calls: [\n                    {\n                        type: 'function',\n                        function: {\n                            name: 'search',\n                            arguments: { query: 'test' },\n                        },\n                    },\n                ],\n            };\n            expect(msg.tool_calls).toHaveLength(1);\n            expect(msg.tool_calls?.[0].function.name).toBe('search');\n        });\n\n        it('should accept message with string tool arguments', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'assistant',\n                content: 'Calling tool',\n                tool_calls: [\n                    {\n                        function: {\n                            name: 'search',\n                            arguments: '{\"query\":\"test\"}',\n                        },\n                    },\n                ],\n            };\n            expect(msg.tool_calls?.[0].function.arguments).toBe('{\"query\":\"test\"}');\n        });\n\n        it('should accept message with extra properties', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'user',\n                content: 'Message',\n                customField: 'custom value',\n                timestamp: 1234567890,\n            };\n            expect(msg.customField).toBe('custom value');\n            expect(msg.timestamp).toBe(1234567890);\n        });\n    });\n\n    describe('AgentSelectionInfo interface validation', () => {\n        it('should accept minimal agent info', () => {\n            const info: AgentSelectionInfo = {};\n            expect(info).toEqual({});\n        });\n\n        it('should accept agent info with type', () => {\n            const info: AgentSelectionInfo = {\n                type: 'research',\n            };\n            expect(info.type).toBe('research');\n        });\n\n        it('should accept agent info with name', () => {\n            const info: AgentSelectionInfo = {\n                name: 'Research Agent',\n            };\n            expect(info.name).toBe('Research Agent');\n        });\n\n        it('should accept agent info with emoji', () => {\n            const info: AgentSelectionInfo = {\n                emoji: 'ðŸ”',\n            };\n            expect(info.emoji).toBe('ðŸ”');\n        });\n\n        it('should accept agent info with phase', () => {\n            const info: AgentSelectionInfo = {\n                phase: 'analysis',\n            };\n            expect(info.phase).toBe('analysis');\n        });\n\n        it('should accept agent info with reason', () => {\n            const info: AgentSelectionInfo = {\n                reason: 'User asked for research',\n            };\n            expect(info.reason).toBe('User asked for research');\n        });\n\n        it('should accept agent info with confidence', () => {\n            const info: AgentSelectionInfo = {\n                confidence: 0.95,\n            };\n            expect(info.confidence).toBe(0.95);\n        });\n\n        it('should accept comprehensive agent info', () => {\n            const info: AgentSelectionInfo = {\n                type: 'research',\n                name: 'Research Agent',\n                emoji: 'ðŸ”',\n                phase: 'analysis',\n                reason: 'Complex query detected',\n                confidence: 0.92,\n            };\n            expect(info.type).toBe('research');\n            expect(info.name).toBe('Research Agent');\n            expect(info.emoji).toBe('ðŸ”');\n            expect(info.phase).toBe('analysis');\n            expect(info.reason).toBe('Complex query detected');\n            expect(info.confidence).toBe(0.92);\n        });\n    });\n\n    describe('ToolCallInfo interface validation', () => {\n        it('should accept tool call with function', () => {\n            const call: ToolCallInfo = {\n                function: {\n                    name: 'search',\n                    arguments: { query: 'test' },\n                },\n            };\n            expect(call.function.name).toBe('search');\n            expect(call.function.arguments.query).toBe('test');\n        });\n\n        it('should accept tool call with type', () => {\n            const call: ToolCallInfo = {\n                type: 'function',\n                function: {\n                    name: 'search',\n                    arguments: { query: 'test' },\n                },\n            };\n            expect(call.type).toBe('function');\n            expect(call.function.name).toBe('search');\n        });\n\n        it('should accept tool call with complex arguments', () => {\n            const call: ToolCallInfo = {\n                function: {\n                    name: 'analyze',\n                    arguments: {\n                        text: 'sample',\n                        options: { depth: 'high', format: 'json' },\n                        tags: ['important', 'urgent'],\n                    },\n                },\n            };\n            expect(call.function.arguments.text).toBe('sample');\n            const options = call.function.arguments.options as Record<string, unknown>;\n            expect(options.depth).toBe('high');\n            const tags = call.function.arguments.tags as unknown[];\n            expect(tags).toHaveLength(2);\n        });\n    });\n\n    describe('WebSearchResult interface validation', () => {\n        it('should accept web search result with required fields', () => {\n            const result: WebSearchResult = {\n                title: 'Search Result',\n                url: 'https://example.com',\n            };\n            expect(result.title).toBe('Search Result');\n            expect(result.url).toBe('https://example.com');\n        });\n\n        it('should accept web search result with snippet', () => {\n            const result: WebSearchResult = {\n                title: 'Search Result',\n                url: 'https://example.com',\n                snippet: 'This is a snippet of the result',\n            };\n            expect(result.snippet).toBe('This is a snippet of the result');\n        });\n\n        it('should accept multiple web search results', () => {\n            const results: WebSearchResult[] = [\n                {\n                    title: 'Result 1',\n                    url: 'https://example1.com',\n                    snippet: 'First result',\n                },\n                {\n                    title: 'Result 2',\n                    url: 'https://example2.com',\n                    snippet: 'Second result',\n                },\n            ];\n            expect(results).toHaveLength(2);\n            expect(results[0].title).toBe('Result 1');\n            expect(results[1].url).toBe('https://example2.com');\n        });\n    });\n\n    describe('ChatResponseMeta interface validation', () => {\n        it('should accept minimal response meta', () => {\n            const meta: ChatResponseMeta = {};\n            expect(meta).toEqual({});\n        });\n\n        it('should accept response meta with model', () => {\n            const meta: ChatResponseMeta = {\n                model: 'llama2',\n            };\n            expect(meta.model).toBe('llama2');\n        });\n\n        it('should accept response meta with tokens', () => {\n            const meta: ChatResponseMeta = {\n                tokens: 256,\n            };\n            expect(meta.tokens).toBe(256);\n        });\n\n        it('should accept response meta with duration', () => {\n            const meta: ChatResponseMeta = {\n                duration: 1234,\n            };\n            expect(meta.duration).toBe(1234);\n        });\n\n        it('should accept response meta with custom fields', () => {\n            const meta: ChatResponseMeta = {\n                model: 'gpt-4',\n                tokens: 512,\n                duration: 2000,\n                temperature: 0.7,\n                topP: 0.9,\n            };\n            expect(meta.model).toBe('gpt-4');\n            expect(meta.tokens).toBe(512);\n            expect(meta.duration).toBe(2000);\n            expect(meta.temperature).toBe(0.7);\n            expect(meta.topP).toBe(0.9);\n        });\n    });\n\n    describe('ChatServiceConfig interface validation', () => {\n        it('should accept config with required fields', () => {\n            const config: ChatServiceConfig = {\n                client: {} as any,\n                model: 'llama2',\n            };\n            expect(config.model).toBe('llama2');\n            expect(config.client).toBeDefined();\n        });\n\n        it('should accept config with different model names', () => {\n            const models = ['gpt-4', 'claude-3', 'llama2', 'mistral'];\n            models.forEach((model) => {\n                const config: ChatServiceConfig = {\n                    client: {} as any,\n                    model,\n                };\n                expect(config.model).toBe(model);\n            });\n        });\n    });\n\n    describe('Tier resolution edge cases', () => {\n        it('should handle all tier combinations with admin role', () => {\n            const tiers: UserTier[] = ['free', 'pro', 'enterprise'];\n            tiers.forEach((tier) => {\n                const result = resolveUserTier('admin', tier);\n                expect(result).toBe('enterprise');\n            });\n        });\n\n        it('should handle all tier combinations with user role', () => {\n            const tiers: UserTier[] = ['free', 'pro', 'enterprise'];\n            tiers.forEach((tier) => {\n                const result = resolveUserTier('user', tier);\n                expect(result).toBe(tier);\n            });\n        });\n\n        it('should handle all tier combinations with guest role', () => {\n            const tiers: UserTier[] = ['free', 'pro', 'enterprise'];\n            tiers.forEach((tier) => {\n                const result = resolveUserTier('guest', tier);\n                expect(result).toBe(tier);\n            });\n        });\n\n        it('should handle all tier combinations with undefined role', () => {\n            const tiers: UserTier[] = ['free', 'pro', 'enterprise'];\n            tiers.forEach((tier) => {\n                const result = resolveUserTier(undefined, tier);\n                expect(result).toBe(tier);\n            });\n        });\n\n        it('should prioritize admin role over any tier', () => {\n            const result1 = resolveUserTier('admin', 'free');\n            const result2 = resolveUserTier('admin', 'pro');\n            const result3 = resolveUserTier('admin', 'enterprise');\n            expect(result1).toBe(result2);\n            expect(result2).toBe(result3);\n            expect(result1).toBe('enterprise');\n        });\n    });\n});\n"],"version":3}