{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/auth.test.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/auth.test.ts"],"sourcesContent":["/**\n * Auth Module Tests\n * JWT 토큰 생성/검증 및 권한 체크 테스트\n */\n\n// 테스트용 환경변수 설정 (다른 import 전에 설정)\nprocess.env.JWT_SECRET = 'test-secret-key-for-testing-purposes-only';\n\nimport {\n    generateToken,\n    verifyToken,\n    extractToken,\n    hasPermission,\n    isAdmin\n} from '../auth';\nimport { PublicUser } from '../data/user-manager';\n\ndescribe('Auth Module', () => {\n    // 테스트용 사용자 데이터\n    const mockUser: PublicUser = {\n        id: 1,\n        email: 'test@example.com',\n        role: 'user',\n        tier: 'free',\n        is_active: true,\n        created_at: new Date().toISOString()\n    };\n\n    const mockAdminUser: PublicUser = {\n        id: 2,\n        email: 'admin@example.com',\n        role: 'admin',\n        tier: 'enterprise',\n        is_active: true,\n        created_at: new Date().toISOString()\n    };\n\n    describe('generateToken', () => {\n        it('should generate a valid JWT token', () => {\n            const token = generateToken(mockUser);\n\n            expect(token).toBeDefined();\n            expect(typeof token).toBe('string');\n            expect(token.split('.')).toHaveLength(3); // JWT는 3개 세그먼트\n        });\n\n        it('should generate different tokens for different users', () => {\n            const token1 = generateToken(mockUser);\n            const token2 = generateToken(mockAdminUser);\n\n            expect(token1).not.toBe(token2);\n        });\n    });\n\n    describe('verifyToken', () => {\n        it('should verify a valid token', () => {\n            const token = generateToken(mockUser);\n            const payload = verifyToken(token);\n\n            expect(payload).not.toBeNull();\n            expect(payload?.userId).toBe(mockUser.id);\n            expect(payload?.email).toBe(mockUser.email);\n            expect(payload?.role).toBe(mockUser.role);\n        });\n\n        it('should return null for invalid token', () => {\n            const payload = verifyToken('invalid-token');\n\n            expect(payload).toBeNull();\n        });\n\n        it('should return null for empty token', () => {\n            const payload = verifyToken('');\n\n            expect(payload).toBeNull();\n        });\n\n        it('should return null for malformed JWT', () => {\n            const payload = verifyToken('a.b.c');\n\n            expect(payload).toBeNull();\n        });\n    });\n\n    describe('extractToken', () => {\n        it('should extract token from Bearer header', () => {\n            const token = extractToken('Bearer mytoken123');\n\n            expect(token).toBe('mytoken123');\n        });\n\n        it('should return raw token if no Bearer prefix', () => {\n            const token = extractToken('rawtoken456');\n\n            expect(token).toBe('rawtoken456');\n        });\n\n        it('should return null for undefined header', () => {\n            const token = extractToken(undefined);\n\n            expect(token).toBeNull();\n        });\n\n        it('should return null for empty header', () => {\n            const token = extractToken('');\n\n            expect(token).toBeNull();\n        });\n    });\n\n    describe('hasPermission', () => {\n        it('should allow admin to access admin resources', () => {\n            expect(hasPermission('admin', 'admin')).toBe(true);\n        });\n\n        it('should allow admin to access user resources', () => {\n            expect(hasPermission('admin', 'user')).toBe(true);\n        });\n\n        it('should allow admin to access guest resources', () => {\n            expect(hasPermission('admin', 'guest')).toBe(true);\n        });\n\n        it('should allow user to access user resources', () => {\n            expect(hasPermission('user', 'user')).toBe(true);\n        });\n\n        it('should allow user to access guest resources', () => {\n            expect(hasPermission('user', 'guest')).toBe(true);\n        });\n\n        it('should deny user access to admin resources', () => {\n            expect(hasPermission('user', 'admin')).toBe(false);\n        });\n\n        it('should allow guest to access guest resources', () => {\n            expect(hasPermission('guest', 'guest')).toBe(true);\n        });\n\n        it('should deny guest access to user resources', () => {\n            expect(hasPermission('guest', 'user')).toBe(false);\n        });\n\n        it('should deny guest access to admin resources', () => {\n            expect(hasPermission('guest', 'admin')).toBe(false);\n        });\n    });\n\n    describe('isAdmin', () => {\n        it('should return true for admin role', () => {\n            expect(isAdmin('admin')).toBe(true);\n        });\n\n        it('should return false for user role', () => {\n            expect(isAdmin('user')).toBe(false);\n        });\n\n        it('should return false for guest role', () => {\n            expect(isAdmin('guest')).toBe(false);\n        });\n    });\n});\n\n// Add at the end of the file, after existing tests\nimport { AuthService } from '../services/AuthService';\n\ndescribe('Password Policy', () => {\n    const authService = new AuthService();\n    \n    it('should reject password shorter than 8 characters', () => {\n        const result = authService.register({ email: 'test@test.com', password: 'Aa1!' });\n        expect(result.success).toBe(false);\n        expect(result.error).toContain('8자');\n    });\n    \n    it('should reject password without uppercase', () => {\n        const result = authService.register({ email: 'test@test.com', password: 'abcd1234!' });\n        expect(result.success).toBe(false);\n        expect(result.error).toContain('대문자');\n    });\n    \n    it('should reject password without lowercase', () => {\n        const result = authService.register({ email: 'test@test.com', password: 'ABCD1234!' });\n        expect(result.success).toBe(false);\n        expect(result.error).toContain('소문자');\n    });\n    \n    it('should reject password without number', () => {\n        const result = authService.register({ email: 'test@test.com', password: 'Abcdefgh!' });\n        expect(result.success).toBe(false);\n        expect(result.error).toContain('숫자');\n    });\n    \n    it('should reject password without special character', () => {\n        const result = authService.register({ email: 'test@test.com', password: 'Abcd1234' });\n        expect(result.success).toBe(false);\n        expect(result.error).toContain('특수문자');\n    });\n    \n    it('should accept valid password', () => {\n        const result = authService.register({ email: 'newuser@test.com', password: 'ValidPass1!' });\n        // Success depends on whether user already exists, but should NOT fail on password\n        if (!result.success) {\n            expect(result.error).not.toContain('비밀번호');\n        }\n    });\n});\n\ndescribe('Token Blacklist', () => {\n    // Import after test setup\n    let SQLiteTokenBlacklist: any;\n    let tempDb: any;\n    \n    beforeAll(async () => {\n        const mod = await import('../data/models/token-blacklist');\n        SQLiteTokenBlacklist = mod.SQLiteTokenBlacklist;\n    });\n    \n    beforeEach(() => {\n        tempDb = new SQLiteTokenBlacklist(':memory:');\n    });\n    \n    afterEach(() => {\n        tempDb.destroy();\n    });\n    \n    it('should add token to blacklist', () => {\n        tempDb.add('test-jti-1', Date.now() + 60000);\n        expect(tempDb.has('test-jti-1')).toBe(true);\n    });\n    \n    it('should return false for non-existent token', () => {\n        expect(tempDb.has('non-existent')).toBe(false);\n    });\n    \n    it('should return false for expired token', () => {\n        tempDb.add('expired-jti', Date.now() - 1000);\n        expect(tempDb.has('expired-jti')).toBe(false);\n    });\n    \n    it('should cleanup expired tokens', () => {\n        tempDb.add('expired-1', Date.now() - 1000);\n        tempDb.add('expired-2', Date.now() - 2000);\n        tempDb.add('valid', Date.now() + 60000);\n        \n        const cleaned = tempDb.cleanup();\n        expect(cleaned).toBe(2);\n        expect(tempDb.getStats().count).toBe(1);\n    });\n    \n    it('should return correct stats', () => {\n        tempDb.add('jti-1', Date.now() + 60000);\n        tempDb.add('jti-2', Date.now() + 60000);\n        \n        expect(tempDb.getStats().count).toBe(2);\n    });\n});\n"],"version":3}