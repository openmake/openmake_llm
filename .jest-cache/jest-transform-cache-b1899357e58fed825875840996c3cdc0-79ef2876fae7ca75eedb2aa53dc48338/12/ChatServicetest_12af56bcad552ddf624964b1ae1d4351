cfb59dfec41981856df3534510477602
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
describe('ChatService Types', () => {
    describe('ChatHistoryMessage', () => {
        it('should allow valid user message', () => {
            const msg = {
                role: 'user',
                content: 'Hello world'
            };
            expect(msg.role).toBe('user');
            expect(msg.content).toBe('Hello world');
        });
        it('should allow assistant message with tool_calls', () => {
            const msg = {
                role: 'assistant',
                content: '',
                tool_calls: [{
                        type: 'function',
                        function: {
                            name: 'test_tool',
                            arguments: { arg1: 'value' }
                        }
                    }]
            };
            expect(msg.tool_calls).toHaveLength(1);
            expect(msg.tool_calls[0].function.name).toBe('test_tool');
        });
        it('should allow message with images', () => {
            const msg = {
                role: 'user',
                content: 'Check this image',
                images: ['base64data']
            };
            expect(msg.images).toHaveLength(1);
        });
        it('should allow system message', () => {
            const msg = {
                role: 'system',
                content: 'You are a helpful assistant'
            };
            expect(msg.role).toBe('system');
            expect(msg.content).toBe('You are a helpful assistant');
        });
        it('should allow tool message', () => {
            const msg = {
                role: 'tool',
                content: 'Tool result'
            };
            expect(msg.role).toBe('tool');
            expect(msg.content).toBe('Tool result');
        });
        it('should allow message with multiple images', () => {
            const msg = {
                role: 'user',
                content: 'Compare these images',
                images: ['image1', 'image2', 'image3']
            };
            expect(msg.images).toHaveLength(3);
        });
        it('should allow message with string arguments in tool_calls', () => {
            const msg = {
                role: 'assistant',
                content: '',
                tool_calls: [{
                        type: 'function',
                        function: {
                            name: 'search',
                            arguments: '{"query": "test"}'
                        }
                    }]
            };
            expect(typeof msg.tool_calls[0].function.arguments).toBe('string');
        });
        it('should allow additional properties via index signature', () => {
            const msg = {
                role: 'user',
                content: 'Test',
                customField: 'custom value',
                anotherField: 123
            };
            // ChatHistoryMessage has index signature [key: string]: unknown
            expect(msg.customField).toBe('custom value');
            expect(msg.anotherField).toBe(123);
        });
    });
    describe('AgentSelectionInfo', () => {
        it('should represent agent selection', () => {
            const info = {
                type: 'code_expert',
                name: 'Code Expert',
                emoji: 'ðŸ‘¨â€ðŸ’»',
                confidence: 0.95,
                reason: 'Code-related query detected'
            };
            expect(info.type).toBe('code_expert');
            expect(info.confidence).toBe(0.95);
        });
        it('should allow partial agent selection info', () => {
            const info = {
                type: 'researcher'
            };
            expect(info.type).toBe('researcher');
            expect(info.name).toBeUndefined();
        });
        it('should allow phase property', () => {
            const info = {
                type: 'agent',
                phase: 'analysis'
            };
            expect(info.phase).toBe('analysis');
        });
        it('should allow additional properties', () => {
            const info = {
                type: 'expert',
                customProp: 'value'
            };
            // AgentSelectionInfo has index signature [key: string]: unknown
            expect(info.customProp).toBe('value');
        });
    });
    describe('ToolCallInfo', () => {
        it('should represent tool call structure', () => {
            const tool = {
                type: 'function',
                function: {
                    name: 'web_search',
                    arguments: { query: 'test query' }
                }
            };
            expect(tool.function.name).toBe('web_search');
        });
        it('should allow tool call without type', () => {
            const tool = {
                function: {
                    name: 'calculator',
                    arguments: { operation: 'add', a: 1, b: 2 }
                }
            };
            expect(tool.function.name).toBe('calculator');
            // ToolCallInfo.function.arguments is Record<string, unknown>
            expect(tool.function.arguments.a).toBe(1);
        });
        it('should handle complex arguments', () => {
            const tool = {
                type: 'function',
                function: {
                    name: 'complex_tool',
                    arguments: {
                        nested: { deep: { value: 'test' } },
                        array: [1, 2, 3],
                        string: 'value'
                    }
                }
            };
            // ToolCallInfo.function.arguments is Record<string, unknown>
            const args = tool.function.arguments;
            expect(args.nested.deep.value).toBe('test');
            expect(args.array).toHaveLength(3);
        });
    });
    describe('WebSearchResult', () => {
        it('should represent search result', () => {
            const result = {
                title: 'Test Page',
                url: 'https://example.com',
                snippet: 'A test snippet'
            };
            expect(result.title).toBe('Test Page');
            expect(result.url).toBe('https://example.com');
        });
        it('should allow result without snippet', () => {
            const result = {
                title: 'Another Page',
                url: 'https://another.com'
            };
            expect(result.title).toBe('Another Page');
            expect(result.snippet).toBeUndefined();
        });
        it('should handle URLs with query parameters', () => {
            const result = {
                title: 'Search Results',
                url: 'https://example.com/search?q=test&lang=en',
                snippet: 'Results for test'
            };
            expect(result.url).toContain('?q=test');
        });
        it('should handle long snippets', () => {
            const longSnippet = 'A'.repeat(500);
            const result = {
                title: 'Long Result',
                url: 'https://example.com',
                snippet: longSnippet
            };
            expect(result.snippet).toHaveLength(500);
        });
    });
    describe('Type Compatibility', () => {
        it('should allow ChatHistoryMessage array', () => {
            const messages = [
                { role: 'user', content: 'Hello' },
                { role: 'assistant', content: 'Hi there' }
            ];
            expect(messages).toHaveLength(2);
            expect(messages[0].role).toBe('user');
        });
        it('should allow WebSearchResult array', () => {
            const results = [
                { title: 'Result 1', url: 'https://example1.com' },
                { title: 'Result 2', url: 'https://example2.com', snippet: 'Snippet' }
            ];
            expect(results).toHaveLength(2);
        });
        it('should allow mixed tool_calls in messages', () => {
            const messages = [
                {
                    role: 'assistant',
                    content: 'I will search',
                    tool_calls: [
                        {
                            type: 'function',
                            function: { name: 'search', arguments: { query: 'test' } }
                        }
                    ]
                },
                {
                    role: 'tool',
                    content: 'Search results'
                }
            ];
            expect(messages).toHaveLength(2);
            expect(messages[0].tool_calls).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL19fdGVzdHNfXy9DaGF0U2VydmljZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBTUEsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUMvQixRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxHQUFHLEVBQUU7WUFDdkMsTUFBTSxHQUFHLEdBQXVCO2dCQUM1QixJQUFJLEVBQUUsTUFBTTtnQkFDWixPQUFPLEVBQUUsYUFBYTthQUN6QixDQUFDO1lBQ0YsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDOUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDNUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0RBQWdELEVBQUUsR0FBRyxFQUFFO1lBQ3RELE1BQU0sR0FBRyxHQUF1QjtnQkFDNUIsSUFBSSxFQUFFLFdBQVc7Z0JBQ2pCLE9BQU8sRUFBRSxFQUFFO2dCQUNYLFVBQVUsRUFBRSxDQUFDO3dCQUNULElBQUksRUFBRSxVQUFVO3dCQUNoQixRQUFRLEVBQUU7NEJBQ04sSUFBSSxFQUFFLFdBQVc7NEJBQ2pCLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUU7eUJBQy9CO3FCQUNKLENBQUM7YUFDTCxDQUFDO1lBQ0YsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUU7WUFDeEMsTUFBTSxHQUFHLEdBQXVCO2dCQUM1QixJQUFJLEVBQUUsTUFBTTtnQkFDWixPQUFPLEVBQUUsa0JBQWtCO2dCQUMzQixNQUFNLEVBQUUsQ0FBQyxZQUFZLENBQUM7YUFDekIsQ0FBQztZQUNGLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtZQUNuQyxNQUFNLEdBQUcsR0FBdUI7Z0JBQzVCLElBQUksRUFBRSxRQUFRO2dCQUNkLE9BQU8sRUFBRSw2QkFBNkI7YUFDekMsQ0FBQztZQUNGLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ2hDLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLDZCQUE2QixDQUFDLENBQUM7UUFDNUQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO1lBQ2pDLE1BQU0sR0FBRyxHQUF1QjtnQkFDNUIsSUFBSSxFQUFFLE1BQU07Z0JBQ1osT0FBTyxFQUFFLGFBQWE7YUFDekIsQ0FBQztZQUNGLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEdBQUcsRUFBRTtZQUNqRCxNQUFNLEdBQUcsR0FBdUI7Z0JBQzVCLElBQUksRUFBRSxNQUFNO2dCQUNaLE9BQU8sRUFBRSxzQkFBc0I7Z0JBQy9CLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDO2FBQ3pDLENBQUM7WUFDRixNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwREFBMEQsRUFBRSxHQUFHLEVBQUU7WUFDaEUsTUFBTSxHQUFHLEdBQXVCO2dCQUM1QixJQUFJLEVBQUUsV0FBVztnQkFDakIsT0FBTyxFQUFFLEVBQUU7Z0JBQ1gsVUFBVSxFQUFFLENBQUM7d0JBQ1QsSUFBSSxFQUFFLFVBQVU7d0JBQ2hCLFFBQVEsRUFBRTs0QkFDTixJQUFJLEVBQUUsUUFBUTs0QkFDZCxTQUFTLEVBQUUsbUJBQW1CO3lCQUNqQztxQkFDSixDQUFDO2FBQ0wsQ0FBQztZQUNGLE1BQU0sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxVQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN4RSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx3REFBd0QsRUFBRSxHQUFHLEVBQUU7WUFDOUQsTUFBTSxHQUFHLEdBQXVCO2dCQUM1QixJQUFJLEVBQUUsTUFBTTtnQkFDWixPQUFPLEVBQUUsTUFBTTtnQkFDZixXQUFXLEVBQUUsY0FBYztnQkFDM0IsWUFBWSxFQUFFLEdBQUc7YUFDcEIsQ0FBQztZQUNGLGdFQUFnRTtZQUNoRSxNQUFNLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUM3QyxNQUFNLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMsa0NBQWtDLEVBQUUsR0FBRyxFQUFFO1lBQ3hDLE1BQU0sSUFBSSxHQUF1QjtnQkFDN0IsSUFBSSxFQUFFLGFBQWE7Z0JBQ25CLElBQUksRUFBRSxhQUFhO2dCQUNuQixLQUFLLEVBQUUsT0FBTztnQkFDZCxVQUFVLEVBQUUsSUFBSTtnQkFDaEIsTUFBTSxFQUFFLDZCQUE2QjthQUN4QyxDQUFDO1lBQ0YsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMkNBQTJDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELE1BQU0sSUFBSSxHQUF1QjtnQkFDN0IsSUFBSSxFQUFFLFlBQVk7YUFDckIsQ0FBQztZQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDdEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO1lBQ25DLE1BQU0sSUFBSSxHQUF1QjtnQkFDN0IsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsS0FBSyxFQUFFLFVBQVU7YUFDcEIsQ0FBQztZQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtZQUMxQyxNQUFNLElBQUksR0FBdUI7Z0JBQzdCLElBQUksRUFBRSxRQUFRO2dCQUNkLFVBQVUsRUFBRSxPQUFPO2FBQ3RCLENBQUM7WUFDRixnRUFBZ0U7WUFDaEUsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDMUMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO1FBQzFCLEVBQUUsQ0FBQyxzQ0FBc0MsRUFBRSxHQUFHLEVBQUU7WUFDNUMsTUFBTSxJQUFJLEdBQWlCO2dCQUN2QixJQUFJLEVBQUUsVUFBVTtnQkFDaEIsUUFBUSxFQUFFO29CQUNOLElBQUksRUFBRSxZQUFZO29CQUNsQixTQUFTLEVBQUUsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFO2lCQUNyQzthQUNKLENBQUM7WUFDRixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDbEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO1lBQzNDLE1BQU0sSUFBSSxHQUFpQjtnQkFDdkIsUUFBUSxFQUFFO29CQUNOLElBQUksRUFBRSxZQUFZO29CQUNsQixTQUFTLEVBQUUsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTtpQkFDOUM7YUFDSixDQUFDO1lBQ0YsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQzlDLDZEQUE2RDtZQUM3RCxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlDQUFpQyxFQUFFLEdBQUcsRUFBRTtZQUN2QyxNQUFNLElBQUksR0FBaUI7Z0JBQ3ZCLElBQUksRUFBRSxVQUFVO2dCQUNoQixRQUFRLEVBQUU7b0JBQ04sSUFBSSxFQUFFLGNBQWM7b0JBQ3BCLFNBQVMsRUFBRTt3QkFDUCxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUU7d0JBQ25DLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO3dCQUNoQixNQUFNLEVBQUUsT0FBTztxQkFDbEI7aUJBQ0o7YUFDSixDQUFDO1lBQ0YsNkRBQTZEO1lBQzdELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBcUUsQ0FBQztZQUNqRyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO1FBQzdCLEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7WUFDdEMsTUFBTSxNQUFNLEdBQW9CO2dCQUM1QixLQUFLLEVBQUUsV0FBVztnQkFDbEIsR0FBRyxFQUFFLHFCQUFxQjtnQkFDMUIsT0FBTyxFQUFFLGdCQUFnQjthQUM1QixDQUFDO1lBQ0YsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7WUFDM0MsTUFBTSxNQUFNLEdBQW9CO2dCQUM1QixLQUFLLEVBQUUsY0FBYztnQkFDckIsR0FBRyxFQUFFLHFCQUFxQjthQUM3QixDQUFDO1lBQ0YsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDMUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUMzQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7WUFDaEQsTUFBTSxNQUFNLEdBQW9CO2dCQUM1QixLQUFLLEVBQUUsZ0JBQWdCO2dCQUN2QixHQUFHLEVBQUUsMkNBQTJDO2dCQUNoRCxPQUFPLEVBQUUsa0JBQWtCO2FBQzlCLENBQUM7WUFDRixNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUU7WUFDbkMsTUFBTSxXQUFXLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNwQyxNQUFNLE1BQU0sR0FBb0I7Z0JBQzVCLEtBQUssRUFBRSxhQUFhO2dCQUNwQixHQUFHLEVBQUUscUJBQXFCO2dCQUMxQixPQUFPLEVBQUUsV0FBVzthQUN2QixDQUFDO1lBQ0YsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0MsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7UUFDaEMsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUM3QyxNQUFNLFFBQVEsR0FBeUI7Z0JBQ25DLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFO2dCQUNsQyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRTthQUM3QyxDQUFDO1lBQ0YsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMxQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7WUFDMUMsTUFBTSxPQUFPLEdBQXNCO2dCQUMvQixFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLHNCQUFzQixFQUFFO2dCQUNsRCxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLHNCQUFzQixFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUU7YUFDekUsQ0FBQztZQUNGLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMkNBQTJDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELE1BQU0sUUFBUSxHQUF5QjtnQkFDbkM7b0JBQ0ksSUFBSSxFQUFFLFdBQVc7b0JBQ2pCLE9BQU8sRUFBRSxlQUFlO29CQUN4QixVQUFVLEVBQUU7d0JBQ1I7NEJBQ0ksSUFBSSxFQUFFLFVBQVU7NEJBQ2hCLFFBQVEsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFO3lCQUM3RDtxQkFDSjtpQkFDSjtnQkFDRDtvQkFDSSxJQUFJLEVBQUUsTUFBTTtvQkFDWixPQUFPLEVBQUUsZ0JBQWdCO2lCQUM1QjthQUNKLENBQUM7WUFDRixNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Wb2x1bWVzL01BQ19BUFAvb3Blbm1ha2VfbGxtL2JhY2tlbmQvYXBpL3NyYy9fX3Rlc3RzX18vQ2hhdFNlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENoYXRTZXJ2aWNlIFRlc3RzXG4gKiBCYXNpYyB0ZXN0cyBmb3IgY2hhdCBzZXJ2aWNlIHR5cGVzIGFuZCBpbnRlcmZhY2VzXG4gKi9cbmltcG9ydCB7IENoYXRIaXN0b3J5TWVzc2FnZSwgQWdlbnRTZWxlY3Rpb25JbmZvLCBUb29sQ2FsbEluZm8sIFdlYlNlYXJjaFJlc3VsdCB9IGZyb20gJy4uL3NlcnZpY2VzL0NoYXRTZXJ2aWNlJztcblxuZGVzY3JpYmUoJ0NoYXRTZXJ2aWNlIFR5cGVzJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdDaGF0SGlzdG9yeU1lc3NhZ2UnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgYWxsb3cgdmFsaWQgdXNlciBtZXNzYWdlJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbXNnOiBDaGF0SGlzdG9yeU1lc3NhZ2UgPSB7XG4gICAgICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdIZWxsbyB3b3JsZCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBleHBlY3QobXNnLnJvbGUpLnRvQmUoJ3VzZXInKTtcbiAgICAgICAgICAgIGV4cGVjdChtc2cuY29udGVudCkudG9CZSgnSGVsbG8gd29ybGQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBhc3Npc3RhbnQgbWVzc2FnZSB3aXRoIHRvb2xfY2FsbHMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtc2c6IENoYXRIaXN0b3J5TWVzc2FnZSA9IHtcbiAgICAgICAgICAgICAgICByb2xlOiAnYXNzaXN0YW50JyxcbiAgICAgICAgICAgICAgICBjb250ZW50OiAnJyxcbiAgICAgICAgICAgICAgICB0b29sX2NhbGxzOiBbe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZnVuY3Rpb24nLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3Rlc3RfdG9vbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsgYXJnMTogJ3ZhbHVlJyB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGV4cGVjdChtc2cudG9vbF9jYWxscykudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgICAgICAgZXhwZWN0KG1zZy50b29sX2NhbGxzIVswXS5mdW5jdGlvbi5uYW1lKS50b0JlKCd0ZXN0X3Rvb2wnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBtZXNzYWdlIHdpdGggaW1hZ2VzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbXNnOiBDaGF0SGlzdG9yeU1lc3NhZ2UgPSB7XG4gICAgICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdDaGVjayB0aGlzIGltYWdlJyxcbiAgICAgICAgICAgICAgICBpbWFnZXM6IFsnYmFzZTY0ZGF0YSddXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZXhwZWN0KG1zZy5pbWFnZXMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBzeXN0ZW0gbWVzc2FnZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1zZzogQ2hhdEhpc3RvcnlNZXNzYWdlID0ge1xuICAgICAgICAgICAgICAgIHJvbGU6ICdzeXN0ZW0nLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdZb3UgYXJlIGEgaGVscGZ1bCBhc3Npc3RhbnQnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZXhwZWN0KG1zZy5yb2xlKS50b0JlKCdzeXN0ZW0nKTtcbiAgICAgICAgICAgIGV4cGVjdChtc2cuY29udGVudCkudG9CZSgnWW91IGFyZSBhIGhlbHBmdWwgYXNzaXN0YW50Jyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgYWxsb3cgdG9vbCBtZXNzYWdlJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbXNnOiBDaGF0SGlzdG9yeU1lc3NhZ2UgPSB7XG4gICAgICAgICAgICAgICAgcm9sZTogJ3Rvb2wnLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdUb29sIHJlc3VsdCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBleHBlY3QobXNnLnJvbGUpLnRvQmUoJ3Rvb2wnKTtcbiAgICAgICAgICAgIGV4cGVjdChtc2cuY29udGVudCkudG9CZSgnVG9vbCByZXN1bHQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBtZXNzYWdlIHdpdGggbXVsdGlwbGUgaW1hZ2VzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbXNnOiBDaGF0SGlzdG9yeU1lc3NhZ2UgPSB7XG4gICAgICAgICAgICAgICAgcm9sZTogJ3VzZXInLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdDb21wYXJlIHRoZXNlIGltYWdlcycsXG4gICAgICAgICAgICAgICAgaW1hZ2VzOiBbJ2ltYWdlMScsICdpbWFnZTInLCAnaW1hZ2UzJ11cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBleHBlY3QobXNnLmltYWdlcykudG9IYXZlTGVuZ3RoKDMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGFsbG93IG1lc3NhZ2Ugd2l0aCBzdHJpbmcgYXJndW1lbnRzIGluIHRvb2xfY2FsbHMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtc2c6IENoYXRIaXN0b3J5TWVzc2FnZSA9IHtcbiAgICAgICAgICAgICAgICByb2xlOiAnYXNzaXN0YW50JyxcbiAgICAgICAgICAgICAgICBjb250ZW50OiAnJyxcbiAgICAgICAgICAgICAgICB0b29sX2NhbGxzOiBbe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZnVuY3Rpb24nLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3NlYXJjaCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6ICd7XCJxdWVyeVwiOiBcInRlc3RcIn0nXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGV4cGVjdCh0eXBlb2YgbXNnLnRvb2xfY2FsbHMhWzBdLmZ1bmN0aW9uLmFyZ3VtZW50cykudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgYWxsb3cgYWRkaXRpb25hbCBwcm9wZXJ0aWVzIHZpYSBpbmRleCBzaWduYXR1cmUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtc2c6IENoYXRIaXN0b3J5TWVzc2FnZSA9IHtcbiAgICAgICAgICAgICAgICByb2xlOiAndXNlcicsXG4gICAgICAgICAgICAgICAgY29udGVudDogJ1Rlc3QnLFxuICAgICAgICAgICAgICAgIGN1c3RvbUZpZWxkOiAnY3VzdG9tIHZhbHVlJyxcbiAgICAgICAgICAgICAgICBhbm90aGVyRmllbGQ6IDEyM1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIENoYXRIaXN0b3J5TWVzc2FnZSBoYXMgaW5kZXggc2lnbmF0dXJlIFtrZXk6IHN0cmluZ106IHVua25vd25cbiAgICAgICAgICAgIGV4cGVjdChtc2cuY3VzdG9tRmllbGQpLnRvQmUoJ2N1c3RvbSB2YWx1ZScpO1xuICAgICAgICAgICAgZXhwZWN0KG1zZy5hbm90aGVyRmllbGQpLnRvQmUoMTIzKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnQWdlbnRTZWxlY3Rpb25JbmZvJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJlcHJlc2VudCBhZ2VudCBzZWxlY3Rpb24nLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbmZvOiBBZ2VudFNlbGVjdGlvbkluZm8gPSB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2NvZGVfZXhwZXJ0JyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnQ29kZSBFeHBlcnQnLFxuICAgICAgICAgICAgICAgIGVtb2ppOiAn8J+RqOKAjfCfkrsnLFxuICAgICAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOTUsXG4gICAgICAgICAgICAgICAgcmVhc29uOiAnQ29kZS1yZWxhdGVkIHF1ZXJ5IGRldGVjdGVkJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGV4cGVjdChpbmZvLnR5cGUpLnRvQmUoJ2NvZGVfZXhwZXJ0Jyk7XG4gICAgICAgICAgICBleHBlY3QoaW5mby5jb25maWRlbmNlKS50b0JlKDAuOTUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGFsbG93IHBhcnRpYWwgYWdlbnQgc2VsZWN0aW9uIGluZm8nLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbmZvOiBBZ2VudFNlbGVjdGlvbkluZm8gPSB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3Jlc2VhcmNoZXInXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZXhwZWN0KGluZm8udHlwZSkudG9CZSgncmVzZWFyY2hlcicpO1xuICAgICAgICAgICAgZXhwZWN0KGluZm8ubmFtZSkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGFsbG93IHBoYXNlIHByb3BlcnR5JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaW5mbzogQWdlbnRTZWxlY3Rpb25JbmZvID0ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdhZ2VudCcsXG4gICAgICAgICAgICAgICAgcGhhc2U6ICdhbmFseXNpcydcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBleHBlY3QoaW5mby5waGFzZSkudG9CZSgnYW5hbHlzaXMnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBhZGRpdGlvbmFsIHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbmZvOiBBZ2VudFNlbGVjdGlvbkluZm8gPSB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2V4cGVydCcsXG4gICAgICAgICAgICAgICAgY3VzdG9tUHJvcDogJ3ZhbHVlJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIEFnZW50U2VsZWN0aW9uSW5mbyBoYXMgaW5kZXggc2lnbmF0dXJlIFtrZXk6IHN0cmluZ106IHVua25vd25cbiAgICAgICAgICAgIGV4cGVjdChpbmZvLmN1c3RvbVByb3ApLnRvQmUoJ3ZhbHVlJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1Rvb2xDYWxsSW5mbycsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZXByZXNlbnQgdG9vbCBjYWxsIHN0cnVjdHVyZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRvb2w6IFRvb2xDYWxsSW5mbyA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnZnVuY3Rpb24nLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICd3ZWJfc2VhcmNoJyxcbiAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7IHF1ZXJ5OiAndGVzdCBxdWVyeScgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBleHBlY3QodG9vbC5mdW5jdGlvbi5uYW1lKS50b0JlKCd3ZWJfc2VhcmNoJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgYWxsb3cgdG9vbCBjYWxsIHdpdGhvdXQgdHlwZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRvb2w6IFRvb2xDYWxsSW5mbyA9IHtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnY2FsY3VsYXRvcicsXG4gICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogeyBvcGVyYXRpb246ICdhZGQnLCBhOiAxLCBiOiAyIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZXhwZWN0KHRvb2wuZnVuY3Rpb24ubmFtZSkudG9CZSgnY2FsY3VsYXRvcicpO1xuICAgICAgICAgICAgLy8gVG9vbENhbGxJbmZvLmZ1bmN0aW9uLmFyZ3VtZW50cyBpcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuICAgICAgICAgICAgZXhwZWN0KHRvb2wuZnVuY3Rpb24uYXJndW1lbnRzLmEpLnRvQmUoMSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbXBsZXggYXJndW1lbnRzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdG9vbDogVG9vbENhbGxJbmZvID0ge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdmdW5jdGlvbicsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb246IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2NvbXBsZXhfdG9vbCcsXG4gICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmVzdGVkOiB7IGRlZXA6IHsgdmFsdWU6ICd0ZXN0JyB9IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnJheTogWzEsIDIsIDNdLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nOiAndmFsdWUnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy8gVG9vbENhbGxJbmZvLmZ1bmN0aW9uLmFyZ3VtZW50cyBpcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuICAgICAgICAgICAgY29uc3QgYXJncyA9IHRvb2wuZnVuY3Rpb24uYXJndW1lbnRzIGFzIHsgbmVzdGVkOiB7IGRlZXA6IHsgdmFsdWU6IHN0cmluZyB9IH07IGFycmF5OiBudW1iZXJbXSB9O1xuICAgICAgICAgICAgZXhwZWN0KGFyZ3MubmVzdGVkLmRlZXAudmFsdWUpLnRvQmUoJ3Rlc3QnKTtcbiAgICAgICAgICAgIGV4cGVjdChhcmdzLmFycmF5KS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1dlYlNlYXJjaFJlc3VsdCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZXByZXNlbnQgc2VhcmNoIHJlc3VsdCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDogV2ViU2VhcmNoUmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnVGVzdCBQYWdlJyxcbiAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL2V4YW1wbGUuY29tJyxcbiAgICAgICAgICAgICAgICBzbmlwcGV0OiAnQSB0ZXN0IHNuaXBwZXQnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC50aXRsZSkudG9CZSgnVGVzdCBQYWdlJyk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnVybCkudG9CZSgnaHR0cHM6Ly9leGFtcGxlLmNvbScpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGFsbG93IHJlc3VsdCB3aXRob3V0IHNuaXBwZXQnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQ6IFdlYlNlYXJjaFJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0Fub3RoZXIgUGFnZScsXG4gICAgICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9hbm90aGVyLmNvbSdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnRpdGxlKS50b0JlKCdBbm90aGVyIFBhZ2UnKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuc25pcHBldCkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBVUkxzIHdpdGggcXVlcnkgcGFyYW1ldGVycycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDogV2ViU2VhcmNoUmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnU2VhcmNoIFJlc3VsdHMnLFxuICAgICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vc2VhcmNoP3E9dGVzdCZsYW5nPWVuJyxcbiAgICAgICAgICAgICAgICBzbmlwcGV0OiAnUmVzdWx0cyBmb3IgdGVzdCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnVybCkudG9Db250YWluKCc/cT10ZXN0Jyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGxvbmcgc25pcHBldHMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBsb25nU25pcHBldCA9ICdBJy5yZXBlYXQoNTAwKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDogV2ViU2VhcmNoUmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnTG9uZyBSZXN1bHQnLFxuICAgICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20nLFxuICAgICAgICAgICAgICAgIHNuaXBwZXQ6IGxvbmdTbmlwcGV0XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5zbmlwcGV0KS50b0hhdmVMZW5ndGgoNTAwKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnVHlwZSBDb21wYXRpYmlsaXR5JywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGFsbG93IENoYXRIaXN0b3J5TWVzc2FnZSBhcnJheScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VzOiBDaGF0SGlzdG9yeU1lc3NhZ2VbXSA9IFtcbiAgICAgICAgICAgICAgICB7IHJvbGU6ICd1c2VyJywgY29udGVudDogJ0hlbGxvJyB9LFxuICAgICAgICAgICAgICAgIHsgcm9sZTogJ2Fzc2lzdGFudCcsIGNvbnRlbnQ6ICdIaSB0aGVyZScgfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlcykudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgICAgICAgZXhwZWN0KG1lc3NhZ2VzWzBdLnJvbGUpLnRvQmUoJ3VzZXInKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBXZWJTZWFyY2hSZXN1bHQgYXJyYXknLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzOiBXZWJTZWFyY2hSZXN1bHRbXSA9IFtcbiAgICAgICAgICAgICAgICB7IHRpdGxlOiAnUmVzdWx0IDEnLCB1cmw6ICdodHRwczovL2V4YW1wbGUxLmNvbScgfSxcbiAgICAgICAgICAgICAgICB7IHRpdGxlOiAnUmVzdWx0IDInLCB1cmw6ICdodHRwczovL2V4YW1wbGUyLmNvbScsIHNuaXBwZXQ6ICdTbmlwcGV0JyB9XG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdHMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBtaXhlZCB0b29sX2NhbGxzIGluIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZXM6IENoYXRIaXN0b3J5TWVzc2FnZVtdID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICdJIHdpbGwgc2VhcmNoJyxcbiAgICAgICAgICAgICAgICAgICAgdG9vbF9jYWxsczogW1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdmdW5jdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb246IHsgbmFtZTogJ3NlYXJjaCcsIGFyZ3VtZW50czogeyBxdWVyeTogJ3Rlc3QnIH0gfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJvbGU6ICd0b29sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogJ1NlYXJjaCByZXN1bHRzJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBleHBlY3QobWVzc2FnZXMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlc1swXS50b29sX2NhbGxzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9