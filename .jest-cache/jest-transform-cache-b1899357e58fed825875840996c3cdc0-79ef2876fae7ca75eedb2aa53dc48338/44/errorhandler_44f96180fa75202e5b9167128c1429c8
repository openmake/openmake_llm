60cf97f191639f1e57e1a0fb4802ff47
"use strict";
/**
 * Unified Error Handler
 * Standardized error handling across all routes
 *
 * #24 연동: api-response 표준 형식 사용
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.DatabaseError = exports.RateLimitError = exports.NotFoundError = exports.AuthorizationError = exports.AuthenticationError = exports.ValidationError = exports.AppError = void 0;
exports.errorHandler = errorHandler;
exports.asyncHandler = asyncHandler;
exports.notFoundHandler = notFoundHandler;
const logger_1 = require("./logger");
const api_response_1 = require("./api-response");
const logger = (0, logger_1.createLogger)('ErrorHandler');
/**
 * Base application error class
 */
class AppError extends Error {
    constructor(message, statusCode = 500, isOperational = true, code) {
        super(message);
        this.statusCode = statusCode;
        this.isOperational = isOperational;
        this.code = code;
        Object.setPrototypeOf(this, new.target.prototype);
        Error.captureStackTrace(this, this.constructor);
    }
}
exports.AppError = AppError;
/**
 * Validation error (400)
 */
class ValidationError extends AppError {
    constructor(message) {
        super(message, 400, true, 'VALIDATION_ERROR');
    }
}
exports.ValidationError = ValidationError;
/**
 * Authentication error (401)
 */
class AuthenticationError extends AppError {
    constructor(message = '인증이 필요합니다') {
        super(message, 401, true, 'AUTHENTICATION_ERROR');
    }
}
exports.AuthenticationError = AuthenticationError;
/**
 * Authorization error (403)
 */
class AuthorizationError extends AppError {
    constructor(message = '권한이 없습니다') {
        super(message, 403, true, 'AUTHORIZATION_ERROR');
    }
}
exports.AuthorizationError = AuthorizationError;
/**
 * Not found error (404)
 */
class NotFoundError extends AppError {
    constructor(message = '리소스를 찾을 수 없습니다') {
        super(message, 404, true, 'NOT_FOUND');
    }
}
exports.NotFoundError = NotFoundError;
/**
 * Rate limit error (429)
 */
class RateLimitError extends AppError {
    constructor(message = '요청 제한을 초과했습니다') {
        super(message, 429, true, 'RATE_LIMIT_EXCEEDED');
    }
}
exports.RateLimitError = RateLimitError;
/**
 * Database error (500)
 */
class DatabaseError extends AppError {
    constructor(message = '데이터베이스 오류가 발생했습니다') {
        super(message, 500, true, 'DATABASE_ERROR');
    }
}
exports.DatabaseError = DatabaseError;
/**
 * Format error for response (#24 연동: 표준 ApiErrorResponse 형식)
 */
function formatError(err, includeStack) {
    const code = err instanceof AppError && err.code
        ? err.code
        : api_response_1.ErrorCodes.INTERNAL_ERROR;
    const response = (0, api_response_1.error)(code, err.message);
    if (includeStack && err.stack) {
        return Object.assign(Object.assign({}, response), { stack: err.stack });
    }
    return response;
}
/**
 * Global error handler middleware
 * Must be registered LAST after all routes
 * #24 연동: 표준 API 응답 형식 적용
 */
function errorHandler(err, req, res, _next) {
    // Log error
    logger.error(`[${req.method}] ${req.path}: ${err.message}`, {
        stack: err.stack,
        body: req.body,
        query: req.query
    });
    // Determine status code
    const statusCode = err instanceof AppError ? err.statusCode : 500;
    const includeStack = process.env.NODE_ENV === 'development';
    // Send response
    res.status(statusCode).json(formatError(err, includeStack));
}
/**
 * Async handler wrapper to catch async errors
 * Wraps async route handlers to forward errors to error middleware
 */
function asyncHandler(fn) {
    return (req, res, next) => {
        Promise.resolve(fn(req, res, next)).catch(next);
    };
}
/**
 * Not found handler for undefined routes
 */
function notFoundHandler(req, res, next) {
    next(new NotFoundError(`Route not found: ${req.method} ${req.path}`));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL3V0aWxzL2Vycm9yLWhhbmRsZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOzs7QUF5SEgsb0NBbUJDO0FBTUQsb0NBTUM7QUFLRCwwQ0FFQztBQTVKRCxxQ0FBd0M7QUFDeEMsaURBQWlGO0FBRWpGLE1BQU0sTUFBTSxHQUFHLElBQUEscUJBQVksRUFBQyxjQUFjLENBQUMsQ0FBQztBQUU1Qzs7R0FFRztBQUNILE1BQWEsUUFBUyxTQUFRLEtBQUs7SUFLL0IsWUFDSSxPQUFlLEVBQ2YsYUFBcUIsR0FBRyxFQUN4QixnQkFBeUIsSUFBSSxFQUM3QixJQUFhO1FBRWIsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDN0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7UUFDbkMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFFakIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNsRCxLQUFLLENBQUMsaUJBQWlCLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNwRCxDQUFDO0NBQ0o7QUFuQkQsNEJBbUJDO0FBRUQ7O0dBRUc7QUFDSCxNQUFhLGVBQWdCLFNBQVEsUUFBUTtJQUN6QyxZQUFZLE9BQWU7UUFDdkIsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLGtCQUFrQixDQUFDLENBQUM7SUFDbEQsQ0FBQztDQUNKO0FBSkQsMENBSUM7QUFFRDs7R0FFRztBQUNILE1BQWEsbUJBQW9CLFNBQVEsUUFBUTtJQUM3QyxZQUFZLFVBQWtCLFdBQVc7UUFDckMsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLHNCQUFzQixDQUFDLENBQUM7SUFDdEQsQ0FBQztDQUNK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Q0FBQyxHQUFZLEVBQUUsR0FBYSxFQUFFLElBQWtCO0lBQzNFLElBQUksQ0FBQyxJQUFJLGFBQWEsQ0FBQyxvQkFBb0IsR0FBRyxDQUFDLE1BQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzFFLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL3V0aWxzL2Vycm9yLWhhbmRsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBVbmlmaWVkIEVycm9yIEhhbmRsZXJcbiAqIFN0YW5kYXJkaXplZCBlcnJvciBoYW5kbGluZyBhY3Jvc3MgYWxsIHJvdXRlc1xuICogXG4gKiAjMjQg7Jew64+ZOiBhcGktcmVzcG9uc2Ug7ZGc7KSAIO2YleyLnSDsgqzsmqlcbiAqL1xuXG5pbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSwgTmV4dEZ1bmN0aW9uIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIgfSBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBlcnJvciBhcyBhcGlFcnJvciwgRXJyb3JDb2RlcywgQXBpRXJyb3JSZXNwb25zZSB9IGZyb20gJy4vYXBpLXJlc3BvbnNlJztcblxuY29uc3QgbG9nZ2VyID0gY3JlYXRlTG9nZ2VyKCdFcnJvckhhbmRsZXInKTtcblxuLyoqXG4gKiBCYXNlIGFwcGxpY2F0aW9uIGVycm9yIGNsYXNzXG4gKi9cbmV4cG9ydCBjbGFzcyBBcHBFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBwdWJsaWMgcmVhZG9ubHkgc3RhdHVzQ29kZTogbnVtYmVyO1xuICAgIHB1YmxpYyByZWFkb25seSBpc09wZXJhdGlvbmFsOiBib29sZWFuO1xuICAgIHB1YmxpYyByZWFkb25seSBjb2RlPzogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICAgICAgc3RhdHVzQ29kZTogbnVtYmVyID0gNTAwLFxuICAgICAgICBpc09wZXJhdGlvbmFsOiBib29sZWFuID0gdHJ1ZSxcbiAgICAgICAgY29kZT86IHN0cmluZ1xuICAgICkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgdGhpcy5zdGF0dXNDb2RlID0gc3RhdHVzQ29kZTtcbiAgICAgICAgdGhpcy5pc09wZXJhdGlvbmFsID0gaXNPcGVyYXRpb25hbDtcbiAgICAgICAgdGhpcy5jb2RlID0gY29kZTtcbiAgICAgICAgXG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBuZXcudGFyZ2V0LnByb3RvdHlwZSk7XG4gICAgICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIHRoaXMuY29uc3RydWN0b3IpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0aW9uIGVycm9yICg0MDApXG4gKi9cbmV4cG9ydCBjbGFzcyBWYWxpZGF0aW9uRXJyb3IgZXh0ZW5kcyBBcHBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UsIDQwMCwgdHJ1ZSwgJ1ZBTElEQVRJT05fRVJST1InKTtcbiAgICB9XG59XG5cbi8qKlxuICogQXV0aGVudGljYXRpb24gZXJyb3IgKDQwMSlcbiAqL1xuZXhwb3J0IGNsYXNzIEF1dGhlbnRpY2F0aW9uRXJyb3IgZXh0ZW5kcyBBcHBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nID0gJ+yduOymneydtCDtlYTsmpTtlanri4jri6QnKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UsIDQwMSwgdHJ1ZSwgJ0FVVEhFTlRJQ0FUSU9OX0VSUk9SJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEF1dGhvcml6YXRpb24gZXJyb3IgKDQwMylcbiAqL1xuZXhwb3J0IGNsYXNzIEF1dGhvcml6YXRpb25FcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcgPSAn6raM7ZWc7J20IOyXhuyKteuLiOuLpCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgNDAzLCB0cnVlLCAnQVVUSE9SSVpBVElPTl9FUlJPUicpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBOb3QgZm91bmQgZXJyb3IgKDQwNClcbiAqL1xuZXhwb3J0IGNsYXNzIE5vdEZvdW5kRXJyb3IgZXh0ZW5kcyBBcHBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nID0gJ+umrOyGjOyKpOulvCDssL7snYQg7IiYIOyXhuyKteuLiOuLpCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgNDA0LCB0cnVlLCAnTk9UX0ZPVU5EJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIFJhdGUgbGltaXQgZXJyb3IgKDQyOSlcbiAqL1xuZXhwb3J0IGNsYXNzIFJhdGVMaW1pdEVycm9yIGV4dGVuZHMgQXBwRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZyA9ICfsmpTssq0g7KCc7ZWc7J2EIOy0iOqzvO2WiOyKteuLiOuLpCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgNDI5LCB0cnVlLCAnUkFURV9MSU1JVF9FWENFRURFRCcpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBEYXRhYmFzZSBlcnJvciAoNTAwKVxuICovXG5leHBvcnQgY2xhc3MgRGF0YWJhc2VFcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcgPSAn642w7J207YSw67Kg7J207IqkIOyYpOulmOqwgCDrsJzsg53tlojsirXri4jri6QnKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UsIDUwMCwgdHJ1ZSwgJ0RBVEFCQVNFX0VSUk9SJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIFN0YW5kYXJkIGVycm9yIHJlc3BvbnNlIGludGVyZmFjZVxuICogQGRlcHJlY2F0ZWQgVXNlIEFwaUVycm9yUmVzcG9uc2UgZnJvbSBhcGktcmVzcG9uc2UudHMgaW5zdGVhZFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEVycm9yUmVzcG9uc2Uge1xuICAgIHN1Y2Nlc3M6IGZhbHNlO1xuICAgIGVycm9yOiBzdHJpbmc7XG4gICAgY29kZT86IHN0cmluZztcbiAgICBkZXRhaWxzPzogc3RyaW5nW107XG4gICAgdGltZXN0YW1wOiBzdHJpbmc7XG4gICAgc3RhY2s/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogRm9ybWF0IGVycm9yIGZvciByZXNwb25zZSAoIzI0IOyXsOuPmTog7ZGc7KSAIEFwaUVycm9yUmVzcG9uc2Ug7ZiV7IudKVxuICovXG5mdW5jdGlvbiBmb3JtYXRFcnJvcihlcnI6IEVycm9yLCBpbmNsdWRlU3RhY2s6IGJvb2xlYW4pOiBBcGlFcnJvclJlc3BvbnNlICYgeyBzdGFjaz86IHN0cmluZyB9IHtcbiAgICBjb25zdCBjb2RlID0gZXJyIGluc3RhbmNlb2YgQXBwRXJyb3IgJiYgZXJyLmNvZGUgXG4gICAgICAgID8gZXJyLmNvZGUgXG4gICAgICAgIDogRXJyb3JDb2Rlcy5JTlRFUk5BTF9FUlJPUjtcbiAgICBcbiAgICBjb25zdCByZXNwb25zZSA9IGFwaUVycm9yKGNvZGUsIGVyci5tZXNzYWdlKTtcbiAgICBcbiAgICBpZiAoaW5jbHVkZVN0YWNrICYmIGVyci5zdGFjaykge1xuICAgICAgICByZXR1cm4geyAuLi5yZXNwb25zZSwgc3RhY2s6IGVyci5zdGFjayB9O1xuICAgIH1cblxuICAgIHJldHVybiByZXNwb25zZTtcbn1cblxuLyoqXG4gKiBHbG9iYWwgZXJyb3IgaGFuZGxlciBtaWRkbGV3YXJlXG4gKiBNdXN0IGJlIHJlZ2lzdGVyZWQgTEFTVCBhZnRlciBhbGwgcm91dGVzXG4gKiAjMjQg7Jew64+ZOiDtkZzspIAgQVBJIOydkeuLtSDtmJXsi50g7KCB7JqpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlcnJvckhhbmRsZXIoXG4gICAgZXJyOiBFcnJvcixcbiAgICByZXE6IFJlcXVlc3QsXG4gICAgcmVzOiBSZXNwb25zZSxcbiAgICBfbmV4dDogTmV4dEZ1bmN0aW9uXG4pOiB2b2lkIHtcbiAgICAvLyBMb2cgZXJyb3JcbiAgICBsb2dnZXIuZXJyb3IoYFske3JlcS5tZXRob2R9XSAke3JlcS5wYXRofTogJHtlcnIubWVzc2FnZX1gLCB7XG4gICAgICAgIHN0YWNrOiBlcnIuc3RhY2ssXG4gICAgICAgIGJvZHk6IHJlcS5ib2R5LFxuICAgICAgICBxdWVyeTogcmVxLnF1ZXJ5XG4gICAgfSk7XG5cbiAgICAvLyBEZXRlcm1pbmUgc3RhdHVzIGNvZGVcbiAgICBjb25zdCBzdGF0dXNDb2RlID0gZXJyIGluc3RhbmNlb2YgQXBwRXJyb3IgPyBlcnIuc3RhdHVzQ29kZSA6IDUwMDtcbiAgICBjb25zdCBpbmNsdWRlU3RhY2sgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JztcblxuICAgIC8vIFNlbmQgcmVzcG9uc2VcbiAgICByZXMuc3RhdHVzKHN0YXR1c0NvZGUpLmpzb24oZm9ybWF0RXJyb3IoZXJyLCBpbmNsdWRlU3RhY2spKTtcbn1cblxuLyoqXG4gKiBBc3luYyBoYW5kbGVyIHdyYXBwZXIgdG8gY2F0Y2ggYXN5bmMgZXJyb3JzXG4gKiBXcmFwcyBhc3luYyByb3V0ZSBoYW5kbGVycyB0byBmb3J3YXJkIGVycm9ycyB0byBlcnJvciBtaWRkbGV3YXJlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhc3luY0hhbmRsZXIoXG4gICAgZm46IChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikgPT4gUHJvbWlzZTx1bmtub3duPlxuKSB7XG4gICAgcmV0dXJuIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbik6IHZvaWQgPT4ge1xuICAgICAgICBQcm9taXNlLnJlc29sdmUoZm4ocmVxLCByZXMsIG5leHQpKS5jYXRjaChuZXh0KTtcbiAgICB9O1xufVxuXG4vKipcbiAqIE5vdCBmb3VuZCBoYW5kbGVyIGZvciB1bmRlZmluZWQgcm91dGVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBub3RGb3VuZEhhbmRsZXIocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiB2b2lkIHtcbiAgICBuZXh0KG5ldyBOb3RGb3VuZEVycm9yKGBSb3V0ZSBub3QgZm91bmQ6ICR7cmVxLm1ldGhvZH0gJHtyZXEucGF0aH1gKSk7XG59XG4iXSwidmVyc2lvbiI6M30=