f71f4c43dd19a63d8965b7e65e9a8559
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createAllClients = exports.createClientForIndex = exports.createClient = exports.OllamaClient = void 0;
const axios_1 = __importDefault(require("axios"));
const config_1 = require("../config");
const logger_1 = require("../utils/logger");
const api_key_manager_1 = require("./api-key-manager");
const api_usage_tracker_1 = require("./api-usage-tracker");
const quota_exceeded_error_1 = require("../errors/quota-exceeded.error");
const key_exhaustion_error_1 = require("../errors/key-exhaustion.error");
const agent_loop_1 = require("./agent-loop");
const logger = (0, logger_1.createLogger)('OllamaClient');
const envConfig = (0, config_1.getConfig)();
const DEFAULT_CONFIG = {
    baseUrl: envConfig.ollamaBaseUrl,
    model: envConfig.ollamaDefaultModel,
    timeout: envConfig.ollamaTimeout
};
class OllamaClient {
    constructor(config = {}) {
        this.context = [];
        this.config = Object.assign(Object.assign({}, DEFAULT_CONFIG), config);
        this.apiKeyManager = (0, api_key_manager_1.getApiKeyManager)();
        // üÜï Î™®Îç∏Ïù¥ :cloud Ï†ëÎØ∏ÏÇ¨Î•º Í∞ÄÏßÄÎ©¥ Ollama Cloud Ìò∏Ïä§Ìä∏ ÏÇ¨Ïö©
        let baseUrl = this.config.baseUrl;
        if (this.isCloudModel(this.config.model)) {
            baseUrl = OllamaClient.OLLAMA_CLOUD_HOST;
            console.log(`[OllamaClient] üåê Cloud Î™®Îç∏ Í∞êÏßÄ - Ìò∏Ïä§Ìä∏: ${baseUrl}`);
        }
        this.client = axios_1.default.create({
            baseURL: baseUrl,
            timeout: this.config.timeout,
            headers: Object.assign({ 'Content-Type': 'application/json' }, this.apiKeyManager.getAuthHeaders())
        });
        // üÜï ÏöîÏ≤≠ Ïù∏ÌÑ∞ÏÖâÌÑ∞: ÎèôÏ†Å API ÌÇ§ Ï£ºÏûÖ
        this.client.interceptors.request.use((config) => {
            const authHeaders = this.apiKeyManager.getAuthHeaders();
            if (authHeaders.Authorization) {
                config.headers.Authorization = authHeaders.Authorization;
            }
            return config;
        });
        // üÜï ÏùëÎãµ Ïù∏ÌÑ∞ÏÖâÌÑ∞: Ïã§Ìå® Ïãú Ìè¥Î∞± Ï≤òÎ¶¨ (Î™®Îì† API ÌÇ§ ÏàúÌôò ÏãúÎèÑ)
        this.client.interceptors.response.use((response) => {
            this.apiKeyManager.reportSuccess();
            return response;
        }, (error) => __awaiter(this, void 0, void 0, function* () {
            var _a, _b;
            const statusCode = (_a = error === null || error === void 0 ? void 0 : error.response) === null || _a === void 0 ? void 0 : _a.status;
            console.log(`[OllamaClient] ‚ùå ÏöîÏ≤≠ Ïã§Ìå® - ÏÉÅÌÉú ÏΩîÎìú: ${statusCode}`);
            // ÎÑ§Ìä∏ÏõåÌÅ¨ ÏóêÎü¨ (ETIMEDOUT, ECONNREFUSED Îì±) Ïãú Ïû¨ÏãúÎèÑ
            const isNetworkError = !statusCode && (error.code === 'ETIMEDOUT' ||
                error.code === 'ECONNREFUSED' ||
                error.code === 'ECONNRESET' ||
                error.code === 'ENOTFOUND' ||
                error.code === 'EAI_AGAIN');
            // 429, 401, 403 ÏóêÎü¨ Ïãú API ÌÇ§ Ïä§ÏôÄÌïë ÏãúÎèÑ
            if (statusCode === 429 || statusCode === 401 || statusCode === 403) {
                // Ïû¨ÏãúÎèÑ ÌöüÏàò Ï∂îÏ†Å (ÌÇ§ Í∞úÏàòÎßåÌÅº ÏãúÎèÑ)
                const retryCount = ((_b = error.config) === null || _b === void 0 ? void 0 : _b._retryCount) || 0;
                const maxRetries = this.apiKeyManager.getTotalKeys() - 1;
                console.log(`[OllamaClient] üîÑ API ÌÇ§ Ïä§ÏôÄÌïë ÏãúÎèÑ Ï§ë... (${retryCount + 1}/${maxRetries + 1})`);
                const switched = this.apiKeyManager.reportFailure(error);
                if (switched && error.config && retryCount < maxRetries) {
                    error.config._retryCount = retryCount + 1;
                    const newAuthHeaders = this.apiKeyManager.getAuthHeaders();
                    error.config.headers.Authorization = newAuthHeaders.Authorization;
                    console.log(`[OllamaClient] ‚úÖ ÏÉà API ÌÇ§Î°ú Ïû¨ÏãúÎèÑ (Key ${this.apiKeyManager.getCurrentKeyIndex() + 1})...`);
                    return this.client.request(error.config);
                }
                else {
                    console.log(`[OllamaClient] ‚ö†Ô∏è Î™®Îì† ÌÇ§ ÏÜåÏßÑ - switched: ${switched}, retryCount: ${retryCount}/${maxRetries}`);
                    // üÜï Î™®Îì† ÌÇ§Í∞Ä ÏÜåÏßÑÎêòÏóàÏùÑ Îïå KeyExhaustionError throw
                    const nextResetTime = this.apiKeyManager.getNextResetTime();
                    if (nextResetTime) {
                        const totalKeys = this.apiKeyManager.getTotalKeys();
                        const keysInCooldown = this.apiKeyManager.getKeysInCooldownCount();
                        throw new key_exhaustion_error_1.KeyExhaustionError(nextResetTime, totalKeys, keysInCooldown);
                    }
                }
            }
            else if (isNetworkError && error.config) {
                // ÎÑ§Ìä∏ÏõåÌÅ¨ ÏùºÏãú Ïû•Ïï† Ïãú ÏµúÎåÄ 2Ìöå Ïû¨ÏãúÎèÑ (ÏßÄÏàò Î∞±Ïò§ÌîÑ)
                const retryCount = error.config._retryCount || 0;
                const maxNetworkRetries = 2;
                if (retryCount < maxNetworkRetries) {
                    error.config._retryCount = retryCount + 1;
                    const backoffMs = Math.pow(2, retryCount) * 1000; // 1s, 2s
                    console.log(`[OllamaClient] üîÑ ÎÑ§Ìä∏ÏõåÌÅ¨ ÏóêÎü¨(${error.code}) - ${backoffMs}ms ÌõÑ Ïû¨ÏãúÎèÑ (${retryCount + 1}/${maxNetworkRetries})`);
                    yield new Promise(resolve => setTimeout(resolve, backoffMs));
                    return this.client.request(error.config);
                }
                console.log(`[OllamaClient] ‚ö†Ô∏è ÎÑ§Ìä∏ÏõåÌÅ¨ Ïû¨ÏãúÎèÑ ÏÜåÏßÑ (${error.code})`);
                this.apiKeyManager.reportFailure(error);
            }
            else {
                this.apiKeyManager.reportFailure(error);
            }
            throw error;
        }));
    }
    get model() {
        return this.config.model;
    }
    /**
     * üÜï Î™®Îç∏Ïù¥ Cloud Î™®Îç∏(:cloud Ï†ëÎØ∏ÏÇ¨)Ïù∏ÏßÄ ÌôïÏù∏
     */
    isCloudModel(model) {
        var _a;
        return (_a = model === null || model === void 0 ? void 0 : model.toLowerCase().endsWith(':cloud')) !== null && _a !== void 0 ? _a : false;
    }
    setModel(model) {
        this.config.model = model;
    }
    listModels() {
        return __awaiter(this, void 0, void 0, function* () {
            const response = yield this.client.get('/api/tags');
            return response.data;
        });
    }
    /**
     * Check API quota before making a request.
     * Throws QuotaExceededError if hourly or weekly limit is exceeded.
     */
    checkQuota() {
        try {
            const tracker = (0, api_usage_tracker_1.getApiUsageTracker)();
            const quota = tracker.getQuotaStatus();
            if (quota.hourly.remaining <= 0 && quota.weekly.remaining <= 0) {
                throw new quota_exceeded_error_1.QuotaExceededError('both', quota.weekly.used, quota.weekly.limit);
            }
            if (quota.hourly.remaining <= 0) {
                throw new quota_exceeded_error_1.QuotaExceededError('hourly', quota.hourly.used, quota.hourly.limit);
            }
            if (quota.weekly.remaining <= 0) {
                throw new quota_exceeded_error_1.QuotaExceededError('weekly', quota.weekly.used, quota.weekly.limit);
            }
        }
        catch (error) {
            // Re-throw QuotaExceededError, ignore other errors (tracker init failures)
            if (error instanceof quota_exceeded_error_1.QuotaExceededError) {
                throw error;
            }
            logger.warn('Quota check failed (non-blocking):', error);
        }
    }
    generate(prompt, options, onToken, images) {
        return __awaiter(this, void 0, void 0, function* () {
            this.checkQuota();
            const request = {
                model: this.config.model,
                prompt,
                context: this.context,
                stream: !!onToken,
                options,
                images
            };
            if (onToken) {
                return this.streamGenerate(request, onToken);
            }
            const response = yield this.client.post('/api/generate', request);
            this.context = response.data.context || [];
            return {
                response: response.data.response,
                metrics: {
                    total_duration: response.data.total_duration,
                    load_duration: response.data.load_duration,
                    prompt_eval_count: response.data.prompt_eval_count,
                    prompt_eval_duration: response.data.prompt_eval_duration,
                    eval_count: response.data.eval_count,
                    eval_duration: response.data.eval_duration
                }
            };
        });
    }
    streamGenerate(request, onToken) {
        return __awaiter(this, void 0, void 0, function* () {
            const response = yield this.client.post('/api/generate', request, {
                responseType: 'stream'
            });
            let fullResponse = '';
            let metrics;
            return new Promise((resolve, reject) => {
                let buffer = '';
                response.data.on('data', (chunk) => {
                    buffer += chunk.toString();
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || '';
                    for (const line of lines) {
                        if (line.trim()) {
                            try {
                                const data = JSON.parse(line);
                                if (data.response) {
                                    fullResponse += data.response;
                                    onToken(data.response);
                                }
                                if (data.done) {
                                    if (data.context) {
                                        this.context = data.context;
                                    }
                                    metrics = {
                                        total_duration: data.total_duration,
                                        load_duration: data.load_duration,
                                        prompt_eval_count: data.prompt_eval_count,
                                        prompt_eval_duration: data.prompt_eval_duration,
                                        eval_count: data.eval_count,
                                        eval_duration: data.eval_duration
                                    };
                                }
                            }
                            catch (e) {
                                console.error('[OllamaClient] JSON Parse Error:', e);
                            }
                        }
                    }
                });
                response.data.on('end', () => {
                    if (buffer.trim()) {
                        try {
                            const data = JSON.parse(buffer);
                            if (data.response) {
                                fullResponse += data.response;
                                onToken(data.response);
                            }
                            if (data.done) {
                                metrics = {
                                    total_duration: data.total_duration,
                                    load_duration: data.load_duration,
                                    prompt_eval_count: data.prompt_eval_count,
                                    prompt_eval_duration: data.prompt_eval_duration,
                                    eval_count: data.eval_count,
                                    eval_duration: data.eval_duration
                                };
                            }
                        }
                        catch (e) { /* ignore */ }
                    }
                    resolve({ response: fullResponse, metrics });
                });
                response.data.on('error', reject);
            });
        });
    }
    /**
     * Enhanced chat with Thinking, Structured Outputs, and Tool Calling support
     */
    chat(messages, options, onToken, advancedOptions) {
        return __awaiter(this, void 0, void 0, function* () {
            this.checkQuota();
            const request = Object.assign(Object.assign(Object.assign({ model: this.config.model, messages, stream: !!onToken, options }, ((advancedOptions === null || advancedOptions === void 0 ? void 0 : advancedOptions.think) !== undefined && { think: advancedOptions.think })), ((advancedOptions === null || advancedOptions === void 0 ? void 0 : advancedOptions.format) && { format: advancedOptions.format })), ((advancedOptions === null || advancedOptions === void 0 ? void 0 : advancedOptions.tools) && { tools: advancedOptions.tools }));
            if (onToken) {
                return this.streamChat(request, onToken);
            }
            const response = yield this.client.post('/api/chat', request);
            return Object.assign(Object.assign({}, response.data.message), { metrics: {
                    total_duration: response.data.total_duration,
                    load_duration: response.data.load_duration,
                    prompt_eval_count: response.data.prompt_eval_count,
                    prompt_eval_duration: response.data.prompt_eval_duration,
                    eval_count: response.data.eval_count,
                    eval_duration: response.data.eval_duration
                } });
        });
    }
    streamChat(request, onToken) {
        return __awaiter(this, void 0, void 0, function* () {
            const response = yield this.client.post('/api/chat', request, {
                responseType: 'stream'
            });
            let fullContent = '';
            let fullThinking = '';
            let toolCalls = [];
            let metrics;
            return new Promise((resolve, reject) => {
                let buffer = '';
                response.data.on('data', (chunk) => {
                    var _a, _b, _c;
                    // logger.debug(`Data chunk received: ${chunk.length} bytes`); // Log noise reduction
                    buffer += chunk.toString();
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || '';
                    for (const line of lines) {
                        if (line.trim()) {
                            try {
                                const data = JSON.parse(line);
                                // Handle thinking trace
                                if ((_a = data.message) === null || _a === void 0 ? void 0 : _a.thinking) {
                                    fullThinking += data.message.thinking;
                                    onToken('', data.message.thinking);
                                }
                                // Handle content
                                if ((_b = data.message) === null || _b === void 0 ? void 0 : _b.content) {
                                    fullContent += data.message.content;
                                    onToken(data.message.content);
                                }
                                // Handle tool calls
                                if ((_c = data.message) === null || _c === void 0 ? void 0 : _c.tool_calls) {
                                    toolCalls = data.message.tool_calls;
                                }
                                if (data.done) {
                                    metrics = {
                                        total_duration: data.total_duration,
                                        load_duration: data.load_duration,
                                        prompt_eval_count: data.prompt_eval_count,
                                        prompt_eval_duration: data.prompt_eval_duration,
                                        eval_count: data.eval_count,
                                        eval_duration: data.eval_duration
                                    };
                                }
                            }
                            catch (e) {
                                console.error('[OllamaClient] Chat JSON Parse Error:', e);
                            }
                        }
                    }
                });
                response.data.on('end', () => {
                    var _a, _b, _c;
                    if (buffer.trim()) {
                        try {
                            const data = JSON.parse(buffer);
                            if ((_a = data.message) === null || _a === void 0 ? void 0 : _a.thinking)
                                fullThinking += data.message.thinking;
                            if ((_b = data.message) === null || _b === void 0 ? void 0 : _b.content) {
                                fullContent += data.message.content;
                                onToken(data.message.content);
                            }
                            if ((_c = data.message) === null || _c === void 0 ? void 0 : _c.tool_calls)
                                toolCalls = data.message.tool_calls;
                            if (data.done) {
                                metrics = {
                                    total_duration: data.total_duration,
                                    load_duration: data.load_duration,
                                    prompt_eval_count: data.prompt_eval_count,
                                    prompt_eval_duration: data.prompt_eval_duration,
                                    eval_count: data.eval_count,
                                    eval_duration: data.eval_duration
                                };
                            }
                        }
                        catch (e) { /* ignore */ }
                    }
                    const result = {
                        role: 'assistant',
                        content: fullContent,
                        metrics
                    };
                    if (fullThinking) {
                        result.thinking = fullThinking;
                    }
                    if (toolCalls.length > 0) {
                        result.tool_calls = toolCalls;
                    }
                    resolve(result);
                });
                response.data.on('error', reject);
            });
        });
    }
    /**
     * Generate embeddings for text (Ollama Embeddings API)
     */
    embed(input, model) {
        return __awaiter(this, void 0, void 0, function* () {
            const request = {
                model: model || 'embeddinggemma',
                input
            };
            const response = yield this.client.post('/api/embed', request);
            return response.data.embeddings;
        });
    }
    isAvailable() {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                yield this.client.get('/');
                return true;
            }
            catch (_a) {
                return false;
            }
        });
    }
    clearContext() {
        this.context = [];
    }
    // ============================================
    // Ollama Web Search API Methods
    // ============================================
    /**
     * Ollama Í≥µÏãù Web Search API
     * https://ollama.com/api/web_search
     */
    webSearch(query_1) {
        return __awaiter(this, arguments, void 0, function* (query, maxResults = 5) {
            var _a;
            const request = {
                query,
                max_results: Math.min(maxResults, 10)
            };
            console.log(`[OllamaClient] üîç Web Search: "${query}"`);
            try {
                // Ollama Í≥µÏãù API ÏóîÎìúÌè¨Ïù∏Ìä∏
                const response = yield this.client.post('https://ollama.com/api/web_search', request, {
                    baseURL: '', // Override baseURL to use absolute URL
                    headers: Object.assign({ 'Content-Type': 'application/json' }, this.apiKeyManager.getAuthHeaders())
                });
                console.log(`[OllamaClient] ‚úÖ Web Search: ${((_a = response.data.results) === null || _a === void 0 ? void 0 : _a.length) || 0}Í∞ú Í≤∞Í≥º`);
                return response.data;
            }
            catch (error) {
                console.error('[OllamaClient] Web Search Ïã§Ìå®:', (error instanceof Error ? error.message : String(error)));
                return { results: [] };
            }
        });
    }
    /**
     * Ollama Í≥µÏãù Web Fetch API
     * https://ollama.com/api/web_fetch
     */
    webFetch(url) {
        return __awaiter(this, void 0, void 0, function* () {
            const request = { url };
            console.log(`[OllamaClient] üì• Web Fetch: ${url}`);
            try {
                const response = yield this.client.post('https://ollama.com/api/web_fetch', request, {
                    baseURL: '',
                    headers: Object.assign({ 'Content-Type': 'application/json' }, this.apiKeyManager.getAuthHeaders())
                });
                console.log(`[OllamaClient] ‚úÖ Web Fetch: "${response.data.title}"`);
                return response.data;
            }
            catch (error) {
                console.error('[OllamaClient] Web Fetch Ïã§Ìå®:', (error instanceof Error ? error.message : String(error)));
                return { title: '', content: '', links: [] };
            }
        });
    }
    // ============================================
    // Multi-turn Tool Calling (Agent Loop)
    // ============================================
    /**
     * Multi-turn Tool Calling Agent Loop Ïã§Ìñâ
     *
     * ÎèÑÍµ¨ Ìò∏Ï∂úÏù¥ ÏóÜÏùÑ ÎïåÍπåÏßÄ ÏûêÎèôÏúºÎ°ú ÎåÄÌôîÎ•º Ïù¥Ïñ¥Í∞ëÎãàÎã§.
     * Í≥µÏãù Î¨∏ÏÑú: https://docs.ollama.com/capabilities/tool-calling#multi-turn-tool-calling-agent-loop
     *
     * @example
     * ```typescript
     * const result = await client.runAgentLoop(
     *   [{ role: 'user', content: 'ÏÑúÏö∏ ÎÇ†Ïî® ÏïåÎ†§Ï§ò' }],
     *   [weatherTool],
     *   { get_weather: getWeatherFunc },
     *   { onToolCall: (name, args, result) => console.log(`Tool: ${name}`) }
     * );
     * ```
     */
    runAgentLoop(messages, tools, availableFunctions, options) {
        return __awaiter(this, void 0, void 0, function* () {
            return (0, agent_loop_1.runAgentLoop)({
                model: this.config.model,
                messages,
                tools,
                availableFunctions,
                think: options === null || options === void 0 ? void 0 : options.think,
                stream: options === null || options === void 0 ? void 0 : options.stream,
                onToken: options === null || options === void 0 ? void 0 : options.onToken,
                onToolCall: options === null || options === void 0 ? void 0 : options.onToolCall,
                maxIterations: options === null || options === void 0 ? void 0 : options.maxIterations
            });
        });
    }
}
exports.OllamaClient = OllamaClient;
// üÜï Ollama Cloud Ìò∏Ïä§Ìä∏ ÏÉÅÏàò
OllamaClient.OLLAMA_CLOUD_HOST = 'https://ollama.com';
const createClient = (config) => {
    return new OllamaClient(config);
};
exports.createClient = createClient;
/**
 * üÜï ÌäπÏ†ï Ïù∏Îç±Ïä§Ïùò ÌÇ§-Î™®Îç∏ ÏåçÏúºÎ°ú ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉùÏÑ± (A2AÏö©)
 * @param index API ÌÇ§ Ïù∏Îç±Ïä§ (0-based)
 * @returns Ìï¥Îãπ ÌÇ§-Î™®Îç∏ ÏåçÏúºÎ°ú Íµ¨ÏÑ±Îêú OllamaClient
 */
const createClientForIndex = (index) => {
    const keyManager = (0, api_key_manager_1.getApiKeyManager)();
    const pair = keyManager.getKeyModelPair(index);
    if (!pair) {
        console.error(`[OllamaClient] ‚ùå Ïù∏Îç±Ïä§ ${index}Ïóê Ìï¥ÎãπÌïòÎäî ÌÇ§-Î™®Îç∏ ÏåçÏù¥ ÏóÜÏäµÎãàÎã§.`);
        return null;
    }
    console.log(`[OllamaClient] üéØ Ïù∏Îç±Ïä§ ${index + 1} ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉùÏÑ±: ${pair.model}`);
    return new OllamaClient({ model: pair.model });
};
exports.createClientForIndex = createClientForIndex;
/**
 * üÜï Î™®Îì† ÌÇ§-Î™®Îç∏ ÏåçÏóê ÎåÄÌï¥ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Î∞∞Ïó¥ ÏÉùÏÑ± (A2A Î≥ëÎ†¨ Ï≤òÎ¶¨Ïö©)
 * @returns OllamaClient Î∞∞Ïó¥
 */
const createAllClients = () => {
    const keyManager = (0, api_key_manager_1.getApiKeyManager)();
    const pairs = keyManager.getAllKeyModelPairs();
    console.log(`[OllamaClient] üöÄ ${pairs.length}Í∞ú A2A ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉùÏÑ± Ï§ë...`);
    const clients = pairs.map(pair => {
        // Í∞Å ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉùÏÑ± Ï†ÑÏóê Ìï¥Îãπ Ïù∏Îç±Ïä§Î°ú ÌÇ§ Îß§ÎãàÏ†Ä ÏÑ§Ï†ï
        const client = new OllamaClient({ model: pair.model });
        return client;
    });
    console.log(`[OllamaClient] ‚úÖ ${clients.length}Í∞ú A2A ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï§ÄÎπÑ ÏôÑÎ£å`);
    return clients;
};
exports.createAllClients = createAllClients;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL29sbGFtYS9jbGllbnQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsa0RBQTZDO0FBc0I3QyxzQ0FBc0M7QUFDdEMsNENBQStDO0FBQy9DLHVEQUFvRTtBQUNwRSwyREFBeUQ7QUFDekQseUVBQW9FO0FBQ3BFLHlFQUFvRTtBQUNwRSw2Q0FBK0U7QUFFL0UsTUFBTSxNQUFNLEdBQUcsSUFBQSxxQkFBWSxFQUFDLGNBQWMsQ0FBQyxDQUFDO0FBRTVDLE1BQU0sU0FBUyxHQUFHLElBQUEsa0JBQVMsR0FBRSxDQUFDO0FBRTlCLE1BQU0sY0FBYyxHQUFpQjtJQUNqQyxPQUFPLEVBQUUsU0FBUyxDQUFDLGFBQWE7SUFDaEMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxrQkFBa0I7SUFDbkMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxhQUFhO0NBQ25DLENBQUM7QUFFRixNQUFhLFlBQVk7SUFTckIsWUFBWSxTQUFnQyxFQUFFO1FBTnRDLFlBQU8sR0FBYSxFQUFFLENBQUM7UUFPM0IsSUFBSSxDQUFDLE1BQU0sbUNBQVEsY0FBYyxHQUFLLE1BQU0sQ0FBRSxDQUFDO1FBQy9DLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBQSxrQ0FBZ0IsR0FBRSxDQUFDO1FBRXhDLDZDQUE2QztRQUM3QyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztRQUNsQyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3ZDLE9BQU8sR0FBRyxZQUFZLENBQUMsaUJBQWlCLENBQUM7WUFDekMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3Q0FBd0MsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUNuRSxDQUFDO1FBRUQsSUFBSSxDQUFDLE1BQU0sR0FBRyxlQUFLLENBQUMsTUFBTSxDQUFDO1lBQ3ZCLE9BQU8sRUFBRSxPQUFPO1lBQ2hCLE9B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LEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztBQUNuRCxDQUFDLENBQUM7QUFYVyxRQUFBLG9CQUFvQix3QkFXL0I7QUFFRjs7O0dBR0c7QUFDSSxNQUFNLGdCQUFnQixHQUFHLEdBQW1CLEVBQUU7SUFDakQsTUFBTSxVQUFVLEdBQUcsSUFBQSxrQ0FBZ0IsR0FBRSxDQUFDO0lBQ3RDLE1BQU0sS0FBSyxHQUFHLFVBQVUsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO0lBRS9DLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLEtBQUssQ0FBQyxNQUFNLHFCQUFxQixDQUFDLENBQUM7SUFFcEUsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUM3QixpQ0FBaUM7UUFDakMsTUFBTSxNQUFNLEdBQUcsSUFBSSxZQUFZLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDdkQsT0FBTyxNQUFNLENBQUM7SUFDbEIsQ0FBQyxDQUFDLENBQUM7SUFFSCxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixPQUFPLENBQUMsTUFBTSxtQkFBbUIsQ0FBQyxDQUFDO0lBQ25FLE9BQU8sT0FBTyxDQUFDO0FBQ25CLENBQUMsQ0FBQztBQWRXLFFBQUEsZ0JBQWdCLG9CQWMzQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVm9sdW1lcy9NQUNfQVBQL29wZW5tYWtlX2xsbS9iYWNrZW5kL2FwaS9zcmMvb2xsYW1hL2NsaWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MsIHsgQXhpb3NJbnN0YW5jZSB9IGZyb20gJ2F4aW9zJztcbmltcG9ydCB7XG4gICAgT2xsYW1hQ29uZmlnLFxuICAgIEdlbmVyYXRlUmVxdWVzdCxcbiAgICBHZW5lcmF0ZVJlc3BvbnNlLFxuICAgIENoYXRSZXF1ZXN0LFxuICAgIENoYXRSZXNwb25zZSxcbiAgICBDaGF0TWVzc2FnZSxcbiAgICBMaXN0TW9kZWxzUmVzcG9uc2UsXG4gICAgTW9kZWxPcHRpb25zLFxuICAgIFRoaW5rT3B0aW9uLFxuICAgIEZvcm1hdE9wdGlvbixcbiAgICBUb29sRGVmaW5pdGlvbixcbiAgICBUb29sQ2FsbCxcbiAgICBFbWJlZFJlcXVlc3QsXG4gICAgRW1iZWRSZXNwb25zZSxcbiAgICBVc2FnZU1ldHJpY3MsXG4gICAgV2ViU2VhcmNoUmVxdWVzdCxcbiAgICBXZWJTZWFyY2hSZXNwb25zZSxcbiAgICBXZWJGZXRjaFJlcXVlc3QsXG4gICAgV2ViRmV0Y2hSZXNwb25zZVxufSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IGdldENvbmZpZyB9IGZyb20gJy4uL2NvbmZpZyc7XG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZ2V0QXBpS2V5TWFuYWdlciwgQXBpS2V5TWFuYWdlciB9IGZyb20gJy4vYXBpLWtleS1tYW5hZ2VyJztcbmltcG9ydCB7IGdldEFwaVVzYWdlVHJhY2tlciB9IGZyb20gJy4vYXBpLXVzYWdlLXRyYWNrZXInO1xuaW1wb3J0IHsgUXVvdGFFeGNlZWRlZEVycm9yIH0gZnJvbSAnLi4vZXJyb3JzL3F1b3RhLWV4Y2VlZGVkLmVycm9yJztcbmltcG9ydCB7IEtleUV4aGF1c3Rpb25FcnJvciB9IGZyb20gJy4uL2Vycm9ycy9rZXktZXhoYXVzdGlvbi5lcnJvcic7XG5pbXBvcnQgeyBydW5BZ2VudExvb3AsIEFnZW50TG9vcE9wdGlvbnMsIEFnZW50TG9vcFJlc3VsdCB9IGZyb20gJy4vYWdlbnQtbG9vcCc7XG5cbmNvbnN0IGxvZ2dlciA9IGNyZWF0ZUxvZ2dlcignT2xsYW1hQ2xpZW50Jyk7XG5cbmNvbnN0IGVudkNvbmZpZyA9IGdldENvbmZpZygpO1xuXG5jb25zdCBERUZBVUxUX0NPTkZJRzogT2xsYW1hQ29uZmlnID0ge1xuICAgIGJhc2VVcmw6IGVudkNvbmZpZy5vbGxhbWFCYXNlVXJsLFxuICAgIG1vZGVsOiBlbnZDb25maWcub2xsYW1hRGVmYXVsdE1vZGVsLFxuICAgIHRpbWVvdXQ6IGVudkNvbmZpZy5vbGxhbWFUaW1lb3V0XG59O1xuXG5leHBvcnQgY2xhc3MgT2xsYW1hQ2xpZW50IHtcbiAgICBwcml2YXRlIGNsaWVudDogQXhpb3NJbnN0YW5jZTtcbiAgICBwcml2YXRlIGNvbmZpZzogT2xsYW1hQ29uZmlnO1xuICAgIHByaXZhdGUgY29udGV4dDogbnVtYmVyW10gPSBbXTtcbiAgICBwcml2YXRlIGFwaUtleU1hbmFnZXI6IEFwaUtleU1hbmFnZXI7XG5cbiAgICAvLyDwn4aVIE9sbGFtYSBDbG91ZCDtmLjsiqTtirgg7IOB7IiYXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgT0xMQU1BX0NMT1VEX0hPU1QgPSAnaHR0cHM6Ly9vbGxhbWEuY29tJztcblxuICAgIGNvbnN0cnVjdG9yKGNvbmZpZzogUGFydGlhbDxPbGxhbWFDb25maWc+ID0ge30pIHtcbiAgICAgICAgdGhpcy5jb25maWcgPSB7IC4uLkRFRkFVTFRfQ09ORklHLCAuLi5jb25maWcgfTtcbiAgICAgICAgdGhpcy5hcGlLZXlNYW5hZ2VyID0gZ2V0QXBpS2V5TWFuYWdlcigpO1xuXG4gICAgICAgIC8vIPCfhpUg66qo64247J20IDpjbG91ZCDsoJHrr7jsgqzrpbwg6rCA7KeA66m0IE9sbGFtYSBDbG91ZCDtmLjsiqTtirgg7IKs7JqpXG4gICAgICAgIGxldCBiYXNlVXJsID0gdGhpcy5jb25maWcuYmFzZVVybDtcbiAgICAgICAgaWYgKHRoaXMuaXNDbG91ZE1vZGVsKHRoaXMuY29uZmlnLm1vZGVsKSkge1xuICAgICAgICAgICAgYmFzZVVybCA9IE9sbGFtYUNsaWVudC5PTExBTUFfQ0xPVURfSE9TVDtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbT2xsYW1hQ2xpZW50XSDwn4yQIENsb3VkIOuqqOuNuCDqsJDsp4AgLSDtmLjsiqTtirg6ICR7YmFzZVVybH1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY2xpZW50ID0gYXhpb3MuY3JlYXRlKHtcbiAgICAgICAgICAgIGJhc2VVUkw6IGJhc2VVcmwsXG4gICAgICAgICAgICB0aW1lb3V0OiB0aGlzLmNvbmZpZy50aW1lb3V0LFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgLi4udGhpcy5hcGlLZXlNYW5hZ2VyLmdldEF1dGhIZWFkZXJzKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8g8J+GlSDsmpTssq0g7J247YSw7IWJ7YSwOiDrj5nsoIEgQVBJIO2CpCDso7zsnoVcbiAgICAgICAgdGhpcy5jbGllbnQuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKChjb25maWcpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGF1dGhIZWFkZXJzID0gdGhpcy5hcGlLZXlNYW5hZ2VyLmdldEF1dGhIZWFkZXJzKCk7XG4gICAgICAgICAgICBpZiAoYXV0aEhlYWRlcnMuQXV0aG9yaXphdGlvbikge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSBhdXRoSGVhZGVycy5BdXRob3JpemF0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8g8J+GlSDsnZHri7Ug7J247YSw7IWJ7YSwOiDsi6TtjKgg7IucIO2PtOuwsSDsspjrpqwgKOuqqOuToCBBUEkg7YKkIOyInO2ZmCDsi5zrj4QpXG4gICAgICAgIHRoaXMuY2xpZW50LmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UoXG4gICAgICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFwaUtleU1hbmFnZXIucmVwb3J0U3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhc3luYyAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXNDb2RlID0gZXJyb3I/LnJlc3BvbnNlPy5zdGF0dXM7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtPbGxhbWFDbGllbnRdIOKdjCDsmpTssq0g7Iuk7YyoIC0g7IOB7YOcIOy9lOuTnDogJHtzdGF0dXNDb2RlfWApO1xuXG4gICAgICAgICAgICAgICAgLy8g64Sk7Yq47JuM7YGsIOyXkOufrCAoRVRJTUVET1VULCBFQ09OTlJFRlVTRUQg65OxKSDsi5wg7J6s7Iuc64+EXG4gICAgICAgICAgICAgICAgY29uc3QgaXNOZXR3b3JrRXJyb3IgPSAhc3RhdHVzQ29kZSAmJiAoXG4gICAgICAgICAgICAgICAgICAgIGVycm9yLmNvZGUgPT09ICdFVElNRURPVVQnIHx8XG4gICAgICAgICAgICAgICAgICAgIGVycm9yLmNvZGUgPT09ICdFQ09OTlJFRlVTRUQnIHx8XG4gICAgICAgICAgICAgICAgICAgIGVycm9yLmNvZGUgPT09ICdFQ09OTlJFU0VUJyB8fFxuICAgICAgICAgICAgICAgICAgICBlcnJvci5jb2RlID09PSAnRU5PVEZPVU5EJyB8fFxuICAgICAgICAgICAgICAgICAgICBlcnJvci5jb2RlID09PSAnRUFJX0FHQUlOJ1xuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAvLyA0MjksIDQwMSwgNDAzIOyXkOufrCDsi5wgQVBJIO2CpCDsiqTsmYDtlZEg7Iuc64+EXG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1c0NvZGUgPT09IDQyOSB8fCBzdGF0dXNDb2RlID09PSA0MDEgfHwgc3RhdHVzQ29kZSA9PT0gNDAzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIOyerOyLnOuPhCDtmp/siJgg7LaU7KCBICjtgqQg6rCc7IiY66eM7YG8IOyLnOuPhClcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmV0cnlDb3VudCA9IGVycm9yLmNvbmZpZz8uX3JldHJ5Q291bnQgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4UmV0cmllcyA9IHRoaXMuYXBpS2V5TWFuYWdlci5nZXRUb3RhbEtleXMoKSAtIDE7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtPbGxhbWFDbGllbnRdIPCflIQgQVBJIO2CpCDsiqTsmYDtlZEg7Iuc64+EIOykkS4uLiAoJHtyZXRyeUNvdW50ICsgMX0vJHttYXhSZXRyaWVzICsgMX0pYCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN3aXRjaGVkID0gdGhpcy5hcGlLZXlNYW5hZ2VyLnJlcG9ydEZhaWx1cmUoZXJyb3IpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChzd2l0Y2hlZCAmJiBlcnJvci5jb25maWcgJiYgcmV0cnlDb3VudCA8IG1heFJldHJpZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLmNvbmZpZy5fcmV0cnlDb3VudCA9IHJldHJ5Q291bnQgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3QXV0aEhlYWRlcnMgPSB0aGlzLmFwaUtleU1hbmFnZXIuZ2V0QXV0aEhlYWRlcnMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLmNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSBuZXdBdXRoSGVhZGVycy5BdXRob3JpemF0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtPbGxhbWFDbGllbnRdIOKchSDsg4ggQVBJIO2CpOuhnCDsnqzsi5zrj4QgKEtleSAke3RoaXMuYXBpS2V5TWFuYWdlci5nZXRDdXJyZW50S2V5SW5kZXgoKSArIDF9KS4uLmApO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnJlcXVlc3QoZXJyb3IuY29uZmlnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbT2xsYW1hQ2xpZW50XSDimqDvuI8g66qo65OgIO2CpCDshozsp4QgLSBzd2l0Y2hlZDogJHtzd2l0Y2hlZH0sIHJldHJ5Q291bnQ6ICR7cmV0cnlDb3VudH0vJHttYXhSZXRyaWVzfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDwn4aVIOuqqOuToCDtgqTqsIAg7IaM7KeE65CY7JeI7J2EIOuVjCBLZXlFeGhhdXN0aW9uRXJyb3IgdGhyb3dcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRSZXNldFRpbWUgPSB0aGlzLmFwaUtleU1hbmFnZXIuZ2V0TmV4dFJlc2V0VGltZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRSZXNldFRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbEtleXMgPSB0aGlzLmFwaUtleU1hbmFnZXIuZ2V0VG90YWxLZXlzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5c0luQ29vbGRvd24gPSB0aGlzLmFwaUtleU1hbmFnZXIuZ2V0S2V5c0luQ29vbGRvd25Db3VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBLZXlFeGhhdXN0aW9uRXJyb3IobmV4dFJlc2V0VGltZSwgdG90YWxLZXlzLCBrZXlzSW5Db29sZG93bik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTmV0d29ya0Vycm9yICYmIGVycm9yLmNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICAvLyDrhKTtirjsm4ztgawg7J287IucIOyepeyVoCDsi5wg7LWc64yAIDLtmowg7J6s7Iuc64+EICjsp4DsiJgg67Cx7Jik7ZSEKVxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXRyeUNvdW50ID0gZXJyb3IuY29uZmlnLl9yZXRyeUNvdW50IHx8IDA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heE5ldHdvcmtSZXRyaWVzID0gMjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJldHJ5Q291bnQgPCBtYXhOZXR3b3JrUmV0cmllcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IuY29uZmlnLl9yZXRyeUNvdW50ID0gcmV0cnlDb3VudCArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiYWNrb2ZmTXMgPSBNYXRoLnBvdygyLCByZXRyeUNvdW50KSAqIDEwMDA7IC8vIDFzLCAyc1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtPbGxhbWFDbGllbnRdIPCflIQg64Sk7Yq47JuM7YGsIOyXkOufrCgke2Vycm9yLmNvZGV9KSAtICR7YmFja29mZk1zfW1zIO2bhCDsnqzsi5zrj4QgKCR7cmV0cnlDb3VudCArIDF9LyR7bWF4TmV0d29ya1JldHJpZXN9KWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGJhY2tvZmZNcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnJlcXVlc3QoZXJyb3IuY29uZmlnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgW09sbGFtYUNsaWVudF0g4pqg77iPIOuEpO2KuOybjO2BrCDsnqzsi5zrj4Qg7IaM7KeEICgke2Vycm9yLmNvZGV9KWApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwaUtleU1hbmFnZXIucmVwb3J0RmFpbHVyZShlcnJvcik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcGlLZXlNYW5hZ2VyLnJlcG9ydEZhaWx1cmUoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGdldCBtb2RlbCgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25maWcubW9kZWw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog8J+GlSDrqqjrjbjsnbQgQ2xvdWQg66qo6424KDpjbG91ZCDsoJHrr7jsgqwp7J247KeAIO2ZleyduFxuICAgICAqL1xuICAgIHByaXZhdGUgaXNDbG91ZE1vZGVsKG1vZGVsOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIG1vZGVsPy50b0xvd2VyQ2FzZSgpLmVuZHNXaXRoKCc6Y2xvdWQnKSA/PyBmYWxzZTtcbiAgICB9XG5cbiAgICBzZXRNb2RlbChtb2RlbDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY29uZmlnLm1vZGVsID0gbW9kZWw7XG4gICAgfVxuXG4gICAgYXN5bmMgbGlzdE1vZGVscygpOiBQcm9taXNlPExpc3RNb2RlbHNSZXNwb25zZT4ge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2xpZW50LmdldDxMaXN0TW9kZWxzUmVzcG9uc2U+KCcvYXBpL3RhZ3MnKTtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBBUEkgcXVvdGEgYmVmb3JlIG1ha2luZyBhIHJlcXVlc3QuXG4gICAgICogVGhyb3dzIFF1b3RhRXhjZWVkZWRFcnJvciBpZiBob3VybHkgb3Igd2Vla2x5IGxpbWl0IGlzIGV4Y2VlZGVkLlxuICAgICAqL1xuICAgIHByaXZhdGUgY2hlY2tRdW90YSgpOiB2b2lkIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHRyYWNrZXIgPSBnZXRBcGlVc2FnZVRyYWNrZXIoKTtcbiAgICAgICAgICAgIGNvbnN0IHF1b3RhID0gdHJhY2tlci5nZXRRdW90YVN0YXR1cygpO1xuXG4gICAgICAgICAgICBpZiAocXVvdGEuaG91cmx5LnJlbWFpbmluZyA8PSAwICYmIHF1b3RhLndlZWtseS5yZW1haW5pbmcgPD0gMCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2JvdGgnLCBxdW90YS53ZWVrbHkudXNlZCwgcXVvdGEud2Vla2x5LmxpbWl0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChxdW90YS5ob3VybHkucmVtYWluaW5nIDw9IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUXVvdGFFeGNlZWRlZEVycm9yKCdob3VybHknLCBxdW90YS5ob3VybHkudXNlZCwgcXVvdGEuaG91cmx5LmxpbWl0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChxdW90YS53ZWVrbHkucmVtYWluaW5nIDw9IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUXVvdGFFeGNlZWRlZEVycm9yKCd3ZWVrbHknLCBxdW90YS53ZWVrbHkudXNlZCwgcXVvdGEud2Vla2x5LmxpbWl0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIFJlLXRocm93IFF1b3RhRXhjZWVkZWRFcnJvciwgaWdub3JlIG90aGVyIGVycm9ycyAodHJhY2tlciBpbml0IGZhaWx1cmVzKVxuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgUXVvdGFFeGNlZWRlZEVycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2dnZXIud2FybignUXVvdGEgY2hlY2sgZmFpbGVkIChub24tYmxvY2tpbmcpOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGdlbmVyYXRlKFxuICAgICAgICBwcm9tcHQ6IHN0cmluZyxcbiAgICAgICAgb3B0aW9ucz86IE1vZGVsT3B0aW9ucyxcbiAgICAgICAgb25Ub2tlbj86ICh0b2tlbjogc3RyaW5nKSA9PiB2b2lkLFxuICAgICAgICBpbWFnZXM/OiBzdHJpbmdbXVxuICAgICk6IFByb21pc2U8eyByZXNwb25zZTogc3RyaW5nOyBtZXRyaWNzPzogVXNhZ2VNZXRyaWNzIH0+IHtcbiAgICAgICAgdGhpcy5jaGVja1F1b3RhKCk7XG5cbiAgICAgICAgY29uc3QgcmVxdWVzdDogR2VuZXJhdGVSZXF1ZXN0ID0ge1xuICAgICAgICAgICAgbW9kZWw6IHRoaXMuY29uZmlnLm1vZGVsLFxuICAgICAgICAgICAgcHJvbXB0LFxuICAgICAgICAgICAgY29udGV4dDogdGhpcy5jb250ZXh0LFxuICAgICAgICAgICAgc3RyZWFtOiAhIW9uVG9rZW4sXG4gICAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgICAgaW1hZ2VzXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKG9uVG9rZW4pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmVhbUdlbmVyYXRlKHJlcXVlc3QsIG9uVG9rZW4pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5wb3N0PEdlbmVyYXRlUmVzcG9uc2U+KCcvYXBpL2dlbmVyYXRlJywgcmVxdWVzdCk7XG4gICAgICAgIHRoaXMuY29udGV4dCA9IHJlc3BvbnNlLmRhdGEuY29udGV4dCB8fCBbXTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3BvbnNlOiByZXNwb25zZS5kYXRhLnJlc3BvbnNlLFxuICAgICAgICAgICAgbWV0cmljczoge1xuICAgICAgICAgICAgICAgIHRvdGFsX2R1cmF0aW9uOiByZXNwb25zZS5kYXRhLnRvdGFsX2R1cmF0aW9uLFxuICAgICAgICAgICAgICAgIGxvYWRfZHVyYXRpb246IHJlc3BvbnNlLmRhdGEubG9hZF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBwcm9tcHRfZXZhbF9jb3VudDogcmVzcG9uc2UuZGF0YS5wcm9tcHRfZXZhbF9jb3VudCxcbiAgICAgICAgICAgICAgICBwcm9tcHRfZXZhbF9kdXJhdGlvbjogcmVzcG9uc2UuZGF0YS5wcm9tcHRfZXZhbF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBldmFsX2NvdW50OiByZXNwb25zZS5kYXRhLmV2YWxfY291bnQsXG4gICAgICAgICAgICAgICAgZXZhbF9kdXJhdGlvbjogcmVzcG9uc2UuZGF0YS5ldmFsX2R1cmF0aW9uXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBzdHJlYW1HZW5lcmF0ZShcbiAgICAgICAgcmVxdWVzdDogR2VuZXJhdGVSZXF1ZXN0LFxuICAgICAgICBvblRva2VuOiAodG9rZW46IHN0cmluZykgPT4gdm9pZFxuICAgICk6IFByb21pc2U8eyByZXNwb25zZTogc3RyaW5nOyBtZXRyaWNzPzogVXNhZ2VNZXRyaWNzIH0+IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5wb3N0KCcvYXBpL2dlbmVyYXRlJywgcmVxdWVzdCwge1xuICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiAnc3RyZWFtJ1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgZnVsbFJlc3BvbnNlID0gJyc7XG4gICAgICAgIGxldCBtZXRyaWNzOiBVc2FnZU1ldHJpY3MgfCB1bmRlZmluZWQ7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGxldCBidWZmZXIgPSAnJztcblxuICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5vbignZGF0YScsIChjaHVuazogQnVmZmVyKSA9PiB7XG4gICAgICAgICAgICAgICAgYnVmZmVyICs9IGNodW5rLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSBidWZmZXIuc3BsaXQoJ1xcbicpO1xuICAgICAgICAgICAgICAgIGJ1ZmZlciA9IGxpbmVzLnBvcCgpIHx8ICcnO1xuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsaW5lLnRyaW0oKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhOiBHZW5lcmF0ZVJlc3BvbnNlID0gSlNPTi5wYXJzZShsaW5lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5yZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsUmVzcG9uc2UgKz0gZGF0YS5yZXNwb25zZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Ub2tlbihkYXRhLnJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZG9uZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5jb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQgPSBkYXRhLmNvbnRleHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2R1cmF0aW9uOiBkYXRhLnRvdGFsX2R1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZF9kdXJhdGlvbjogZGF0YS5sb2FkX2R1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbXB0X2V2YWxfY291bnQ6IGRhdGEucHJvbXB0X2V2YWxfY291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHRfZXZhbF9kdXJhdGlvbjogZGF0YS5wcm9tcHRfZXZhbF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2YWxfY291bnQ6IGRhdGEuZXZhbF9jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2YWxfZHVyYXRpb246IGRhdGEuZXZhbF9kdXJhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbT2xsYW1hQ2xpZW50XSBKU09OIFBhcnNlIEVycm9yOicsIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEub24oJ2VuZCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYnVmZmVyLnRyaW0oKSkge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YTogR2VuZXJhdGVSZXNwb25zZSA9IEpTT04ucGFyc2UoYnVmZmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbFJlc3BvbnNlICs9IGRhdGEucmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Ub2tlbihkYXRhLnJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmRvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWNzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9kdXJhdGlvbjogZGF0YS50b3RhbF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZF9kdXJhdGlvbjogZGF0YS5sb2FkX2R1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHRfZXZhbF9jb3VudDogZGF0YS5wcm9tcHRfZXZhbF9jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbXB0X2V2YWxfZHVyYXRpb246IGRhdGEucHJvbXB0X2V2YWxfZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2YWxfY291bnQ6IGRhdGEuZXZhbF9jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZhbF9kdXJhdGlvbjogZGF0YS5ldmFsX2R1cmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyAvKiBpZ25vcmUgKi8gfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNvbHZlKHsgcmVzcG9uc2U6IGZ1bGxSZXNwb25zZSwgbWV0cmljcyB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5vbignZXJyb3InLCByZWplY3QpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFbmhhbmNlZCBjaGF0IHdpdGggVGhpbmtpbmcsIFN0cnVjdHVyZWQgT3V0cHV0cywgYW5kIFRvb2wgQ2FsbGluZyBzdXBwb3J0XG4gICAgICovXG4gICAgYXN5bmMgY2hhdChcbiAgICAgICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW10sXG4gICAgICAgIG9wdGlvbnM/OiBNb2RlbE9wdGlvbnMsXG4gICAgICAgIG9uVG9rZW4/OiAodG9rZW46IHN0cmluZywgdGhpbmtpbmc/OiBzdHJpbmcpID0+IHZvaWQsXG4gICAgICAgIGFkdmFuY2VkT3B0aW9ucz86IHtcbiAgICAgICAgICAgIHRoaW5rPzogVGhpbmtPcHRpb247XG4gICAgICAgICAgICBmb3JtYXQ/OiBGb3JtYXRPcHRpb247XG4gICAgICAgICAgICB0b29scz86IFRvb2xEZWZpbml0aW9uW107XG4gICAgICAgIH1cbiAgICApOiBQcm9taXNlPENoYXRNZXNzYWdlICYgeyBtZXRyaWNzPzogVXNhZ2VNZXRyaWNzIH0+IHtcbiAgICAgICAgdGhpcy5jaGVja1F1b3RhKCk7XG5cbiAgICAgICAgY29uc3QgcmVxdWVzdDogQ2hhdFJlcXVlc3QgPSB7XG4gICAgICAgICAgICBtb2RlbDogdGhpcy5jb25maWcubW9kZWwsXG4gICAgICAgICAgICBtZXNzYWdlcyxcbiAgICAgICAgICAgIHN0cmVhbTogISFvblRva2VuLFxuICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICAgIC4uLihhZHZhbmNlZE9wdGlvbnM/LnRoaW5rICE9PSB1bmRlZmluZWQgJiYgeyB0aGluazogYWR2YW5jZWRPcHRpb25zLnRoaW5rIH0pLFxuICAgICAgICAgICAgLi4uKGFkdmFuY2VkT3B0aW9ucz8uZm9ybWF0ICYmIHsgZm9ybWF0OiBhZHZhbmNlZE9wdGlvbnMuZm9ybWF0IH0pLFxuICAgICAgICAgICAgLi4uKGFkdmFuY2VkT3B0aW9ucz8udG9vbHMgJiYgeyB0b29sczogYWR2YW5jZWRPcHRpb25zLnRvb2xzIH0pXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKG9uVG9rZW4pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmVhbUNoYXQocmVxdWVzdCwgb25Ub2tlbik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2xpZW50LnBvc3Q8Q2hhdFJlc3BvbnNlPignL2FwaS9jaGF0JywgcmVxdWVzdCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5yZXNwb25zZS5kYXRhLm1lc3NhZ2UsXG4gICAgICAgICAgICBtZXRyaWNzOiB7XG4gICAgICAgICAgICAgICAgdG90YWxfZHVyYXRpb246IHJlc3BvbnNlLmRhdGEudG90YWxfZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgbG9hZF9kdXJhdGlvbjogcmVzcG9uc2UuZGF0YS5sb2FkX2R1cmF0aW9uLFxuICAgICAgICAgICAgICAgIHByb21wdF9ldmFsX2NvdW50OiByZXNwb25zZS5kYXRhLnByb21wdF9ldmFsX2NvdW50LFxuICAgICAgICAgICAgICAgIHByb21wdF9ldmFsX2R1cmF0aW9uOiByZXNwb25zZS5kYXRhLnByb21wdF9ldmFsX2R1cmF0aW9uLFxuICAgICAgICAgICAgICAgIGV2YWxfY291bnQ6IHJlc3BvbnNlLmRhdGEuZXZhbF9jb3VudCxcbiAgICAgICAgICAgICAgICBldmFsX2R1cmF0aW9uOiByZXNwb25zZS5kYXRhLmV2YWxfZHVyYXRpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHN0cmVhbUNoYXQoXG4gICAgICAgIHJlcXVlc3Q6IENoYXRSZXF1ZXN0LFxuICAgICAgICBvblRva2VuOiAodG9rZW46IHN0cmluZywgdGhpbmtpbmc/OiBzdHJpbmcpID0+IHZvaWRcbiAgICApOiBQcm9taXNlPENoYXRNZXNzYWdlICYgeyBtZXRyaWNzPzogVXNhZ2VNZXRyaWNzIH0+IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5wb3N0KCcvYXBpL2NoYXQnLCByZXF1ZXN0LCB7XG4gICAgICAgICAgICByZXNwb25zZVR5cGU6ICdzdHJlYW0nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBmdWxsQ29udGVudCA9ICcnO1xuICAgICAgICBsZXQgZnVsbFRoaW5raW5nID0gJyc7XG4gICAgICAgIGxldCB0b29sQ2FsbHM6IFRvb2xDYWxsW10gPSBbXTtcbiAgICAgICAgbGV0IG1ldHJpY3M6IFVzYWdlTWV0cmljcyB8IHVuZGVmaW5lZDtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IGJ1ZmZlciA9ICcnO1xuXG4gICAgICAgICAgICByZXNwb25zZS5kYXRhLm9uKCdkYXRhJywgKGNodW5rOiBCdWZmZXIpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBsb2dnZXIuZGVidWcoYERhdGEgY2h1bmsgcmVjZWl2ZWQ6ICR7Y2h1bmsubGVuZ3RofSBieXRlc2ApOyAvLyBMb2cgbm9pc2UgcmVkdWN0aW9uXG4gICAgICAgICAgICAgICAgYnVmZmVyICs9IGNodW5rLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSBidWZmZXIuc3BsaXQoJ1xcbicpO1xuICAgICAgICAgICAgICAgIGJ1ZmZlciA9IGxpbmVzLnBvcCgpIHx8ICcnO1xuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsaW5lLnRyaW0oKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhOiBDaGF0UmVzcG9uc2UgPSBKU09OLnBhcnNlKGxpbmUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIHRoaW5raW5nIHRyYWNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubWVzc2FnZT8udGhpbmtpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbFRoaW5raW5nICs9IGRhdGEubWVzc2FnZS50aGlua2luZztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Ub2tlbignJywgZGF0YS5tZXNzYWdlLnRoaW5raW5nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgY29udGVudFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLm1lc3NhZ2U/LmNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbENvbnRlbnQgKz0gZGF0YS5tZXNzYWdlLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uVG9rZW4oZGF0YS5tZXNzYWdlLmNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSB0b29sIGNhbGxzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubWVzc2FnZT8udG9vbF9jYWxscykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sQ2FsbHMgPSBkYXRhLm1lc3NhZ2UudG9vbF9jYWxscztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5kb25lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldHJpY3MgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9kdXJhdGlvbjogZGF0YS50b3RhbF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRfZHVyYXRpb246IGRhdGEubG9hZF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb21wdF9ldmFsX2NvdW50OiBkYXRhLnByb21wdF9ldmFsX2NvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbXB0X2V2YWxfZHVyYXRpb246IGRhdGEucHJvbXB0X2V2YWxfZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmFsX2NvdW50OiBkYXRhLmV2YWxfY291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmFsX2R1cmF0aW9uOiBkYXRhLmV2YWxfZHVyYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW09sbGFtYUNsaWVudF0gQ2hhdCBKU09OIFBhcnNlIEVycm9yOicsIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEub24oJ2VuZCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYnVmZmVyLnRyaW0oKSkge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YTogQ2hhdFJlc3BvbnNlID0gSlNPTi5wYXJzZShidWZmZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEubWVzc2FnZT8udGhpbmtpbmcpIGZ1bGxUaGlua2luZyArPSBkYXRhLm1lc3NhZ2UudGhpbmtpbmc7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5tZXNzYWdlPy5jb250ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbENvbnRlbnQgKz0gZGF0YS5tZXNzYWdlLmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Ub2tlbihkYXRhLm1lc3NhZ2UuY29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5tZXNzYWdlPy50b29sX2NhbGxzKSB0b29sQ2FsbHMgPSBkYXRhLm1lc3NhZ2UudG9vbF9jYWxscztcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmRvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRyaWNzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9kdXJhdGlvbjogZGF0YS50b3RhbF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZF9kdXJhdGlvbjogZGF0YS5sb2FkX2R1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHRfZXZhbF9jb3VudDogZGF0YS5wcm9tcHRfZXZhbF9jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbXB0X2V2YWxfZHVyYXRpb246IGRhdGEucHJvbXB0X2V2YWxfZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2YWxfY291bnQ6IGRhdGEuZXZhbF9jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZhbF9kdXJhdGlvbjogZGF0YS5ldmFsX2R1cmF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyAvKiBpZ25vcmUgKi8gfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdDogQ2hhdE1lc3NhZ2UgJiB7IG1ldHJpY3M/OiBVc2FnZU1ldHJpY3MgfSA9IHtcbiAgICAgICAgICAgICAgICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGZ1bGxDb250ZW50LFxuICAgICAgICAgICAgICAgICAgICBtZXRyaWNzXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGlmIChmdWxsVGhpbmtpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnRoaW5raW5nID0gZnVsbFRoaW5raW5nO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0b29sQ2FsbHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQudG9vbF9jYWxscyA9IHRvb2xDYWxscztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEub24oJ2Vycm9yJywgcmVqZWN0KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2VuZXJhdGUgZW1iZWRkaW5ncyBmb3IgdGV4dCAoT2xsYW1hIEVtYmVkZGluZ3MgQVBJKVxuICAgICAqL1xuICAgIGFzeW5jIGVtYmVkKGlucHV0OiBzdHJpbmcgfCBzdHJpbmdbXSwgbW9kZWw/OiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcltdW10+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdDogRW1iZWRSZXF1ZXN0ID0ge1xuICAgICAgICAgICAgbW9kZWw6IG1vZGVsIHx8ICdlbWJlZGRpbmdnZW1tYScsXG4gICAgICAgICAgICBpbnB1dFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jbGllbnQucG9zdDxFbWJlZFJlc3BvbnNlPignL2FwaS9lbWJlZCcsIHJlcXVlc3QpO1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5lbWJlZGRpbmdzO1xuICAgIH1cblxuICAgIGFzeW5jIGlzQXZhaWxhYmxlKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5jbGllbnQuZ2V0KCcvJyk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbGVhckNvbnRleHQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY29udGV4dCA9IFtdO1xuICAgIH1cblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gT2xsYW1hIFdlYiBTZWFyY2ggQVBJIE1ldGhvZHNcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgLyoqXG4gICAgICogT2xsYW1hIOqzteyLnSBXZWIgU2VhcmNoIEFQSVxuICAgICAqIGh0dHBzOi8vb2xsYW1hLmNvbS9hcGkvd2ViX3NlYXJjaFxuICAgICAqL1xuICAgIGFzeW5jIHdlYlNlYXJjaChxdWVyeTogc3RyaW5nLCBtYXhSZXN1bHRzOiBudW1iZXIgPSA1KTogUHJvbWlzZTxXZWJTZWFyY2hSZXNwb25zZT4ge1xuICAgICAgICBjb25zdCByZXF1ZXN0OiBXZWJTZWFyY2hSZXF1ZXN0ID0ge1xuICAgICAgICAgICAgcXVlcnksXG4gICAgICAgICAgICBtYXhfcmVzdWx0czogTWF0aC5taW4obWF4UmVzdWx0cywgMTApXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc29sZS5sb2coYFtPbGxhbWFDbGllbnRdIPCflI0gV2ViIFNlYXJjaDogXCIke3F1ZXJ5fVwiYCk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIE9sbGFtYSDqs7Xsi50gQVBJIOyXlOuTnO2PrOyduO2KuFxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmNsaWVudC5wb3N0PFdlYlNlYXJjaFJlc3BvbnNlPihcbiAgICAgICAgICAgICAgICAnaHR0cHM6Ly9vbGxhbWEuY29tL2FwaS93ZWJfc2VhcmNoJyxcbiAgICAgICAgICAgICAgICByZXF1ZXN0LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgYmFzZVVSTDogJycsIC8vIE92ZXJyaWRlIGJhc2VVUkwgdG8gdXNlIGFic29sdXRlIFVSTFxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5hcGlLZXlNYW5hZ2VyLmdldEF1dGhIZWFkZXJzKClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbT2xsYW1hQ2xpZW50XSDinIUgV2ViIFNlYXJjaDogJHtyZXNwb25zZS5kYXRhLnJlc3VsdHM/Lmxlbmd0aCB8fCAwfeqwnCDqsrDqs7xgKTtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xuICAgICAgICB9IGNhdGNoIChlcnJvcjogdW5rbm93bikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW09sbGFtYUNsaWVudF0gV2ViIFNlYXJjaCDsi6TtjKg6JywgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSkpO1xuICAgICAgICAgICAgcmV0dXJuIHsgcmVzdWx0czogW10gfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9sbGFtYSDqs7Xsi50gV2ViIEZldGNoIEFQSVxuICAgICAqIGh0dHBzOi8vb2xsYW1hLmNvbS9hcGkvd2ViX2ZldGNoXG4gICAgICovXG4gICAgYXN5bmMgd2ViRmV0Y2godXJsOiBzdHJpbmcpOiBQcm9taXNlPFdlYkZldGNoUmVzcG9uc2U+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdDogV2ViRmV0Y2hSZXF1ZXN0ID0geyB1cmwgfTtcblxuICAgICAgICBjb25zb2xlLmxvZyhgW09sbGFtYUNsaWVudF0g8J+TpSBXZWIgRmV0Y2g6ICR7dXJsfWApO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuY2xpZW50LnBvc3Q8V2ViRmV0Y2hSZXNwb25zZT4oXG4gICAgICAgICAgICAgICAgJ2h0dHBzOi8vb2xsYW1hLmNvbS9hcGkvd2ViX2ZldGNoJyxcbiAgICAgICAgICAgICAgICByZXF1ZXN0LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgYmFzZVVSTDogJycsXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi50aGlzLmFwaUtleU1hbmFnZXIuZ2V0QXV0aEhlYWRlcnMoKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coYFtPbGxhbWFDbGllbnRdIOKchSBXZWIgRmV0Y2g6IFwiJHtyZXNwb25zZS5kYXRhLnRpdGxlfVwiYCk7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tPbGxhbWFDbGllbnRdIFdlYiBGZXRjaCDsi6TtjKg6JywgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSkpO1xuICAgICAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICcnLCBjb250ZW50OiAnJywgbGlua3M6IFtdIH07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIE11bHRpLXR1cm4gVG9vbCBDYWxsaW5nIChBZ2VudCBMb29wKVxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAvKipcbiAgICAgKiBNdWx0aS10dXJuIFRvb2wgQ2FsbGluZyBBZ2VudCBMb29wIOyLpO2WiVxuICAgICAqIFxuICAgICAqIOuPhOq1rCDtmLjstpzsnbQg7JeG7J2EIOuVjOq5jOyngCDsnpDrj5nsnLzroZwg64yA7ZmU66W8IOydtOyWtOqwkeuLiOuLpC5cbiAgICAgKiDqs7Xsi50g66y47IScOiBodHRwczovL2RvY3Mub2xsYW1hLmNvbS9jYXBhYmlsaXRpZXMvdG9vbC1jYWxsaW5nI211bHRpLXR1cm4tdG9vbC1jYWxsaW5nLWFnZW50LWxvb3BcbiAgICAgKiBcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQucnVuQWdlbnRMb29wKFxuICAgICAqICAgW3sgcm9sZTogJ3VzZXInLCBjb250ZW50OiAn7ISc7Jq4IOuCoOyUqCDslYzroKTspJgnIH1dLFxuICAgICAqICAgW3dlYXRoZXJUb29sXSxcbiAgICAgKiAgIHsgZ2V0X3dlYXRoZXI6IGdldFdlYXRoZXJGdW5jIH0sXG4gICAgICogICB7IG9uVG9vbENhbGw6IChuYW1lLCBhcmdzLCByZXN1bHQpID0+IGNvbnNvbGUubG9nKGBUb29sOiAke25hbWV9YCkgfVxuICAgICAqICk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgYXN5bmMgcnVuQWdlbnRMb29wKFxuICAgICAgICBtZXNzYWdlczogQ2hhdE1lc3NhZ2VbXSxcbiAgICAgICAgdG9vbHM6IFRvb2xEZWZpbml0aW9uW10sXG4gICAgICAgIGF2YWlsYWJsZUZ1bmN0aW9uczogUmVjb3JkPHN0cmluZywgKGFyZ3M6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KSA9PiB1bmtub3duIHwgUHJvbWlzZTx1bmtub3duPj4sXG4gICAgICAgIG9wdGlvbnM/OiB7XG4gICAgICAgICAgICB0aGluaz86IFRoaW5rT3B0aW9uO1xuICAgICAgICAgICAgc3RyZWFtPzogYm9vbGVhbjtcbiAgICAgICAgICAgIG9uVG9rZW4/OiAodG9rZW46IHN0cmluZywgdGhpbmtpbmc/OiBzdHJpbmcpID0+IHZvaWQ7XG4gICAgICAgICAgICBvblRvb2xDYWxsPzogKG5hbWU6IHN0cmluZywgYXJnczogdW5rbm93biwgcmVzdWx0OiB1bmtub3duKSA9PiB2b2lkO1xuICAgICAgICAgICAgbWF4SXRlcmF0aW9ucz86IG51bWJlcjtcbiAgICAgICAgfVxuICAgICk6IFByb21pc2U8QWdlbnRMb29wUmVzdWx0PiB7XG4gICAgICAgIHJldHVybiBydW5BZ2VudExvb3Aoe1xuICAgICAgICAgICAgbW9kZWw6IHRoaXMuY29uZmlnLm1vZGVsLFxuICAgICAgICAgICAgbWVzc2FnZXMsXG4gICAgICAgICAgICB0b29scyxcbiAgICAgICAgICAgIGF2YWlsYWJsZUZ1bmN0aW9ucyxcbiAgICAgICAgICAgIHRoaW5rOiBvcHRpb25zPy50aGluayxcbiAgICAgICAgICAgIHN0cmVhbTogb3B0aW9ucz8uc3RyZWFtLFxuICAgICAgICAgICAgb25Ub2tlbjogb3B0aW9ucz8ub25Ub2tlbixcbiAgICAgICAgICAgIG9uVG9vbENhbGw6IG9wdGlvbnM/Lm9uVG9vbENhbGwsXG4gICAgICAgICAgICBtYXhJdGVyYXRpb25zOiBvcHRpb25zPy5tYXhJdGVyYXRpb25zXG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNsaWVudCA9IChjb25maWc/OiBQYXJ0aWFsPE9sbGFtYUNvbmZpZz4pOiBPbGxhbWFDbGllbnQgPT4ge1xuICAgIHJldHVybiBuZXcgT2xsYW1hQ2xpZW50KGNvbmZpZyk7XG59O1xuXG4vKipcbiAqIPCfhpUg7Yq57KCVIOyduOuNseyKpOydmCDtgqQt66qo6424IOyMjeycvOuhnCDtgbTrnbzsnbTslrjtirgg7IOd7ISxIChBMkHsmqkpXG4gKiBAcGFyYW0gaW5kZXggQVBJIO2CpCDsnbjrjbHsiqQgKDAtYmFzZWQpXG4gKiBAcmV0dXJucyDtlbTri7kg7YKkLeuqqOuNuCDsjI3snLzroZwg6rWs7ISx65CcIE9sbGFtYUNsaWVudFxuICovXG5leHBvcnQgY29uc3QgY3JlYXRlQ2xpZW50Rm9ySW5kZXggPSAoaW5kZXg6IG51bWJlcik6IE9sbGFtYUNsaWVudCB8IG51bGwgPT4ge1xuICAgIGNvbnN0IGtleU1hbmFnZXIgPSBnZXRBcGlLZXlNYW5hZ2VyKCk7XG4gICAgY29uc3QgcGFpciA9IGtleU1hbmFnZXIuZ2V0S2V5TW9kZWxQYWlyKGluZGV4KTtcbiAgICBcbiAgICBpZiAoIXBhaXIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgW09sbGFtYUNsaWVudF0g4p2MIOyduOuNseyKpCAke2luZGV4feyXkCDtlbTri7ntlZjripQg7YKkLeuqqOuNuCDsjI3snbQg7JeG7Iq164uI64ukLmApO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coYFtPbGxhbWFDbGllbnRdIPCfjq8g7J24642x7IqkICR7aW5kZXggKyAxfSDtgbTrnbzsnbTslrjtirgg7IOd7ISxOiAke3BhaXIubW9kZWx9YCk7XG4gICAgcmV0dXJuIG5ldyBPbGxhbWFDbGllbnQoeyBtb2RlbDogcGFpci5tb2RlbCB9KTtcbn07XG5cbi8qKlxuICog8J+GlSDrqqjrk6Ag7YKkLeuqqOuNuCDsjI3sl5Ag64yA7ZW0IO2BtOudvOydtOyWuO2KuCDrsLDsl7Qg7IOd7ISxIChBMkEg67OR66CsIOyymOumrOyaqSlcbiAqIEByZXR1cm5zIE9sbGFtYUNsaWVudCDrsLDsl7RcbiAqL1xuZXhwb3J0IGNvbnN0IGNyZWF0ZUFsbENsaWVudHMgPSAoKTogT2xsYW1hQ2xpZW50W10gPT4ge1xuICAgIGNvbnN0IGtleU1hbmFnZXIgPSBnZXRBcGlLZXlNYW5hZ2VyKCk7XG4gICAgY29uc3QgcGFpcnMgPSBrZXlNYW5hZ2VyLmdldEFsbEtleU1vZGVsUGFpcnMoKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhgW09sbGFtYUNsaWVudF0g8J+agCAke3BhaXJzLmxlbmd0aH3qsJwgQTJBIO2BtOudvOydtOyWuO2KuCDsg53shLEg7KSRLi4uYCk7XG4gICAgXG4gICAgY29uc3QgY2xpZW50cyA9IHBhaXJzLm1hcChwYWlyID0+IHtcbiAgICAgICAgLy8g6rCBIO2BtOudvOydtOyWuO2KuCDsg53shLEg7KCE7JeQIO2VtOuLuSDsnbjrjbHsiqTroZwg7YKkIOunpOuLiOyggCDshKTsoJVcbiAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE9sbGFtYUNsaWVudCh7IG1vZGVsOiBwYWlyLm1vZGVsIH0pO1xuICAgICAgICByZXR1cm4gY2xpZW50O1xuICAgIH0pO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKGBbT2xsYW1hQ2xpZW50XSDinIUgJHtjbGllbnRzLmxlbmd0aH3qsJwgQTJBIO2BtOudvOydtOyWuO2KuCDspIDruYQg7JmE66OMYCk7XG4gICAgcmV0dXJuIGNsaWVudHM7XG59O1xuXG4iXSwidmVyc2lvbiI6M30=