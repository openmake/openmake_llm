69295cedab28bd59ec154794848c7823
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateConfig = validateConfig;
exports.loadConfig = loadConfig;
exports.getConfig = getConfig;
exports.resetConfig = resetConfig;
// 환경 설정 로더
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const DEFAULT_CONFIG = {
    // Node
    nodeEnv: 'development',
    // Server
    port: 52416,
    serverHost: '0.0.0.0',
    // Database
    databaseUrl: 'postgresql://localhost:5432/openmake_llm',
    // Auth
    jwtSecret: '',
    adminPassword: '',
    defaultAdminEmail: 'admin@localhost',
    adminEmails: '',
    // OAuth
    googleClientId: '',
    googleClientSecret: '',
    githubClientId: '',
    githubClientSecret: '',
    oauthRedirectUri: 'http://localhost:52416/api/auth/callback/google',
    // CORS
    corsOrigins: 'http://localhost:52416',
    // Ollama
    ollamaBaseUrl: 'http://localhost:11434',
    ollamaDefaultModel: 'gemini-3-flash-preview:cloud',
    ollamaKoreanModel: 'gemini-3-flash-preview:cloud',
    ollamaModel: 'gemini-3-flash-preview:cloud',
    ollamaTimeout: 120000,
    ollamaHost: 'http://localhost:11434',
    ollamaApiKey: '',
    ollamaApiKeyPrimary: '',
    ollamaApiKeySecondary: '',
    ollamaSshKey: '',
    ollamaModels: [], // Per-key models
    // Rate limits
    ollamaHourlyLimit: 150,
    ollamaWeeklyLimit: 2500,
    ollamaMonthlyPremiumLimit: 5,
    // Log
    logLevel: 'info',
    // Gemini
    geminiThinkEnabled: true,
    geminiThinkLevel: 'high',
    geminiNumCtx: 32768,
    geminiEmbeddingModel: 'gemini-3-flash-preview:cloud',
    geminiWebSearchEnabled: true,
    // External services
    googleApiKey: '',
    googleCseId: '',
    firecrawlApiKey: '',
    firecrawlApiUrl: 'https://api.firecrawl.dev/v1',
    // Documents
    documentTtlHours: 1,
    maxUploadedDocuments: 100,
    // Conversations
    maxConversationSessions: 1000,
    sessionTtlDays: 30,
    // User data
    userDataPath: './data/users',
    // VAPID
    vapidPublicKey: '',
    vapidPrivateKey: '',
    vapidSubject: 'mailto:admin@openmake.ai',
    // Swagger
    swaggerBaseUrl: '',
};
function parseEnvFile(filePath) {
    const env = {};
    if (!fs.existsSync(filePath)) {
        return env;
    }
    const content = fs.readFileSync(filePath, 'utf-8');
    const lines = content.split('\n');
    for (const line of lines) {
        const trimmed = line.trim();
        // 빈 줄이나 주석 건너뛰기
        if (!trimmed || trimmed.startsWith('#')) {
            continue;
        }
        const equalIndex = trimmed.indexOf('=');
        if (equalIndex > 0) {
            const key = trimmed.substring(0, equalIndex).trim();
            const value = trimmed.substring(equalIndex + 1).trim();
            env[key] = value;
        }
    }
    return env;
}
function parseLogLevel(value) {
    const level = (value || '').toLowerCase();
    if (level === 'debug' || level === 'info' || level === 'warn' || level === 'error') {
        return level;
    }
    return DEFAULT_CONFIG.logLevel;
}
/**
 * 필수 환경 변수 검증
 * 런타임 시작 전에 호출하여 설정 오류를 조기에 발견
 */
function validateConfig(config) {
    const errors = [];
    // URL 검증
    if (!config.ollamaBaseUrl || !config.ollamaBaseUrl.startsWith('http')) {
        errors.push(`Invalid OLLAMA_BASE_URL: ${config.ollamaBaseUrl}`);
    }
    // 모델 이름 검증
    if (!config.ollamaDefaultModel || config.ollamaDefaultModel.trim() === '') {
        errors.push('OLLAMA_DEFAULT_MODEL is required');
    }
    // 타임아웃 검증
    if (config.ollamaTimeout <= 0 || config.ollamaTimeout > 600000) {
        errors.push(`Invalid OLLAMA_TIMEOUT: ${config.ollamaTimeout} (must be between 1-600000ms)`);
    }
    if (errors.length > 0) {
        throw new Error(`Configuration validation failed:\n${errors.join('\n')}`);
    }
}
function loadConfig() {
    // 프로젝트 루트에서 .env 파일 찾기
    const envPath = path.resolve(process.cwd(), '.env');
    const projectEnvPath = path.resolve(__dirname, '../../.env');
    // 환경변수 우선순위: process.env > .env 파일 > 기본값
    const fileEnv = parseEnvFile(fs.existsSync(envPath) ? envPath : projectEnvPath);
    const env = (key) => process.env[key] || fileEnv[key];
    return {
        // Node
        nodeEnv: env('NODE_ENV') || DEFAULT_CONFIG.nodeEnv,
        // Server
        port: parseInt(env('PORT') || String(DEFAULT_CONFIG.port), 10),
        serverHost: env('SERVER_HOST') || DEFAULT_CONFIG.serverHost,
        // Database
        databaseUrl: env('DATABASE_URL') || DEFAULT_CONFIG.databaseUrl,
        // Auth
        jwtSecret: env('JWT_SECRET') || DEFAULT_CONFIG.jwtSecret,
        adminPassword: env('ADMIN_PASSWORD') || DEFAULT_CONFIG.adminPassword,
        defaultAdminEmail: env('DEFAULT_ADMIN_EMAIL') || DEFAULT_CONFIG.defaultAdminEmail,
        adminEmails: env('ADMIN_EMAILS') || DEFAULT_CONFIG.adminEmails,
        // OAuth
        googleClientId: env('GOOGLE_CLIENT_ID') || DEFAULT_CONFIG.googleClientId,
        googleClientSecret: env('GOOGLE_CLIENT_SECRET') || DEFAULT_CONFIG.googleClientSecret,
        githubClientId: env('GITHUB_CLIENT_ID') || DEFAULT_CONFIG.githubClientId,
        githubClientSecret: env('GITHUB_CLIENT_SECRET') || DEFAULT_CONFIG.githubClientSecret,
        oauthRedirectUri: env('OAUTH_REDIRECT_URI') || DEFAULT_CONFIG.oauthRedirectUri,
        // CORS
        corsOrigins: env('CORS_ORIGINS') || DEFAULT_CONFIG.corsOrigins,
        // Ollama
        ollamaBaseUrl: env('OLLAMA_BASE_URL') || DEFAULT_CONFIG.ollamaBaseUrl,
        ollamaDefaultModel: env('OLLAMA_DEFAULT_MODEL') || DEFAULT_CONFIG.ollamaDefaultModel,
        ollamaKoreanModel: env('OLLAMA_KOREAN_MODEL') || DEFAULT_CONFIG.ollamaKoreanModel,
        ollamaModel: env('OLLAMA_MODEL') || DEFAULT_CONFIG.ollamaModel,
        ollamaTimeout: parseInt(env('OLLAMA_TIMEOUT') || String(DEFAULT_CONFIG.ollamaTimeout), 10),
        ollamaHost: env('OLLAMA_HOST') || DEFAULT_CONFIG.ollamaHost,
        ollamaApiKey: env('OLLAMA_API_KEY') || DEFAULT_CONFIG.ollamaApiKey,
        ollamaApiKeyPrimary: env('OLLAMA_API_KEY_PRIMARY') || DEFAULT_CONFIG.ollamaApiKeyPrimary,
        ollamaApiKeySecondary: env('OLLAMA_API_KEY_SECONDARY') || DEFAULT_CONFIG.ollamaApiKeySecondary,
        ollamaSshKey: env('OLLAMA_SSH_KEY') || DEFAULT_CONFIG.ollamaSshKey,
        // Per-key models (OLLAMA_MODEL_1, _2, _3, ... N)
        ollamaModels: (() => {
            const models = [];
            let index = 1;
            while (true) {
                const model = env(`OLLAMA_MODEL_${index}`);
                if (model && model.trim() !== '') {
                    models.push(model.trim());
                    index++;
                }
                else {
                    break;
                }
            }
            return models;
        })(),
        // Rate limits
        ollamaHourlyLimit: parseInt(env('OLLAMA_HOURLY_LIMIT') || String(DEFAULT_CONFIG.ollamaHourlyLimit), 10),
        ollamaWeeklyLimit: parseInt(env('OLLAMA_WEEKLY_LIMIT') || String(DEFAULT_CONFIG.ollamaWeeklyLimit), 10),
        ollamaMonthlyPremiumLimit: parseInt(env('OLLAMA_MONTHLY_PREMIUM_LIMIT') || String(DEFAULT_CONFIG.ollamaMonthlyPremiumLimit), 10),
        // Log
        logLevel: parseLogLevel(env('LOG_LEVEL')),
        // Gemini
        geminiThinkEnabled: (env('GEMINI_THINK_ENABLED') || 'true') === 'true',
        geminiThinkLevel: (env('GEMINI_THINK_LEVEL') || 'high'),
        geminiNumCtx: parseInt(env('GEMINI_NUM_CTX') || '32768', 10),
        geminiEmbeddingModel: env('GEMINI_EMBEDDING_MODEL') || DEFAULT_CONFIG.geminiEmbeddingModel,
        geminiWebSearchEnabled: (env('GEMINI_WEB_SEARCH_ENABLED') || 'true') === 'true',
        // External services
        googleApiKey: env('GOOGLE_API_KEY') || DEFAULT_CONFIG.googleApiKey,
        googleCseId: env('GOOGLE_CSE_ID') || DEFAULT_CONFIG.googleCseId,
        firecrawlApiKey: env('FIRECRAWL_API_KEY') || DEFAULT_CONFIG.firecrawlApiKey,
        firecrawlApiUrl: env('FIRECRAWL_API_URL') || DEFAULT_CONFIG.firecrawlApiUrl,
        // Documents
        documentTtlHours: parseInt(env('DOCUMENT_TTL_HOURS') || String(DEFAULT_CONFIG.documentTtlHours), 10),
        maxUploadedDocuments: parseInt(env('MAX_UPLOADED_DOCUMENTS') || String(DEFAULT_CONFIG.maxUploadedDocuments), 10),
        // Conversations
        maxConversationSessions: parseInt(env('MAX_CONVERSATION_SESSIONS') || String(DEFAULT_CONFIG.maxConversationSessions), 10),
        sessionTtlDays: parseInt(env('SESSION_TTL_DAYS') || String(DEFAULT_CONFIG.sessionTtlDays), 10),
        // User data
        userDataPath: env('USER_DATA_PATH') || DEFAULT_CONFIG.userDataPath,
        // VAPID
        vapidPublicKey: env('VAPID_PUBLIC_KEY') || DEFAULT_CONFIG.vapidPublicKey,
        vapidPrivateKey: env('VAPID_PRIVATE_KEY') || DEFAULT_CONFIG.vapidPrivateKey,
        vapidSubject: env('VAPID_SUBJECT') || DEFAULT_CONFIG.vapidSubject,
        // Swagger
        swaggerBaseUrl: env('SWAGGER_BASE_URL') || DEFAULT_CONFIG.swaggerBaseUrl,
    };
}
// 싱글톤 설정 인스턴스
let cachedConfig = null;
function getConfig() {
    if (!cachedConfig) {
        cachedConfig = loadConfig();
        // 설정 검증
        validateConfig(cachedConfig);
    }
    return cachedConfig;
}
function resetConfig() {
    cachedConfig = null;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL2NvbmZpZy9lbnYudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUErTUEsd0NBcUJDO0FBRUQsZ0NBeUdDO0FBS0QsOEJBT0M7QUFFRCxrQ0FFQztBQS9WRCxXQUFXO0FBQ1gsdUNBQXlCO0FBQ3pCLDJDQUE2QjtBQW1GN0IsTUFBTSxjQUFjLEdBQWM7SUFDOUIsT0FBTztJQUNQLE9BQU8sRUFBRSxhQUFhO0lBRXRCLFNBQVM7SUFDVCxJQUFJLEVBQUUsS0FBSztJQUNYLFVBQVUsRUFBRSxTQUFTO0lBRXJCLFdBQVc7SUFDWCxXQUFXLEVBQUUsMENBQTBDO0lBRXZELE9BQU87SUFDUCxTQUFTLEVBQUUsRUFBRTtJQUNiLGFBQWEsRUFBRSxFQUFFO0lBQ2pCLGlCQUFpQixFQUFFLGlCQUFpQjtJQUNwQyxXQUFXLEVBQUUsRUFBRTtJQUVmLFFBQVE7SUFDUixjQUFjLEVBQUUsRUFBRTtJQUNsQixrQkFBa0IsRUFBRSxFQUFFO0lBQ3RCLGNBQWMsRUFBRSxFQUFFO0lBQ2xCLGtCQUFrQixFQUFFLEVBQUU7SUFDdEIsZ0JBQWdCLEVBQUUsaURBQWlEO0lBRW5FLE9BQU87SUFDUCxXQUFXLEVBQUUsd0JBQXdCO0lBRXJDLFNBQVM7SUFDVCxhQUFhLEVBQUUsd0JBQXdCO0lBQ3ZDLGtCQUFrQixFQUFFLDhCQUE4QjtJQUNsRCxpQkFBaUIsRUFBRSw4QkFBOEI7SUFDakQsV0FBVyxFQUFFLDhCQUE4QjtJQUMzQyxhQUFhLEVBQUUsTUFBTTtJQUNyQixVQUFVLEVBQUUsd0JBQXdCO0lBQ3BDLFlBQVksRUFBRSxFQUFFO0lBQ2hCLG1CQUFtQixFQUFFLEVBQUU7SUFDdkIscUJBQXFCLEVBQUUsRUFBRTtJQUN6QixZQUFZLEVBQUUsRUFBRTtJQUNoQixZQUFZLEVBQUUsRUFBRSxFQUFHLGlCQUFpQjtJQUVwQyxjQUFjO0lBQ2QsaUJBQWlCLEVBQUUsR0FBRztJQUN0Qixp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UUFDM0UsWUFBWSxFQUFFLEdBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxjQUFjLENBQUMsWUFBWTtRQUVqRSxVQUFVO1FBQ1YsY0FBYyxFQUFFLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLGNBQWMsQ0FBQyxjQUFjO0tBQzNFLENBQUM7QUFDTixDQUFDO0FBRUQsY0FBYztBQUNkLElBQUksWUFBWSxHQUFxQixJQUFJLENBQUM7QUFFMUMsU0FBZ0IsU0FBUztJQUNyQixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDaEIsWUFBWSxHQUFHLFVBQVUsRUFBRSxDQUFDO1FBQzVCLFFBQVE7UUFDUixjQUFjLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUNELE9BQU8sWUFBWSxDQUFDO0FBQ3hCLENBQUM7QUFFRCxTQUFnQixXQUFXO0lBQ3ZCLFlBQVksR0FBRyxJQUFJLENBQUM7QUFDeEIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVm9sdW1lcy9NQUNfQVBQL29wZW5tYWtlX2xsbS9iYWNrZW5kL2FwaS9zcmMvY29uZmlnL2Vudi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyDtmZjqsr0g7ISk7KCVIOuhnOuNlFxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcblxuZXhwb3J0IGludGVyZmFjZSBFbnZDb25maWcge1xuICAgIC8vIE5vZGVcbiAgICBub2RlRW52OiBzdHJpbmc7XG5cbiAgICAvLyBTZXJ2ZXJcbiAgICBwb3J0OiBudW1iZXI7XG4gICAgc2VydmVySG9zdDogc3RyaW5nO1xuXG4gICAgLy8gRGF0YWJhc2VcbiAgICBkYXRhYmFzZVVybDogc3RyaW5nO1xuXG4gICAgLy8gQXV0aFxuICAgIGp3dFNlY3JldDogc3RyaW5nO1xuICAgIGFkbWluUGFzc3dvcmQ6IHN0cmluZztcbiAgICBkZWZhdWx0QWRtaW5FbWFpbDogc3RyaW5nO1xuICAgIGFkbWluRW1haWxzOiBzdHJpbmc7XG5cbiAgICAvLyBPQXV0aFxuICAgIGdvb2dsZUNsaWVudElkOiBzdHJpbmc7XG4gICAgZ29vZ2xlQ2xpZW50U2VjcmV0OiBzdHJpbmc7XG4gICAgZ2l0aHViQ2xpZW50SWQ6IHN0cmluZztcbiAgICBnaXRodWJDbGllbnRTZWNyZXQ6IHN0cmluZztcbiAgICBvYXV0aFJlZGlyZWN0VXJpOiBzdHJpbmc7XG5cbiAgICAvLyBDT1JTXG4gICAgY29yc09yaWdpbnM6IHN0cmluZztcblxuICAgIC8vIE9sbGFtYVxuICAgIG9sbGFtYUJhc2VVcmw6IHN0cmluZztcbiAgICBvbGxhbWFEZWZhdWx0TW9kZWw6IHN0cmluZztcbiAgICBvbGxhbWFLb3JlYW5Nb2RlbDogc3RyaW5nO1xuICAgIG9sbGFtYU1vZGVsOiBzdHJpbmc7XG4gICAgb2xsYW1hVGltZW91dDogbnVtYmVyO1xuICAgIG9sbGFtYUhvc3Q6IHN0cmluZztcbiAgICBvbGxhbWFBcGlLZXk6IHN0cmluZztcbiAgICBvbGxhbWFBcGlLZXlQcmltYXJ5OiBzdHJpbmc7XG4gICAgb2xsYW1hQXBpS2V5U2Vjb25kYXJ5OiBzdHJpbmc7XG4gICAgb2xsYW1hU3NoS2V5OiBzdHJpbmc7XG4gICAgb2xsYW1hTW9kZWxzOiBzdHJpbmdbXTsgIC8vIFBlci1rZXkgbW9kZWxzIChPTExBTUFfTU9ERUxfMSwgXzIsIGV0Yy4pXG5cbiAgICAvLyBSYXRlIGxpbWl0c1xuICAgIG9sbGFtYUhvdXJseUxpbWl0OiBudW1iZXI7XG4gICAgb2xsYW1hV2Vla2x5TGltaXQ6IG51bWJlcjtcbiAgICBvbGxhbWFNb250aGx5UHJlbWl1bUxpbWl0OiBudW1iZXI7XG5cbiAgICAvLyBMb2dcbiAgICBsb2dMZXZlbDogJ2RlYnVnJyB8ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcic7XG5cbiAgICAvLyBHZW1pbmlcbiAgICBnZW1pbmlUaGlua0VuYWJsZWQ6IGJvb2xlYW47XG4gICAgZ2VtaW5pVGhpbmtMZXZlbDogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJztcbiAgICBnZW1pbmlOdW1DdHg6IG51bWJlcjtcbiAgICBnZW1pbmlFbWJlZGRpbmdNb2RlbDogc3RyaW5nO1xuICAgIGdlbWluaVdlYlNlYXJjaEVuYWJsZWQ6IGJvb2xlYW47XG5cbiAgICAvLyBFeHRlcm5hbCBzZXJ2aWNlc1xuICAgIGdvb2dsZUFwaUtleTogc3RyaW5nO1xuICAgIGdvb2dsZUNzZUlkOiBzdHJpbmc7XG4gICAgZmlyZWNyYXdsQXBpS2V5OiBzdHJpbmc7XG4gICAgZmlyZWNyYXdsQXBpVXJsOiBzdHJpbmc7XG5cbiAgICAvLyBEb2N1bWVudHNcbiAgICBkb2N1bWVudFR0bEhvdXJzOiBudW1iZXI7XG4gICAgbWF4VXBsb2FkZWREb2N1bWVudHM6IG51bWJlcjtcblxuICAgIC8vIENvbnZlcnNhdGlvbnNcbiAgICBtYXhDb252ZXJzYXRpb25TZXNzaW9uczogbnVtYmVyO1xuICAgIHNlc3Npb25UdGxEYXlzOiBudW1iZXI7XG5cbiAgICAvLyBVc2VyIGRhdGFcbiAgICB1c2VyRGF0YVBhdGg6IHN0cmluZztcblxuICAgIC8vIFB1c2ggbm90aWZpY2F0aW9ucyAoVkFQSUQpXG4gICAgdmFwaWRQdWJsaWNLZXk6IHN0cmluZztcbiAgICB2YXBpZFByaXZhdGVLZXk6IHN0cmluZztcbiAgICB2YXBpZFN1YmplY3Q6IHN0cmluZztcblxuICAgIC8vIFN3YWdnZXJcbiAgICBzd2FnZ2VyQmFzZVVybDogc3RyaW5nO1xufVxuXG5jb25zdCBERUZBVUxUX0NPTkZJRzogRW52Q29uZmlnID0ge1xuICAgIC8vIE5vZGVcbiAgICBub2RlRW52OiAnZGV2ZWxvcG1lbnQnLFxuXG4gICAgLy8gU2VydmVyXG4gICAgcG9ydDogNTI0MTYsXG4gICAgc2VydmVySG9zdDogJzAuMC4wLjAnLFxuXG4gICAgLy8gRGF0YWJhc2VcbiAgICBkYXRhYmFzZVVybDogJ3Bvc3RncmVzcWw6Ly9sb2NhbGhvc3Q6NTQzMi9vcGVubWFrZV9sbG0nLFxuXG4gICAgLy8gQXV0aFxuICAgIGp3dFNlY3JldDogJycsXG4gICAgYWRtaW5QYXNzd29yZDogJycsXG4gICAgZGVmYXVsdEFkbWluRW1haWw6ICdhZG1pbkBsb2NhbGhvc3QnLFxuICAgIGFkbWluRW1haWxzOiAnJyxcblxuICAgIC8vIE9BdXRoXG4gICAgZ29vZ2xlQ2xpZW50SWQ6ICcnLFxuICAgIGdvb2dsZUNsaWVudFNlY3JldDogJycsXG4gICAgZ2l0aHViQ2xpZW50SWQ6ICcnLFxuICAgIGdpdGh1YkNsaWVudFNlY3JldDogJycsXG4gICAgb2F1dGhSZWRpcmVjdFVyaTogJ2h0dHA6Ly9sb2NhbGhvc3Q6NTI0MTYvYXBpL2F1dGgvY2FsbGJhY2svZ29vZ2xlJyxcblxuICAgIC8vIENPUlNcbiAgICBjb3JzT3JpZ2luczogJ2h0dHA6Ly9sb2NhbGhvc3Q6NTI0MTYnLFxuXG4gICAgLy8gT2xsYW1hXG4gICAgb2xsYW1hQmFzZVVybDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MTE0MzQnLFxuICAgIG9sbGFtYURlZmF1bHRNb2RlbDogJ2dlbWluaS0zLWZsYXNoLXByZXZpZXc6Y2xvdWQnLFxuICAgIG9sbGFtYUtvcmVhbk1vZGVsOiAnZ2VtaW5pLTMtZmxhc2gtcHJldmlldzpjbG91ZCcsXG4gICAgb2xsYW1hTW9kZWw6ICdnZW1pbmktMy1mbGFzaC1wcmV2aWV3OmNsb3VkJyxcbiAgICBvbGxhbWFUaW1lb3V0OiAxMjAwMDAsXG4gICAgb2xsYW1hSG9zdDogJ2h0dHA6Ly9sb2NhbGhvc3Q6MTE0MzQnLFxuICAgIG9sbGFtYUFwaUtleTogJycsXG4gICAgb2xsYW1hQXBpS2V5UHJpbWFyeTogJycsXG4gICAgb2xsYW1hQXBpS2V5U2Vjb25kYXJ5OiAnJyxcbiAgICBvbGxhbWFTc2hLZXk6ICcnLFxuICAgIG9sbGFtYU1vZGVsczogW10sICAvLyBQZXIta2V5IG1vZGVsc1xuXG4gICAgLy8gUmF0ZSBsaW1pdHNcbiAgICBvbGxhbWFIb3VybHlMaW1pdDogMTUwLFxuICAgIG9sbGFtYVdlZWtseUxpbWl0OiAyNTAwLFxuICAgIG9sbGFtYU1vbnRobHlQcmVtaXVtTGltaXQ6IDUsXG5cbiAgICAvLyBMb2dcbiAgICBsb2dMZXZlbDogJ2luZm8nLFxuXG4gICAgLy8gR2VtaW5pXG4gICAgZ2VtaW5pVGhpbmtFbmFibGVkOiB0cnVlLFxuICAgIGdlbWluaVRoaW5rTGV2ZWw6ICdoaWdoJyBhcyBjb25zdCxcbiAgICBnZW1pbmlOdW1DdHg6IDMyNzY4LFxuICAgIGdlbWluaUVtYmVkZGluZ01vZGVsOiAnZ2VtaW5pLTMtZmxhc2gtcHJldmlldzpjbG91ZCcsXG4gICAgZ2VtaW5pV2ViU2VhcmNoRW5hYmxlZDogdHJ1ZSxcblxuICAgIC8vIEV4dGVybmFsIHNlcnZpY2VzXG4gICAgZ29vZ2xlQXBpS2V5OiAnJyxcbiAgICBnb29nbGVDc2VJZDogJycsXG4gICAgZmlyZWNyYXdsQXBpS2V5OiAnJyxcbiAgICBmaXJlY3Jhd2xBcGlVcmw6ICdodHRwczovL2FwaS5maXJlY3Jhd2wuZGV2L3YxJyxcblxuICAgIC8vIERvY3VtZW50c1xuICAgIGRvY3VtZW50VHRsSG91cnM6IDEsXG4gICAgbWF4VXBsb2FkZWREb2N1bWVudHM6IDEwMCxcblxuICAgIC8vIENvbnZlcnNhdGlvbnNcbiAgICBtYXhDb252ZXJzYXRpb25TZXNzaW9uczogMTAwMCxcbiAgICBzZXNzaW9uVHRsRGF5czogMzAsXG5cbiAgICAvLyBVc2VyIGRhdGFcbiAgICB1c2VyRGF0YVBhdGg6ICcuL2RhdGEvdXNlcnMnLFxuXG4gICAgLy8gVkFQSURcbiAgICB2YXBpZFB1YmxpY0tleTogJycsXG4gICAgdmFwaWRQcml2YXRlS2V5OiAnJyxcbiAgICB2YXBpZFN1YmplY3Q6ICdtYWlsdG86YWRtaW5Ab3Blbm1ha2UuYWknLFxuXG4gICAgLy8gU3dhZ2dlclxuICAgIHN3YWdnZXJCYXNlVXJsOiAnJyxcbn07XG5cbmZ1bmN0aW9uIHBhcnNlRW52RmlsZShmaWxlUGF0aDogc3RyaW5nKTogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB7XG4gICAgY29uc3QgZW52OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG5cbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZmlsZVBhdGgpKSB7XG4gICAgICAgIHJldHVybiBlbnY7XG4gICAgfVxuXG4gICAgY29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0Zi04Jyk7XG4gICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcblxuICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICBjb25zdCB0cmltbWVkID0gbGluZS50cmltKCk7XG5cbiAgICAgICAgLy8g67mIIOykhOydtOuCmCDso7zshJ0g6rG064SI65uw6riwXG4gICAgICAgIGlmICghdHJpbW1lZCB8fCB0cmltbWVkLnN0YXJ0c1dpdGgoJyMnKSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBlcXVhbEluZGV4ID0gdHJpbW1lZC5pbmRleE9mKCc9Jyk7XG4gICAgICAgIGlmIChlcXVhbEluZGV4ID4gMCkge1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gdHJpbW1lZC5zdWJzdHJpbmcoMCwgZXF1YWxJbmRleCkudHJpbSgpO1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0cmltbWVkLnN1YnN0cmluZyhlcXVhbEluZGV4ICsgMSkudHJpbSgpO1xuICAgICAgICAgICAgZW52W2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBlbnY7XG59XG5cbmZ1bmN0aW9uIHBhcnNlTG9nTGV2ZWwodmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCk6ICdkZWJ1ZycgfCAnaW5mbycgfCAnd2FybicgfCAnZXJyb3InIHtcbiAgICBjb25zdCBsZXZlbCA9ICh2YWx1ZSB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGV2ZWwgPT09ICdkZWJ1ZycgfHwgbGV2ZWwgPT09ICdpbmZvJyB8fCBsZXZlbCA9PT0gJ3dhcm4nIHx8IGxldmVsID09PSAnZXJyb3InKSB7XG4gICAgICAgIHJldHVybiBsZXZlbDtcbiAgICB9XG4gICAgcmV0dXJuIERFRkFVTFRfQ09ORklHLmxvZ0xldmVsO1xufVxuXG4vKipcbiAqIO2VhOyImCDtmZjqsr0g67OA7IiYIOqygOymnVxuICog65+w7YOA7J6EIOyLnOyekSDsoITsl5Ag7Zi47Lac7ZWY7JesIOyEpOyglSDsmKTrpZjrpbwg7KGw6riw7JeQIOuwnOqyrFxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVDb25maWcoY29uZmlnOiBFbnZDb25maWcpOiB2b2lkIHtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBVUkwg6rKA7KadXG4gICAgaWYgKCFjb25maWcub2xsYW1hQmFzZVVybCB8fCAhY29uZmlnLm9sbGFtYUJhc2VVcmwuc3RhcnRzV2l0aCgnaHR0cCcpKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKGBJbnZhbGlkIE9MTEFNQV9CQVNFX1VSTDogJHtjb25maWcub2xsYW1hQmFzZVVybH1gKTtcbiAgICB9XG5cbiAgICAvLyDrqqjrjbgg7J2066aEIOqygOymnVxuICAgIGlmICghY29uZmlnLm9sbGFtYURlZmF1bHRNb2RlbCB8fCBjb25maWcub2xsYW1hRGVmYXVsdE1vZGVsLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgICAgZXJyb3JzLnB1c2goJ09MTEFNQV9ERUZBVUxUX01PREVMIGlzIHJlcXVpcmVkJyk7XG4gICAgfVxuXG4gICAgLy8g7YOA7J6E7JWE7JuDIOqygOymnVxuICAgIGlmIChjb25maWcub2xsYW1hVGltZW91dCA8PSAwIHx8IGNvbmZpZy5vbGxhbWFUaW1lb3V0ID4gNjAwMDAwKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKGBJbnZhbGlkIE9MTEFNQV9USU1FT1VUOiAke2NvbmZpZy5vbGxhbWFUaW1lb3V0fSAobXVzdCBiZSBiZXR3ZWVuIDEtNjAwMDAwbXMpYCk7XG4gICAgfVxuXG4gICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ29uZmlndXJhdGlvbiB2YWxpZGF0aW9uIGZhaWxlZDpcXG4ke2Vycm9ycy5qb2luKCdcXG4nKX1gKTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2FkQ29uZmlnKCk6IEVudkNvbmZpZyB7XG4gICAgLy8g7ZSE66Gc7KCd7Yq4IOujqO2KuOyXkOyEnCAuZW52IO2MjOydvCDssL7quLBcbiAgICBjb25zdCBlbnZQYXRoID0gcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksICcuZW52Jyk7XG4gICAgY29uc3QgcHJvamVjdEVudlBhdGggPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4vLi4vLmVudicpO1xuXG4gICAgLy8g7ZmY6rK967OA7IiYIOyasOyEoOyInOychDogcHJvY2Vzcy5lbnYgPiAuZW52IO2MjOydvCA+IOq4sOuzuOqwklxuICAgIGNvbnN0IGZpbGVFbnYgPSBwYXJzZUVudkZpbGUoZnMuZXhpc3RzU3luYyhlbnZQYXRoKSA/IGVudlBhdGggOiBwcm9qZWN0RW52UGF0aCk7XG5cbiAgICBjb25zdCBlbnYgPSAoa2V5OiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQgPT4gcHJvY2Vzcy5lbnZba2V5XSB8fCBmaWxlRW52W2tleV07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICAvLyBOb2RlXG4gICAgICAgIG5vZGVFbnY6IGVudignTk9ERV9FTlYnKSB8fCBERUZBVUxUX0NPTkZJRy5ub2RlRW52LFxuXG4gICAgICAgIC8vIFNlcnZlclxuICAgICAgICBwb3J0OiBwYXJzZUludChlbnYoJ1BPUlQnKSB8fCBTdHJpbmcoREVGQVVMVF9DT05GSUcucG9ydCksIDEwKSxcbiAgICAgICAgc2VydmVySG9zdDogZW52KCdTRVJWRVJfSE9TVCcpIHx8IERFRkFVTFRfQ09ORklHLnNlcnZlckhvc3QsXG5cbiAgICAgICAgLy8gRGF0YWJhc2VcbiAgICAgICAgZGF0YWJhc2VVcmw6IGVudignREFUQUJBU0VfVVJMJykgfHwgREVGQVVMVF9DT05GSUcuZGF0YWJhc2VVcmwsXG5cbiAgICAgICAgLy8gQXV0aFxuICAgICAgICBqd3RTZWNyZXQ6IGVudignSldUX1NFQ1JFVCcpIHx8IERFRkFVTFRfQ09ORklHLmp3dFNlY3JldCxcbiAgICAgICAgYWRtaW5QYXNzd29yZDogZW52KCdBRE1JTl9QQVNTV09SRCcpIHx8IERFRkFVTFRfQ09ORklHLmFkbWluUGFzc3dvcmQsXG4gICAgICAgIGRlZmF1bHRBZG1pbkVtYWlsOiBlbnYoJ0RFRkFVTFRfQURNSU5fRU1BSUwnKSB8fCBERUZBVUxUX0NPTkZJRy5kZWZhdWx0QWRtaW5FbWFpbCxcbiAgICAgICAgYWRtaW5FbWFpbHM6IGVudignQURNSU5fRU1BSUxTJykgfHwgREVGQVVMVF9DT05GSUcuYWRtaW5FbWFpbHMsXG5cbiAgICAgICAgLy8gT0F1dGhcbiAgICAgICAgZ29vZ2xlQ2xpZW50SWQ6IGVudignR09PR0xFX0NMSUVOVF9JRCcpIHx8IERFRkFVTFRfQ09ORklHLmdvb2dsZUNsaWVudElkLFxuICAgICAgICBnb29nbGVDbGllbnRTZWNyZXQ6IGVudignR09PR0xFX0NMSUVOVF9TRUNSRVQnKSB8fCBERUZBVUxUX0NPTkZJRy5nb29nbGVDbGllbnRTZWNyZXQsXG4gICAgICAgIGdpdGh1YkNsaWVudElkOiBlbnYoJ0dJVEhVQl9DTElFTlRfSUQnKSB8fCBERUZBVUxUX0NPTkZJRy5naXRodWJDbGllbnRJZCxcbiAgICAgICAgZ2l0aHViQ2xpZW50U2VjcmV0OiBlbnYoJ0dJVEhVQl9DTElFTlRfU0VDUkVUJykgfHwgREVGQVVMVF9DT05GSUcuZ2l0aHViQ2xpZW50U2VjcmV0LFxuICAgICAgICBvYXV0aFJlZGlyZWN0VXJpOiBlbnYoJ09BVVRIX1JFRElSRUNUX1VSSScpIHx8IERFRkFVTFRfQ09ORklHLm9hdXRoUmVkaXJlY3RVcmksXG5cbiAgICAgICAgLy8gQ09SU1xuICAgICAgICBjb3JzT3JpZ2luczogZW52KCdDT1JTX09SSUdJTlMnKSB8fCBERUZBVUxUX0NPTkZJRy5jb3JzT3JpZ2lucyxcblxuICAgICAgICAvLyBPbGxhbWFcbiAgICAgICAgb2xsYW1hQmFzZVVybDogZW52KCdPTExBTUFfQkFTRV9VUkwnKSB8fCBERUZBVUxUX0NPTkZJRy5vbGxhbWFCYXNlVXJsLFxuICAgICAgICBvbGxhbWFEZWZhdWx0TW9kZWw6IGVudignT0xMQU1BX0RFRkFVTFRfTU9ERUwnKSB8fCBERUZBVUxUX0NPTkZJRy5vbGxhbWFEZWZhdWx0TW9kZWwsXG4gICAgICAgIG9sbGFtYUtvcmVhbk1vZGVsOiBlbnYoJ09MTEFNQV9LT1JFQU5fTU9ERUwnKSB8fCBERUZBVUxUX0NPTkZJRy5vbGxhbWFLb3JlYW5Nb2RlbCxcbiAgICAgICAgb2xsYW1hTW9kZWw6IGVudignT0xMQU1BX01PREVMJykgfHwgREVGQVVMVF9DT05GSUcub2xsYW1hTW9kZWwsXG4gICAgICAgIG9sbGFtYVRpbWVvdXQ6IHBhcnNlSW50KGVudignT0xMQU1BX1RJTUVPVVQnKSB8fCBTdHJpbmcoREVGQVVMVF9DT05GSUcub2xsYW1hVGltZW91dCksIDEwKSxcbiAgICAgICAgb2xsYW1hSG9zdDogZW52KCdPTExBTUFfSE9TVCcpIHx8IERFRkFVTFRfQ09ORklHLm9sbGFtYUhvc3QsXG4gICAgICAgIG9sbGFtYUFwaUtleTogZW52KCdPTExBTUFfQVBJX0tFWScpIHx8IERFRkFVTFRfQ09ORklHLm9sbGFtYUFwaUtleSxcbiAgICAgICAgb2xsYW1hQXBpS2V5UHJpbWFyeTogZW52KCdPTExBTUFfQVBJX0tFWV9QUklNQVJZJykgfHwgREVGQVVMVF9DT05GSUcub2xsYW1hQXBpS2V5UHJpbWFyeSxcbiAgICAgICAgb2xsYW1hQXBpS2V5U2Vjb25kYXJ5OiBlbnYoJ09MTEFNQV9BUElfS0VZX1NFQ09OREFSWScpIHx8IERFRkFVTFRfQ09ORklHLm9sbGFtYUFwaUtleVNlY29uZGFyeSxcbiAgICAgICAgb2xsYW1hU3NoS2V5OiBlbnYoJ09MTEFNQV9TU0hfS0VZJykgfHwgREVGQVVMVF9DT05GSUcub2xsYW1hU3NoS2V5LFxuXG4gICAgICAgIC8vIFBlci1rZXkgbW9kZWxzIChPTExBTUFfTU9ERUxfMSwgXzIsIF8zLCAuLi4gTilcbiAgICAgICAgb2xsYW1hTW9kZWxzOiAoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbW9kZWxzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgICAgbGV0IGluZGV4ID0gMTtcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9kZWwgPSBlbnYoYE9MTEFNQV9NT0RFTF8ke2luZGV4fWApO1xuICAgICAgICAgICAgICAgIGlmIChtb2RlbCAmJiBtb2RlbC50cmltKCkgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZGVscy5wdXNoKG1vZGVsLnRyaW0oKSk7XG4gICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1vZGVscztcbiAgICAgICAgfSkoKSxcblxuICAgICAgICAvLyBSYXRlIGxpbWl0c1xuICAgICAgICBvbGxhbWFIb3VybHlMaW1pdDogcGFyc2VJbnQoZW52KCdPTExBTUFfSE9VUkxZX0xJTUlUJykgfHwgU3RyaW5nKERFRkFVTFRfQ09ORklHLm9sbGFtYUhvdXJseUxpbWl0KSwgMTApLFxuICAgICAgICBvbGxhbWFXZWVrbHlMaW1pdDogcGFyc2VJbnQoZW52KCdPTExBTUFfV0VFS0xZX0xJTUlUJykgfHwgU3RyaW5nKERFRkFVTFRfQ09ORklHLm9sbGFtYVdlZWtseUxpbWl0KSwgMTApLFxuICAgICAgICBvbGxhbWFNb250aGx5UHJlbWl1bUxpbWl0OiBwYXJzZUludChlbnYoJ09MTEFNQV9NT05USExZX1BSRU1JVU1fTElNSVQnKSB8fCBTdHJpbmcoREVGQVVMVF9DT05GSUcub2xsYW1hTW9udGhseVByZW1pdW1MaW1pdCksIDEwKSxcblxuICAgICAgICAvLyBMb2dcbiAgICAgICAgbG9nTGV2ZWw6IHBhcnNlTG9nTGV2ZWwoZW52KCdMT0dfTEVWRUwnKSksXG5cbiAgICAgICAgLy8gR2VtaW5pXG4gICAgICAgIGdlbWluaVRoaW5rRW5hYmxlZDogKGVudignR0VNSU5JX1RISU5LX0VOQUJMRUQnKSB8fCAndHJ1ZScpID09PSAndHJ1ZScsXG4gICAgICAgIGdlbWluaVRoaW5rTGV2ZWw6IChlbnYoJ0dFTUlOSV9USElOS19MRVZFTCcpIHx8ICdoaWdoJykgYXMgJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyxcbiAgICAgICAgZ2VtaW5pTnVtQ3R4OiBwYXJzZUludChlbnYoJ0dFTUlOSV9OVU1fQ1RYJykgfHwgJzMyNzY4JywgMTApLFxuICAgICAgICBnZW1pbmlFbWJlZGRpbmdNb2RlbDogZW52KCdHRU1JTklfRU1CRURESU5HX01PREVMJykgfHwgREVGQVVMVF9DT05GSUcuZ2VtaW5pRW1iZWRkaW5nTW9kZWwsXG4gICAgICAgIGdlbWluaVdlYlNlYXJjaEVuYWJsZWQ6IChlbnYoJ0dFTUlOSV9XRUJfU0VBUkNIX0VOQUJMRUQnKSB8fCAndHJ1ZScpID09PSAndHJ1ZScsXG5cbiAgICAgICAgLy8gRXh0ZXJuYWwgc2VydmljZXNcbiAgICAgICAgZ29vZ2xlQXBpS2V5OiBlbnYoJ0dPT0dMRV9BUElfS0VZJykgfHwgREVGQVVMVF9DT05GSUcuZ29vZ2xlQXBpS2V5LFxuICAgICAgICBnb29nbGVDc2VJZDogZW52KCdHT09HTEVfQ1NFX0lEJykgfHwgREVGQVVMVF9DT05GSUcuZ29vZ2xlQ3NlSWQsXG4gICAgICAgIGZpcmVjcmF3bEFwaUtleTogZW52KCdGSVJFQ1JBV0xfQVBJX0tFWScpIHx8IERFRkFVTFRfQ09ORklHLmZpcmVjcmF3bEFwaUtleSxcbiAgICAgICAgZmlyZWNyYXdsQXBpVXJsOiBlbnYoJ0ZJUkVDUkFXTF9BUElfVVJMJykgfHwgREVGQVVMVF9DT05GSUcuZmlyZWNyYXdsQXBpVXJsLFxuXG4gICAgICAgIC8vIERvY3VtZW50c1xuICAgICAgICBkb2N1bWVudFR0bEhvdXJzOiBwYXJzZUludChlbnYoJ0RPQ1VNRU5UX1RUTF9IT1VSUycpIHx8IFN0cmluZyhERUZBVUxUX0NPTkZJRy5kb2N1bWVudFR0bEhvdXJzKSwgMTApLFxuICAgICAgICBtYXhVcGxvYWRlZERvY3VtZW50czogcGFyc2VJbnQoZW52KCdNQVhfVVBMT0FERURfRE9DVU1FTlRTJykgfHwgU3RyaW5nKERFRkFVTFRfQ09ORklHLm1heFVwbG9hZGVkRG9jdW1lbnRzKSwgMTApLFxuXG4gICAgICAgIC8vIENvbnZlcnNhdGlvbnNcbiAgICAgICAgbWF4Q29udmVyc2F0aW9uU2Vzc2lvbnM6IHBhcnNlSW50KGVudignTUFYX0NPTlZFUlNBVElPTl9TRVNTSU9OUycpIHx8IFN0cmluZyhERUZBVUxUX0NPTkZJRy5tYXhDb252ZXJzYXRpb25TZXNzaW9ucyksIDEwKSxcbiAgICAgICAgc2Vzc2lvblR0bERheXM6IHBhcnNlSW50KGVudignU0VTU0lPTl9UVExfREFZUycpIHx8IFN0cmluZyhERUZBVUxUX0NPTkZJRy5zZXNzaW9uVHRsRGF5cyksIDEwKSxcblxuICAgICAgICAvLyBVc2VyIGRhdGFcbiAgICAgICAgdXNlckRhdGFQYXRoOiBlbnYoJ1VTRVJfREFUQV9QQVRIJykgfHwgREVGQVVMVF9DT05GSUcudXNlckRhdGFQYXRoLFxuXG4gICAgICAgIC8vIFZBUElEXG4gICAgICAgIHZhcGlkUHVibGljS2V5OiBlbnYoJ1ZBUElEX1BVQkxJQ19LRVknKSB8fCBERUZBVUxUX0NPTkZJRy52YXBpZFB1YmxpY0tleSxcbiAgICAgICAgdmFwaWRQcml2YXRlS2V5OiBlbnYoJ1ZBUElEX1BSSVZBVEVfS0VZJykgfHwgREVGQVVMVF9DT05GSUcudmFwaWRQcml2YXRlS2V5LFxuICAgICAgICB2YXBpZFN1YmplY3Q6IGVudignVkFQSURfU1VCSkVDVCcpIHx8IERFRkFVTFRfQ09ORklHLnZhcGlkU3ViamVjdCxcblxuICAgICAgICAvLyBTd2FnZ2VyXG4gICAgICAgIHN3YWdnZXJCYXNlVXJsOiBlbnYoJ1NXQUdHRVJfQkFTRV9VUkwnKSB8fCBERUZBVUxUX0NPTkZJRy5zd2FnZ2VyQmFzZVVybCxcbiAgICB9O1xufVxuXG4vLyDsi7HquIDthqQg7ISk7KCVIOyduOyKpO2EtOyKpFxubGV0IGNhY2hlZENvbmZpZzogRW52Q29uZmlnIHwgbnVsbCA9IG51bGw7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb25maWcoKTogRW52Q29uZmlnIHtcbiAgICBpZiAoIWNhY2hlZENvbmZpZykge1xuICAgICAgICBjYWNoZWRDb25maWcgPSBsb2FkQ29uZmlnKCk7XG4gICAgICAgIC8vIOyEpOyglSDqsoDspp1cbiAgICAgICAgdmFsaWRhdGVDb25maWcoY2FjaGVkQ29uZmlnKTtcbiAgICB9XG4gICAgcmV0dXJuIGNhY2hlZENvbmZpZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0Q29uZmlnKCk6IHZvaWQge1xuICAgIGNhY2hlZENvbmZpZyA9IG51bGw7XG59XG4iXSwidmVyc2lvbiI6M30=