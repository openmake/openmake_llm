a30d73f07757a2686dafaebd66931c77
"use strict";
/**
 * Ollama Agent Loop 유닛 테스트
 */
Object.defineProperty(exports, "__esModule", { value: true });
const agent_loop_1 = require("../../../backend/api/src/ollama/agent-loop");
// Mock Tools
const addTool = {
    type: 'function',
    function: {
        name: 'add',
        description: 'Add two numbers',
        parameters: {
            type: 'object',
            properties: {
                a: { type: 'integer', description: 'First number' },
                b: { type: 'integer', description: 'Second number' }
            },
            required: ['a', 'b']
        }
    }
};
const multiplyTool = {
    type: 'function',
    function: {
        name: 'multiply',
        description: 'Multiply two numbers',
        parameters: {
            type: 'object',
            properties: {
                a: { type: 'integer', description: 'First number' },
                b: { type: 'integer', description: 'Second number' }
            },
            required: ['a', 'b']
        }
    }
};
// Mock Functions
const availableFunctions = {
    add: (args) => args.a + args.b,
    multiply: (args) => args.a * args.b
};
describe('Ollama Agent Loop', () => {
    describe('mcpToolToOllamaTool', () => {
        it('should convert MCP tool to Ollama tool format', () => {
            const mcpTool = {
                tool: {
                    name: 'test_tool',
                    description: 'A test tool',
                    inputSchema: {
                        type: 'object',
                        properties: {
                            input: { type: 'string', description: 'Input value' }
                        },
                        required: ['input']
                    }
                }
            };
            const result = (0, agent_loop_1.mcpToolToOllamaTool)(mcpTool);
            expect(result.type).toBe('function');
            expect(result.function.name).toBe('test_tool');
            expect(result.function.description).toBe('A test tool');
            expect(result.function.parameters).toEqual(mcpTool.tool.inputSchema);
        });
    });
    describe('mcpToolsToOllamaTools', () => {
        it('should convert multiple MCP tools', () => {
            const mcpTools = [
                {
                    tool: {
                        name: 'tool1',
                        description: 'Tool 1',
                        inputSchema: { type: 'object', properties: {} }
                    }
                },
                {
                    tool: {
                        name: 'tool2',
                        description: 'Tool 2',
                        inputSchema: { type: 'object', properties: {} }
                    }
                }
            ];
            const result = (0, agent_loop_1.mcpToolsToOllamaTools)(mcpTools);
            expect(result).toHaveLength(2);
            expect(result[0].function.name).toBe('tool1');
            expect(result[1].function.name).toBe('tool2');
        });
    });
    // Note: 아래 테스트는 실제 Ollama 서버가 필요하므로 integration test로 분류해야 합니다.
    // 여기서는 구조 테스트만 수행합니다.
    describe('AgentLoopOptions interface', () => {
        it('should accept valid options', () => {
            const options = {
                model: 'gemini-3-flash-preview:cloud',
                messages: [{ role: 'user', content: 'Test' }],
                tools: [addTool, multiplyTool],
                availableFunctions,
                think: true,
                stream: false,
                maxIterations: 5
            };
            expect(options.model).toBe('gemini-3-flash-preview:cloud');
            expect(options.tools).toHaveLength(2);
            expect(options.maxIterations).toBe(5);
        });
        it('should have default values for optional fields', () => {
            const options = {
                messages: [{ role: 'user', content: 'Test' }],
                tools: [],
                availableFunctions: {}
            };
            expect(options.model).toBeUndefined();
            expect(options.think).toBeUndefined();
            expect(options.stream).toBeUndefined();
            expect(options.maxIterations).toBeUndefined();
        });
    });
    describe('Tool Definitions', () => {
        it('should have correct structure for add tool', () => {
            expect(addTool.type).toBe('function');
            expect(addTool.function.name).toBe('add');
            expect(addTool.function.parameters.required).toContain('a');
            expect(addTool.function.parameters.required).toContain('b');
        });
        it('should have correct structure for multiply tool', () => {
            expect(multiplyTool.type).toBe('function');
            expect(multiplyTool.function.name).toBe('multiply');
        });
    });
    describe('Available Functions', () => {
        it('should correctly execute add function', () => {
            const result = availableFunctions.add({ a: 5, b: 3 });
            expect(result).toBe(8);
        });
        it('should correctly execute multiply function', () => {
            const result = availableFunctions.multiply({ a: 4, b: 7 });
            expect(result).toBe(28);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vdGVzdHMvdW5pdC9fX3Rlc3RzX18vYWdlbnQtbG9vcC50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFFSCwyRUFPb0Q7QUFHcEQsYUFBYTtBQUNiLE1BQU0sT0FBTyxHQUFtQjtJQUM1QixJQUFJLEVBQUUsVUFBVTtJQUNoQixRQUFRLEVBQUU7UUFDTixJQUFJLEVBQUUsS0FBSztRQUNYLFdBQVcsRUFBRSxpQkFBaUI7UUFDOUIsVUFBVSxFQUFFO1lBQ1IsSUFBSSxFQUFFLFFBQVE7WUFDZCxVQUFVLEVBQUU7Z0JBQ1IsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsY0FBYyxFQUFFO2dCQUNuRCxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUU7YUFDdkQ7WUFDRCxRQUFRLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1NBQ3ZCO0tBQ0o7Q0FDSixDQUFDO0FBRUYsTUFBTSxZQUFZLEdBQW1CO0lBQ2pDLElBQUksRUFBRSxVQUFVO0lBQ2hCLFFBQVEsRUFBRTtRQUNOLElBQUksRUFBRSxVQUFVO1FBQ2hCLFdBQVcsRUFBRSxzQkFBc0I7UUFDbkMsVUFBVSxFQUFFO1lBQ1IsSUFBSSxFQUFFLFFBQVE7WUFDZCxVQUFVLEVBQUU7Z0JBQ1IsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsY0FBYyxFQUFFO2dCQUNuRCxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUU7YUFDdkQ7WUFDRCxRQUFRLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO1NBQ3ZCO0tBQ0o7Q0FDSixDQUFDO0FBRUYsaUJBQWlCO0FBQ2pCLE1BQU0sa0JBQWtCLEdBQUc7SUFDdkIsR0FBRyxFQUFFLENBQUMsSUFBOEIsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLENB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QUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMzRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVm9sdW1lcy9NQUNfQVBQL29wZW5tYWtlX2xsbS90ZXN0cy91bml0L19fdGVzdHNfXy9hZ2VudC1sb29wLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPbGxhbWEgQWdlbnQgTG9vcCDsnKDri5sg7YWM7Iqk7Yq4XG4gKi9cblxuaW1wb3J0IHtcbiAgICBydW5BZ2VudExvb3AsXG4gICAgZXhlY3V0ZVNpbmdsZVRvb2xDYWxsLFxuICAgIG1jcFRvb2xUb09sbGFtYVRvb2wsXG4gICAgbWNwVG9vbHNUb09sbGFtYVRvb2xzLFxuICAgIEFnZW50TG9vcE9wdGlvbnMsXG4gICAgQWdlbnRMb29wUmVzdWx0XG59IGZyb20gJy4uLy4uLy4uL2JhY2tlbmQvYXBpL3NyYy9vbGxhbWEvYWdlbnQtbG9vcCc7XG5pbXBvcnQgeyBUb29sRGVmaW5pdGlvbiwgQ2hhdE1lc3NhZ2UgfSBmcm9tICcuLi8uLi8uLi9iYWNrZW5kL2FwaS9zcmMvb2xsYW1hL3R5cGVzJztcblxuLy8gTW9jayBUb29sc1xuY29uc3QgYWRkVG9vbDogVG9vbERlZmluaXRpb24gPSB7XG4gICAgdHlwZTogJ2Z1bmN0aW9uJyxcbiAgICBmdW5jdGlvbjoge1xuICAgICAgICBuYW1lOiAnYWRkJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdBZGQgdHdvIG51bWJlcnMnLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICBhOiB7IHR5cGU6ICdpbnRlZ2VyJywgZGVzY3JpcHRpb246ICdGaXJzdCBudW1iZXInIH0sXG4gICAgICAgICAgICAgICAgYjogeyB0eXBlOiAnaW50ZWdlcicsIGRlc2NyaXB0aW9uOiAnU2Vjb25kIG51bWJlcicgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlcXVpcmVkOiBbJ2EnLCAnYiddXG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5jb25zdCBtdWx0aXBseVRvb2w6IFRvb2xEZWZpbml0aW9uID0ge1xuICAgIHR5cGU6ICdmdW5jdGlvbicsXG4gICAgZnVuY3Rpb246IHtcbiAgICAgICAgbmFtZTogJ211bHRpcGx5JyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdNdWx0aXBseSB0d28gbnVtYmVycycsXG4gICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgIGE6IHsgdHlwZTogJ2ludGVnZXInLCBkZXNjcmlwdGlvbjogJ0ZpcnN0IG51bWJlcicgfSxcbiAgICAgICAgICAgICAgICBiOiB7IHR5cGU6ICdpbnRlZ2VyJywgZGVzY3JpcHRpb246ICdTZWNvbmQgbnVtYmVyJyB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVxdWlyZWQ6IFsnYScsICdiJ11cbiAgICAgICAgfVxuICAgIH1cbn07XG5cbi8vIE1vY2sgRnVuY3Rpb25zXG5jb25zdCBhdmFpbGFibGVGdW5jdGlvbnMgPSB7XG4gICAgYWRkOiAoYXJnczogeyBhOiBudW1iZXI7IGI6IG51bWJlciB9KSA9PiBhcmdzLmEgKyBhcmdzLmIsXG4gICAgbXVsdGlwbHk6IChhcmdzOiB7IGE6IG51bWJlcjsgYjogbnVtYmVyIH0pID0+IGFyZ3MuYSAqIGFyZ3MuYlxufTtcblxuZGVzY3JpYmUoJ09sbGFtYSBBZ2VudCBMb29wJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdtY3BUb29sVG9PbGxhbWFUb29sJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGNvbnZlcnQgTUNQIHRvb2wgdG8gT2xsYW1hIHRvb2wgZm9ybWF0JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWNwVG9vbCA9IHtcbiAgICAgICAgICAgICAgICB0b29sOiB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICd0ZXN0X3Rvb2wnLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0EgdGVzdCB0b29sJyxcbiAgICAgICAgICAgICAgICAgICAgaW5wdXRTY2hlbWE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiB7IHR5cGU6ICdzdHJpbmcnLCBkZXNjcmlwdGlvbjogJ0lucHV0IHZhbHVlJyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFsnaW5wdXQnXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gbWNwVG9vbFRvT2xsYW1hVG9vbChtY3BUb29sKTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC50eXBlKS50b0JlKCdmdW5jdGlvbicpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5mdW5jdGlvbi5uYW1lKS50b0JlKCd0ZXN0X3Rvb2wnKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZnVuY3Rpb24uZGVzY3JpcHRpb24pLnRvQmUoJ0EgdGVzdCB0b29sJyk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmZ1bmN0aW9uLnBhcmFtZXRlcnMpLnRvRXF1YWwobWNwVG9vbC50b29sLmlucHV0U2NoZW1hKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnbWNwVG9vbHNUb09sbGFtYVRvb2xzJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGNvbnZlcnQgbXVsdGlwbGUgTUNQIHRvb2xzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWNwVG9vbHMgPSBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0b29sOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAndG9vbDEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdUb29sIDEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRTY2hlbWE6IHsgdHlwZTogJ29iamVjdCcsIHByb3BlcnRpZXM6IHt9IH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0b29sOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAndG9vbDInLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdUb29sIDInLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRTY2hlbWE6IHsgdHlwZTogJ29iamVjdCcsIHByb3BlcnRpZXM6IHt9IH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG1jcFRvb2xzVG9PbGxhbWFUb29scyhtY3BUb29scyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHRbMF0uZnVuY3Rpb24ubmFtZSkudG9CZSgndG9vbDEnKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHRbMV0uZnVuY3Rpb24ubmFtZSkudG9CZSgndG9vbDInKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBOb3RlOiDslYTrnpgg7YWM7Iqk7Yq464qUIOyLpOygnCBPbGxhbWEg7ISc67KE6rCAIO2VhOyalO2VmOuvgOuhnCBpbnRlZ3JhdGlvbiB0ZXN066GcIOu2hOulmO2VtOyVvCDtlanri4jri6QuXG4gICAgLy8g7Jes6riw7ISc64qUIOq1rOyhsCDthYzsiqTtirjrp4wg7IiY7ZaJ7ZWp64uI64ukLlxuXG4gICAgZGVzY3JpYmUoJ0FnZW50TG9vcE9wdGlvbnMgaW50ZXJmYWNlJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGFjY2VwdCB2YWxpZCBvcHRpb25zJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9uczogQWdlbnRMb29wT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBtb2RlbDogJ2dlbWluaS0zLWZsYXNoLXByZXZpZXc6Y2xvdWQnLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6ICdUZXN0JyB9XSxcbiAgICAgICAgICAgICAgICB0b29sczogW2FkZFRvb2wsIG11bHRpcGx5VG9vbF0sXG4gICAgICAgICAgICAgICAgYXZhaWxhYmxlRnVuY3Rpb25zLFxuICAgICAgICAgICAgICAgIHRoaW5rOiB0cnVlLFxuICAgICAgICAgICAgICAgIHN0cmVhbTogZmFsc2UsXG4gICAgICAgICAgICAgICAgbWF4SXRlcmF0aW9uczogNVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZXhwZWN0KG9wdGlvbnMubW9kZWwpLnRvQmUoJ2dlbWluaS0zLWZsYXNoLXByZXZpZXc6Y2xvdWQnKTtcbiAgICAgICAgICAgIGV4cGVjdChvcHRpb25zLnRvb2xzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICAgICAgICBleHBlY3Qob3B0aW9ucy5tYXhJdGVyYXRpb25zKS50b0JlKDUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgZGVmYXVsdCB2YWx1ZXMgZm9yIG9wdGlvbmFsIGZpZWxkcycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnM6IEFnZW50TG9vcE9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZXM6IFt7IHJvbGU6ICd1c2VyJywgY29udGVudDogJ1Rlc3QnIH1dLFxuICAgICAgICAgICAgICAgIHRvb2xzOiBbXSxcbiAgICAgICAgICAgICAgICBhdmFpbGFibGVGdW5jdGlvbnM6IHt9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBleHBlY3Qob3B0aW9ucy5tb2RlbCkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KG9wdGlvbnMudGhpbmspLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChvcHRpb25zLnN0cmVhbSkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KG9wdGlvbnMubWF4SXRlcmF0aW9ucykudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdUb29sIERlZmluaXRpb25zJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBzdHJ1Y3R1cmUgZm9yIGFkZCB0b29sJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGFkZFRvb2wudHlwZSkudG9CZSgnZnVuY3Rpb24nKTtcbiAgICAgICAgICAgIGV4cGVjdChhZGRUb29sLmZ1bmN0aW9uLm5hbWUpLnRvQmUoJ2FkZCcpO1xuICAgICAgICAgICAgZXhwZWN0KGFkZFRvb2wuZnVuY3Rpb24ucGFyYW1ldGVycy5yZXF1aXJlZCkudG9Db250YWluKCdhJyk7XG4gICAgICAgICAgICBleHBlY3QoYWRkVG9vbC5mdW5jdGlvbi5wYXJhbWV0ZXJzLnJlcXVpcmVkKS50b0NvbnRhaW4oJ2InKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIGNvcnJlY3Qgc3RydWN0dXJlIGZvciBtdWx0aXBseSB0b29sJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KG11bHRpcGx5VG9vbC50eXBlKS50b0JlKCdmdW5jdGlvbicpO1xuICAgICAgICAgICAgZXhwZWN0KG11bHRpcGx5VG9vbC5mdW5jdGlvbi5uYW1lKS50b0JlKCdtdWx0aXBseScpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdBdmFpbGFibGUgRnVuY3Rpb25zJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGNvcnJlY3RseSBleGVjdXRlIGFkZCBmdW5jdGlvbicsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF2YWlsYWJsZUZ1bmN0aW9ucy5hZGQoeyBhOiA1LCBiOiAzIH0pO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSg4KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBjb3JyZWN0bHkgZXhlY3V0ZSBtdWx0aXBseSBmdW5jdGlvbicsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF2YWlsYWJsZUZ1bmN0aW9ucy5tdWx0aXBseSh7IGE6IDQsIGI6IDcgfSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKDI4KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==