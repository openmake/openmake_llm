{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/__tests__/external-client.test.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/__tests__/external-client.test.ts"],"sourcesContent":["/**\n * ExternalMCPClient Unit Tests\n * SDK 연결은 모킹 — 구조 및 상태 관리 검증\n */\n\nimport { ExternalMCPClient } from '../external-client';\nimport type { MCPServerConfig } from '../types';\n\nconst makeConfig = (overrides?: Partial<MCPServerConfig>): MCPServerConfig => ({\n    id: 'test-1',\n    name: 'test-server',\n    transport_type: 'stdio',\n    command: 'echo',\n    args: ['hello'],\n    enabled: true,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n    ...overrides,\n});\n\ndescribe('ExternalMCPClient', () => {\n    describe('constructor', () => {\n        it('should create client with config', () => {\n            const config = makeConfig();\n            const client = new ExternalMCPClient(config);\n\n            expect(client).toBeDefined();\n            expect(client.getConfig().name).toBe('test-server');\n        });\n\n        it('should start with disconnected status', () => {\n            const client = new ExternalMCPClient(makeConfig());\n            const status = client.getStatus();\n\n            expect(status.status).toBe('disconnected');\n            expect(status.toolCount).toBe(0);\n            expect(status.serverId).toBe('test-1');\n            expect(status.serverName).toBe('test-server');\n        });\n    });\n\n    describe('getTools', () => {\n        it('should return empty array when disconnected', () => {\n            const client = new ExternalMCPClient(makeConfig());\n            expect(client.getTools()).toEqual([]);\n        });\n    });\n\n    describe('callTool (disconnected)', () => {\n        it('should return error when not connected', async () => {\n            const client = new ExternalMCPClient(makeConfig());\n            const result = await client.callTool('test_tool', {});\n\n            expect(result.isError).toBe(true);\n            expect(result.content[0].text).toContain('연결되어 있지 않습니다');\n        });\n    });\n\n    describe('ping (disconnected)', () => {\n        it('should return false when not connected', async () => {\n            const client = new ExternalMCPClient(makeConfig());\n            const result = await client.ping();\n\n            expect(result).toBe(false);\n        });\n    });\n\n    describe('disconnect (already disconnected)', () => {\n        it('should safely disconnect when already disconnected', async () => {\n            const client = new ExternalMCPClient(makeConfig());\n            // Should not throw\n            await client.disconnect();\n            expect(client.getStatus().status).toBe('disconnected');\n        });\n    });\n\n    describe('connect with invalid config', () => {\n        it('should throw for stdio without command', async () => {\n            const client = new ExternalMCPClient(makeConfig({ command: undefined }));\n\n            try {\n                await client.connect();\n                // Should not reach here\n                expect(true).toBe(false);\n            } catch (e) {\n                expect(client.getStatus().status).toBe('error');\n                expect(client.getStatus().error).toBeDefined();\n            }\n        });\n\n        it('should throw for SSE without url', async () => {\n            const client = new ExternalMCPClient(makeConfig({\n                transport_type: 'sse',\n                command: undefined,\n                url: undefined,\n            }));\n\n            try {\n                await client.connect();\n                expect(true).toBe(false);\n            } catch (e) {\n                expect(client.getStatus().status).toBe('error');\n            }\n        });\n\n        it('should throw for streamable-http without url', async () => {\n            const client = new ExternalMCPClient(makeConfig({\n                transport_type: 'streamable-http',\n                command: undefined,\n                url: undefined,\n            }));\n\n            try {\n                await client.connect();\n                expect(true).toBe(false);\n            } catch (e) {\n                expect(client.getStatus().status).toBe('error');\n            }\n        });\n    });\n});\n"],"version":3}