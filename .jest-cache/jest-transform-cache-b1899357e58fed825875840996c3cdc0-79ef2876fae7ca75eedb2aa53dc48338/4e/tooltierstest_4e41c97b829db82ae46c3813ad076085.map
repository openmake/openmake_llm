{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/__tests__/tool-tiers.test.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/__tests__/tool-tiers.test.ts"],"sourcesContent":["/**\n * Tool Tiers Tests\n * MCP 도구 등급별 접근 제어 테스트\n */\n\nimport { describe, it, expect } from 'bun:test';\nimport { canUseTool, getToolsForTier, getDefaultTierForRole, TOOL_TIERS } from '../tool-tiers';\n\ndescribe('Tool Tiers', () => {\n    describe('TOOL_TIERS', () => {\n        it('should define free tier with limited tools', () => {\n            expect(TOOL_TIERS.free).toContain('web_search');\n            expect(TOOL_TIERS.free).toContain('vision_ocr');\n            expect(TOOL_TIERS.free).toContain('analyze_image');\n            expect(TOOL_TIERS.free).not.toContain('run_command');\n        });\n\n        it('should define pro tier with more tools', () => {\n            expect(TOOL_TIERS.pro).toContain('web_search');\n            expect(TOOL_TIERS.pro).toContain('run_command');\n            expect(TOOL_TIERS.pro).toContain('firecrawl_*');\n            expect(TOOL_TIERS.pro).toContain('sequential_thinking');\n        });\n\n        it('should define enterprise tier with wildcard', () => {\n            expect(TOOL_TIERS.enterprise).toContain('*');\n        });\n    });\n\n    describe('canUseTool', () => {\n        describe('free tier', () => {\n            it('should allow web_search', () => {\n                expect(canUseTool('free', 'web_search')).toBe(true);\n            });\n\n            it('should allow vision_ocr', () => {\n                expect(canUseTool('free', 'vision_ocr')).toBe(true);\n            });\n\n            it('should allow analyze_image', () => {\n                expect(canUseTool('free', 'analyze_image')).toBe(true);\n            });\n\n            it('should deny run_command', () => {\n                expect(canUseTool('free', 'run_command')).toBe(false);\n            });\n\n            it('should deny firecrawl tools', () => {\n                expect(canUseTool('free', 'firecrawl_scrape')).toBe(false);\n            });\n\n            it('should deny external tools (with namespace)', () => {\n                expect(canUseTool('free', 'postgres::query')).toBe(false);\n            });\n        });\n\n        describe('pro tier', () => {\n            it('should allow free tier tools', () => {\n                expect(canUseTool('pro', 'web_search')).toBe(true);\n                expect(canUseTool('pro', 'vision_ocr')).toBe(true);\n            });\n\n            it('should allow run_command', () => {\n                expect(canUseTool('pro', 'run_command')).toBe(true);\n            });\n\n            it('should allow firecrawl tools via wildcard', () => {\n                expect(canUseTool('pro', 'firecrawl_scrape')).toBe(true);\n                expect(canUseTool('pro', 'firecrawl_search')).toBe(true);\n            });\n\n            it('should allow sequential_thinking', () => {\n                expect(canUseTool('pro', 'sequential_thinking')).toBe(true);\n            });\n\n            it('should allow external tools by default', () => {\n                // pro tier allows all external tools by default\n                expect(canUseTool('pro', 'postgres::query')).toBe(true);\n                expect(canUseTool('pro', 'redis::get')).toBe(true);\n            });\n        });\n\n        describe('enterprise tier', () => {\n            it('should allow all tools via wildcard', () => {\n                expect(canUseTool('enterprise', 'web_search')).toBe(true);\n                expect(canUseTool('enterprise', 'run_command')).toBe(true);\n                expect(canUseTool('enterprise', 'any_tool')).toBe(true);\n                expect(canUseTool('enterprise', 'postgres::query')).toBe(true);\n            });\n        });\n    });\n\n    describe('getToolsForTier', () => {\n        const allTools = [\n            'web_search',\n            'vision_ocr',\n            'analyze_image',\n            'run_command',\n            'firecrawl_scrape',\n            'sequential_thinking',\n            'postgres::query'\n        ];\n\n        it('should filter tools for free tier', () => {\n            const tools = getToolsForTier('free', allTools);\n            \n            expect(tools).toContain('web_search');\n            expect(tools).toContain('vision_ocr');\n            expect(tools).toContain('analyze_image');\n            expect(tools).not.toContain('run_command');\n            expect(tools).not.toContain('firecrawl_scrape');\n            expect(tools).not.toContain('postgres::query');\n        });\n\n        it('should filter tools for pro tier', () => {\n            const tools = getToolsForTier('pro', allTools);\n            \n            expect(tools).toContain('web_search');\n            expect(tools).toContain('run_command');\n            expect(tools).toContain('firecrawl_scrape');\n            expect(tools).toContain('sequential_thinking');\n            expect(tools).toContain('postgres::query');\n        });\n\n        it('should return all tools for enterprise tier', () => {\n            const tools = getToolsForTier('enterprise', allTools);\n            \n            expect(tools).toEqual(allTools);\n        });\n    });\n\n    describe('getDefaultTierForRole', () => {\n        it('should return enterprise for admin role', () => {\n            expect(getDefaultTierForRole('admin')).toBe('enterprise');\n        });\n\n        it('should return free for user role', () => {\n            expect(getDefaultTierForRole('user')).toBe('free');\n        });\n\n        it('should return free for guest role', () => {\n            expect(getDefaultTierForRole('guest')).toBe('free');\n        });\n    });\n});\n"],"version":3}