{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/ollama/client.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/ollama/client.ts"],"sourcesContent":["import axios, { AxiosInstance } from 'axios';\nimport {\n    OllamaConfig,\n    GenerateRequest,\n    GenerateResponse,\n    ChatRequest,\n    ChatResponse,\n    ChatMessage,\n    ListModelsResponse,\n    ModelOptions,\n    ThinkOption,\n    FormatOption,\n    ToolDefinition,\n    EmbedRequest,\n    EmbedResponse,\n    UsageMetrics,\n    WebSearchRequest,\n    WebSearchResponse,\n    WebFetchRequest,\n    WebFetchResponse\n} from './types';\nimport { getConfig } from '../config';\nimport { createLogger } from '../utils/logger';\nimport { getApiKeyManager, ApiKeyManager } from './api-key-manager';\nimport { runAgentLoop, AgentLoopOptions, AgentLoopResult } from './agent-loop';\n\nconst logger = createLogger('OllamaClient');\n\nconst envConfig = getConfig();\n\nconst DEFAULT_CONFIG: OllamaConfig = {\n    baseUrl: envConfig.ollamaBaseUrl,\n    model: envConfig.ollamaDefaultModel,\n    timeout: envConfig.ollamaTimeout\n};\n\nexport class OllamaClient {\n    private client: AxiosInstance;\n    private config: OllamaConfig;\n    private context: number[] = [];\n    private apiKeyManager: ApiKeyManager;\n\n    // üÜï Ollama Cloud Ìò∏Ïä§Ìä∏ ÏÉÅÏàò\n    private static readonly OLLAMA_CLOUD_HOST = 'https://ollama.com';\n\n    constructor(config: Partial<OllamaConfig> = {}) {\n        this.config = { ...DEFAULT_CONFIG, ...config };\n        this.apiKeyManager = getApiKeyManager();\n\n        // üÜï Î™®Îç∏Ïù¥ :cloud Ï†ëÎØ∏ÏÇ¨Î•º Í∞ÄÏßÄÎ©¥ Ollama Cloud Ìò∏Ïä§Ìä∏ ÏÇ¨Ïö©\n        let baseUrl = this.config.baseUrl;\n        if (this.isCloudModel(this.config.model)) {\n            baseUrl = OllamaClient.OLLAMA_CLOUD_HOST;\n            console.log(`[OllamaClient] üåê Cloud Î™®Îç∏ Í∞êÏßÄ - Ìò∏Ïä§Ìä∏: ${baseUrl}`);\n        }\n\n        this.client = axios.create({\n            baseURL: baseUrl,\n            timeout: this.config.timeout,\n            headers: {\n                'Content-Type': 'application/json',\n                ...this.apiKeyManager.getAuthHeaders()\n            }\n        });\n\n        // üÜï ÏöîÏ≤≠ Ïù∏ÌÑ∞ÏÖâÌÑ∞: ÎèôÏ†Å API ÌÇ§ Ï£ºÏûÖ\n        this.client.interceptors.request.use((config) => {\n            const authHeaders = this.apiKeyManager.getAuthHeaders();\n            if (authHeaders.Authorization) {\n                config.headers.Authorization = authHeaders.Authorization;\n            }\n            return config;\n        });\n\n        // üÜï ÏùëÎãµ Ïù∏ÌÑ∞ÏÖâÌÑ∞: Ïã§Ìå® Ïãú Ìè¥Î∞± Ï≤òÎ¶¨ (Î™®Îì† API ÌÇ§ ÏàúÌôò ÏãúÎèÑ)\n        this.client.interceptors.response.use(\n            (response) => {\n                this.apiKeyManager.reportSuccess();\n                return response;\n            },\n            async (error) => {\n                const statusCode = error?.response?.status;\n                console.log(`[OllamaClient] ‚ùå ÏöîÏ≤≠ Ïã§Ìå® - ÏÉÅÌÉú ÏΩîÎìú: ${statusCode}`);\n\n                // 429, 401, 403 ÏóêÎü¨ Ïãú API ÌÇ§ Ïä§ÏôÄÌïë ÏãúÎèÑ\n                if (statusCode === 429 || statusCode === 401 || statusCode === 403) {\n                    // Ïû¨ÏãúÎèÑ ÌöüÏàò Ï∂îÏ†Å (ÌÇ§ Í∞úÏàòÎßåÌÅº ÏãúÎèÑ)\n                    const retryCount = error.config?._retryCount || 0;\n                    const maxRetries = this.apiKeyManager.getTotalKeys() - 1;\n\n                    console.log(`[OllamaClient] üîÑ API ÌÇ§ Ïä§ÏôÄÌïë ÏãúÎèÑ Ï§ë... (${retryCount + 1}/${maxRetries + 1})`);\n                    const switched = this.apiKeyManager.reportFailure(error);\n\n                    if (switched && error.config && retryCount < maxRetries) {\n                        error.config._retryCount = retryCount + 1;\n                        const newAuthHeaders = this.apiKeyManager.getAuthHeaders();\n                        error.config.headers.Authorization = newAuthHeaders.Authorization;\n                        console.log(`[OllamaClient] ‚úÖ ÏÉà API ÌÇ§Î°ú Ïû¨ÏãúÎèÑ (Key ${this.apiKeyManager.getCurrentKeyIndex() + 1})...`);\n                        return this.client.request(error.config);\n                    } else {\n                        console.log(`[OllamaClient] ‚ö†Ô∏è Î™®Îì† ÌÇ§ ÏÜåÏßÑ - switched: ${switched}, retryCount: ${retryCount}/${maxRetries}`);\n                    }\n                } else {\n                    this.apiKeyManager.reportFailure(error);\n                }\n\n                throw error;\n            }\n        );\n    }\n\n    get model(): string {\n        return this.config.model;\n    }\n\n    /**\n     * üÜï Î™®Îç∏Ïù¥ Cloud Î™®Îç∏(:cloud Ï†ëÎØ∏ÏÇ¨)Ïù∏ÏßÄ ÌôïÏù∏\n     */\n    private isCloudModel(model: string): boolean {\n        return model?.toLowerCase().endsWith(':cloud') ?? false;\n    }\n\n    setModel(model: string): void {\n        this.config.model = model;\n    }\n\n    async listModels(): Promise<ListModelsResponse> {\n        const response = await this.client.get<ListModelsResponse>('/api/tags');\n        return response.data;\n    }\n\n    async generate(\n        prompt: string,\n        options?: ModelOptions,\n        onToken?: (token: string) => void,\n        images?: string[]\n    ): Promise<{ response: string; metrics?: UsageMetrics }> {\n        const request: GenerateRequest = {\n            model: this.config.model,\n            prompt,\n            context: this.context,\n            stream: !!onToken,\n            options,\n            images\n        };\n\n        if (onToken) {\n            return this.streamGenerate(request, onToken);\n        }\n\n        const response = await this.client.post<GenerateResponse>('/api/generate', request);\n        this.context = response.data.context || [];\n        return {\n            response: response.data.response,\n            metrics: {\n                total_duration: response.data.total_duration,\n                load_duration: response.data.load_duration,\n                prompt_eval_count: response.data.prompt_eval_count,\n                prompt_eval_duration: response.data.prompt_eval_duration,\n                eval_count: response.data.eval_count,\n                eval_duration: response.data.eval_duration\n            }\n        };\n    }\n\n    private async streamGenerate(\n        request: GenerateRequest,\n        onToken: (token: string) => void\n    ): Promise<{ response: string; metrics?: UsageMetrics }> {\n        const response = await this.client.post('/api/generate', request, {\n            responseType: 'stream'\n        });\n\n        let fullResponse = '';\n        let metrics: UsageMetrics | undefined;\n\n        return new Promise((resolve, reject) => {\n            let buffer = '';\n\n            response.data.on('data', (chunk: Buffer) => {\n                buffer += chunk.toString();\n                const lines = buffer.split('\\n');\n                buffer = lines.pop() || '';\n\n                for (const line of lines) {\n                    if (line.trim()) {\n                        try {\n                            const data: GenerateResponse = JSON.parse(line);\n                            if (data.response) {\n                                fullResponse += data.response;\n                                onToken(data.response);\n                            }\n                            if (data.done) {\n                                if (data.context) {\n                                    this.context = data.context;\n                                }\n                                metrics = {\n                                    total_duration: data.total_duration,\n                                    load_duration: data.load_duration,\n                                    prompt_eval_count: data.prompt_eval_count,\n                                    prompt_eval_duration: data.prompt_eval_duration,\n                                    eval_count: data.eval_count,\n                                    eval_duration: data.eval_duration\n                                };\n                            }\n                        } catch (e) {\n                            console.error('[OllamaClient] JSON Parse Error:', e);\n                        }\n                    }\n                }\n            });\n\n            response.data.on('end', () => {\n                if (buffer.trim()) {\n                    try {\n                        const data: GenerateResponse = JSON.parse(buffer);\n                        if (data.response) {\n                            fullResponse += data.response;\n                            onToken(data.response);\n                        }\n                        if (data.done) {\n                            metrics = {\n                                total_duration: data.total_duration,\n                                load_duration: data.load_duration,\n                                prompt_eval_count: data.prompt_eval_count,\n                                prompt_eval_duration: data.prompt_eval_duration,\n                                eval_count: data.eval_count,\n                                eval_duration: data.eval_duration\n                            };\n                        }\n                    } catch (e) { /* ignore */ }\n                }\n                resolve({ response: fullResponse, metrics });\n            });\n            response.data.on('error', reject);\n        });\n    }\n\n    /**\n     * Enhanced chat with Thinking, Structured Outputs, and Tool Calling support\n     */\n    async chat(\n        messages: ChatMessage[],\n        options?: ModelOptions,\n        onToken?: (token: string, thinking?: string) => void,\n        advancedOptions?: {\n            think?: ThinkOption;\n            format?: FormatOption;\n            tools?: ToolDefinition[];\n        }\n    ): Promise<ChatMessage & { metrics?: UsageMetrics }> {\n        const request: ChatRequest = {\n            model: this.config.model,\n            messages,\n            stream: !!onToken,\n            options,\n            ...(advancedOptions?.think !== undefined && { think: advancedOptions.think }),\n            ...(advancedOptions?.format && { format: advancedOptions.format }),\n            ...(advancedOptions?.tools && { tools: advancedOptions.tools })\n        };\n\n        if (onToken) {\n            return this.streamChat(request, onToken);\n        }\n\n        const response = await this.client.post<ChatResponse>('/api/chat', request);\n        return {\n            ...response.data.message,\n            metrics: {\n                total_duration: response.data.total_duration,\n                load_duration: response.data.load_duration,\n                prompt_eval_count: response.data.prompt_eval_count,\n                prompt_eval_duration: response.data.prompt_eval_duration,\n                eval_count: response.data.eval_count,\n                eval_duration: response.data.eval_duration\n            }\n        };\n    }\n\n    private async streamChat(\n        request: ChatRequest,\n        onToken: (token: string, thinking?: string) => void\n    ): Promise<ChatMessage & { metrics?: UsageMetrics }> {\n        const response = await this.client.post('/api/chat', request, {\n            responseType: 'stream'\n        });\n\n        let fullContent = '';\n        let fullThinking = '';\n        let toolCalls: any[] = [];\n        let metrics: UsageMetrics | undefined;\n\n        return new Promise((resolve, reject) => {\n            let buffer = '';\n\n            response.data.on('data', (chunk: Buffer) => {\n                // logger.debug(`Data chunk received: ${chunk.length} bytes`); // Log noise reduction\n                buffer += chunk.toString();\n                const lines = buffer.split('\\n');\n                buffer = lines.pop() || '';\n\n                for (const line of lines) {\n                    if (line.trim()) {\n                        try {\n                            const data: ChatResponse = JSON.parse(line);\n\n                            // Handle thinking trace\n                            if (data.message?.thinking) {\n                                fullThinking += data.message.thinking;\n                                onToken('', data.message.thinking);\n                            }\n\n                            // Handle content\n                            if (data.message?.content) {\n                                fullContent += data.message.content;\n                                onToken(data.message.content);\n                            }\n\n                            // Handle tool calls\n                            if (data.message?.tool_calls) {\n                                toolCalls = data.message.tool_calls;\n                            }\n\n                            if (data.done) {\n                                metrics = {\n                                    total_duration: data.total_duration,\n                                    load_duration: data.load_duration,\n                                    prompt_eval_count: data.prompt_eval_count,\n                                    prompt_eval_duration: data.prompt_eval_duration,\n                                    eval_count: data.eval_count,\n                                    eval_duration: data.eval_duration\n                                };\n                            }\n                        } catch (e) {\n                            console.error('[OllamaClient] Chat JSON Parse Error:', e);\n                        }\n                    }\n                }\n            });\n\n            response.data.on('end', () => {\n                if (buffer.trim()) {\n                    try {\n                        const data: ChatResponse = JSON.parse(buffer);\n                        if (data.message?.thinking) fullThinking += data.message.thinking;\n                        if (data.message?.content) {\n                            fullContent += data.message.content;\n                            onToken(data.message.content);\n                        }\n                        if (data.message?.tool_calls) toolCalls = data.message.tool_calls;\n                        if (data.done) {\n                            metrics = {\n                                total_duration: data.total_duration,\n                                load_duration: data.load_duration,\n                                prompt_eval_count: data.prompt_eval_count,\n                                prompt_eval_duration: data.prompt_eval_duration,\n                                eval_count: data.eval_count,\n                                eval_duration: data.eval_duration\n                            };\n                        }\n                    } catch (e) { /* ignore */ }\n                }\n\n                const result: ChatMessage & { metrics?: UsageMetrics } = {\n                    role: 'assistant',\n                    content: fullContent,\n                    metrics\n                };\n\n                if (fullThinking) {\n                    result.thinking = fullThinking;\n                }\n\n                if (toolCalls.length > 0) {\n                    result.tool_calls = toolCalls;\n                }\n\n                resolve(result);\n            });\n            response.data.on('error', reject);\n        });\n    }\n\n    /**\n     * Generate embeddings for text (Ollama Embeddings API)\n     */\n    async embed(input: string | string[], model?: string): Promise<number[][]> {\n        const request: EmbedRequest = {\n            model: model || 'embeddinggemma',\n            input\n        };\n\n        const response = await this.client.post<EmbedResponse>('/api/embed', request);\n        return response.data.embeddings;\n    }\n\n    async isAvailable(): Promise<boolean> {\n        try {\n            await this.client.get('/');\n            return true;\n        } catch {\n            return false;\n        }\n    }\n\n    clearContext(): void {\n        this.context = [];\n    }\n\n    // ============================================\n    // Ollama Web Search API Methods\n    // ============================================\n\n    /**\n     * Ollama Í≥µÏãù Web Search API\n     * https://ollama.com/api/web_search\n     */\n    async webSearch(query: string, maxResults: number = 5): Promise<WebSearchResponse> {\n        const request: WebSearchRequest = {\n            query,\n            max_results: Math.min(maxResults, 10)\n        };\n\n        console.log(`[OllamaClient] üîç Web Search: \"${query}\"`);\n\n        try {\n            // Ollama Í≥µÏãù API ÏóîÎìúÌè¨Ïù∏Ìä∏\n            const response = await this.client.post<WebSearchResponse>(\n                'https://ollama.com/api/web_search',\n                request,\n                {\n                    baseURL: '', // Override baseURL to use absolute URL\n                    headers: {\n                        'Content-Type': 'application/json',\n                        ...this.apiKeyManager.getAuthHeaders()\n                    }\n                }\n            );\n\n            console.log(`[OllamaClient] ‚úÖ Web Search: ${response.data.results?.length || 0}Í∞ú Í≤∞Í≥º`);\n            return response.data;\n        } catch (error: any) {\n            console.error('[OllamaClient] Web Search Ïã§Ìå®:', error.message);\n            return { results: [] };\n        }\n    }\n\n    /**\n     * Ollama Í≥µÏãù Web Fetch API\n     * https://ollama.com/api/web_fetch\n     */\n    async webFetch(url: string): Promise<WebFetchResponse> {\n        const request: WebFetchRequest = { url };\n\n        console.log(`[OllamaClient] üì• Web Fetch: ${url}`);\n\n        try {\n            const response = await this.client.post<WebFetchResponse>(\n                'https://ollama.com/api/web_fetch',\n                request,\n                {\n                    baseURL: '',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        ...this.apiKeyManager.getAuthHeaders()\n                    }\n                }\n            );\n\n            console.log(`[OllamaClient] ‚úÖ Web Fetch: \"${response.data.title}\"`);\n            return response.data;\n        } catch (error: any) {\n            console.error('[OllamaClient] Web Fetch Ïã§Ìå®:', error.message);\n            return { title: '', content: '', links: [] };\n        }\n    }\n\n    // ============================================\n    // Multi-turn Tool Calling (Agent Loop)\n    // ============================================\n\n    /**\n     * Multi-turn Tool Calling Agent Loop Ïã§Ìñâ\n     * \n     * ÎèÑÍµ¨ Ìò∏Ï∂úÏù¥ ÏóÜÏùÑ ÎïåÍπåÏßÄ ÏûêÎèôÏúºÎ°ú ÎåÄÌôîÎ•º Ïù¥Ïñ¥Í∞ëÎãàÎã§.\n     * Í≥µÏãù Î¨∏ÏÑú: https://docs.ollama.com/capabilities/tool-calling#multi-turn-tool-calling-agent-loop\n     * \n     * @example\n     * ```typescript\n     * const result = await client.runAgentLoop(\n     *   [{ role: 'user', content: 'ÏÑúÏö∏ ÎÇ†Ïî® ÏïåÎ†§Ï§ò' }],\n     *   [weatherTool],\n     *   { get_weather: getWeatherFunc },\n     *   { onToolCall: (name, args, result) => console.log(`Tool: ${name}`) }\n     * );\n     * ```\n     */\n    async runAgentLoop(\n        messages: ChatMessage[],\n        tools: ToolDefinition[],\n        availableFunctions: Record<string, (...args: any[]) => any>,\n        options?: {\n            think?: ThinkOption;\n            stream?: boolean;\n            onToken?: (token: string, thinking?: string) => void;\n            onToolCall?: (name: string, args: unknown, result: unknown) => void;\n            maxIterations?: number;\n        }\n    ): Promise<AgentLoopResult> {\n        return runAgentLoop({\n            model: this.config.model,\n            messages,\n            tools,\n            availableFunctions,\n            think: options?.think,\n            stream: options?.stream,\n            onToken: options?.onToken,\n            onToolCall: options?.onToolCall,\n            maxIterations: options?.maxIterations\n        });\n    }\n}\n\nexport const createClient = (config?: Partial<OllamaConfig>): OllamaClient => {\n    return new OllamaClient(config);\n};\n"],"version":3}