{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/ChatService.test.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/ChatService.test.ts"],"sourcesContent":["/**\n * ChatService Tests\n * Basic tests for chat service types and interfaces\n */\nimport { ChatHistoryMessage, AgentSelectionInfo, ToolCallInfo, WebSearchResult } from '../services/ChatService';\n\ndescribe('ChatService Types', () => {\n    describe('ChatHistoryMessage', () => {\n        it('should allow valid user message', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'user',\n                content: 'Hello world'\n            };\n            expect(msg.role).toBe('user');\n            expect(msg.content).toBe('Hello world');\n        });\n\n        it('should allow assistant message with tool_calls', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'assistant',\n                content: '',\n                tool_calls: [{\n                    type: 'function',\n                    function: {\n                        name: 'test_tool',\n                        arguments: { arg1: 'value' }\n                    }\n                }]\n            };\n            expect(msg.tool_calls).toHaveLength(1);\n            expect(msg.tool_calls![0].function.name).toBe('test_tool');\n        });\n\n        it('should allow message with images', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'user',\n                content: 'Check this image',\n                images: ['base64data']\n            };\n            expect(msg.images).toHaveLength(1);\n        });\n\n        it('should allow system message', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'system',\n                content: 'You are a helpful assistant'\n            };\n            expect(msg.role).toBe('system');\n            expect(msg.content).toBe('You are a helpful assistant');\n        });\n\n        it('should allow tool message', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'tool',\n                content: 'Tool result'\n            };\n            expect(msg.role).toBe('tool');\n            expect(msg.content).toBe('Tool result');\n        });\n\n        it('should allow message with multiple images', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'user',\n                content: 'Compare these images',\n                images: ['image1', 'image2', 'image3']\n            };\n            expect(msg.images).toHaveLength(3);\n        });\n\n        it('should allow message with string arguments in tool_calls', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'assistant',\n                content: '',\n                tool_calls: [{\n                    type: 'function',\n                    function: {\n                        name: 'search',\n                        arguments: '{\"query\": \"test\"}'\n                    }\n                }]\n            };\n            expect(typeof msg.tool_calls![0].function.arguments).toBe('string');\n        });\n\n        it('should allow additional properties via index signature', () => {\n            const msg: ChatHistoryMessage = {\n                role: 'user',\n                content: 'Test',\n                customField: 'custom value',\n                anotherField: 123\n            };\n            expect((msg as any).customField).toBe('custom value');\n            expect((msg as any).anotherField).toBe(123);\n        });\n    });\n\n    describe('AgentSelectionInfo', () => {\n        it('should represent agent selection', () => {\n            const info: AgentSelectionInfo = {\n                type: 'code_expert',\n                name: 'Code Expert',\n                emoji: 'ðŸ‘¨â€ðŸ’»',\n                confidence: 0.95,\n                reason: 'Code-related query detected'\n            };\n            expect(info.type).toBe('code_expert');\n            expect(info.confidence).toBe(0.95);\n        });\n\n        it('should allow partial agent selection info', () => {\n            const info: AgentSelectionInfo = {\n                type: 'researcher'\n            };\n            expect(info.type).toBe('researcher');\n            expect(info.name).toBeUndefined();\n        });\n\n        it('should allow phase property', () => {\n            const info: AgentSelectionInfo = {\n                type: 'agent',\n                phase: 'analysis'\n            };\n            expect(info.phase).toBe('analysis');\n        });\n\n        it('should allow additional properties', () => {\n            const info: AgentSelectionInfo = {\n                type: 'expert',\n                customProp: 'value'\n            };\n            expect((info as any).customProp).toBe('value');\n        });\n    });\n\n    describe('ToolCallInfo', () => {\n        it('should represent tool call structure', () => {\n            const tool: ToolCallInfo = {\n                type: 'function',\n                function: {\n                    name: 'web_search',\n                    arguments: { query: 'test query' }\n                }\n            };\n            expect(tool.function.name).toBe('web_search');\n        });\n\n        it('should allow tool call without type', () => {\n            const tool: ToolCallInfo = {\n                function: {\n                    name: 'calculator',\n                    arguments: { operation: 'add', a: 1, b: 2 }\n                }\n            };\n            expect(tool.function.name).toBe('calculator');\n            expect((tool.function.arguments as any).a).toBe(1);\n        });\n\n        it('should handle complex arguments', () => {\n            const tool: ToolCallInfo = {\n                type: 'function',\n                function: {\n                    name: 'complex_tool',\n                    arguments: {\n                        nested: { deep: { value: 'test' } },\n                        array: [1, 2, 3],\n                        string: 'value'\n                    }\n                }\n            };\n            expect((tool.function.arguments as any).nested.deep.value).toBe('test');\n            expect((tool.function.arguments as any).array).toHaveLength(3);\n        });\n    });\n\n    describe('WebSearchResult', () => {\n        it('should represent search result', () => {\n            const result: WebSearchResult = {\n                title: 'Test Page',\n                url: 'https://example.com',\n                snippet: 'A test snippet'\n            };\n            expect(result.title).toBe('Test Page');\n            expect(result.url).toBe('https://example.com');\n        });\n\n        it('should allow result without snippet', () => {\n            const result: WebSearchResult = {\n                title: 'Another Page',\n                url: 'https://another.com'\n            };\n            expect(result.title).toBe('Another Page');\n            expect(result.snippet).toBeUndefined();\n        });\n\n        it('should handle URLs with query parameters', () => {\n            const result: WebSearchResult = {\n                title: 'Search Results',\n                url: 'https://example.com/search?q=test&lang=en',\n                snippet: 'Results for test'\n            };\n            expect(result.url).toContain('?q=test');\n        });\n\n        it('should handle long snippets', () => {\n            const longSnippet = 'A'.repeat(500);\n            const result: WebSearchResult = {\n                title: 'Long Result',\n                url: 'https://example.com',\n                snippet: longSnippet\n            };\n            expect(result.snippet).toHaveLength(500);\n        });\n    });\n\n    describe('Type Compatibility', () => {\n        it('should allow ChatHistoryMessage array', () => {\n            const messages: ChatHistoryMessage[] = [\n                { role: 'user', content: 'Hello' },\n                { role: 'assistant', content: 'Hi there' }\n            ];\n            expect(messages).toHaveLength(2);\n            expect(messages[0].role).toBe('user');\n        });\n\n        it('should allow WebSearchResult array', () => {\n            const results: WebSearchResult[] = [\n                { title: 'Result 1', url: 'https://example1.com' },\n                { title: 'Result 2', url: 'https://example2.com', snippet: 'Snippet' }\n            ];\n            expect(results).toHaveLength(2);\n        });\n\n        it('should allow mixed tool_calls in messages', () => {\n            const messages: ChatHistoryMessage[] = [\n                {\n                    role: 'assistant',\n                    content: 'I will search',\n                    tool_calls: [\n                        {\n                            type: 'function',\n                            function: { name: 'search', arguments: { query: 'test' } }\n                        }\n                    ]\n                },\n                {\n                    role: 'tool',\n                    content: 'Search results'\n                }\n            ];\n            expect(messages).toHaveLength(2);\n            expect(messages[0].tool_calls).toBeDefined();\n        });\n    });\n});\n"],"version":3}