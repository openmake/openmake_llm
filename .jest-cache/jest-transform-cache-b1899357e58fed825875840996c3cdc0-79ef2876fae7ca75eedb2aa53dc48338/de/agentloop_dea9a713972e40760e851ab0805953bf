cca0c2014f1f7481e810a9e77fd4c19b
"use strict";
/**
 * Ollama Cloud Multi-turn Tool Calling Agent Loop
 *
 * Í≥µÏãù Î¨∏ÏÑú Ï∞∏Í≥†: https://docs.ollama.com/capabilities/tool-calling#multi-turn-tool-calling-agent-loop
 *
 * Ïù¥ Î™®ÎìàÏùÄ OllamaÏùò Tool Calling Í∏∞Îä•ÏùÑ ÌôúÏö©Ìïú Agent LoopÎ•º Íµ¨ÌòÑÌï©ÎãàÎã§.
 * - Multi-turn ÎåÄÌôîÏóêÏÑú ÏûêÎèôÏúºÎ°ú ÎèÑÍµ¨Î•º Ìò∏Ï∂úÌïòÍ≥† Í≤∞Í≥ºÎ•º Îã§Ïãú LLMÏóê Ï†ÑÎã¨
 * - Streaming ÏßÄÏõêÏúºÎ°ú Ïã§ÏãúÍ∞Ñ ÏùëÎãµ Í∞ÄÎä•
 * - Î¨¥Ìïú Î£®ÌîÑ Î∞©ÏßÄÎ•º ÏúÑÌïú maxIterations ÏÑ§Ï†ï
 */
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __asyncValues = (this && this.__asyncValues) || function (o) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[Symbol.asyncIterator], i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.runAgentLoop = runAgentLoop;
exports.executeSingleToolCall = executeSingleToolCall;
exports.mcpToolToOllamaTool = mcpToolToOllamaTool;
exports.mcpToolsToOllamaTools = mcpToolsToOllamaTools;
const ollama_1 = require("ollama");
const api_key_manager_1 = require("./api-key-manager");
const config_1 = require("../config");
const envConfig = (0, config_1.getConfig)();
// Ollama Cloud Ìò∏Ïä§Ìä∏
const OLLAMA_CLOUD_HOST = 'https://ollama.com';
/**
 * ChatMessageÎ•º Ollama Message ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò
 */
function toOllamaMessage(msg) {
    const ollamaMsg = {
        role: msg.role,
        content: msg.content
    };
    if (msg.images) {
        ollamaMsg.images = msg.images;
    }
    if (msg.tool_calls) {
        ollamaMsg.tool_calls = msg.tool_calls.map(tc => ({
            function: {
                name: tc.function.name,
                arguments: tc.function.arguments
            }
        }));
    }
    return ollamaMsg;
}
/**
 * Ollama MessageÎ•º ChatMessage ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò
 */
function fromOllamaMessage(msg) {
    const chatMsg = {
        role: msg.role,
        content: msg.content
    };
    if (msg.images) {
        chatMsg.images = msg.images;
    }
    if (msg.tool_calls && msg.tool_calls.length > 0) {
        chatMsg.tool_calls = msg.tool_calls.map((tc, index) => ({
            type: 'function',
            function: {
                index,
                name: tc.function.name,
                arguments: tc.function.arguments
            }
        }));
    }
    return chatMsg;
}
/**
 * ToolDefinitionÏùÑ Ollama Tool ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò
 */
function toOllamaTool(tool) {
    return {
        type: 'function',
        function: {
            name: tool.function.name,
            description: tool.function.description,
            parameters: tool.function.parameters
        }
    };
}
/**
 * Ollama ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉùÏÑ± (Cloud ÏßÄÏõê)
 */
function createOllamaClient(model) {
    const apiKeyManager = (0, api_key_manager_1.getApiKeyManager)();
    const isCloud = model === null || model === void 0 ? void 0 : model.toLowerCase().endsWith(':cloud');
    const host = isCloud ? OLLAMA_CLOUD_HOST : envConfig.ollamaBaseUrl;
    const ollama = new ollama_1.Ollama({
        host,
        headers: apiKeyManager.getAuthHeaders()
    });
    console.log(`[AgentLoop] üåê Ollama ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉùÏÑ± - Ìò∏Ïä§Ìä∏: ${host}, Î™®Îç∏: ${model}`);
    return ollama;
}
/**
 * Multi-turn Tool Calling Agent Loop Ïã§Ìñâ
 *
 * ÎèÑÍµ¨ Ìò∏Ï∂úÏù¥ ÏóÜÏùÑ ÎïåÍπåÏßÄ ÏûêÎèôÏúºÎ°ú ÎåÄÌôîÎ•º Ïù¥Ïñ¥Í∞ëÎãàÎã§.
 *
 * @example
 * ```typescript
 * const result = await runAgentLoop({
 *   model: 'gemini-3-flash-preview:cloud',
 *   messages: [{ role: 'user', content: 'ÏÑúÏö∏ ÎÇ†Ïî® ÏïåÎ†§Ï§ò' }],
 *   tools: [weatherTool],
 *   availableFunctions: { get_weather: getWeather },
 *   onToolCall: (name, args, result) => console.log(`Tool ${name}: ${result}`)
 * });
 * ```
 */
function runAgentLoop(options) {
    return __awaiter(this, void 0, void 0, function* () {
        var _a, e_1, _b, _c;
        var _d, _e, _f, _g, _h;
        const { model = envConfig.ollamaDefaultModel, messages: initialMessages, tools, availableFunctions, think = true, stream = false, onToken, onToolCall, maxIterations = 10 } = options;
        const ollama = createOllamaClient(model);
        const ollamaTools = tools.map(toOllamaTool);
        // Î©îÏãúÏßÄ ÌûàÏä§ÌÜ†Î¶¨ Î≥µÏÇ¨
        const messages = initialMessages.map(toOllamaMessage);
        const toolCallsExecuted = [];
        let iterations = 0;
        let lastMetrics;
        console.log(`[AgentLoop] üöÄ Agent Loop ÏãúÏûë - Î™®Îç∏: ${model}, ÎèÑÍµ¨: ${tools.length}Í∞ú`);
        while (iterations < maxIterations) {
            iterations++;
            console.log(`[AgentLoop] üìç Î∞òÎ≥µ ${iterations}/${maxIterations}`);
            let response;
            if (stream && onToken) {
                // Ïä§Ìä∏Î¶¨Î∞ç Î™®Îìú
                let content = '';
                let thinking = '';
                let toolCalls = [];
                const streamResponse = yield ollama.chat({
                    model,
                    messages,
                    tools: ollamaTools,
                    stream: true,
                    options: {
                    // think ÏòµÏÖòÏùÄ model optionsÍ∞Ä ÏïÑÎãå Î≥ÑÎèÑÎ°ú Ï≤òÎ¶¨
                    }
                });
                try {
                    for (var _j = true, streamResponse_1 = (e_1 = void 0, __asyncValues(streamResponse)), streamResponse_1_1; streamResponse_1_1 = yield streamResponse_1.next(), _a = streamResponse_1_1.done, !_a; _j = true) {
                        _c = streamResponse_1_1.value;
                        _j = false;
                        const chunk = _c;
                        // Thinking Ï≤òÎ¶¨
                        if ((_d = chunk.message) === null || _d === void 0 ? void 0 : _d.thinking) {
                            thinking += chunk.message.thinking;
                            onToken('', chunk.message.thinking);
                        }
                        // Content Ï≤òÎ¶¨
                        if ((_e = chunk.message) === null || _e === void 0 ? void 0 : _e.content) {
                            content += chunk.message.content;
                            onToken(chunk.message.content);
                        }
                        // Tool calls ÏàòÏßë
                        if ((_f = chunk.message) === null || _f === void 0 ? void 0 : _f.tool_calls) {
                            toolCalls = chunk.message.tool_calls;
                        }
                        // Î©îÌä∏Î¶≠ ÏàòÏßë
                        if (chunk.done) {
                            lastMetrics = {
                                total_duration: chunk.total_duration,
                                load_duration: chunk.load_duration,
                                prompt_eval_count: chunk.prompt_eval_count,
                                prompt_eval_duration: chunk.prompt_eval_duration,
                                eval_count: chunk.eval_count,
                                eval_duration: chunk.eval_duration
                            };
                        }
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (!_j && !_a && (_b = streamResponse_1.return)) yield _b.call(streamResponse_1);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
                // Ïä§Ìä∏Î¶¨Î∞ç ÏôÑÎ£å ÌõÑ ÏùëÎãµ Íµ¨ÏÑ±
                response = {
                    model,
                    created_at: new Date(),
                    message: {
                        role: 'assistant',
                        content,
                        tool_calls: toolCalls.length > 0 ? toolCalls : undefined
                    },
                    done: true,
                    done_reason: toolCalls.length > 0 ? 'tool_calls' : 'stop',
                    total_duration: lastMetrics === null || lastMetrics === void 0 ? void 0 : lastMetrics.total_duration,
                    load_duration: lastMetrics === null || lastMetrics === void 0 ? void 0 : lastMetrics.load_duration,
                    prompt_eval_count: lastMetrics === null || lastMetrics === void 0 ? void 0 : lastMetrics.prompt_eval_count,
                    prompt_eval_duration: lastMetrics === null || lastMetrics === void 0 ? void 0 : lastMetrics.prompt_eval_duration,
                    eval_count: lastMetrics === null || lastMetrics === void 0 ? void 0 : lastMetrics.eval_count,
                    eval_duration: lastMetrics === null || lastMetrics === void 0 ? void 0 : lastMetrics.eval_duration
                };
                if (thinking) {
                    response.message.thinking = thinking;
                }
            }
            else {
                // ÎπÑÏä§Ìä∏Î¶¨Î∞ç Î™®Îìú
                response = yield ollama.chat({
                    model,
                    messages,
                    tools: ollamaTools,
                    stream: false
                });
                lastMetrics = {
                    total_duration: response.total_duration,
                    load_duration: response.load_duration,
                    prompt_eval_count: response.prompt_eval_count,
                    prompt_eval_duration: response.prompt_eval_duration,
                    eval_count: response.eval_count,
                    eval_duration: response.eval_duration
                };
            }
            // ÏùëÎãµ Î©îÏãúÏßÄÎ•º ÌûàÏä§ÌÜ†Î¶¨Ïóê Ï∂îÍ∞Ä
            messages.push(response.message);
            // Thinking Î°úÍ∑∏
            if ((_g = response.message) === null || _g === void 0 ? void 0 : _g.thinking) {
                console.log(`[AgentLoop] üß† Thinking: ${response.message.thinking.substring(0, 100)}...`);
            }
            // Content Î°úÍ∑∏
            if (response.message.content) {
                console.log(`[AgentLoop] üí¨ Content: ${response.message.content.substring(0, 100)}...`);
            }
            // Tool calls ÌôïÏù∏
            const responsToolCalls = (_h = response.message.tool_calls) !== null && _h !== void 0 ? _h : [];
            if (responsToolCalls.length === 0) {
                // ÎèÑÍµ¨ Ìò∏Ï∂ú ÏóÜÏùå - Î£®ÌîÑ Ï¢ÖÎ£å
                console.log(`[AgentLoop] ‚úÖ ÎèÑÍµ¨ Ìò∏Ï∂ú ÏóÜÏùå - Î£®ÌîÑ Ï¢ÖÎ£å`);
                break;
            }
            // ÎèÑÍµ¨ Ìò∏Ï∂ú Ï≤òÎ¶¨
            for (const toolCall of responsToolCalls) {
                const funcName = toolCall.function.name;
                const funcArgs = toolCall.function.arguments;
                console.log(`[AgentLoop] üîß ÎèÑÍµ¨ Ìò∏Ï∂ú: ${funcName}(${JSON.stringify(funcArgs)})`);
                if (!(funcName in availableFunctions)) {
                    console.warn(`[AgentLoop] ‚ö†Ô∏è Ïïå Ïàò ÏóÜÎäî ÎèÑÍµ¨: ${funcName}`);
                    continue;
                }
                try {
                    // ÎèÑÍµ¨ Ïã§Ìñâ
                    const result = yield availableFunctions[funcName](funcArgs);
                    const resultStr = typeof result === 'string' ? result : JSON.stringify(result);
                    console.log(`[AgentLoop] üì§ ÎèÑÍµ¨ Í≤∞Í≥º: ${resultStr.substring(0, 100)}...`);
                    // ÏΩúÎ∞± Ìò∏Ï∂ú
                    if (onToolCall) {
                        onToolCall(funcName, funcArgs, result);
                    }
                    // Ïã§Ìñâ Í∏∞Î°ù Ï†ÄÏû•
                    toolCallsExecuted.push({
                        name: funcName,
                        arguments: funcArgs,
                        result
                    });
                    // ÎèÑÍµ¨ Í≤∞Í≥ºÎ•º Î©îÏãúÏßÄÏóê Ï∂îÍ∞Ä
                    messages.push({
                        role: 'tool',
                        content: resultStr
                    });
                }
                catch (error) {
                    console.error(`[AgentLoop] ‚ùå ÎèÑÍµ¨ Ïã§Ìñâ Ïò§Î•ò: ${error.message}`);
                    messages.push({
                        role: 'tool',
                        content: `Error: ${error.message}`
                    });
                }
            }
        }
        if (iterations >= maxIterations) {
            console.warn(`[AgentLoop] ‚ö†Ô∏è ÏµúÎåÄ Î∞òÎ≥µ ÌöüÏàò(${maxIterations}) ÎèÑÎã¨`);
        }
        // ÏµúÏ¢Ö Í≤∞Í≥º Íµ¨ÏÑ±
        const lastMessage = messages[messages.length - 1];
        const history = messages.map(fromOllamaMessage);
        console.log(`[AgentLoop] üèÅ Agent Loop ÏôÑÎ£å - Î∞òÎ≥µ: ${iterations}, ÎèÑÍµ¨ Ìò∏Ï∂ú: ${toolCallsExecuted.length}Í∞ú`);
        return {
            message: fromOllamaMessage(lastMessage),
            history,
            toolCallsExecuted,
            metrics: lastMetrics,
            iterations
        };
    });
}
/**
 * Îã®Ïùº ÎèÑÍµ¨ Ìò∏Ï∂ú Ïã§Ìñâ (Agent Loop ÏÇ¨Ïö©)
 *
 * Îã®ÏàúÌïú Îã®Ïùº ÎèÑÍµ¨ Ìò∏Ï∂ú ÏãúÎÇòÎ¶¨Ïò§Ïóê ÏÇ¨Ïö©Îê©ÎãàÎã§.
 */
function executeSingleToolCall(model, prompt, tools, availableFunctions, options) {
    return __awaiter(this, void 0, void 0, function* () {
        return runAgentLoop({
            model,
            messages: [{ role: 'user', content: prompt }],
            tools,
            availableFunctions,
            think: options === null || options === void 0 ? void 0 : options.think,
            stream: !!(options === null || options === void 0 ? void 0 : options.onToken),
            onToken: options === null || options === void 0 ? void 0 : options.onToken,
            maxIterations: 3 // Îã®Ïùº Ìò∏Ï∂úÏù¥ÎØÄÎ°ú Ï†ÅÏùÄ Î∞òÎ≥µ
        });
    });
}
/**
 * MCP ToolÏùÑ Ollama ToolÎ°ú Î≥ÄÌôòÌïòÎäî Ïñ¥ÎåëÌÑ∞
 */
function mcpToolToOllamaTool(mcpTool) {
    return {
        type: 'function',
        function: {
            name: mcpTool.tool.name,
            description: mcpTool.tool.description,
            parameters: mcpTool.tool.inputSchema
        }
    };
}
/**
 * Ïó¨Îü¨ MCP ToolsÎ•º Ollama ToolsÎ°ú Î≥ÄÌôò
 */
function mcpToolsToOllamaTools(mcpTools) {
    return mcpTools.map(mcpToolToOllamaTool);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL29sbGFtYS9hZ2VudC1sb29wLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7O0dBU0c7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZKSCxvQ0E2TUM7QUFPRCxzREFvQkM7QUFLRCxrREFlQztBQUtELHNEQVFDO0FBcGFELG1DQUF1RTtBQUV2RSx1REFBcUQ7QUFDckQsc0NBQXNDO0FBRXRDLE1BQU0sU0FBUyxHQUFHLElBQUEsa0JBQVMsR0FBRSxDQUFDO0FBRTlCLG1CQUFtQjtBQUNuQixNQUFNLGlCQUFpQixHQUFHLG9CQUFvQixDQUFDO0FBOEMvQzs7R0FFRztBQUNILFNBQVMsZUFBZSxDQUFDLEdBQWdCO0lBQ3JDLE1BQU0sU0FBUyxHQUFZO1FBQ3ZCLElBQUksRUFBRSxHQUFHLENBQUMsSUFBZ0Q7UUFDMUQsT0FBTyxFQUFFLEdBQUcsQ0FBQyxPQUFPO0tBQ3ZCLENBQUM7SUFFRixJQUFJLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNiLFNBQVMsQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQWtCLENBQUM7SUFDOUMsQ0FBQztJQUVELElBQUksR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ2pCLFNBQVMsQ0FBQyxVQUFVLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzdDLFFBQVEsRUFBRTtnQkFDTixJQUFJLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJO2dCQUN0QixTQUFTLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxTQUFTO2FBQ25DO1NBQ0osQ0FBQyxDQUFDLENBQUM7SUFDUixDQUFDO0lBRUQsT0FBTyxTQUFTLENBQUM7QUFDckIsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBUyxpQkFBaUIsQ0FBQyxHQUFZO0lBQ25DLE1BQU0sT0FBTyxHQUFnQjtRQUN6QixJQUFJLEVBQUUsR0FBRyxDQUFDLElBQWdEO1FBQzFELE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBTztLQUN2QixDQUFDO0lBRUYsSUFBSSxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDYixPQUFPLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxNQUFrQixDQUFDO0lBQzVDLENBQUM7SUFFRCxJQUFJLEdBQUcsQ0FBQyxVQUFVLElBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDOUMsT0FBTyxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDcEQsSUFBSSxFQUFFLFVBQW1CO1lBQ3pCLFFBQVEsRUFBRTtnQkFDTixLQUFLO2dCQUNMLElBQUksRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUk7Z0JBQ3RCLFNBQVMsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLFNBQW9DO2FBQzlEO1NBQ0osQ0FBQyxDQUFDLENBQUM7SUFDUixDQUFDO0lBRUQsT0FBTyxPQUFPLENBQUM7QUFDbkIsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBUyxZQUFZLENBQUMsSUFBb0I7SUFDdEMsT0FBTztRQUNILElBQUksRUFBRSxVQUFVO1FBQ2hCLFFBQVEsRUFBRTtZQUNOLElBQUksRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUk7WUFDeEIsV0FBVyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVztZQUN0QyxVQUFVLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVO1NBQ3ZDO0tBQ0osQ0FBQztBQUNOLENBQUM7QUFFRDs7R0FFRztBQUNILFNBQVMsa0JBQWtCLENBQUMsS0FBYTtJQUNyQyxNQUFNLGFBQWEsR0FBRyxJQUFBLGtDQUFnQixHQUFFLENBQUM7SUFDekMsTUFBTSxPQUFPLEdBQUcsS0FBSyxhQUFMLEtBQUssdUJBQUwsS0FBSyxDQUFFLFdBQVcsR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7SUFFeEQsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQztJQUVuRSxNQUFNLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQztRQUN0QixJQUFJO1FBQ0osT0FBTyxFQUFFLGFBQWEsQ0FBQyxjQUFjLEVBQUU7S0FDMUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5Q0FBeUMsSUFBSSxTQUFTLEtBQUssRUFBRSxDQUFDLENBQUM7SUFFM0UsT0FBTyxNQUFNLENBQUM7QUFDbEIsQ0FBQztBQUVEOzs7Ozs7Ozs7Ozs7Ozs7R0FlRztBQUNILFNBQXNCLFlBQVksQ0FBQyxPQUF5Qjs7OztRQUN4RCxNQUFNLEVBQ0YsS0FBSyxHQUFHLFNBQVMsQ0FBQyxrQkFBa0IsRUFDcEMsUUFBUSxFQUFFLGVBQWUsRUFDekIsS0FBSyxFQUNMLGtCQUFrQixFQUNsQixLQUFLLEdBQUcsSUFBSSxFQUNaLE1BQU0sR0FBRyxLQUFLLEVBQ2QsT0FBTyxFQUNQLFVBQVUsRUFDVixhQUFhLEdBQUcsRUFBRSxFQUNyQixHQUFHLE9BQU8sQ0FBQztRQUVaLE1BQU0sTUFBTSxHQUFHLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7UUFFNUMsY0FBYztRQUNkLE1BQU0sUUFBUSxHQUFjLGVBQWUsQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDakUsTUFBTSxpQkFBaUIsR0FBeUMsRUFBRSxDQUFDO1FBQ25FLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQztRQUNuQixJQUFJLFdBQXFDLENBQUM7UUFFMUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQ0FBc0MsS0FBSyxTQUFTLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBRWpGLE9BQU8sVUFBVSxHQUFHLGFBQWEsRUFBRSxDQUFDO1lBQ2hDLFVBQVUsRUFBRSxDQUFDO1lBQ2IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsVUFBVSxJQUFJLGFBQWEsRUFBRSxDQUFDLENBQUM7WUFFaEUsSUFBSSxRQUFzQixDQUFDO1lBRTNCLElBQUksTUFBTSxJQUFJLE9BQU8sRUFBRSxDQUFDO2dCQUNwQixVQUFVO2dCQUNWLElBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztnQkFDakIsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO2dCQUNsQixJQUFJLFNBQVMsR0FBZSxFQUFFLENBQUM7Z0JBRS9CLE1BQU0sY0FBYyxHQUFHLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQztvQkFDckMsS0FBSztvQkFDTCxRQUFRO29CQUNSLEtBQUssRUFBRSxXQUFXO29CQUNsQixNQUFNLEVBQUUsSUFBSTtvQkFDWixPQUFPLEVBQUU7b0JBQ0wscUNBQXFDO3FCQUN4QztpQkFDSixDQUFDLENBQUM7O29CQUVILEtBQTBCLGVBQUEsa0NBQUEsY0FBQSxjQUFjLENBQUEsQ0FBQSxvQkFBQSxvR0FBRSxDQUFDO3dCQUFqQiw4QkFBYzt3QkFBZCxXQUFjO3dCQUE3QixNQUFNLEtBQUssS0FBQSxDQUFBO3dCQUNsQixjQUFjO3dCQUNkLElBQUksTUFBQyxLQUFLLENBQUMsT0FBZSwwQ0FBRSxRQUFRLEVBQUUsQ0FBQzs0QkFDbkMsUUFBUSxJQUFLLEtBQUssQ0FBQyxPQUFlLENBQUMsUUFBUSxDQUFDOzRCQUM1QyxPQUFPLENBQUMsRUFBRSxFQUFHLEtBQUssQ0FBQyxPQUFlLENBQUMsUUFBUSxDQUFDLENBQUM7d0JBQ2pELENBQUM7d0JBRUQsYUFBYTt3QkFDYixJQUFJLE1BQUEsS0FBSyxDQUFDLE9BQU8sMENBQUUsT0FBTyxFQUFFLENBQUM7NEJBQ3pCLE9BQU8sSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQzs0QkFDakMsT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7d0JBQ25DLENBQUM7d0JBRUQsZ0JBQWdCO3dCQUNoQixJQUFJLE1BQUEsS0FBSyxDQUFDLE9BQU8sMENBQUUsVUFBVSxFQUFFLENBQUM7NEJBQzVCLFNBQVMsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQzt3QkFDekMsQ0FBQzt3QkFFRCxTQUFTO3dCQUNULElBQUksS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDOzRCQUNiLFdBQVcsR0FBRztnQ0FDVixjQUFjLEVBQUUsS0FBSyxDQUFDLGNBQWM7Z0NBQ3BDLGFBQWEsRUFBRSxLQUFLLENBQUMsYUFBYTtnQ0FDbEMsaUJBQWlCLEVBQUUsS0FBSyxDQUFDLGlCQUFpQjtnQ0FDMUMsb0JBQW9CLEVBQUUsS0FBSyxDQUFDLG9CQUFvQjtnQ0FDaEQsVUFBVSxFQUFFLEtBQUssQ0FBQyxVQUFVO2dDQUM1QixhQUFhLEVBQUUsS0FBSyxDQUFDLGFBQWE7NkJBQ3JDLENBQUM7d0JBQ04sQ0FBQztvQkFDTCxDQUFDOzs7Ozs7Ozs7Z0JBRUQsa0JBQWtCO2dCQUNsQixRQUFRLEdBQUc7b0JBQ1AsS0FBSztvQkFDTCxVQUFVLEVBQUUsSUFBSSxJQUFJLEVBQUU7b0JBQ3RCLE9BQU8sRUFBRTt3QkFDTCxJQUFJLEVBQUUsV0FBVzt3QkFDakIsT0FBTzt3QkFDUCxVQUFVLEVBQUUsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUztxQkFDM0Q7b0JBQ0QsSUFBSSxFQUFFLElBQUk7b0JBQ1YsV0FBVyxFQUFFLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLE1BQU07b0JBQ3pELGNBQWMsRUFBRSxXQUFXLGFBQVgsV0FBVyx1QkFBWCxXQUFXLENBQUUsY0FBYztvQkFDM0MsYUFBYSxFQUFFLFdBQVcsYUFBWCxXQUFXLHVCQUFYLFdBQVcsQ0FBRSxhQUFhO29CQUN6QyxpQkFBaUIsRUFBRSxXQUFXLGFBQVgsV0FBVyx1QkFBWCxXQUFXLENBQUUsaUJBQWlCO29CQUNqRCxvQkFBb0IsRUFBRSxXQUFXLGFBQVgsV0FBVyx1QkFBWCxXQUFXLENBQUUsb0JBQW9CO29CQUN2RCxVQUFVLEVBQUUsV0FBVyxhQUFYLFdBQVcsdUJBQVgsV0FBVyxDQUFFLFVBQVU7b0JBQ25DLGFBQWEsRUFBRSxXQUFXLGFBQVgsV0FBVyx1QkFBWCxXQUFXLENBQUUsYUFBYTtpQkFDNUIsQ0FBQztnQkFFbEIsSUFBSSxRQUFRLEVBQUUsQ0FBQztvQkFDVixRQUFRLENBQUMsT0FBZSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7Z0JBQ2xELENBQUM7WUFFTCxDQUFDO2lCQUFNLENBQUM7Z0JBQ0osV0FBVztnQkFDWCxRQUFRLEdBQUcsTUFBTSxNQUFNLENBQUMsSUFBSSxDQUFDO29CQUN6QixLQUFLO29CQUNMLFFBQVE7b0JBQ1IsS0FBSyxFQUFFLFdBQVc7b0JBQ2xCLE1BQU0sRUFBRSxLQUFLO2lCQUNoQixDQUFDLENBQUM7Z0JBRUgsV0FBVyxHQUFHO29CQUNWLGNBQWMsRUFBRSxRQUFRLENBQUMsY0FBYztvQkFDdkMsYUFBYSxFQUFFLFFBQVEsQ0FBQyxhQUFhO29CQUNyQyxpQkFBaUIsRUFBRSxRQUFRLENBQUMsaUJBQWlCO29CQUM3QyxvQkFBb0IsRUFBRSxRQUFRLENBQUMsb0JBQW9CO29CQUNuRCxVQUFVLEVBQUUsUUFBUSxDQUFDLFVBQVU7b0JBQy9CLGFBQWEsRUFBRSxRQUFRLENBQUMsYUFBYTtpQkFDeEMsQ0FBQztZQUNOLENBQUM7WUFFRCxtQkFBbUI7WUFDbkIsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFaEMsY0FBYztZQUNkLElBQUksTUFBQyxRQUFRLENBQUMsT0FBZSwwQ0FBRSxRQUFRLEVBQUUsQ0FBQztnQkFDdEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyw0QkFBNkIsUUFBUSxDQUFDLE9BQWUsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkcsQ0FBQztZQUVELGFBQWE7WUFDYixJQUFJLFFBQVEsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLFFBQVEsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzVGLENBQUM7WUFFRCxnQkFBZ0I7WUFDaEIsTUFBTSxnQkFBZ0IsR0FBRyxNQUFBLFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBVSxtQ0FBSSxFQUFFLENBQUM7WUFFM0QsSUFBSSxnQkFBZ0IsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQ2hDLG1CQUFtQjtnQkFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO2dCQUM5QyxNQUFNO1lBQ1YsQ0FBQztZQUVELFdBQVc7WUFDWCxLQUFLLE1BQU0sUUFBUSxJQUFJLGdCQUFnQixFQUFFLENBQUM7Z0JBQ3RDLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO2dCQUN4QyxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQztnQkFFN0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5QkFBeUIsUUFBUSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUU5RSxJQUFJLENBQUMsQ0FBQyxRQUFRLElBQUksa0JBQWtCLENBQUMsRUFBRSxDQUFDO29CQUNwQyxPQUFPLENBQUMsSUFBSSxDQUFDLDZCQUE2QixRQUFRLEVBQUUsQ0FBQyxDQUFDO29CQUN0RCxTQUFTO2dCQUNiLENBQUM7Z0JBRUQsSUFBSSxDQUFDO29CQUNELFFBQVE7b0JBQ1IsTUFBTSxNQUFNLEdBQUcsTUFBTSxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDNUQsTUFBTSxTQUFTLEdBQUcsT0FBTyxNQUFNLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBRS9FLE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFFdkUsUUFBUTtvQkFDUixJQUFJLFVBQVUsRUFBRSxDQUFDO3dCQUNiLFVBQVUsQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO29CQUMzQyxDQUFDO29CQUVELFdBQVc7b0JBQ1gsaUJBQWlCLENBQUMsSUFBSSxDQUFDO3dCQUNuQixJQUFJLEVBQUUsUUFBUTt3QkFDZCxTQUFTLEVBQUUsUUFBUTt3QkFDbkIsTUFBTTtxQkFDVCxDQUFDLENBQUM7b0JBRUgsaUJBQWlCO29CQUNqQixRQUFRLENBQUMsSUFBSSxDQUFDO3dCQUNWLElBQUksRUFBRSxNQUFNO3dCQUNaLE9BQU8sRUFBRSxTQUFTO3FCQUNyQixDQUFDLENBQUM7Z0JBRVAsQ0FBQztnQkFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO29CQUNsQixPQUFPLENBQUMsS0FBSyxDQUFDLDJCQUEyQixLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztvQkFDMUQsUUFBUSxDQUFDLElBQUksQ0FBQzt3QkFDVixJQUFJLEVBQUUsTUFBTTt3QkFDWixPQUFPLEVBQUUsVUFBVSxLQUFLLENBQUMsT0FBTyxFQUFFO3FCQUNyQyxDQUFDLENBQUM7Z0JBQ1AsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDO1FBRUQsSUFBSSxVQUFVLElBQUksYUFBYSxFQUFFLENBQUM7WUFDOUIsT0FBTyxDQUFDLElBQUksQ0FBQywyQkFBMkIsYUFBYSxNQUFNLENBQUMsQ0FBQztRQUNqRSxDQUFDO1FBRUQsV0FBVztRQUNYLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2xELE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUVoRCxPQUFPLENBQUMsR0FBRyxDQUFDLHNDQUFzQyxVQUFVLFlBQVksaUJBQWlCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztRQUVyRyxPQUFPO1lBQ0gsT0FBTyxFQUFFLGlCQUFpQixDQUFDLFdBQVcsQ0FBQztZQUN2QyxPQUFPO1lBQ1AsaUJBQWlCO1lBQ2pCLE9BQU8sRUFBRSxXQUFXO1lBQ3BCLFVBQVU7U0FDYixDQUFDO0lBQ04sQ0FBQztDQUFBO0FBRUQ7Ozs7R0FJRztBQUNILFNBQXNCLHFCQUFxQixDQUN2QyxLQUFhLEVBQ2IsTUFBYyxFQUNkLEtBQXVCLEVBQ3ZCLGtCQUEyRCxFQUMzRCxPQUdDOztRQUVELE9BQU8sWUFBWSxDQUFDO1lBQ2hCLEtBQUs7WUFDTCxRQUFRLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxDQUFDO1lBQzdDLEtBQUs7WUFDTCxrQkFBa0I7WUFDbEIsS0FBSyxFQUFFLE9BQU8sYUFBUCxPQUFPLHVCQUFQLE9BQU8sQ0FBRSxLQUFLO1lBQ3JCLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQSxPQUFPLGFBQVAsT0FBTyx1QkFBUCxPQUFPLENBQUUsT0FBTyxDQUFBO1lBQzFCLE9BQU8sRUFBRSxPQUFPLGFBQVAsT0FBTyx1QkFBUCxPQUFPLENBQUUsT0FBTztZQUN6QixhQUFhLEVBQUUsQ0FBQyxDQUFFLGlCQUFpQjtTQUN0QyxDQUFDLENBQUM7SUFDUCxDQUFDO0NBQUE7QUFFRDs7R0FFRztBQUNILFNBQWdCLG1CQUFtQixDQUFDLE9BTW5DO0lBQ0csT0FBTztRQUNILElBQUksRUFBRSxVQUFVO1FBQ2hCLFFBQVEsRUFBRTtZQUNOLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUk7WUFDdkIsV0FBVyxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVztZQUNyQyxVQUFVLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXO1NBQ3ZDO0tBQ0osQ0FBQztBQUNOLENBQUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLHFCQUFxQixDQUFDLFFBTXBDO0lBQ0UsT0FBTyxRQUFRLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLENBQUM7QUFDN0MsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVm9sdW1lcy9NQUNfQVBQL29wZW5tYWtlX2xsbS9iYWNrZW5kL2FwaS9zcmMvb2xsYW1hL2FnZW50LWxvb3AudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPbGxhbWEgQ2xvdWQgTXVsdGktdHVybiBUb29sIENhbGxpbmcgQWdlbnQgTG9vcFxuICogXG4gKiDqs7Xsi50g66y47IScIOywuOqzoDogaHR0cHM6Ly9kb2NzLm9sbGFtYS5jb20vY2FwYWJpbGl0aWVzL3Rvb2wtY2FsbGluZyNtdWx0aS10dXJuLXRvb2wtY2FsbGluZy1hZ2VudC1sb29wXG4gKiBcbiAqIOydtCDrqqjrk4jsnYAgT2xsYW1h7J2YIFRvb2wgQ2FsbGluZyDquLDriqXsnYQg7Zmc7Jqp7ZWcIEFnZW50IExvb3Drpbwg6rWs7ZiE7ZWp64uI64ukLlxuICogLSBNdWx0aS10dXJuIOuMgO2ZlOyXkOyEnCDsnpDrj5nsnLzroZwg64+E6rWs66W8IO2YuOy2nO2VmOqzoCDqsrDqs7zrpbwg64uk7IucIExMTeyXkCDsoITri6xcbiAqIC0gU3RyZWFtaW5nIOyngOybkOycvOuhnCDsi6Tsi5zqsIQg7J2R64u1IOqwgOuKpVxuICogLSDrrLTtlZwg66Oo7ZSEIOuwqeyngOulvCDsnITtlZwgbWF4SXRlcmF0aW9ucyDshKTsoJVcbiAqL1xuXG5pbXBvcnQgeyBPbGxhbWEsIE1lc3NhZ2UsIFRvb2wsIFRvb2xDYWxsLCBDaGF0UmVzcG9uc2UgfSBmcm9tICdvbGxhbWEnO1xuaW1wb3J0IHsgQ2hhdE1lc3NhZ2UsIFRvb2xEZWZpbml0aW9uLCBUaGlua09wdGlvbiwgVXNhZ2VNZXRyaWNzIH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBnZXRBcGlLZXlNYW5hZ2VyIH0gZnJvbSAnLi9hcGkta2V5LW1hbmFnZXInO1xuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi4vY29uZmlnJztcblxuY29uc3QgZW52Q29uZmlnID0gZ2V0Q29uZmlnKCk7XG5cbi8vIE9sbGFtYSBDbG91ZCDtmLjsiqTtirhcbmNvbnN0IE9MTEFNQV9DTE9VRF9IT1NUID0gJ2h0dHBzOi8vb2xsYW1hLmNvbSc7XG5cbi8qKlxuICogQWdlbnQgTG9vcCDsi6Ttlokg7Ji17IWYXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQWdlbnRMb29wT3B0aW9ucyB7XG4gICAgLyoqIOyCrOyaqe2VoCDrqqjrjbgg7J2066aEICovXG4gICAgbW9kZWw/OiBzdHJpbmc7XG4gICAgLyoqIOy0iOq4sCDrqZTsi5zsp4Ag66qp66GdICovXG4gICAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW107XG4gICAgLyoqIOyCrOyaqSDqsIDriqXtlZwg64+E6rWsIOygleydmCAqL1xuICAgIHRvb2xzOiBUb29sRGVmaW5pdGlvbltdO1xuICAgIC8qKiDrj4Tqtawg7J2066aEIC0+IOyLpO2WiSDtlajsiJgg66ek7ZWRICovXG4gICAgYXZhaWxhYmxlRnVuY3Rpb25zOiBSZWNvcmQ8c3RyaW5nLCAoLi4uYXJnczogYW55W10pID0+IGFueSB8IFByb21pc2U8YW55Pj47XG4gICAgLyoqIFRoaW5raW5nIOuqqOuTnCDtmZzshLHtmZQgKi9cbiAgICB0aGluaz86IFRoaW5rT3B0aW9uO1xuICAgIC8qKiDsiqTtirjrpqzrsI0g66qo65OcICovXG4gICAgc3RyZWFtPzogYm9vbGVhbjtcbiAgICAvKiog7Yag7YGwIOy9nOuwsSAo7Iqk7Yq466as67CNIOyLnCkgKi9cbiAgICBvblRva2VuPzogKHRva2VuOiBzdHJpbmcsIHRoaW5raW5nPzogc3RyaW5nKSA9PiB2b2lkO1xuICAgIC8qKiDrj4Tqtawg7Zi47LacIOy9nOuwsSAqL1xuICAgIG9uVG9vbENhbGw/OiAobmFtZTogc3RyaW5nLCBhcmdzOiB1bmtub3duLCByZXN1bHQ6IHVua25vd24pID0+IHZvaWQ7XG4gICAgLyoqIOy1nOuMgCDrsJjrs7Ug7Zqf7IiYICjrrLTtlZwg66Oo7ZSEIOuwqeyngCkgKi9cbiAgICBtYXhJdGVyYXRpb25zPzogbnVtYmVyO1xufVxuXG4vKipcbiAqIEFnZW50IExvb3Ag6rKw6rO8XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQWdlbnRMb29wUmVzdWx0IHtcbiAgICAvKiog7LWc7KKFIOydkeuLtSDrqZTsi5zsp4AgKi9cbiAgICBtZXNzYWdlOiBDaGF0TWVzc2FnZTtcbiAgICAvKiog7KCE7LK0IOuMgO2ZlCDtnojsiqTthqDrpqwgKi9cbiAgICBoaXN0b3J5OiBDaGF0TWVzc2FnZVtdO1xuICAgIC8qKiDtmLjstpzrkJwg64+E6rWsIOuqqeuhnSAqL1xuICAgIHRvb2xDYWxsc0V4ZWN1dGVkOiBBcnJheTx7XG4gICAgICAgIG5hbWU6IHN0cmluZztcbiAgICAgICAgYXJndW1lbnRzOiB1bmtub3duO1xuICAgICAgICByZXN1bHQ6IHVua25vd247XG4gICAgfT47XG4gICAgLyoqIOyCrOyaqeufiSDrqZTtirjrpq0gKi9cbiAgICBtZXRyaWNzPzogVXNhZ2VNZXRyaWNzO1xuICAgIC8qKiDrsJjrs7Ug7Zqf7IiYICovXG4gICAgaXRlcmF0aW9uczogbnVtYmVyO1xufVxuXG4vKipcbiAqIENoYXRNZXNzYWdl66W8IE9sbGFtYSBNZXNzYWdlIO2YleyLneycvOuhnCDrs4DtmZhcbiAqL1xuZnVuY3Rpb24gdG9PbGxhbWFNZXNzYWdlKG1zZzogQ2hhdE1lc3NhZ2UpOiBNZXNzYWdlIHtcbiAgICBjb25zdCBvbGxhbWFNc2c6IE1lc3NhZ2UgPSB7XG4gICAgICAgIHJvbGU6IG1zZy5yb2xlIGFzICdzeXN0ZW0nIHwgJ3VzZXInIHwgJ2Fzc2lzdGFudCcgfCAndG9vbCcsXG4gICAgICAgIGNvbnRlbnQ6IG1zZy5jb250ZW50XG4gICAgfTtcblxuICAgIGlmIChtc2cuaW1hZ2VzKSB7XG4gICAgICAgIG9sbGFtYU1zZy5pbWFnZXMgPSBtc2cuaW1hZ2VzIGFzIHN0cmluZ1tdO1xuICAgIH1cblxuICAgIGlmIChtc2cudG9vbF9jYWxscykge1xuICAgICAgICBvbGxhbWFNc2cudG9vbF9jYWxscyA9IG1zZy50b29sX2NhbGxzLm1hcCh0YyA9PiAoe1xuICAgICAgICAgICAgZnVuY3Rpb246IHtcbiAgICAgICAgICAgICAgICBuYW1lOiB0Yy5mdW5jdGlvbi5uYW1lLFxuICAgICAgICAgICAgICAgIGFyZ3VtZW50czogdGMuZnVuY3Rpb24uYXJndW1lbnRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICByZXR1cm4gb2xsYW1hTXNnO1xufVxuXG4vKipcbiAqIE9sbGFtYSBNZXNzYWdl66W8IENoYXRNZXNzYWdlIO2YleyLneycvOuhnCDrs4DtmZhcbiAqL1xuZnVuY3Rpb24gZnJvbU9sbGFtYU1lc3NhZ2UobXNnOiBNZXNzYWdlKTogQ2hhdE1lc3NhZ2Uge1xuICAgIGNvbnN0IGNoYXRNc2c6IENoYXRNZXNzYWdlID0ge1xuICAgICAgICByb2xlOiBtc2cucm9sZSBhcyAnc3lzdGVtJyB8ICd1c2VyJyB8ICdhc3Npc3RhbnQnIHwgJ3Rvb2wnLFxuICAgICAgICBjb250ZW50OiBtc2cuY29udGVudFxuICAgIH07XG5cbiAgICBpZiAobXNnLmltYWdlcykge1xuICAgICAgICBjaGF0TXNnLmltYWdlcyA9IG1zZy5pbWFnZXMgYXMgc3RyaW5nW107XG4gICAgfVxuXG4gICAgaWYgKG1zZy50b29sX2NhbGxzICYmIG1zZy50b29sX2NhbGxzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY2hhdE1zZy50b29sX2NhbGxzID0gbXNnLnRvb2xfY2FsbHMubWFwKCh0YywgaW5kZXgpID0+ICh7XG4gICAgICAgICAgICB0eXBlOiAnZnVuY3Rpb24nIGFzIGNvbnN0LFxuICAgICAgICAgICAgZnVuY3Rpb246IHtcbiAgICAgICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgICAgICBuYW1lOiB0Yy5mdW5jdGlvbi5uYW1lLFxuICAgICAgICAgICAgICAgIGFyZ3VtZW50czogdGMuZnVuY3Rpb24uYXJndW1lbnRzIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2hhdE1zZztcbn1cblxuLyoqXG4gKiBUb29sRGVmaW5pdGlvbuydhCBPbGxhbWEgVG9vbCDtmJXsi53snLzroZwg67OA7ZmYXG4gKi9cbmZ1bmN0aW9uIHRvT2xsYW1hVG9vbCh0b29sOiBUb29sRGVmaW5pdGlvbik6IFRvb2wge1xuICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdmdW5jdGlvbicsXG4gICAgICAgIGZ1bmN0aW9uOiB7XG4gICAgICAgICAgICBuYW1lOiB0b29sLmZ1bmN0aW9uLm5hbWUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogdG9vbC5mdW5jdGlvbi5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IHRvb2wuZnVuY3Rpb24ucGFyYW1ldGVyc1xuICAgICAgICB9XG4gICAgfTtcbn1cblxuLyoqXG4gKiBPbGxhbWEg7YG065287J207Ja47Yq4IOyDneyEsSAoQ2xvdWQg7KeA7JuQKVxuICovXG5mdW5jdGlvbiBjcmVhdGVPbGxhbWFDbGllbnQobW9kZWw6IHN0cmluZyk6IE9sbGFtYSB7XG4gICAgY29uc3QgYXBpS2V5TWFuYWdlciA9IGdldEFwaUtleU1hbmFnZXIoKTtcbiAgICBjb25zdCBpc0Nsb3VkID0gbW9kZWw/LnRvTG93ZXJDYXNlKCkuZW5kc1dpdGgoJzpjbG91ZCcpO1xuXG4gICAgY29uc3QgaG9zdCA9IGlzQ2xvdWQgPyBPTExBTUFfQ0xPVURfSE9TVCA6IGVudkNvbmZpZy5vbGxhbWFCYXNlVXJsO1xuXG4gICAgY29uc3Qgb2xsYW1hID0gbmV3IE9sbGFtYSh7XG4gICAgICAgIGhvc3QsXG4gICAgICAgIGhlYWRlcnM6IGFwaUtleU1hbmFnZXIuZ2V0QXV0aEhlYWRlcnMoKVxuICAgIH0pO1xuXG4gICAgY29uc29sZS5sb2coYFtBZ2VudExvb3BdIPCfjJAgT2xsYW1hIO2BtOudvOydtOyWuO2KuCDsg53shLEgLSDtmLjsiqTtirg6ICR7aG9zdH0sIOuqqOuNuDogJHttb2RlbH1gKTtcblxuICAgIHJldHVybiBvbGxhbWE7XG59XG5cbi8qKlxuICogTXVsdGktdHVybiBUb29sIENhbGxpbmcgQWdlbnQgTG9vcCDsi6TtlolcbiAqIFxuICog64+E6rWsIO2YuOy2nOydtCDsl4bsnYQg65WM6rmM7KeAIOyekOuPmeycvOuhnCDrjIDtmZTrpbwg7J207Ja06rCR64uI64ukLlxuICogXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgcnVuQWdlbnRMb29wKHtcbiAqICAgbW9kZWw6ICdnZW1pbmktMy1mbGFzaC1wcmV2aWV3OmNsb3VkJyxcbiAqICAgbWVzc2FnZXM6IFt7IHJvbGU6ICd1c2VyJywgY29udGVudDogJ+yEnOyauCDrgqDslKgg7JWM66Ck7KSYJyB9XSxcbiAqICAgdG9vbHM6IFt3ZWF0aGVyVG9vbF0sXG4gKiAgIGF2YWlsYWJsZUZ1bmN0aW9uczogeyBnZXRfd2VhdGhlcjogZ2V0V2VhdGhlciB9LFxuICogICBvblRvb2xDYWxsOiAobmFtZSwgYXJncywgcmVzdWx0KSA9PiBjb25zb2xlLmxvZyhgVG9vbCAke25hbWV9OiAke3Jlc3VsdH1gKVxuICogfSk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJ1bkFnZW50TG9vcChvcHRpb25zOiBBZ2VudExvb3BPcHRpb25zKTogUHJvbWlzZTxBZ2VudExvb3BSZXN1bHQ+IHtcbiAgICBjb25zdCB7XG4gICAgICAgIG1vZGVsID0gZW52Q29uZmlnLm9sbGFtYURlZmF1bHRNb2RlbCxcbiAgICAgICAgbWVzc2FnZXM6IGluaXRpYWxNZXNzYWdlcyxcbiAgICAgICAgdG9vbHMsXG4gICAgICAgIGF2YWlsYWJsZUZ1bmN0aW9ucyxcbiAgICAgICAgdGhpbmsgPSB0cnVlLFxuICAgICAgICBzdHJlYW0gPSBmYWxzZSxcbiAgICAgICAgb25Ub2tlbixcbiAgICAgICAgb25Ub29sQ2FsbCxcbiAgICAgICAgbWF4SXRlcmF0aW9ucyA9IDEwXG4gICAgfSA9IG9wdGlvbnM7XG5cbiAgICBjb25zdCBvbGxhbWEgPSBjcmVhdGVPbGxhbWFDbGllbnQobW9kZWwpO1xuICAgIGNvbnN0IG9sbGFtYVRvb2xzID0gdG9vbHMubWFwKHRvT2xsYW1hVG9vbCk7XG5cbiAgICAvLyDrqZTsi5zsp4Ag7Z6I7Iqk7Yag66asIOuzteyCrFxuICAgIGNvbnN0IG1lc3NhZ2VzOiBNZXNzYWdlW10gPSBpbml0aWFsTWVzc2FnZXMubWFwKHRvT2xsYW1hTWVzc2FnZSk7XG4gICAgY29uc3QgdG9vbENhbGxzRXhlY3V0ZWQ6IEFnZW50TG9vcFJlc3VsdFsndG9vbENhbGxzRXhlY3V0ZWQnXSA9IFtdO1xuICAgIGxldCBpdGVyYXRpb25zID0gMDtcbiAgICBsZXQgbGFzdE1ldHJpY3M6IFVzYWdlTWV0cmljcyB8IHVuZGVmaW5lZDtcblxuICAgIGNvbnNvbGUubG9nKGBbQWdlbnRMb29wXSDwn5qAIEFnZW50IExvb3Ag7Iuc7J6RIC0g66qo6424OiAke21vZGVsfSwg64+E6rWsOiAke3Rvb2xzLmxlbmd0aH3qsJxgKTtcblxuICAgIHdoaWxlIChpdGVyYXRpb25zIDwgbWF4SXRlcmF0aW9ucykge1xuICAgICAgICBpdGVyYXRpb25zKys7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbQWdlbnRMb29wXSDwn5ONIOuwmOuztSAke2l0ZXJhdGlvbnN9LyR7bWF4SXRlcmF0aW9uc31gKTtcblxuICAgICAgICBsZXQgcmVzcG9uc2U6IENoYXRSZXNwb25zZTtcblxuICAgICAgICBpZiAoc3RyZWFtICYmIG9uVG9rZW4pIHtcbiAgICAgICAgICAgIC8vIOyKpO2KuOumrOuwjSDrqqjrk5xcbiAgICAgICAgICAgIGxldCBjb250ZW50ID0gJyc7XG4gICAgICAgICAgICBsZXQgdGhpbmtpbmcgPSAnJztcbiAgICAgICAgICAgIGxldCB0b29sQ2FsbHM6IFRvb2xDYWxsW10gPSBbXTtcblxuICAgICAgICAgICAgY29uc3Qgc3RyZWFtUmVzcG9uc2UgPSBhd2FpdCBvbGxhbWEuY2hhdCh7XG4gICAgICAgICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgICAgICAgbWVzc2FnZXMsXG4gICAgICAgICAgICAgICAgdG9vbHM6IG9sbGFtYVRvb2xzLFxuICAgICAgICAgICAgICAgIHN0cmVhbTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaW5rIOyYteyFmOydgCBtb2RlbCBvcHRpb25z6rCAIOyVhOuLjCDrs4Trj4TroZwg7LKY66asXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGZvciBhd2FpdCAoY29uc3QgY2h1bmsgb2Ygc3RyZWFtUmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlua2luZyDsspjrpqxcbiAgICAgICAgICAgICAgICBpZiAoKGNodW5rLm1lc3NhZ2UgYXMgYW55KT8udGhpbmtpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpbmtpbmcgKz0gKGNodW5rLm1lc3NhZ2UgYXMgYW55KS50aGlua2luZztcbiAgICAgICAgICAgICAgICAgICAgb25Ub2tlbignJywgKGNodW5rLm1lc3NhZ2UgYXMgYW55KS50aGlua2luZyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQ29udGVudCDsspjrpqxcbiAgICAgICAgICAgICAgICBpZiAoY2h1bmsubWVzc2FnZT8uY29udGVudCkge1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50ICs9IGNodW5rLm1lc3NhZ2UuY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgb25Ub2tlbihjaHVuay5tZXNzYWdlLmNvbnRlbnQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFRvb2wgY2FsbHMg7IiY7KeRXG4gICAgICAgICAgICAgICAgaWYgKGNodW5rLm1lc3NhZ2U/LnRvb2xfY2FsbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9vbENhbGxzID0gY2h1bmsubWVzc2FnZS50b29sX2NhbGxzO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIOuplO2KuOumrSDsiJjsp5FcbiAgICAgICAgICAgICAgICBpZiAoY2h1bmsuZG9uZSkge1xuICAgICAgICAgICAgICAgICAgICBsYXN0TWV0cmljcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX2R1cmF0aW9uOiBjaHVuay50b3RhbF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRfZHVyYXRpb246IGNodW5rLmxvYWRfZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHRfZXZhbF9jb3VudDogY2h1bmsucHJvbXB0X2V2YWxfY291bnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9tcHRfZXZhbF9kdXJhdGlvbjogY2h1bmsucHJvbXB0X2V2YWxfZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBldmFsX2NvdW50OiBjaHVuay5ldmFsX2NvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgZXZhbF9kdXJhdGlvbjogY2h1bmsuZXZhbF9kdXJhdGlvblxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8g7Iqk7Yq466as67CNIOyZhOujjCDtm4Qg7J2R64u1IOq1rOyEsVxuICAgICAgICAgICAgcmVzcG9uc2UgPSB7XG4gICAgICAgICAgICAgICAgbW9kZWwsXG4gICAgICAgICAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgIHJvbGU6ICdhc3Npc3RhbnQnLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgICAgICAgICB0b29sX2NhbGxzOiB0b29sQ2FsbHMubGVuZ3RoID4gMCA/IHRvb2xDYWxscyA6IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZG9uZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkb25lX3JlYXNvbjogdG9vbENhbGxzLmxlbmd0aCA+IDAgPyAndG9vbF9jYWxscycgOiAnc3RvcCcsXG4gICAgICAgICAgICAgICAgdG90YWxfZHVyYXRpb246IGxhc3RNZXRyaWNzPy50b3RhbF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBsb2FkX2R1cmF0aW9uOiBsYXN0TWV0cmljcz8ubG9hZF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBwcm9tcHRfZXZhbF9jb3VudDogbGFzdE1ldHJpY3M/LnByb21wdF9ldmFsX2NvdW50LFxuICAgICAgICAgICAgICAgIHByb21wdF9ldmFsX2R1cmF0aW9uOiBsYXN0TWV0cmljcz8ucHJvbXB0X2V2YWxfZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgZXZhbF9jb3VudDogbGFzdE1ldHJpY3M/LmV2YWxfY291bnQsXG4gICAgICAgICAgICAgICAgZXZhbF9kdXJhdGlvbjogbGFzdE1ldHJpY3M/LmV2YWxfZHVyYXRpb25cbiAgICAgICAgICAgIH0gYXMgQ2hhdFJlc3BvbnNlO1xuXG4gICAgICAgICAgICBpZiAodGhpbmtpbmcpIHtcbiAgICAgICAgICAgICAgICAocmVzcG9uc2UubWVzc2FnZSBhcyBhbnkpLnRoaW5raW5nID0gdGhpbmtpbmc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIOu5hOyKpO2KuOumrOuwjSDrqqjrk5xcbiAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgb2xsYW1hLmNoYXQoe1xuICAgICAgICAgICAgICAgIG1vZGVsLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzLFxuICAgICAgICAgICAgICAgIHRvb2xzOiBvbGxhbWFUb29scyxcbiAgICAgICAgICAgICAgICBzdHJlYW06IGZhbHNlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGFzdE1ldHJpY3MgPSB7XG4gICAgICAgICAgICAgICAgdG90YWxfZHVyYXRpb246IHJlc3BvbnNlLnRvdGFsX2R1cmF0aW9uLFxuICAgICAgICAgICAgICAgIGxvYWRfZHVyYXRpb246IHJlc3BvbnNlLmxvYWRfZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgcHJvbXB0X2V2YWxfY291bnQ6IHJlc3BvbnNlLnByb21wdF9ldmFsX2NvdW50LFxuICAgICAgICAgICAgICAgIHByb21wdF9ldmFsX2R1cmF0aW9uOiByZXNwb25zZS5wcm9tcHRfZXZhbF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBldmFsX2NvdW50OiByZXNwb25zZS5ldmFsX2NvdW50LFxuICAgICAgICAgICAgICAgIGV2YWxfZHVyYXRpb246IHJlc3BvbnNlLmV2YWxfZHVyYXRpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyDsnZHri7Ug66mU7Iuc7KeA66W8IO2eiOyKpO2GoOumrOyXkCDstpTqsIBcbiAgICAgICAgbWVzc2FnZXMucHVzaChyZXNwb25zZS5tZXNzYWdlKTtcblxuICAgICAgICAvLyBUaGlua2luZyDroZzqt7hcbiAgICAgICAgaWYgKChyZXNwb25zZS5tZXNzYWdlIGFzIGFueSk/LnRoaW5raW5nKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW0FnZW50TG9vcF0g8J+noCBUaGlua2luZzogJHsocmVzcG9uc2UubWVzc2FnZSBhcyBhbnkpLnRoaW5raW5nLnN1YnN0cmluZygwLCAxMDApfS4uLmApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ29udGVudCDroZzqt7hcbiAgICAgICAgaWYgKHJlc3BvbnNlLm1lc3NhZ2UuY29udGVudCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYFtBZ2VudExvb3BdIPCfkqwgQ29udGVudDogJHtyZXNwb25zZS5tZXNzYWdlLmNvbnRlbnQuc3Vic3RyaW5nKDAsIDEwMCl9Li4uYCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUb29sIGNhbGxzIO2ZleyduFxuICAgICAgICBjb25zdCByZXNwb25zVG9vbENhbGxzID0gcmVzcG9uc2UubWVzc2FnZS50b29sX2NhbGxzID8/IFtdO1xuXG4gICAgICAgIGlmIChyZXNwb25zVG9vbENhbGxzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgLy8g64+E6rWsIO2YuOy2nCDsl4bsnYwgLSDro6jtlIQg7KKF66OMXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW0FnZW50TG9vcF0g4pyFIOuPhOq1rCDtmLjstpwg7JeG7J2MIC0g66Oo7ZSEIOyiheujjGApO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICAvLyDrj4Tqtawg7Zi47LacIOyymOumrFxuICAgICAgICBmb3IgKGNvbnN0IHRvb2xDYWxsIG9mIHJlc3BvbnNUb29sQ2FsbHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGZ1bmNOYW1lID0gdG9vbENhbGwuZnVuY3Rpb24ubmFtZTtcbiAgICAgICAgICAgIGNvbnN0IGZ1bmNBcmdzID0gdG9vbENhbGwuZnVuY3Rpb24uYXJndW1lbnRzO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgW0FnZW50TG9vcF0g8J+UpyDrj4Tqtawg7Zi47LacOiAke2Z1bmNOYW1lfSgke0pTT04uc3RyaW5naWZ5KGZ1bmNBcmdzKX0pYCk7XG5cbiAgICAgICAgICAgIGlmICghKGZ1bmNOYW1lIGluIGF2YWlsYWJsZUZ1bmN0aW9ucykpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFtBZ2VudExvb3BdIOKaoO+4jyDslYwg7IiYIOyXhuuKlCDrj4Tqtaw6ICR7ZnVuY05hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8g64+E6rWsIOyLpO2WiVxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF2YWlsYWJsZUZ1bmN0aW9uc1tmdW5jTmFtZV0oZnVuY0FyZ3MpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdFN0ciA9IHR5cGVvZiByZXN1bHQgPT09ICdzdHJpbmcnID8gcmVzdWx0IDogSlNPTi5zdHJpbmdpZnkocmVzdWx0KTtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQWdlbnRMb29wXSDwn5OkIOuPhOq1rCDqsrDqs7w6ICR7cmVzdWx0U3RyLnN1YnN0cmluZygwLCAxMDApfS4uLmApO1xuXG4gICAgICAgICAgICAgICAgLy8g7L2c67CxIO2YuOy2nFxuICAgICAgICAgICAgICAgIGlmIChvblRvb2xDYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uVG9vbENhbGwoZnVuY05hbWUsIGZ1bmNBcmdzLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIOyLpO2WiSDquLDroZ0g7KCA7J6lXG4gICAgICAgICAgICAgICAgdG9vbENhbGxzRXhlY3V0ZWQucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGZ1bmNOYW1lLFxuICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IGZ1bmNBcmdzLFxuICAgICAgICAgICAgICAgICAgICByZXN1bHRcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIOuPhOq1rCDqsrDqs7zrpbwg66mU7Iuc7KeA7JeQIOy2lOqwgFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICByb2xlOiAndG9vbCcsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3VsdFN0clxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgW0FnZW50TG9vcF0g4p2MIOuPhOq1rCDsi6Ttlokg7Jik66WYOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICAgICAgbWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHJvbGU6ICd0b29sJyxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGl0ZXJhdGlvbnMgPj0gbWF4SXRlcmF0aW9ucykge1xuICAgICAgICBjb25zb2xlLndhcm4oYFtBZ2VudExvb3BdIOKaoO+4jyDstZzrjIAg67CY67O1IO2an+yImCgke21heEl0ZXJhdGlvbnN9KSDrj4Tri6xgKTtcbiAgICB9XG5cbiAgICAvLyDstZzsooUg6rKw6rO8IOq1rOyEsVxuICAgIGNvbnN0IGxhc3RNZXNzYWdlID0gbWVzc2FnZXNbbWVzc2FnZXMubGVuZ3RoIC0gMV07XG4gICAgY29uc3QgaGlzdG9yeSA9IG1lc3NhZ2VzLm1hcChmcm9tT2xsYW1hTWVzc2FnZSk7XG5cbiAgICBjb25zb2xlLmxvZyhgW0FnZW50TG9vcF0g8J+PgSBBZ2VudCBMb29wIOyZhOujjCAtIOuwmOuztTogJHtpdGVyYXRpb25zfSwg64+E6rWsIO2YuOy2nDogJHt0b29sQ2FsbHNFeGVjdXRlZC5sZW5ndGh96rCcYCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiBmcm9tT2xsYW1hTWVzc2FnZShsYXN0TWVzc2FnZSksXG4gICAgICAgIGhpc3RvcnksXG4gICAgICAgIHRvb2xDYWxsc0V4ZWN1dGVkLFxuICAgICAgICBtZXRyaWNzOiBsYXN0TWV0cmljcyxcbiAgICAgICAgaXRlcmF0aW9uc1xuICAgIH07XG59XG5cbi8qKlxuICog64uo7J28IOuPhOq1rCDtmLjstpwg7Iuk7ZaJIChBZ2VudCBMb29wIOyCrOyaqSlcbiAqIFxuICog64uo7Iic7ZWcIOuLqOydvCDrj4Tqtawg7Zi47LacIOyLnOuCmOumrOyYpOyXkCDsgqzsmqnrkKnri4jri6QuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlU2luZ2xlVG9vbENhbGwoXG4gICAgbW9kZWw6IHN0cmluZyxcbiAgICBwcm9tcHQ6IHN0cmluZyxcbiAgICB0b29sczogVG9vbERlZmluaXRpb25bXSxcbiAgICBhdmFpbGFibGVGdW5jdGlvbnM6IFJlY29yZDxzdHJpbmcsICguLi5hcmdzOiBhbnlbXSkgPT4gYW55PixcbiAgICBvcHRpb25zPzoge1xuICAgICAgICB0aGluaz86IFRoaW5rT3B0aW9uO1xuICAgICAgICBvblRva2VuPzogKHRva2VuOiBzdHJpbmcsIHRoaW5raW5nPzogc3RyaW5nKSA9PiB2b2lkO1xuICAgIH1cbik6IFByb21pc2U8QWdlbnRMb29wUmVzdWx0PiB7XG4gICAgcmV0dXJuIHJ1bkFnZW50TG9vcCh7XG4gICAgICAgIG1vZGVsLFxuICAgICAgICBtZXNzYWdlczogW3sgcm9sZTogJ3VzZXInLCBjb250ZW50OiBwcm9tcHQgfV0sXG4gICAgICAgIHRvb2xzLFxuICAgICAgICBhdmFpbGFibGVGdW5jdGlvbnMsXG4gICAgICAgIHRoaW5rOiBvcHRpb25zPy50aGluayxcbiAgICAgICAgc3RyZWFtOiAhIW9wdGlvbnM/Lm9uVG9rZW4sXG4gICAgICAgIG9uVG9rZW46IG9wdGlvbnM/Lm9uVG9rZW4sXG4gICAgICAgIG1heEl0ZXJhdGlvbnM6IDMgIC8vIOuLqOydvCDtmLjstpzsnbTrr4DroZwg7KCB7J2AIOuwmOuztVxuICAgIH0pO1xufVxuXG4vKipcbiAqIE1DUCBUb29s7J2EIE9sbGFtYSBUb29s66GcIOuzgO2ZmO2VmOuKlCDslrTrjJHthLBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1jcFRvb2xUb09sbGFtYVRvb2wobWNwVG9vbDoge1xuICAgIHRvb2w6IHtcbiAgICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgICAgICBpbnB1dFNjaGVtYTogYW55O1xuICAgIH07XG59KTogVG9vbERlZmluaXRpb24ge1xuICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdmdW5jdGlvbicsXG4gICAgICAgIGZ1bmN0aW9uOiB7XG4gICAgICAgICAgICBuYW1lOiBtY3BUb29sLnRvb2wubmFtZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBtY3BUb29sLnRvb2wuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBwYXJhbWV0ZXJzOiBtY3BUb29sLnRvb2wuaW5wdXRTY2hlbWFcbiAgICAgICAgfVxuICAgIH07XG59XG5cbi8qKlxuICog7Jes65+sIE1DUCBUb29sc+ulvCBPbGxhbWEgVG9vbHProZwg67OA7ZmYXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtY3BUb29sc1RvT2xsYW1hVG9vbHMobWNwVG9vbHM6IEFycmF5PHtcbiAgICB0b29sOiB7XG4gICAgICAgIG5hbWU6IHN0cmluZztcbiAgICAgICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICAgICAgaW5wdXRTY2hlbWE6IGFueTtcbiAgICB9O1xufT4pOiBUb29sRGVmaW5pdGlvbltdIHtcbiAgICByZXR1cm4gbWNwVG9vbHMubWFwKG1jcFRvb2xUb09sbGFtYVRvb2wpO1xufVxuIl0sInZlcnNpb24iOjN9