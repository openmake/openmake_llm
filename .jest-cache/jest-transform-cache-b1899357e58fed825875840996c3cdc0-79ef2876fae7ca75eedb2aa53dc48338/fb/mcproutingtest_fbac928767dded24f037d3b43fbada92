5f32c5396cce917d46926273c72b0644
"use strict";
/**
 * Dynamic MCP Routing 기능 테스트
 *
 * 테스트 항목:
 * 1. UserTier 연계
 * 2. tool-tiers (등급별 도구 접근)
 * 3. user-sandbox (사용자 데이터 격리)
 */
Object.defineProperty(exports, "__esModule", { value: true });
const tool_tiers_1 = require("../../../backend/api/src/mcp/tool-tiers");
const user_sandbox_1 = require("../../../backend/api/src/mcp/user-sandbox");
// ============================================
// 1. Tool Tiers 테스트
// ============================================
describe('Tool Tiers', () => {
    describe('TOOL_TIERS 설정', () => {
        it('free 등급은 기본 도구만 포함', () => {
            expect(tool_tiers_1.TOOL_TIERS.free).toContain('web_search');
            expect(tool_tiers_1.TOOL_TIERS.free).toContain('vision_ocr');
            expect(tool_tiers_1.TOOL_TIERS.free).not.toContain('run_command');
        });
        it('pro 등급은 고급 도구 포함', () => {
            expect(tool_tiers_1.TOOL_TIERS.pro).toContain('run_command');
            expect(tool_tiers_1.TOOL_TIERS.pro).toContain('firecrawl_*');
        });
        it('enterprise 등급은 모든 도구 허용', () => {
            expect(tool_tiers_1.TOOL_TIERS.enterprise).toContain('*');
        });
    });
    describe('canUseTool', () => {
        it('free 사용자는 web_search 사용 가능', () => {
            expect((0, tool_tiers_1.canUseTool)('free', 'web_search')).toBe(true);
        });
        it('free 사용자는 run_command 사용 불가', () => {
            expect((0, tool_tiers_1.canUseTool)('free', 'run_command')).toBe(false);
        });
        it('pro 사용자는 run_command 사용 가능', () => {
            expect((0, tool_tiers_1.canUseTool)('pro', 'run_command')).toBe(true);
        });
        it('pro 사용자는 firecrawl_* 와일드카드 매칭', () => {
            expect((0, tool_tiers_1.canUseTool)('pro', 'firecrawl_scrape')).toBe(true);
            expect((0, tool_tiers_1.canUseTool)('pro', 'firecrawl_crawl')).toBe(true);
        });
        it('enterprise 사용자는 모든 도구 사용 가능', () => {
            expect((0, tool_tiers_1.canUseTool)('enterprise', 'web_search')).toBe(true);
            expect((0, tool_tiers_1.canUseTool)('enterprise', 'run_command')).toBe(true);
            expect((0, tool_tiers_1.canUseTool)('enterprise', 'any_random_tool')).toBe(true);
        });
    });
    describe('getToolsForTier', () => {
        const allTools = ['web_search', 'vision_ocr', 'run_command', 'firecrawl_scrape', 'secret_tool'];
        it('free 등급은 허용된 도구만 반환', () => {
            const tools = (0, tool_tiers_1.getToolsForTier)('free', allTools);
            expect(tools).toContain('web_search');
            expect(tools).toContain('vision_ocr');
            expect(tools).not.toContain('run_command');
        });
        it('enterprise 등급은 모든 도구 반환', () => {
            const tools = (0, tool_tiers_1.getToolsForTier)('enterprise', allTools);
            expect(tools).toEqual(allTools);
        });
    });
    describe('getDefaultTierForRole', () => {
        it('admin은 enterprise tier', () => {
            expect((0, tool_tiers_1.getDefaultTierForRole)('admin')).toBe('enterprise');
        });
        it('user는 free tier', () => {
            expect((0, tool_tiers_1.getDefaultTierForRole)('user')).toBe('free');
        });
        it('guest는 free tier', () => {
            expect((0, tool_tiers_1.getDefaultTierForRole)('guest')).toBe('free');
        });
    });
});
// ============================================
// 2. User Sandbox 테스트
// ============================================
describe('User Sandbox', () => {
    const testUserId = 'test_user_123';
    describe('경로 생성', () => {
        it('작업 디렉토리 경로 생성', () => {
            const workDir = user_sandbox_1.UserSandbox.getWorkDir(testUserId);
            expect(workDir).toContain(testUserId);
            expect(workDir).toContain('workspace');
        });
        it('데이터 디렉토리 경로 생성', () => {
            const dataDir = user_sandbox_1.UserSandbox.getDataDir(testUserId);
            expect(dataDir).toContain(testUserId);
            expect(dataDir).toContain('data');
        });
        it('SQLite DB 경로 생성', () => {
            const dbPath = user_sandbox_1.UserSandbox.getUserDbPath(testUserId);
            expect(dbPath).toContain(testUserId);
            expect(dbPath).toContain('user.db');
        });
        it('대화 DB 경로 생성', () => {
            const dbPath = user_sandbox_1.UserSandbox.getUserConversationDbPath(testUserId);
            expect(dbPath).toContain('conversations.db');
        });
    });
    describe('경로 검증 (보안)', () => {
        it('사용자 디렉토리 내 경로는 허용', () => {
            const userRoot = user_sandbox_1.UserSandbox.getWorkDir(testUserId);
            const validPath = `${userRoot}/test.txt`;
            expect(user_sandbox_1.UserSandbox.validatePath(testUserId, validPath)).toBe(true);
        });
        it('사용자 디렉토리 외부 접근 차단', () => {
            expect(user_sandbox_1.UserSandbox.validatePath(testUserId, '/etc/passwd')).toBe(false);
            expect(user_sandbox_1.UserSandbox.validatePath(testUserId, '/root/.ssh')).toBe(false);
        });
        it('상대 경로 탈출 시도 차단', () => {
            const result = user_sandbox_1.UserSandbox.resolvePath(testUserId, '../../../etc/passwd');
            // 경로 탈출 시 null 반환
            expect(result === null || !result.includes('/etc/passwd')).toBe(true);
        });
    });
    describe('사용자 컨텍스트', () => {
        it('컨텍스트 생성', () => {
            const context = (0, user_sandbox_1.createUserContext)(1, 'pro', 'user', 'org123');
            expect(context.userId).toBe(1);
            expect(context.tier).toBe('pro');
            expect(context.role).toBe('user');
            expect(context.orgId).toBe('org123');
        });
    });
});
// ============================================
// 테스트 실행
// ============================================
console.log('테스트 시작...');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vdGVzdHMvdW5pdC9fX3Rlc3RzX18vbWNwLXJvdXRpbmcudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7R0FPRzs7QUFHSCx3RUFBeUg7QUFDekgsNEVBQXdHO0FBRXhHLCtDQUErQztBQUMvQyxvQkFBb0I7QUFDcEIsK0NBQStDO0FBRS9DLFFBQVEsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO0lBQ3hCLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1FBQzNCLEVBQUUsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7WUFDMUIsTUFBTSxDQUFDLHVCQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ2hELE1BQU0sQ0FBQyx1QkFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNoRCxNQUFNLENBQUMsdUJBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3pELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtZQUN4QixNQUFNLENBQUMsdUJBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDaEQsTUFBTSxDQUFDLHVCQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3BELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHlCQUF5QixFQUFFLEdBQUcsRUFBRTtZQUMvQixNQUFNLENBQUMsdUJBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO1FBQ3hCLEVBQUUs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QVBQL29wZW5tYWtlX2xsbS90ZXN0cy91bml0L19fdGVzdHNfXy9tY3Atcm91dGluZy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRHluYW1pYyBNQ1AgUm91dGluZyDquLDriqUg7YWM7Iqk7Yq4XG4gKiBcbiAqIO2FjOyKpO2KuCDtla3rqqk6XG4gKiAxLiBVc2VyVGllciDsl7Dqs4RcbiAqIDIuIHRvb2wtdGllcnMgKOuTseq4ieuzhCDrj4Tqtawg7KCR6re8KVxuICogMy4gdXNlci1zYW5kYm94ICjsgqzsmqnsnpAg642w7J207YSwIOqyqeumrClcbiAqL1xuXG5pbXBvcnQgeyBVc2VyVGllciwgUHVibGljVXNlciB9IGZyb20gJy4uLy4uLy4uL2JhY2tlbmQvYXBpL3NyYy9kYXRhL3VzZXItbWFuYWdlcic7XG5pbXBvcnQgeyBUT09MX1RJRVJTLCBjYW5Vc2VUb29sLCBnZXRUb29sc0ZvclRpZXIsIGdldERlZmF1bHRUaWVyRm9yUm9sZSB9IGZyb20gJy4uLy4uLy4uL2JhY2tlbmQvYXBpL3NyYy9tY3AvdG9vbC10aWVycyc7XG5pbXBvcnQgeyBVc2VyU2FuZGJveCwgVXNlckNvbnRleHQsIGNyZWF0ZVVzZXJDb250ZXh0IH0gZnJvbSAnLi4vLi4vLi4vYmFja2VuZC9hcGkvc3JjL21jcC91c2VyLXNhbmRib3gnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gMS4gVG9vbCBUaWVycyDthYzsiqTtirhcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmRlc2NyaWJlKCdUb29sIFRpZXJzJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdUT09MX1RJRVJTIOyEpOyglScsICgpID0+IHtcbiAgICAgICAgaXQoJ2ZyZWUg65Ox6riJ7J2AIOq4sOuzuCDrj4Tqtazrp4wg7Y+s7ZWoJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KFRPT0xfVElFUlMuZnJlZSkudG9Db250YWluKCd3ZWJfc2VhcmNoJyk7XG4gICAgICAgICAgICBleHBlY3QoVE9PTF9USUVSUy5mcmVlKS50b0NvbnRhaW4oJ3Zpc2lvbl9vY3InKTtcbiAgICAgICAgICAgIGV4cGVjdChUT09MX1RJRVJTLmZyZWUpLm5vdC50b0NvbnRhaW4oJ3J1bl9jb21tYW5kJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdwcm8g65Ox6riJ7J2AIOqzoOq4iSDrj4Tqtawg7Y+s7ZWoJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KFRPT0xfVElFUlMucHJvKS50b0NvbnRhaW4oJ3J1bl9jb21tYW5kJyk7XG4gICAgICAgICAgICBleHBlY3QoVE9PTF9USUVSUy5wcm8pLnRvQ29udGFpbignZmlyZWNyYXdsXyonKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ2VudGVycHJpc2Ug65Ox6riJ7J2AIOuqqOuToCDrj4Tqtawg7ZeI7JqpJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KFRPT0xfVElFUlMuZW50ZXJwcmlzZSkudG9Db250YWluKCcqJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2NhblVzZVRvb2wnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdmcmVlIOyCrOyaqeyekOuKlCB3ZWJfc2VhcmNoIOyCrOyaqSDqsIDriqUnLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoY2FuVXNlVG9vbCgnZnJlZScsICd3ZWJfc2VhcmNoJykpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdmcmVlIOyCrOyaqeyekOuKlCBydW5fY29tbWFuZCDsgqzsmqkg67aI6rCAJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGNhblVzZVRvb2woJ2ZyZWUnLCAncnVuX2NvbW1hbmQnKSkudG9CZShmYWxzZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdwcm8g7IKs7Jqp7J6Q64qUIHJ1bl9jb21tYW5kIOyCrOyaqSDqsIDriqUnLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoY2FuVXNlVG9vbCgncHJvJywgJ3J1bl9jb21tYW5kJykpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdwcm8g7IKs7Jqp7J6Q64qUIGZpcmVjcmF3bF8qIOyZgOydvOuTnOy5tOuTnCDrp6Tsua0nLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoY2FuVXNlVG9vbCgncHJvJywgJ2ZpcmVjcmF3bF9zY3JhcGUnKSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChjYW5Vc2VUb29sKCdwcm8nLCAnZmlyZWNyYXdsX2NyYXdsJykpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdlbnRlcnByaXNlIOyCrOyaqeyekOuKlCDrqqjrk6Ag64+E6rWsIOyCrOyaqSDqsIDriqUnLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoY2FuVXNlVG9vbCgnZW50ZXJwcmlzZScsICd3ZWJfc2VhcmNoJykpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QoY2FuVXNlVG9vbCgnZW50ZXJwcmlzZScsICdydW5fY29tbWFuZCcpKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgZXhwZWN0KGNhblVzZVRvb2woJ2VudGVycHJpc2UnLCAnYW55X3JhbmRvbV90b29sJykpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2dldFRvb2xzRm9yVGllcicsICgpID0+IHtcbiAgICAgICAgY29uc3QgYWxsVG9vbHMgPSBbJ3dlYl9zZWFyY2gnLCAndmlzaW9uX29jcicsICdydW5fY29tbWFuZCcsICdmaXJlY3Jhd2xfc2NyYXBlJywgJ3NlY3JldF90b29sJ107XG5cbiAgICAgICAgaXQoJ2ZyZWUg65Ox6riJ7J2AIO2XiOyaqeuQnCDrj4Tqtazrp4wg67CY7ZmYJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdG9vbHMgPSBnZXRUb29sc0ZvclRpZXIoJ2ZyZWUnLCBhbGxUb29scyk7XG4gICAgICAgICAgICBleHBlY3QodG9vbHMpLnRvQ29udGFpbignd2ViX3NlYXJjaCcpO1xuICAgICAgICAgICAgZXhwZWN0KHRvb2xzKS50b0NvbnRhaW4oJ3Zpc2lvbl9vY3InKTtcbiAgICAgICAgICAgIGV4cGVjdCh0b29scykubm90LnRvQ29udGFpbigncnVuX2NvbW1hbmQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ2VudGVycHJpc2Ug65Ox6riJ7J2AIOuqqOuToCDrj4Tqtawg67CY7ZmYJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdG9vbHMgPSBnZXRUb29sc0ZvclRpZXIoJ2VudGVycHJpc2UnLCBhbGxUb29scyk7XG4gICAgICAgICAgICBleHBlY3QodG9vbHMpLnRvRXF1YWwoYWxsVG9vbHMpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdnZXREZWZhdWx0VGllckZvclJvbGUnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdhZG1pbuydgCBlbnRlcnByaXNlIHRpZXInLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoZ2V0RGVmYXVsdFRpZXJGb3JSb2xlKCdhZG1pbicpKS50b0JlKCdlbnRlcnByaXNlJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCd1c2Vy64qUIGZyZWUgdGllcicsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChnZXREZWZhdWx0VGllckZvclJvbGUoJ3VzZXInKSkudG9CZSgnZnJlZScpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnZ3Vlc3TripQgZnJlZSB0aWVyJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGdldERlZmF1bHRUaWVyRm9yUm9sZSgnZ3Vlc3QnKSkudG9CZSgnZnJlZScpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gMi4gVXNlciBTYW5kYm94IO2FjOyKpO2KuFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZGVzY3JpYmUoJ1VzZXIgU2FuZGJveCcsICgpID0+IHtcbiAgICBjb25zdCB0ZXN0VXNlcklkID0gJ3Rlc3RfdXNlcl8xMjMnO1xuXG4gICAgZGVzY3JpYmUoJ+qyveuhnCDsg53shLEnLCAoKSA9PiB7XG4gICAgICAgIGl0KCfsnpHsl4Ug65SU66CJ7Yag66asIOqyveuhnCDsg53shLEnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB3b3JrRGlyID0gVXNlclNhbmRib3guZ2V0V29ya0Rpcih0ZXN0VXNlcklkKTtcbiAgICAgICAgICAgIGV4cGVjdCh3b3JrRGlyKS50b0NvbnRhaW4odGVzdFVzZXJJZCk7XG4gICAgICAgICAgICBleHBlY3Qod29ya0RpcikudG9Db250YWluKCd3b3Jrc3BhY2UnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ+uNsOydtO2EsCDrlJTroInthqDrpqwg6rK966GcIOyDneyEsScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGFEaXIgPSBVc2VyU2FuZGJveC5nZXREYXRhRGlyKHRlc3RVc2VySWQpO1xuICAgICAgICAgICAgZXhwZWN0KGRhdGFEaXIpLnRvQ29udGFpbih0ZXN0VXNlcklkKTtcbiAgICAgICAgICAgIGV4cGVjdChkYXRhRGlyKS50b0NvbnRhaW4oJ2RhdGEnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ1NRTGl0ZSBEQiDqsr3roZwg7IOd7ISxJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGJQYXRoID0gVXNlclNhbmRib3guZ2V0VXNlckRiUGF0aCh0ZXN0VXNlcklkKTtcbiAgICAgICAgICAgIGV4cGVjdChkYlBhdGgpLnRvQ29udGFpbih0ZXN0VXNlcklkKTtcbiAgICAgICAgICAgIGV4cGVjdChkYlBhdGgpLnRvQ29udGFpbigndXNlci5kYicpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgn64yA7ZmUIERCIOqyveuhnCDsg53shLEnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkYlBhdGggPSBVc2VyU2FuZGJveC5nZXRVc2VyQ29udmVyc2F0aW9uRGJQYXRoKHRlc3RVc2VySWQpO1xuICAgICAgICAgICAgZXhwZWN0KGRiUGF0aCkudG9Db250YWluKCdjb252ZXJzYXRpb25zLmRiJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ+qyveuhnCDqsoDspp0gKOuztOyViCknLCAoKSA9PiB7XG4gICAgICAgIGl0KCfsgqzsmqnsnpAg65SU66CJ7Yag66asIOuCtCDqsr3roZzripQg7ZeI7JqpJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdXNlclJvb3QgPSBVc2VyU2FuZGJveC5nZXRXb3JrRGlyKHRlc3RVc2VySWQpO1xuICAgICAgICAgICAgY29uc3QgdmFsaWRQYXRoID0gYCR7dXNlclJvb3R9L3Rlc3QudHh0YDtcbiAgICAgICAgICAgIGV4cGVjdChVc2VyU2FuZGJveC52YWxpZGF0ZVBhdGgodGVzdFVzZXJJZCwgdmFsaWRQYXRoKSkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ+yCrOyaqeyekCDrlJTroInthqDrpqwg7Jm467aAIOygkeq3vCDssKjri6gnLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoVXNlclNhbmRib3gudmFsaWRhdGVQYXRoKHRlc3RVc2VySWQsICcvZXRjL3Bhc3N3ZCcpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChVc2VyU2FuZGJveC52YWxpZGF0ZVBhdGgodGVzdFVzZXJJZCwgJy9yb290Ly5zc2gnKSkudG9CZShmYWxzZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCfsg4HrjIAg6rK966GcIO2DiOy2nCDsi5zrj4Qg7LCo64uoJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gVXNlclNhbmRib3gucmVzb2x2ZVBhdGgodGVzdFVzZXJJZCwgJy4uLy4uLy4uL2V0Yy9wYXNzd2QnKTtcbiAgICAgICAgICAgIC8vIOqyveuhnCDtg4jstpwg7IucIG51bGwg67CY7ZmYXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0ID09PSBudWxsIHx8ICFyZXN1bHQuaW5jbHVkZXMoJy9ldGMvcGFzc3dkJykpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ+yCrOyaqeyekCDsu6jthY3siqTtirgnLCAoKSA9PiB7XG4gICAgICAgIGl0KCfsu6jthY3siqTtirgg7IOd7ISxJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZVVzZXJDb250ZXh0KDEsICdwcm8nLCAndXNlcicsICdvcmcxMjMnKTtcbiAgICAgICAgICAgIGV4cGVjdChjb250ZXh0LnVzZXJJZCkudG9CZSgxKTtcbiAgICAgICAgICAgIGV4cGVjdChjb250ZXh0LnRpZXIpLnRvQmUoJ3BybycpO1xuICAgICAgICAgICAgZXhwZWN0KGNvbnRleHQucm9sZSkudG9CZSgndXNlcicpO1xuICAgICAgICAgICAgZXhwZWN0KGNvbnRleHQub3JnSWQpLnRvQmUoJ29yZzEyMycpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8g7YWM7Iqk7Yq4IOyLpO2WiVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuY29uc29sZS5sb2coJ+2FjOyKpO2KuCDsi5zsnpEuLi4nKTtcbiJdLCJ2ZXJzaW9uIjozfQ==