{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/auth-middleware.test.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/auth-middleware.test.ts"],"sourcesContent":["/**\n * Auth Middleware Tests\n * 인증 미들웨어 테스트\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport { optionalAuth, requireAuth, requireAdmin, requireRole } from '../auth/middleware';\n\n// Mock user manager\njest.mock('../data/user-manager', () => ({\n    getUserManager: () => ({\n        getUserById: async (id: number) => {\n            if (id === 1) {\n                return {\n                    id: 1,\n                    email: 'test@example.com',\n                    role: 'user',\n                    tier: 'free',\n                    is_active: true,\n                    created_at: new Date().toISOString()\n                };\n            }\n            if (id === 2) {\n                return {\n                    id: 2,\n                    email: 'admin@example.com',\n                    role: 'admin',\n                    tier: 'enterprise',\n                    is_active: true,\n                    created_at: new Date().toISOString()\n                };\n            }\n            if (id === 3) {\n                return {\n                    id: 3,\n                    email: 'inactive@example.com',\n                    role: 'user',\n                    tier: 'free',\n                    is_active: false,\n                    created_at: new Date().toISOString()\n                };\n            }\n            return null;\n        }\n    }),\n    PublicUser: {},\n    UserRole: {}\n}));\n\n// Mock auth functions\njest.mock('../auth/index', () => ({\n    extractToken: (header?: string) => {\n        if (!header) return null;\n        if (header.startsWith('Bearer ')) return header.substring(7);\n        return header;\n    },\n    verifyToken: async (token: string) => {\n        if (token === 'valid-user-token') return { userId: 1, email: 'test@example.com', role: 'user' };\n        if (token === 'valid-admin-token') return { userId: 2, email: 'admin@example.com', role: 'admin' };\n        if (token === 'inactive-user-token') return { userId: 3, email: 'inactive@example.com', role: 'user' };\n        if (token === 'unknown-user-token') return { userId: 999, email: 'unknown@example.com', role: 'user' };\n        return null;\n    },\n    hasPermission: (userRole: string, requiredRole: string) => {\n        const roles = ['guest', 'user', 'admin'];\n        return roles.indexOf(userRole) >= roles.indexOf(requiredRole);\n    },\n    isAdmin: (role: string) => role === 'admin'\n}));\n\n// Helper to create mock request\nfunction createMockRequest(overrides: Partial<Request> = {}): Request {\n    return {\n        headers: {},\n        cookies: {},\n        ...overrides\n    } as Request;\n}\n\n// Helper to create mock response\nfunction createMockResponse(): Response & { jsonData?: unknown; statusCode?: number } {\n    const res: Partial<Response> & { jsonData?: unknown; statusCode?: number } = {\n        statusCode: 200,\n        jsonData: null,\n        status: function(code: number) {\n            this.statusCode = code;\n            return this as Response;\n        },\n        json: function(data: unknown) {\n            this.jsonData = data;\n            return this as Response;\n        }\n    };\n    return res as Response & { jsonData?: unknown; statusCode?: number };\n}\n\ndescribe('Auth Middleware', () => {\n    describe('optionalAuth', () => {\n        it('should pass through without token', async () => {\n            const req = createMockRequest();\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            await optionalAuth(req, res, next);\n            \n            expect(nextCalled).toBe(true);\n            expect(req.user).toBeUndefined();\n        });\n\n        it('should set user from Bearer token in header', async () => {\n            const req = createMockRequest({\n                headers: { authorization: 'Bearer valid-user-token' }\n            });\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            await optionalAuth(req, res, next);\n            \n            expect(nextCalled).toBe(true);\n            expect(req.user).toBeDefined();\n            expect(req.user?.email).toBe('test@example.com');\n        });\n\n        it('should prefer cookie over header', async () => {\n            const req = createMockRequest({\n                headers: { authorization: 'Bearer invalid-token' },\n                cookies: { auth_token: 'valid-user-token' }\n            });\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            await optionalAuth(req, res, next);\n            \n            expect(nextCalled).toBe(true);\n            expect(req.user).toBeDefined();\n        });\n\n        it('should pass through with invalid token', async () => {\n            const req = createMockRequest({\n                headers: { authorization: 'Bearer invalid-token' }\n            });\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            await optionalAuth(req, res, next);\n            \n            expect(nextCalled).toBe(true);\n            expect(req.user).toBeUndefined();\n        });\n    });\n\n    describe('requireAuth', () => {\n        it('should return 401 without token', async () => {\n            const req = createMockRequest();\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            await requireAuth(req, res, next);\n            \n            expect(nextCalled).toBe(false);\n            expect(res.statusCode).toBe(401);\n            expect((res.jsonData as { error: string })?.error).toContain('인증이 필요합니다');\n        });\n\n        it('should return 401 with invalid token', async () => {\n            const req = createMockRequest({\n                headers: { authorization: 'Bearer invalid-token' }\n            });\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            await requireAuth(req, res, next);\n            \n            expect(nextCalled).toBe(false);\n            expect(res.statusCode).toBe(401);\n            expect((res.jsonData as { error: string })?.error).toContain('유효하지 않은 토큰');\n        });\n\n        it('should return 401 for unknown user', async () => {\n            const req = createMockRequest({\n                headers: { authorization: 'Bearer unknown-user-token' }\n            });\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            await requireAuth(req, res, next);\n            \n            expect(nextCalled).toBe(false);\n            expect(res.statusCode).toBe(401);\n            expect((res.jsonData as { error: string })?.error).toContain('사용자를 찾을 수 없습니다');\n        });\n\n        it('should return 403 for inactive user', async () => {\n            const req = createMockRequest({\n                headers: { authorization: 'Bearer inactive-user-token' }\n            });\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            await requireAuth(req, res, next);\n            \n            expect(nextCalled).toBe(false);\n            expect(res.statusCode).toBe(403);\n            expect((res.jsonData as { error: string })?.error).toContain('비활성화된 계정');\n        });\n\n        it('should pass with valid token', async () => {\n            const req = createMockRequest({\n                headers: { authorization: 'Bearer valid-user-token' }\n            });\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            await requireAuth(req, res, next);\n            \n            expect(nextCalled).toBe(true);\n            expect(req.user).toBeDefined();\n            expect(req.token).toBe('valid-user-token');\n        });\n    });\n\n    describe('requireAdmin', () => {\n        it('should return 401 without user', () => {\n            const req = createMockRequest();\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            requireAdmin(req, res, next);\n            \n            expect(nextCalled).toBe(false);\n            expect(res.statusCode).toBe(401);\n        });\n\n        it('should return 403 for non-admin user', () => {\n            const req = createMockRequest();\n            req.user = { userId: '1', role: 'user' };\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            requireAdmin(req, res, next);\n            \n            expect(nextCalled).toBe(false);\n            expect(res.statusCode).toBe(403);\n            expect((res.jsonData as { error: string })?.error).toContain('관리자 권한');\n        });\n\n        it('should pass for admin user', () => {\n            const req = createMockRequest();\n            req.user = { userId: '2', role: 'admin' };\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            requireAdmin(req, res, next);\n            \n            expect(nextCalled).toBe(true);\n        });\n    });\n\n    describe('requireRole', () => {\n        it('should return 401 without user', () => {\n            const req = createMockRequest();\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            const middleware = requireRole('user');\n            middleware(req, res, next);\n            \n            expect(nextCalled).toBe(false);\n            expect(res.statusCode).toBe(401);\n        });\n\n        it('should return 403 when user lacks required role', () => {\n            const req = createMockRequest();\n            req.user = { userId: '1', role: 'guest' };\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            const middleware = requireRole('user');\n            middleware(req, res, next);\n            \n            expect(nextCalled).toBe(false);\n            expect(res.statusCode).toBe(403);\n        });\n\n        it('should pass when user has required role', () => {\n            const req = createMockRequest();\n            req.user = { userId: '1', role: 'user' };\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            const middleware = requireRole('user');\n            middleware(req, res, next);\n            \n            expect(nextCalled).toBe(true);\n        });\n\n        it('should pass when user has higher role', () => {\n            const req = createMockRequest();\n            req.user = { userId: '2', role: 'admin' };\n            const res = createMockResponse();\n            let nextCalled = false;\n            const next: NextFunction = () => { nextCalled = true; };\n            \n            const middleware = requireRole('user');\n            middleware(req, res, next);\n            \n            expect(nextCalled).toBe(true);\n        });\n    });\n});\n"],"version":3}