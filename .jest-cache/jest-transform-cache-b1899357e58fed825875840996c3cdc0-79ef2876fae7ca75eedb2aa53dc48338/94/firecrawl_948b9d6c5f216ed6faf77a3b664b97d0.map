{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/firecrawl.ts","mappings":";AAAA;;;;GAIG;;;;;;;;;;;;AAyWH,sDAEC;AAKD,gDAKC;AAlXD,uCAA0C;AAE1C,+CAA+C;AAC/C,uBAAuB;AACvB,+CAA+C;AAE/C,MAAM,iBAAiB,GAAG,IAAA,eAAS,GAAE,CAAC,eAAe,IAAI,SAAS,CAAC;AACnE,MAAM,iBAAiB,GAAG,IAAA,eAAS,GAAE,CAAC,eAAe,CAAC;AA2BtD;;GAEG;AACH,SAAe,gBAAgB,CAAC,QAAgB,EAAE,IAA6B;;QAC3E,IAAI,CAAC,iBAAiB,EAAE,CAAC;YACrB,MAAM,IAAI,KAAK,CAAC,qCAAqC,CAAC,CAAC;QAC3D,CAAC;QAED,MAAM,GAAG,GAAG,GAAG,iBAAiB,GAAG,QAAQ,EAAE,CAAC;QAC9C,OAAO,CAAC,GAAG,CAAC,mBAAmB,QAAQ,EAAE,CAAC,CAAC;QAE3C,IAAI,CAAC;YACD,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,EAAE;gBAC9B,MAAM,EAAE,MAAM;gBACd,OAAO,EAAE;oBACL,cAAc,EAAE,kBAAkB;oBAClC,eAAe,EAAE,UAAU,iBAAiB,EAAE;iBACjD;gBACD,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;aAC7B,CAAC,CAAC;YAEH,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC;gBACf,MAAM,SAAS,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;gBACxC,MAAM,IAAI,KAAK,CAAC,qBAAqB,QAAQ,CAAC,MAAM,MAAM,SAAS,EAAE,CAAC,CAAC;YAC3E,CAAC;YAED,OAAO,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;QACjC,CAAC;QAAC,OAAO,KAAc,EAAE,CAAC;YACtB,OAAO,CAAC,KAAK,CAAC,oBAAoB,EAAE,CAAC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAC9F,MAAM,KAAK,CAAC;QAChB,CAAC;IACL,CAAC;CAAA;AAED,+CAA+C;AAC/C,sBAAsB;AACtB,+CAA+C;AAE/C;;GAEG;AACU,QAAA,mBAAmB,GAAsB;IAClD,IAAI,EAAE;QACF,IAAI,EAAE,kBAAkB;QACxB,WAAW,EAAE,uDAAuD;QACpE,WAAW,EAAE;YACT,IAAI,EAAE,QAAQ;YACd,UAAU,EAAE;gBACR,GAAG,EAAE;oBACD,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,WAAW;iBAC3B;gBACD,OAAO,EAAE;oBACL,IAAI,EAAE,OAAO;oBACb,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;oBACzB,WAAW,EAAE,oDAAoD;iBACpE;gBACD,eAAe,EAAE;oBACb,IAAI,EAAE,SAAS;oBACf,WAAW,EAAE,wCAAwC;iBACxD;gBACD,OAAO,EAAE;oBACL,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,kBAAkB;iBAClC;gBACD,OAAO,EAAE;oBACL,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,yBAAyB;iBACzC;aACJ;YACD,QAAQ,EAAE,CAAC,KAAK,CAAC;SACpB;KACJ;IACK,OAAO,CAAC,IAA6B;;;YACvC,IAAI,CAAC;gBACD,MAAM,GAAG,GAAG,IAAI,CAAC,GAAa,CAAC;gBAC/B,MAAM,OAAO,GAA2B;oBACpC,OAAO,EAAG,IAAI,CAAC,OAA6C,IAAI,CAAC,UAAU,CAAC;oBAC5E,eAAe,EAAE,IAAI,CAAC,eAAe,KAAK,KAAK;oBAC/C,OAAO,EAAE,IAAI,CAAC,OAAiB;oBAC/B,OAAO,EAAG,IAAI,CAAC,OAAkB,IAAI,KAAK;iBAC7C,CAAC;gBAEF,MAAM,MAAM,GAAG,MAAM,gBAAgB,CAAC,SAAS,kBAAI,GAAG,IAAK,OAAO,EAAG,CAAC;gBAEtE,IAAI,OAAO,GAAG,EAAE,CAAC;gBACjB,IAAI,MAAA,MAAM,CAAC,IAAI,0CAAE,QAAQ,EAAE,CAAC;oBACxB,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;gBACnC,CAAC;qBAAM,IAAI,MAAA,MAAM,CAAC,IAAI,0CAAE,IAAI,EAAE,CAAC;oBAC3B,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;gBAC/B,CAAC;qBAAM,CAAC;oBACJ,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;gBACnD,CAAC;gBAED,OAAO;oBACH,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,QAAQ,GAAG,iBAAiB,OAAO,EAAE,EAAE,CAAC;oBACxE,OAAO,EAAE,KAAK;iBACjB,CAAC;YACN,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACtB,OAAO;oBACH,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,cAAc,CAAC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;oBAC3G,OAAO,EAAE,IAAI;iBAChB,CAAC;YACN,CAAC;QACL,CAAC;KAAA;CACJ,CAAC;AAEF;;GAEG;AACU,QAAA,mBAAmB,GAAsB;IAClD,IAAI,EAAE;QACF,IAAI,EAAE,kBAAkB;QACxB,WAAW,EAAE,oCAAoC;QACjD,WAAW,EAAE;YACT,IAAI,EAAE,QAAQ;YACd,UAAU,EAAE;gBACR,KAAK,EAAE;oBACH,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,OAAO;iBACvB;gBACD,KAAK,EAAE;oBACH,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,iBAAiB;iBACjC;gBACD,IAAI,EAAE;oBACF,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,+BAA+B;iBAC/C;gBACD,OAAO,EAAE;oBACL,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,2BAA2B;iBAC3C;gBACD,aAAa,EAAE;oBACX,IAAI,EAAE,SAAS;oBACf,WAAW,EAAE,iCAAiC;iBACjD;aACJ;YACD,QAAQ,EAAE,CAAC,OAAO,CAAC;SACtB;KACJ;IACK,OAAO,CAAC,IAA6B;;;YACvC,IAAI,CAAC;gBACD,MAAM,KAAK,GAAG,IAAI,CAAC,KAAe,CAAC;gBACnC,MAAM,OAAO,GAA2B;oBACpC,KAAK,EAAG,IAAI,CAAC,KAAgB,IAAI,CAAC;oBAClC,IAAI,EAAG,IAAI,CAAC,IAAe,IAAI,IAAI;oBACnC,OAAO,EAAG,IAAI,CAAC,OAAkB,IAAI,IAAI;iBAC5C,CAAC;gBAEF,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;oBACrB,OAAO,CAAC,aAAa,GAAG;wBACpB,OAAO,EAAE,CAAC,UAAU,CAAC;wBACrB,eAAe,EAAE,IAAI;qBACxB,CAAC;gBACN,CAAC;gBAED,MAAM,MAAM,GAAG,MAAM,gBAAgB,CAAC,SAAS,kBAAI,KAAK,IAAK,OAAO,EAAG,CAAC;gBAExE,IAAI,MAAM,GAAG,SAAS,KAAK,cAAc,CAAA,MAAA,MAAM,CAAC,IAAI,0CAAE,MAAM,KAAI,CAAC,QAAQ,CAAC;gBAE1E,IAAI,MAAM,CAAC,IAAI,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC;oBAC5C,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAA+E,EAAE,KAAa,EAAE,EAAE;wBACnH,MAAM,IAAI,OAAO,KAAK,GAAG,CAAC,KAAK,IAAI,CAAC,KAAK,IAAI,OAAO,IAAI,CAAC;wBACzD,MAAM,IAAI,MAAM,IAAI,CAAC,GAAG,IAAI,CAAC;wBAC7B,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;4BACnB,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,IAAI,CAAC;wBACtC,CAAC;wBACD,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;4BAChB,MAAM,IAAI,UAAU,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC;wBACxG,CAAC;wBACD,MAAM,IAAI,IAAI,CAAC;oBACnB,CAAC,CAAC,CAAC;gBACP,CAAC;gBAED,OAAO;oBACH,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;oBACzC,OAAO,EAAE,KAAK;iBACjB,CAAC;YACN,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACtB,OAAO;oBACH,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,YAAY,CAAC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;oBACzG,OAAO,EAAE,IAAI;iBAChB,CAAC;YACN,CAAC;QACL,CAAC;KAAA;CACJ,CAAC;AAEF;;GAEG;AACU,QAAA,gBAAgB,GAAsB;IAC/C,IAAI,EAAE;QACF,IAAI,EAAE,eAAe;QACrB,WAAW,EAAE,mCAAmC;QAChD,WAAW,EAAE;YACT,IAAI,EAAE,QAAQ;YACd,UAAU,EAAE;gBACR,GAAG,EAAE;oBACD,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,cAAc;iBAC9B;gBACD,MAAM,EAAE;oBACJ,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,iBAAiB;iBACjC;gBACD,KAAK,EAAE;oBACH,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,oBAAoB;iBACpC;gBACD,iBAAiB,EAAE;oBACf,IAAI,EAAE,SAAS;oBACf,WAAW,EAAE,yBAAyB;iBACzC;aACJ;YACD,QAAQ,EAAE,CAAC,KAAK,CAAC;SACpB;KACJ;IACK,OAAO,CAAC,IAA6B;;YACvC,IAAI,CAAC;gBACD,MAAM,GAAG,GAAG,IAAI,CAAC,GAAa,CAAC;gBAC/B,MAAM,OAAO,GAAwB;oBACjC,MAAM,EAAE,IAAI,CAAC,MAAgB;oBAC7B,KAAK,EAAG,IAAI,CAAC,KAAgB,IAAI,GAAG;oBACpC,iBAAiB,EAAE,IAAI,CAAC,iBAA4B;iBACvD,CAAC;gBAEF,MAAM,MAAM,GAAG,MAAM,gBAAgB,CAAC,MAAM,kBAAI,GAAG,IAAK,OAAO,EAAG,CAAC;gBAEnE,MAAM,IAAI,GAAG,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,IAAI,IAAI,EAAE,CAAC;gBAC/C,IAAI,MAAM,GAAG,SAAS,GAAG,iBAAiB,IAAI,CAAC,MAAM,WAAW,CAAC;gBAEjE,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,IAAY,EAAE,KAAa,EAAE,EAAE;oBACtD,MAAM,IAAI,GAAG,KAAK,GAAG,CAAC,KAAK,IAAI,IAAI,CAAC;gBACxC,CAAC,CAAC,CAAC;gBAEH,IAAI,IAAI,CAAC,MAAM,GAAG,EAAE,EAAE,CAAC;oBACnB,MAAM,IAAI,WAAW,IAAI,CAAC,MAAM,GAAG,EAAE,KAAK,CAAC;gBAC/C,CAAC;gBAED,OAAO;oBACH,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;oBACzC,OAAO,EAAE,KAAK;iBACjB,CAAC;YACN,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACtB,OAAO;oBACH,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,gBAAgB,CAAC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;oBAC7G,OAAO,EAAE,IAAI;iBAChB,CAAC;YACN,CAAC;QACL,CAAC;KAAA;CACJ,CAAC;AAEF;;GAEG;AACU,QAAA,kBAAkB,GAAsB;IACjD,IAAI,EAAE;QACF,IAAI,EAAE,iBAAiB;QACvB,WAAW,EAAE,0CAA0C;QACvD,WAAW,EAAE;YACT,IAAI,EAAE,QAAQ;YACd,UAAU,EAAE;gBACR,GAAG,EAAE;oBACD,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,YAAY;iBAC5B;gBACD,KAAK,EAAE;oBACH,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,uBAAuB;iBACvC;gBACD,QAAQ,EAAE;oBACN,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,mBAAmB;iBACnC;gBACD,YAAY,EAAE;oBACV,IAAI,EAAE,OAAO;oBACb,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;oBACzB,WAAW,EAAE,6BAA6B;iBAC7C;aACJ;YACD,QAAQ,EAAE,CAAC,KAAK,CAAC;SACpB;KACJ;IACK,OAAO,CAAC,IAA6B;;YACvC,IAAI,CAAC;gBACD,MAAM,GAAG,GAAG,IAAI,CAAC,GAAa,CAAC;gBAC/B,MAAM,OAAO,GAAG;oBACZ,KAAK,EAAG,IAAI,CAAC,KAAgB,IAAI,EAAE;oBACnC,QAAQ,EAAG,IAAI,CAAC,QAAmB,IAAI,CAAC;oBACxC,YAAY,EAAE,IAAI,CAAC,YAAwB;iBAC9C,CAAC;gBAEF,MAAM,MAAM,GAAG,MAAM,gBAAgB,CAAC,QAAQ,kBAAI,GAAG,IAAK,OAAO,EAAG,CAAC;gBAErE,OAAO;oBACH,OAAO,EAAE,CAAC;4BACN,IAAI,EAAE,MAAM;4BACZ,IAAI,EAAE,kCAAkC,MAAM,CAAC,EAAE,IAAI,MAAM,CAAC,KAAK,eAAe,MAAM,CAAC,MAAM,IAAI,QAAQ,wDAAwD;yBACpK,CAAC;oBACF,OAAO,EAAE,KAAK;iBACjB,CAAC;YACN,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACtB,OAAO;oBACH,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,gBAAgB,CAAC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;oBAC7G,OAAO,EAAE,IAAI;iBAChB,CAAC;YACN,CAAC;QACL,CAAC;KAAA;CACJ,CAAC;AAEF,+CAA+C;AAC/C,yBAAyB;AACzB,+CAA+C;AAElC,QAAA,cAAc,GAAwB;IAC/C,2BAAmB;IACnB,2BAAmB;IACnB,wBAAgB;IAChB,0BAAkB;CACrB,CAAC;AAEF;;GAEG;AACH,SAAgB,qBAAqB;IACjC,OAAO,CAAC,CAAC,iBAAiB,CAAC;AAC/B,CAAC;AAED;;GAEG;AACH,SAAgB,kBAAkB;IAC9B,OAAO;QACH,UAAU,EAAE,qBAAqB,EAAE;QACnC,MAAM,EAAE,iBAAiB;KAC5B,CAAC;AACN,CAAC","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/firecrawl.ts"],"sourcesContent":["/**\n * Firecrawl MCP ÎèÑÍµ¨\n * Ïõπ Ïä§ÌÅ¨ÎûòÌïë, Í≤ÄÏÉâ, URL Îß§ÌïëÏùÑ ÏúÑÌïú MCP ÎèÑÍµ¨\n * https://github.com/firecrawl/firecrawl-mcp-server\n */\n\nimport { MCPToolDefinition, MCPToolResult } from './types';\nimport { getConfig } from '../config/env';\n\n// ============================================\n// Firecrawl API Client\n// ============================================\n\nconst FIRECRAWL_API_KEY = getConfig().firecrawlApiKey || undefined;\nconst FIRECRAWL_API_URL = getConfig().firecrawlApiUrl;\n\ninterface FirecrawlScrapeOptions {\n    formats?: ('markdown' | 'html' | 'rawHtml' | 'links' | 'screenshot')[];\n    onlyMainContent?: boolean;\n    includeTags?: string[];\n    excludeTags?: string[];\n    waitFor?: number;\n    timeout?: number;\n    mobile?: boolean;\n}\n\ninterface FirecrawlSearchOptions {\n    limit?: number;\n    lang?: string;\n    country?: string;\n    scrapeOptions?: FirecrawlScrapeOptions;\n}\n\ninterface FirecrawlMapOptions {\n    search?: string;\n    ignoreSitemap?: boolean;\n    sitemapOnly?: boolean;\n    includeSubdomains?: boolean;\n    limit?: number;\n}\n\n/**\n * Firecrawl API Ìò∏Ï∂ú Ìó¨Ìçº\n */\nasync function firecrawlRequest(endpoint: string, data: Record<string, unknown>): Promise<any> {\n    if (!FIRECRAWL_API_KEY) {\n        throw new Error('FIRECRAWL_API_KEY ÌôòÍ≤ΩÎ≥ÄÏàòÍ∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');\n    }\n\n    const url = `${FIRECRAWL_API_URL}${endpoint}`;\n    console.log(`[Firecrawl] ÏöîÏ≤≠: ${endpoint}`);\n\n    try {\n        const response = await fetch(url, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${FIRECRAWL_API_KEY}`\n            },\n            body: JSON.stringify(data)\n        });\n\n        if (!response.ok) {\n            const errorText = await response.text();\n            throw new Error(`Firecrawl API Ïò§Î•ò (${response.status}): ${errorText}`);\n        }\n\n        return await response.json();\n    } catch (error: unknown) {\n        console.error(`[Firecrawl] ÏöîÏ≤≠ Ïã§Ìå®:`, (error instanceof Error ? error.message : String(error)));\n        throw error;\n    }\n}\n\n// ============================================\n// Firecrawl MCP Tools\n// ============================================\n\n/**\n * Ïõπ ÌéòÏù¥ÏßÄ Ïä§ÌÅ¨ÎûòÌïë ÎèÑÍµ¨\n */\nexport const firecrawlScrapeTool: MCPToolDefinition = {\n    tool: {\n        name: 'firecrawl_scrape',\n        description: 'URLÏóêÏÑú Ïõπ ÏΩòÌÖêÏ∏†Î•º Ïä§ÌÅ¨ÎûòÌïëÌï©ÎãàÎã§. ÎßàÌÅ¨Îã§Ïö¥, HTML Îì± Îã§ÏñëÌïú ÌòïÏãùÏúºÎ°ú Ï∂îÏ∂ú Í∞ÄÎä•Ìï©ÎãàÎã§.',\n        inputSchema: {\n            type: 'object',\n            properties: {\n                url: {\n                    type: 'string',\n                    description: 'Ïä§ÌÅ¨ÎûòÌïëÌï† URL'\n                },\n                formats: {\n                    type: 'array',\n                    items: { type: 'string' },\n                    description: 'Ï∂úÎ†• ÌòïÏãù (markdown, html, links Îì±). Í∏∞Î≥∏Í∞í: [\"markdown\"]'\n                },\n                onlyMainContent: {\n                    type: 'boolean',\n                    description: 'Î©îÏù∏ ÏΩòÌÖêÏ∏†Îßå Ï∂îÏ∂ú (nav, footer Ï†úÏô∏). Í∏∞Î≥∏Í∞í: true'\n                },\n                waitFor: {\n                    type: 'number',\n                    description: 'ÌéòÏù¥ÏßÄ Î°úÎî© ÎåÄÍ∏∞ ÏãúÍ∞Ñ(ms)'\n                },\n                timeout: {\n                    type: 'number',\n                    description: 'ÏöîÏ≤≠ ÌÉÄÏûÑÏïÑÏõÉ(ms). Í∏∞Î≥∏Í∞í: 30000'\n                }\n            },\n            required: ['url']\n        }\n    },\n    async handler(args: Record<string, unknown>): Promise<MCPToolResult> {\n        try {\n            const url = args.url as string;\n            const options: FirecrawlScrapeOptions = {\n                formats: (args.formats as FirecrawlScrapeOptions['formats']) || ['markdown'],\n                onlyMainContent: args.onlyMainContent !== false,\n                waitFor: args.waitFor as number,\n                timeout: (args.timeout as number) || 30000\n            };\n\n            const result = await firecrawlRequest('/scrape', { url, ...options });\n\n            let content = '';\n            if (result.data?.markdown) {\n                content = result.data.markdown;\n            } else if (result.data?.html) {\n                content = result.data.html;\n            } else {\n                content = JSON.stringify(result.data, null, 2);\n            }\n\n            return {\n                content: [{ type: 'text', text: `üìÑ **${url}** Ïä§ÌÅ¨ÎûòÌïë ÏôÑÎ£å\\n\\n${content}` }],\n                isError: false\n            };\n        } catch (error: unknown) {\n            return {\n                content: [{ type: 'text', text: `‚ùå Ïä§ÌÅ¨ÎûòÌïë Ïã§Ìå®: ${(error instanceof Error ? error.message : String(error))}` }],\n                isError: true\n            };\n        }\n    }\n};\n\n/**\n * Ïõπ Í≤ÄÏÉâ ÎèÑÍµ¨ (Firecrawl)\n */\nexport const firecrawlSearchTool: MCPToolDefinition = {\n    tool: {\n        name: 'firecrawl_search',\n        description: 'ÏõπÏùÑ Í≤ÄÏÉâÌïòÍ≥† Í≤ÄÏÉâ Í≤∞Í≥ºÏùò ÏΩòÌÖêÏ∏†Î•º ÏÑ†ÌÉùÏ†ÅÏúºÎ°ú Ïä§ÌÅ¨ÎûòÌïëÌï©ÎãàÎã§.',\n        inputSchema: {\n            type: 'object',\n            properties: {\n                query: {\n                    type: 'string',\n                    description: 'Í≤ÄÏÉâ ÏøºÎ¶¨'\n                },\n                limit: {\n                    type: 'number',\n                    description: 'ÏµúÎåÄ Í≤∞Í≥º Ïàò. Í∏∞Î≥∏Í∞í: 5'\n                },\n                lang: {\n                    type: 'string',\n                    description: 'Í≤ÄÏÉâ Ïñ∏Ïñ¥ (ko, en, ja Îì±). Í∏∞Î≥∏Í∞í: ko'\n                },\n                country: {\n                    type: 'string',\n                    description: 'Í≤ÄÏÉâ Íµ≠Í∞Ä (kr, us Îì±). Í∏∞Î≥∏Í∞í: kr'\n                },\n                scrapeContent: {\n                    type: 'boolean',\n                    description: 'Í≤ÄÏÉâ Í≤∞Í≥º ÌéòÏù¥ÏßÄ ÏΩòÌÖêÏ∏†ÎèÑ Ïä§ÌÅ¨ÎûòÌïë. Í∏∞Î≥∏Í∞í: false'\n                }\n            },\n            required: ['query']\n        }\n    },\n    async handler(args: Record<string, unknown>): Promise<MCPToolResult> {\n        try {\n            const query = args.query as string;\n            const options: FirecrawlSearchOptions = {\n                limit: (args.limit as number) || 5,\n                lang: (args.lang as string) || 'ko',\n                country: (args.country as string) || 'kr'\n            };\n\n            if (args.scrapeContent) {\n                options.scrapeOptions = {\n                    formats: ['markdown'],\n                    onlyMainContent: true\n                };\n            }\n\n            const result = await firecrawlRequest('/search', { query, ...options });\n\n            let output = `üîç **\"${query}\"** Í≤ÄÏÉâ Í≤∞Í≥º (${result.data?.length || 0}Í±¥)\\n\\n`;\n\n            if (result.data && Array.isArray(result.data)) {\n                result.data.forEach((item: { title?: string; url?: string; description?: string; markdown?: string }, index: number) => {\n                    output += `### ${index + 1}. ${item.title || 'Ï†úÎ™© ÏóÜÏùå'}\\n`;\n                    output += `üîó ${item.url}\\n`;\n                    if (item.description) {\n                        output += `${item.description}\\n`;\n                    }\n                    if (item.markdown) {\n                        output += `\\n---\\n${item.markdown.substring(0, 1000)}${item.markdown.length > 1000 ? '...' : ''}\\n`;\n                    }\n                    output += '\\n';\n                });\n            }\n\n            return {\n                content: [{ type: 'text', text: output }],\n                isError: false\n            };\n        } catch (error: unknown) {\n            return {\n                content: [{ type: 'text', text: `‚ùå Í≤ÄÏÉâ Ïã§Ìå®: ${(error instanceof Error ? error.message : String(error))}` }],\n                isError: true\n            };\n        }\n    }\n};\n\n/**\n * URL Îß§Ìïë ÎèÑÍµ¨ (ÏÇ¨Ïù¥Ìä∏ Íµ¨Ï°∞ ÌååÏïÖ)\n */\nexport const firecrawlMapTool: MCPToolDefinition = {\n    tool: {\n        name: 'firecrawl_map',\n        description: 'ÏõπÏÇ¨Ïù¥Ìä∏Ïùò Î™®Îì† URLÏùÑ Îß§ÌïëÌïòÏó¨ ÏÇ¨Ïù¥Ìä∏ Íµ¨Ï°∞Î•º ÌååÏïÖÌï©ÎãàÎã§.',\n        inputSchema: {\n            type: 'object',\n            properties: {\n                url: {\n                    type: 'string',\n                    description: 'Îß§ÌïëÌï† ÏõπÏÇ¨Ïù¥Ìä∏ URL'\n                },\n                search: {\n                    type: 'string',\n                    description: 'ÌäπÏ†ï Ìå®ÌÑ¥Ïùò URLÎßå ÌïÑÌÑ∞ÎßÅ'\n                },\n                limit: {\n                    type: 'number',\n                    description: 'ÏµúÎåÄ URL Ïàò. Í∏∞Î≥∏Í∞í: 100'\n                },\n                includeSubdomains: {\n                    type: 'boolean',\n                    description: 'ÏÑúÎ∏åÎèÑÎ©îÏù∏ Ìè¨Ìï® Ïó¨Î∂Ä. Í∏∞Î≥∏Í∞í: false'\n                }\n            },\n            required: ['url']\n        }\n    },\n    async handler(args: Record<string, unknown>): Promise<MCPToolResult> {\n        try {\n            const url = args.url as string;\n            const options: FirecrawlMapOptions = {\n                search: args.search as string,\n                limit: (args.limit as number) || 100,\n                includeSubdomains: args.includeSubdomains as boolean\n            };\n\n            const result = await firecrawlRequest('/map', { url, ...options });\n\n            const urls = result.links || result.data || [];\n            let output = `üó∫Ô∏è **${url}** URL Îß§Ìïë Í≤∞Í≥º (${urls.length}Í∞ú Î∞úÍ≤¨)\\n\\n`;\n\n            urls.slice(0, 50).forEach((link: string, index: number) => {\n                output += `${index + 1}. ${link}\\n`;\n            });\n\n            if (urls.length > 50) {\n                output += `\\n... Ïô∏ ${urls.length - 50}Í∞ú Îçî`;\n            }\n\n            return {\n                content: [{ type: 'text', text: output }],\n                isError: false\n            };\n        } catch (error: unknown) {\n            return {\n                content: [{ type: 'text', text: `‚ùå URL Îß§Ìïë Ïã§Ìå®: ${(error instanceof Error ? error.message : String(error))}` }],\n                isError: true\n            };\n        }\n    }\n};\n\n/**\n * ÌÅ¨Î°§ÎßÅ ÏãúÏûë ÎèÑÍµ¨ (ÎπÑÎèôÍ∏∞)\n */\nexport const firecrawlCrawlTool: MCPToolDefinition = {\n    tool: {\n        name: 'firecrawl_crawl',\n        description: 'ÏõπÏÇ¨Ïù¥Ìä∏Î•º ÌÅ¨Î°§ÎßÅÌïòÏó¨ Ïó¨Îü¨ ÌéòÏù¥ÏßÄÏùò ÏΩòÌÖêÏ∏†Î•º ÏàòÏßëÌï©ÎãàÎã§ (ÎπÑÎèôÍ∏∞ ÏûëÏóÖ).',\n        inputSchema: {\n            type: 'object',\n            properties: {\n                url: {\n                    type: 'string',\n                    description: 'ÌÅ¨Î°§ÎßÅ ÏãúÏûë URL'\n                },\n                limit: {\n                    type: 'number',\n                    description: 'ÏµúÎåÄ ÌÅ¨Î°§ÎßÅ ÌéòÏù¥ÏßÄ Ïàò. Í∏∞Î≥∏Í∞í: 10'\n                },\n                maxDepth: {\n                    type: 'number',\n                    description: 'ÏµúÎåÄ ÌÅ¨Î°§ÎßÅ ÍπäÏù¥. Í∏∞Î≥∏Í∞í: 2'\n                },\n                excludePaths: {\n                    type: 'array',\n                    items: { type: 'string' },\n                    description: 'Ï†úÏô∏Ìï† Í≤ΩÎ°ú Ìå®ÌÑ¥ (Ïòà: [\"/admin/*\"])'\n                }\n            },\n            required: ['url']\n        }\n    },\n    async handler(args: Record<string, unknown>): Promise<MCPToolResult> {\n        try {\n            const url = args.url as string;\n            const options = {\n                limit: (args.limit as number) || 10,\n                maxDepth: (args.maxDepth as number) || 2,\n                excludePaths: args.excludePaths as string[]\n            };\n\n            const result = await firecrawlRequest('/crawl', { url, ...options });\n\n            return {\n                content: [{\n                    type: 'text',\n                    text: `üï∑Ô∏è ÌÅ¨Î°§ÎßÅ ÏûëÏóÖ ÏãúÏûëÎê®\\n\\n- **ÏûëÏóÖ ID**: ${result.id || result.jobId}\\n- **ÏÉÅÌÉú**: ${result.status || 'queued'}\\n\\n\\`firecrawl_check_crawl_status\\` ÎèÑÍµ¨Î°ú ÏßÑÌñâ ÏÉÅÌô©ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.`\n                }],\n                isError: false\n            };\n        } catch (error: unknown) {\n            return {\n                content: [{ type: 'text', text: `‚ùå ÌÅ¨Î°§ÎßÅ ÏãúÏûë Ïã§Ìå®: ${(error instanceof Error ? error.message : String(error))}` }],\n                isError: true\n            };\n        }\n    }\n};\n\n// ============================================\n// Firecrawl Tools Export\n// ============================================\n\nexport const firecrawlTools: MCPToolDefinition[] = [\n    firecrawlScrapeTool,\n    firecrawlSearchTool,\n    firecrawlMapTool,\n    firecrawlCrawlTool\n];\n\n/**\n * Firecrawl API ÌÇ§ ÏÑ§Ï†ï Ïó¨Î∂Ä ÌôïÏù∏\n */\nexport function isFirecrawlConfigured(): boolean {\n    return !!FIRECRAWL_API_KEY;\n}\n\n/**\n * Firecrawl ÏÉÅÌÉú Ï†ïÎ≥¥\n */\nexport function getFirecrawlStatus(): { configured: boolean; apiUrl: string } {\n    return {\n        configured: isFirecrawlConfigured(),\n        apiUrl: FIRECRAWL_API_URL\n    };\n}\n"],"version":3}