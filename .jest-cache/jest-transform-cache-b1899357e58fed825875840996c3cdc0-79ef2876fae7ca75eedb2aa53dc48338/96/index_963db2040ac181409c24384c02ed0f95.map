{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/auth/index.ts","mappings":";AAAA;;;GAGG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BH,sCAQC;AAKD,kCAQC;AAKD,oCASC;AAKD,sCAQC;AAKD,0BAEC;AAnFD,kDAAoC;AAGpC,+CAAiC;AAEjC,2CAA2C;AAC3C,MAAM,iBAAiB,GAAG,GAAG,EAAE;IAC3B,OAAO,eAAe,MAAM,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC;AACnE,CAAC,CAAC;AAEF,MAAM,UAAU,GAAG,OAAO,CAAC,GAAG,CAAC,UAAU,IAAI,iBAAiB,EAAE,CAAC;AACjE,MAAM,cAAc,GAAG,KAAK,CAAC,CAAE,0CAA0C;AACzE,MAAM,wBAAwB,GAAG,IAAI,CAAC,CAAE,+BAA+B;AAEvE,oBAAoB;AACpB,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC;IAC1B,OAAO,CAAC,IAAI,CAAC,wCAAwC,CAAC,CAAC;IACvD,OAAO,CAAC,IAAI,CAAC,2DAA2D,CAAC,CAAC;IAC1E,OAAO,CAAC,IAAI,CAAC,+CAA+C,CAAC,CAAC;IAC9D,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,YAAY,EAAE,CAAC;QACxC,MAAM,IAAI,KAAK,CAAC,2CAA2C,CAAC,CAAC;IACjE,CAAC;AACL,CAAC;AAGD;;GAEG;AACH,SAAgB,aAAa,CAAC,IAAgB;IAC1C,MAAM,OAAO,GAAe;QACxB,MAAM,EAAE,IAAI,CAAC,EAAE;QACf,KAAK,EAAE,IAAI,CAAC,KAAK;QACjB,IAAI,EAAE,IAAI,CAAC,IAAI;KAClB,CAAC;IAEF,OAAO,GAAG,CAAC,IAAI,CAAC,OAAO,EAAE,UAAU,EAAE,EAAE,SAAS,EAAE,cAAc,EAAE,CAAC,CAAC;AACxE,CAAC;AAED;;GAEG;AACH,SAAgB,WAAW,CAAC,KAAa;IACrC,IAAI,CAAC;QACD,MAAM,OAAO,GAAG,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,UAAU,CAA0B,CAAC;QACvE,OAAO,OAAO,CAAC;IACnB,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACb,OAAO,CAAC,KAAK,CAAC,kBAAkB,EAAE,KAAK,CAAC,CAAC;QACzC,OAAO,IAAI,CAAC;IAChB,CAAC;AACL,CAAC;AAED;;GAEG;AACH,SAAgB,YAAY,CAAC,UAAmB;IAC5C,IAAI,CAAC,UAAU;QAAE,OAAO,IAAI,CAAC;IAE7B,sBAAsB;IACtB,IAAI,UAAU,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE,CAAC;QACnC,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAC/B,CAAC;IAED,OAAO,UAAU,CAAC;AACtB,CAAC;AAED;;GAEG;AACH,SAAgB,aAAa,CAAC,QAAkB,EAAE,YAAsB;IACpE,MAAM,aAAa,GAA6B;QAC5C,OAAO,EAAE,CAAC;QACV,MAAM,EAAE,CAAC;QACT,OAAO,EAAE,CAAC;KACb,CAAC;IAEF,OAAO,aAAa,CAAC,QAAQ,CAAC,IAAI,aAAa,CAAC,YAAY,CAAC,CAAC;AAClE,CAAC;AAED;;GAEG;AACH,SAAgB,OAAO,CAAC,IAAc;IAClC,OAAO,IAAI,KAAK,OAAO,CAAC;AAC5B,CAAC;AAED,cAAc;AACd,0CAAwB;AACxB,2CAAoF;AAA3E,0GAAA,YAAY,OAAA;AAAE,yGAAA,WAAW,OAAA;AAAE,0GAAA,YAAY,OAAA;AAAE,yGAAA,WAAW,OAAA","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/auth/index.ts"],"sourcesContent":["/**\n * 인증 모듈\n * JWT 토큰 생성/검증 및 인증 유틸리티\n */\n\nimport * as jwt from 'jsonwebtoken';\nimport { JWTPayload } from './types';\nimport { PublicUser, UserRole } from '../data/user-manager';\nimport * as crypto from 'crypto';\n\n// JWT 비밀키 (환경변수 필수, 개발환경에서는 세션별 랜덤 시크릿 생성)\nconst generateDevSecret = () => {\n    return `dev-session-${crypto.randomBytes(32).toString('hex')}`;\n};\n\nconst JWT_SECRET = process.env.JWT_SECRET || generateDevSecret();\nconst JWT_EXPIRES_IN = '15m';  // Access token - short lived for security\nconst REFRESH_TOKEN_EXPIRES_IN = '7d';  // Refresh token - longer lived\n\n// JWT_SECRET 미설정 경고\nif (!process.env.JWT_SECRET) {\n    console.warn('[Auth] ⚠️ JWT_SECRET 환경변수가 설정되지 않았습니다!');\n    console.warn('[Auth] 개발 환경용 세션 시크릿이 자동 생성되었습니다. 서버 재시작 시 기존 토큰이 무효화됩니다.');\n    console.warn('[Auth] 보안을 위해 .env 파일에 JWT_SECRET을 반드시 설정하세요.');\n    if (process.env.NODE_ENV === 'production') {\n        throw new Error('[Auth] 프로덕션 환경에서는 JWT_SECRET 환경변수가 필수입니다!');\n    }\n}\n\n\n/**\n * JWT 토큰 생성\n */\nexport function generateToken(user: PublicUser): string {\n    const payload: JWTPayload = {\n        userId: user.id,\n        email: user.email,\n        role: user.role\n    };\n\n    return jwt.sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN });\n}\n\n/**\n * JWT 토큰 검증\n */\nexport function verifyToken(token: string): JWTPayload | null {\n    try {\n        const decoded = jwt.verify(token, JWT_SECRET) as unknown as JWTPayload;\n        return decoded;\n    } catch (error) {\n        console.error('[Auth] 토큰 검증 실패:', error);\n        return null;\n    }\n}\n\n/**\n * Authorization 헤더에서 토큰 추출\n */\nexport function extractToken(authHeader?: string): string | null {\n    if (!authHeader) return null;\n\n    // \"Bearer <token>\" 형식\n    if (authHeader.startsWith('Bearer ')) {\n        return authHeader.slice(7);\n    }\n\n    return authHeader;\n}\n\n/**\n * 역할 권한 체크\n */\nexport function hasPermission(userRole: UserRole, requiredRole: UserRole): boolean {\n    const roleHierarchy: Record<UserRole, number> = {\n        'admin': 3,\n        'user': 2,\n        'guest': 1\n    };\n\n    return roleHierarchy[userRole] >= roleHierarchy[requiredRole];\n}\n\n/**\n * 관리자 여부 확인\n */\nexport function isAdmin(role: UserRole): boolean {\n    return role === 'admin';\n}\n\n// 모듈 재-export\nexport * from './types';\nexport { optionalAuth, requireAuth, requireAdmin, requireRole } from './middleware';\n"],"version":3}