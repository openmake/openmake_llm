{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/errors/key-exhaustion.error.ts","mappings":";;;AAAA;;;GAGG;AACH,MAAa,kBAAmB,SAAQ,KAAK;IAUzC,YAAY,SAAe,EAAE,SAAiB,EAAE,cAAsB;QAClE,MAAM,iBAAiB,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC;QAC5F,MAAM,OAAO,GAAG,2BAA2B,cAAc,IAAI,SAAS,8BAA8B,iBAAiB,GAAG,CAAC;QACzH,KAAK,CAAC,OAAO,CAAC,CAAC;QACf,IAAI,CAAC,IAAI,GAAG,oBAAoB,CAAC;QACjC,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,iBAAiB,GAAG,iBAAiB,CAAC;QAC3C,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,cAAc,GAAG,cAAc,CAAC;IACzC,CAAC;IAED;;OAEG;IACH,iBAAiB,CAAC,WAAwB,IAAI;QAC1C,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,iBAAiB,GAAG,EAAE,CAAC,CAAC;QAEvD,IAAI,QAAQ,KAAK,IAAI,EAAE,CAAC;YACpB,OAAO,iCAAiC;gBACjC,KAAK,OAAO,mBAAmB;gBAC/B,IAAI,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,SAAS,YAAY,CAAC;QACjE,CAAC;aAAM,CAAC;YACJ,OAAO,gDAAgD;gBAChD,6BAA6B,OAAO,aAAa;gBACjD,IAAI,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,SAAS,oBAAoB,CAAC;QACzE,CAAC;IACL,CAAC;CACJ;AArCD,gDAqCC","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/errors/key-exhaustion.error.ts"],"sourcesContent":["/**\n * Error thrown when all API keys are exhausted (rate limited).\n * Contains information about when keys will reset.\n */\nexport class KeyExhaustionError extends Error {\n    /** Timestamp when the next key will be available (earliest reset time) */\n    public readonly resetTime: Date;\n    /** Seconds until the next key is available */\n    public readonly retryAfterSeconds: number;\n    /** Total number of API keys configured */\n    public readonly totalKeys: number;\n    /** Number of keys currently in cooldown */\n    public readonly keysInCooldown: number;\n\n    constructor(resetTime: Date, totalKeys: number, keysInCooldown: number) {\n        const retryAfterSeconds = Math.max(0, Math.ceil((resetTime.getTime() - Date.now()) / 1000));\n        const message = `All API keys exhausted (${keysInCooldown}/${totalKeys} in cooldown). Retry after ${retryAfterSeconds}s`;\n        super(message);\n        this.name = 'KeyExhaustionError';\n        this.resetTime = resetTime;\n        this.retryAfterSeconds = retryAfterSeconds;\n        this.totalKeys = totalKeys;\n        this.keysInCooldown = keysInCooldown;\n    }\n\n    /**\n     * Get a user-friendly message for display\n     */\n    getDisplayMessage(language: 'ko' | 'en' = 'ko'): string {\n        const minutes = Math.ceil(this.retryAfterSeconds / 60);\n        \n        if (language === 'ko') {\n            return `⚠️ 모든 API 키가 일시적으로 사용 불가능합니다.\\n` +\n                   `약 ${minutes}분 후에 다시 시도해주세요.\\n` +\n                   `(${this.keysInCooldown}/${this.totalKeys}개 키 쿨다운 중)`;\n        } else {\n            return `⚠️ All API keys are temporarily unavailable.\\n` +\n                   `Please try again in about ${minutes} minutes.\\n` +\n                   `(${this.keysInCooldown}/${this.totalKeys} keys in cooldown)`;\n        }\n    }\n}\n"],"version":3}