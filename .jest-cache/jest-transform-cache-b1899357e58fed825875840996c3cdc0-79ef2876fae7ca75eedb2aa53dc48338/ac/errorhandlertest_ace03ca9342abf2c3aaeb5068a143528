cf3e4bfc50c444b32d32a1eabecfd70e
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock logger
jest.mock('../utils/logger', () => ({
    createLogger: () => ({
        error: jest.fn(),
        info: jest.fn(),
        warn: jest.fn(),
        debug: jest.fn()
    })
}));
/**
 * Error Handler Tests
 */
const error_handler_1 = require("../utils/error-handler");
describe('Error Handler', () => {
    // Test all error classes
    describe('AppError classes', () => {
        it('should create AppError with correct properties', () => {
            const error = new error_handler_1.AppError('Test error', 500, true, 'TEST_ERROR');
            expect(error.message).toBe('Test error');
            expect(error.statusCode).toBe(500);
            expect(error.isOperational).toBe(true);
            expect(error.code).toBe('TEST_ERROR');
        });
        it('should create ValidationError with 400 status', () => {
            const error = new error_handler_1.ValidationError('Invalid input');
            expect(error.message).toBe('Invalid input');
            expect(error.statusCode).toBe(400);
            expect(error.code).toBe('VALIDATION_ERROR');
            expect(error.isOperational).toBe(true);
        });
        it('should create AuthenticationError with 401 status', () => {
            const error = new error_handler_1.AuthenticationError('Not authenticated');
            expect(error.message).toBe('Not authenticated');
            expect(error.statusCode).toBe(401);
            expect(error.code).toBe('AUTHENTICATION_ERROR');
            expect(error.isOperational).toBe(true);
        });
        it('should create AuthenticationError with default message', () => {
            const error = new error_handler_1.AuthenticationError();
            expect(error.message).toBe('인증이 필요합니다');
            expect(error.statusCode).toBe(401);
        });
        it('should create AuthorizationError with 403 status', () => {
            const error = new error_handler_1.AuthorizationError('Access denied');
            expect(error.message).toBe('Access denied');
            expect(error.statusCode).toBe(403);
            expect(error.code).toBe('AUTHORIZATION_ERROR');
            expect(error.isOperational).toBe(true);
        });
        it('should create AuthorizationError with default message', () => {
            const error = new error_handler_1.AuthorizationError();
            expect(error.message).toBe('권한이 없습니다');
            expect(error.statusCode).toBe(403);
        });
        it('should create NotFoundError with 404 status', () => {
            const error = new error_handler_1.NotFoundError('Resource not found');
            expect(error.message).toBe('Resource not found');
            expect(error.statusCode).toBe(404);
            expect(error.code).toBe('NOT_FOUND');
            expect(error.isOperational).toBe(true);
        });
        it('should create NotFoundError with default message', () => {
            const error = new error_handler_1.NotFoundError();
            expect(error.message).toBe('리소스를 찾을 수 없습니다');
            expect(error.statusCode).toBe(404);
        });
        it('should create RateLimitError with 429 status', () => {
            const error = new error_handler_1.RateLimitError('Too many requests');
            expect(error.message).toBe('Too many requests');
            expect(error.statusCode).toBe(429);
            expect(error.code).toBe('RATE_LIMIT_EXCEEDED');
            expect(error.isOperational).toBe(true);
        });
        it('should create RateLimitError with default message', () => {
            const error = new error_handler_1.RateLimitError();
            expect(error.message).toBe('요청 제한을 초과했습니다');
            expect(error.statusCode).toBe(429);
        });
        it('should create DatabaseError with 500 status', () => {
            const error = new error_handler_1.DatabaseError('Database connection failed');
            expect(error.message).toBe('Database connection failed');
            expect(error.statusCode).toBe(500);
            expect(error.code).toBe('DATABASE_ERROR');
            expect(error.isOperational).toBe(true);
        });
        it('should create DatabaseError with default message', () => {
            const error = new error_handler_1.DatabaseError();
            expect(error.message).toBe('데이터베이스 오류가 발생했습니다');
            expect(error.statusCode).toBe(500);
        });
    });
    describe('errorHandler middleware', () => {
        let mockReq;
        let mockRes;
        let mockNext;
        beforeEach(() => {
            mockReq = {
                method: 'GET',
                path: '/test',
                body: {},
                query: {}
            };
            mockRes = {
                status: jest.fn().mockReturnThis(),
                json: jest.fn().mockReturnThis()
            };
            mockNext = jest.fn();
        });
        it('should handle AppError and return correct status', () => {
            const error = new error_handler_1.ValidationError('Invalid data');
            (0, error_handler_1.errorHandler)(error, mockReq, mockRes, mockNext);
            expect(mockRes.status).toHaveBeenCalledWith(400);
            expect(mockRes.json).toHaveBeenCalled();
            const response = mockRes.json.mock.calls[0][0];
            expect(response.success).toBe(false);
            expect(response.error).toBe('Invalid data');
            expect(response.code).toBe('VALIDATION_ERROR');
        });
        it('should handle unknown errors as 500', () => {
            const error = new Error('Unknown error');
            (0, error_handler_1.errorHandler)(error, mockReq, mockRes, mockNext);
            expect(mockRes.status).toHaveBeenCalledWith(500);
            expect(mockRes.json).toHaveBeenCalled();
            const response = mockRes.json.mock.calls[0][0];
            expect(response.success).toBe(false);
            expect(response.error).toBe('Unknown error');
        });
        it('should include stack in dev environment', () => {
            const originalEnv = process.env.NODE_ENV;
            process.env.NODE_ENV = 'development';
            const error = new error_handler_1.AppError('Dev error', 500);
            (0, error_handler_1.errorHandler)(error, mockReq, mockRes, mockNext);
            const response = mockRes.json.mock.calls[0][0];
            expect(response.stack).toBeDefined();
            process.env.NODE_ENV = originalEnv;
        });
        it('should not include stack in production environment', () => {
            const originalEnv = process.env.NODE_ENV;
            process.env.NODE_ENV = 'production';
            const error = new error_handler_1.AppError('Prod error', 500);
            (0, error_handler_1.errorHandler)(error, mockReq, mockRes, mockNext);
            const response = mockRes.json.mock.calls[0][0];
            expect(response.stack).toBeUndefined();
            process.env.NODE_ENV = originalEnv;
        });
        it('should include timestamp in response', () => {
            const error = new error_handler_1.AppError('Test error', 500);
            (0, error_handler_1.errorHandler)(error, mockReq, mockRes, mockNext);
            const response = mockRes.json.mock.calls[0][0];
            expect(response.timestamp).toBeDefined();
            expect(typeof response.timestamp).toBe('string');
        });
    });
    describe('asyncHandler', () => {
        let mockReq;
        let mockRes;
        let mockNext;
        beforeEach(() => {
            mockReq = {};
            mockRes = {};
            mockNext = jest.fn();
        });
        it('should pass resolved promise to next handler', () => __awaiter(void 0, void 0, void 0, function* () {
            const handler = (0, error_handler_1.asyncHandler)((req, res, next) => __awaiter(void 0, void 0, void 0, function* () {
                res.json = jest.fn().mockReturnValue({ success: true });
                return { success: true };
            }));
            handler(mockReq, mockRes, mockNext);
            // Give async handler time to resolve
            yield new Promise(resolve => setTimeout(resolve, 10));
            expect(mockNext).not.toHaveBeenCalled();
        }));
        it('should catch rejected promise and call next', () => __awaiter(void 0, void 0, void 0, function* () {
            const testError = new Error('Async error');
            const handler = (0, error_handler_1.asyncHandler)((req, res, next) => __awaiter(void 0, void 0, void 0, function* () {
                throw testError;
            }));
            handler(mockReq, mockRes, mockNext);
            // Give async handler time to reject
            yield new Promise(resolve => setTimeout(resolve, 10));
            expect(mockNext).toHaveBeenCalledWith(testError);
        }));
        it('should handle synchronous errors in async function', () => __awaiter(void 0, void 0, void 0, function* () {
            const testError = new error_handler_1.ValidationError('Sync error in async');
            const handler = (0, error_handler_1.asyncHandler)((req, res, next) => __awaiter(void 0, void 0, void 0, function* () {
                throw testError;
            }));
            handler(mockReq, mockRes, mockNext);
            yield new Promise(resolve => setTimeout(resolve, 10));
            expect(mockNext).toHaveBeenCalledWith(testError);
        }));
    });
    describe('notFoundHandler', () => {
        let mockReq;
        let mockRes;
        let mockNext;
        beforeEach(() => {
            mockReq = {
                method: 'POST',
                path: '/api/nonexistent'
            };
            mockRes = {};
            mockNext = jest.fn();
        });
        it('should create NotFoundError with route info', () => {
            (0, error_handler_1.notFoundHandler)(mockReq, mockRes, mockNext);
            expect(mockNext).toHaveBeenCalled();
            const error = mockNext.mock.calls[0][0];
            expect(error).toBeInstanceOf(error_handler_1.NotFoundError);
            expect(error.message).toContain('POST');
            expect(error.message).toContain('/api/nonexistent');
        });
        it('should pass error to next middleware', () => {
            (0, error_handler_1.notFoundHandler)(mockReq, mockRes, mockNext);
            expect(mockNext).toHaveBeenCalledTimes(1);
            const error = mockNext.mock.calls[0][0];
            expect(error).toBeInstanceOf(error_handler_1.NotFoundError);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL19fdGVzdHNfXy9lcnJvci1oYW5kbGVyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFNQSxjQUFjO0FBQ2QsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2hDLFlBQVksRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2hCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNuQixDQUFDO0NBQ0wsQ0FBQyxDQUFDLENBQUM7QUFkSjs7R0FFRztBQUNILDBEQUF1TTtBQWF2TSxRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtJQUMzQix5QkFBeUI7SUFDekIsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUM5QixFQUFFLENBQUMsZ0RBQWdELEVBQUUsR0FBRyxFQUFFO1lBQ3RELE1BQU0sS0FBSyxHQUFHLElBQUksd0JBQVEsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxZQUFZLENBQUMsQ0FBQztZQUNsRSxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUN6QyxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN2QyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUMxQyxDQUFDLENBQUMsQ0FB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QUMsQ0FBQyxDQUFDLENBQUM7WUFDdkQsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLGNBQWMsQ0FBQyw2QkFBYSxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Wb2x1bWVzL01BQ19BUFAvb3Blbm1ha2VfbGxtL2JhY2tlbmQvYXBpL3NyYy9fX3Rlc3RzX18vZXJyb3ItaGFuZGxlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRXJyb3IgSGFuZGxlciBUZXN0c1xuICovXG5pbXBvcnQgeyBBcHBFcnJvciwgVmFsaWRhdGlvbkVycm9yLCBBdXRoZW50aWNhdGlvbkVycm9yLCBBdXRob3JpemF0aW9uRXJyb3IsIE5vdEZvdW5kRXJyb3IsIFJhdGVMaW1pdEVycm9yLCBEYXRhYmFzZUVycm9yLCBlcnJvckhhbmRsZXIsIGFzeW5jSGFuZGxlciwgbm90Rm91bmRIYW5kbGVyIH0gZnJvbSAnLi4vdXRpbHMvZXJyb3ItaGFuZGxlcic7XG5pbXBvcnQgeyBSZXF1ZXN0LCBSZXNwb25zZSwgTmV4dEZ1bmN0aW9uIH0gZnJvbSAnZXhwcmVzcyc7XG5cbi8vIE1vY2sgbG9nZ2VyXG5qZXN0Lm1vY2soJy4uL3V0aWxzL2xvZ2dlcicsICgpID0+ICh7XG4gICAgY3JlYXRlTG9nZ2VyOiAoKSA9PiAoe1xuICAgICAgICBlcnJvcjogamVzdC5mbigpLFxuICAgICAgICBpbmZvOiBqZXN0LmZuKCksXG4gICAgICAgIHdhcm46IGplc3QuZm4oKSxcbiAgICAgICAgZGVidWc6IGplc3QuZm4oKVxuICAgIH0pXG59KSk7XG5cbmRlc2NyaWJlKCdFcnJvciBIYW5kbGVyJywgKCkgPT4ge1xuICAgIC8vIFRlc3QgYWxsIGVycm9yIGNsYXNzZXNcbiAgICBkZXNjcmliZSgnQXBwRXJyb3IgY2xhc3NlcycsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgQXBwRXJyb3Igd2l0aCBjb3JyZWN0IHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBBcHBFcnJvcignVGVzdCBlcnJvcicsIDUwMCwgdHJ1ZSwgJ1RFU1RfRVJST1InKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdUZXN0IGVycm9yJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3Iuc3RhdHVzQ29kZSkudG9CZSg1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLmlzT3BlcmF0aW9uYWwpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IuY29kZSkudG9CZSgnVEVTVF9FUlJPUicpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBWYWxpZGF0aW9uRXJyb3Igd2l0aCA0MDAgc3RhdHVzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgVmFsaWRhdGlvbkVycm9yKCdJbnZhbGlkIGlucHV0Jyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnSW52YWxpZCBpbnB1dCcpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnN0YXR1c0NvZGUpLnRvQmUoNDAwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5jb2RlKS50b0JlKCdWQUxJREFUSU9OX0VSUk9SJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IuaXNPcGVyYXRpb25hbCkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgQXV0aGVudGljYXRpb25FcnJvciB3aXRoIDQwMSBzdGF0dXMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBBdXRoZW50aWNhdGlvbkVycm9yKCdOb3QgYXV0aGVudGljYXRlZCcpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQmUoJ05vdCBhdXRoZW50aWNhdGVkJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3Iuc3RhdHVzQ29kZSkudG9CZSg0MDEpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLmNvZGUpLnRvQmUoJ0FVVEhFTlRJQ0FUSU9OX0VSUk9SJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IuaXNPcGVyYXRpb25hbCkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgQXV0aGVudGljYXRpb25FcnJvciB3aXRoIGRlZmF1bHQgbWVzc2FnZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEF1dGhlbnRpY2F0aW9uRXJyb3IoKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCfsnbjspp3snbQg7ZWE7JqU7ZWp64uI64ukJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3Iuc3RhdHVzQ29kZSkudG9CZSg0MDEpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBBdXRob3JpemF0aW9uRXJyb3Igd2l0aCA0MDMgc3RhdHVzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgQXV0aG9yaXphdGlvbkVycm9yKCdBY2Nlc3MgZGVuaWVkJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnQWNjZXNzIGRlbmllZCcpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnN0YXR1c0NvZGUpLnRvQmUoNDAzKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5jb2RlKS50b0JlKCdBVVRIT1JJWkFUSU9OX0VSUk9SJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IuaXNPcGVyYXRpb25hbCkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgQXV0aG9yaXphdGlvbkVycm9yIHdpdGggZGVmYXVsdCBtZXNzYWdlJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgQXV0aG9yaXphdGlvbkVycm9yKCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgn6raM7ZWc7J20IOyXhuyKteuLiOuLpCcpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnN0YXR1c0NvZGUpLnRvQmUoNDAzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgTm90Rm91bmRFcnJvciB3aXRoIDQwNCBzdGF0dXMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBOb3RGb3VuZEVycm9yKCdSZXNvdXJjZSBub3QgZm91bmQnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdSZXNvdXJjZSBub3QgZm91bmQnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5zdGF0dXNDb2RlKS50b0JlKDQwNCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IuY29kZSkudG9CZSgnTk9UX0ZPVU5EJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IuaXNPcGVyYXRpb25hbCkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgTm90Rm91bmRFcnJvciB3aXRoIGRlZmF1bHQgbWVzc2FnZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IE5vdEZvdW5kRXJyb3IoKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCfrpqzshozsiqTrpbwg7LC+7J2EIOyImCDsl4bsirXri4jri6QnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5zdGF0dXNDb2RlKS50b0JlKDQwNCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIFJhdGVMaW1pdEVycm9yIHdpdGggNDI5IHN0YXR1cycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFJhdGVMaW1pdEVycm9yKCdUb28gbWFueSByZXF1ZXN0cycpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQmUoJ1RvbyBtYW55IHJlcXVlc3RzJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3Iuc3RhdHVzQ29kZSkudG9CZSg0MjkpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLmNvZGUpLnRvQmUoJ1JBVEVfTElNSVRfRVhDRUVERUQnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5pc09wZXJhdGlvbmFsKS50b0JlKHRydWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBSYXRlTGltaXRFcnJvciB3aXRoIGRlZmF1bHQgbWVzc2FnZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFJhdGVMaW1pdEVycm9yKCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgn7JqU7LKtIOygnO2VnOydhCDstIjqs7ztlojsirXri4jri6QnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5zdGF0dXNDb2RlKS50b0JlKDQyOSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIERhdGFiYXNlRXJyb3Igd2l0aCA1MDAgc3RhdHVzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRGF0YWJhc2VFcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnN0YXR1c0NvZGUpLnRvQmUoNTAwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5jb2RlKS50b0JlKCdEQVRBQkFTRV9FUlJPUicpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLmlzT3BlcmF0aW9uYWwpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIERhdGFiYXNlRXJyb3Igd2l0aCBkZWZhdWx0IG1lc3NhZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBEYXRhYmFzZUVycm9yKCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgn642w7J207YSw67Kg7J207IqkIOyYpOulmOqwgCDrsJzsg53tlojsirXri4jri6QnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5zdGF0dXNDb2RlKS50b0JlKDUwMCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2Vycm9ySGFuZGxlciBtaWRkbGV3YXJlJywgKCkgPT4ge1xuICAgICAgICBsZXQgbW9ja1JlcTogUGFydGlhbDxSZXF1ZXN0PjtcbiAgICAgICAgbGV0IG1vY2tSZXM6IFBhcnRpYWw8UmVzcG9uc2U+O1xuICAgICAgICBsZXQgbW9ja05leHQ6IE5leHRGdW5jdGlvbjtcblxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgICAgIG1vY2tSZXEgPSB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICBwYXRoOiAnL3Rlc3QnLFxuICAgICAgICAgICAgICAgIGJvZHk6IHt9LFxuICAgICAgICAgICAgICAgIHF1ZXJ5OiB7fVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIG1vY2tSZXMgPSB7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgICAgICAgICAgICBqc29uOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIG1vY2tOZXh0ID0gamVzdC5mbigpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBBcHBFcnJvciBhbmQgcmV0dXJuIGNvcnJlY3Qgc3RhdHVzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgVmFsaWRhdGlvbkVycm9yKCdJbnZhbGlkIGRhdGEnKTtcbiAgICAgICAgICAgIGVycm9ySGFuZGxlcihlcnJvciwgbW9ja1JlcSBhcyBSZXF1ZXN0LCBtb2NrUmVzIGFzIFJlc3BvbnNlLCBtb2NrTmV4dCk7XG5cbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAwKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gKG1vY2tSZXMuanNvbiBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2Uuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IpLnRvQmUoJ0ludmFsaWQgZGF0YScpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmNvZGUpLnRvQmUoJ1ZBTElEQVRJT05fRVJST1InKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgdW5rbm93biBlcnJvcnMgYXMgNTAwJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1Vua25vd24gZXJyb3InKTtcbiAgICAgICAgICAgIGVycm9ySGFuZGxlcihlcnJvciwgbW9ja1JlcSBhcyBSZXF1ZXN0LCBtb2NrUmVzIGFzIFJlc3BvbnNlLCBtb2NrTmV4dCk7XG5cbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNTAwKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrUmVzLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gKG1vY2tSZXMuanNvbiBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2Uuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UuZXJyb3IpLnRvQmUoJ1Vua25vd24gZXJyb3InKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBpbmNsdWRlIHN0YWNrIGluIGRldiBlbnZpcm9ubWVudCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsRW52ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlY7XG4gICAgICAgICAgICBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICdkZXZlbG9wbWVudCc7XG5cbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdEZXYgZXJyb3InLCA1MDApO1xuICAgICAgICAgICAgZXJyb3JIYW5kbGVyKGVycm9yLCBtb2NrUmVxIGFzIFJlcXVlc3QsIG1vY2tSZXMgYXMgUmVzcG9uc2UsIG1vY2tOZXh0KTtcblxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSAobW9ja1Jlcy5qc29uIGFzIGplc3QuTW9jaykubW9jay5jYWxsc1swXVswXTtcbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZS5zdGFjaykudG9CZURlZmluZWQoKTtcblxuICAgICAgICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSBvcmlnaW5hbEVudjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBub3QgaW5jbHVkZSBzdGFjayBpbiBwcm9kdWN0aW9uIGVudmlyb25tZW50JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxFbnYgPSBwcm9jZXNzLmVudi5OT0RFX0VOVjtcbiAgICAgICAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Byb2R1Y3Rpb24nO1xuXG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBBcHBFcnJvcignUHJvZCBlcnJvcicsIDUwMCk7XG4gICAgICAgICAgICBlcnJvckhhbmRsZXIoZXJyb3IsIG1vY2tSZXEgYXMgUmVxdWVzdCwgbW9ja1JlcyBhcyBSZXNwb25zZSwgbW9ja05leHQpO1xuXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IChtb2NrUmVzLmpzb24gYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YWNrKS50b0JlVW5kZWZpbmVkKCk7XG5cbiAgICAgICAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gb3JpZ2luYWxFbnY7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaW5jbHVkZSB0aW1lc3RhbXAgaW4gcmVzcG9uc2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBBcHBFcnJvcignVGVzdCBlcnJvcicsIDUwMCk7XG4gICAgICAgICAgICBlcnJvckhhbmRsZXIoZXJyb3IsIG1vY2tSZXEgYXMgUmVxdWVzdCwgbW9ja1JlcyBhcyBSZXNwb25zZSwgbW9ja05leHQpO1xuXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IChtb2NrUmVzLmpzb24gYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnRpbWVzdGFtcCkudG9CZURlZmluZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdCh0eXBlb2YgcmVzcG9uc2UudGltZXN0YW1wKS50b0JlKCdzdHJpbmcnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnYXN5bmNIYW5kbGVyJywgKCkgPT4ge1xuICAgICAgICBsZXQgbW9ja1JlcTogUGFydGlhbDxSZXF1ZXN0PjtcbiAgICAgICAgbGV0IG1vY2tSZXM6IFBhcnRpYWw8UmVzcG9uc2U+O1xuICAgICAgICBsZXQgbW9ja05leHQ6IE5leHRGdW5jdGlvbjtcblxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgICAgIG1vY2tSZXEgPSB7fTtcbiAgICAgICAgICAgIG1vY2tSZXMgPSB7fTtcbiAgICAgICAgICAgIG1vY2tOZXh0ID0gamVzdC5mbigpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHBhc3MgcmVzb2x2ZWQgcHJvbWlzZSB0byBuZXh0IGhhbmRsZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBoYW5kbGVyID0gYXN5bmNIYW5kbGVyKGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlcy5qc29uID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHN1Y2Nlc3M6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGhhbmRsZXIobW9ja1JlcSBhcyBSZXF1ZXN0LCBtb2NrUmVzIGFzIFJlc3BvbnNlLCBtb2NrTmV4dCk7XG5cbiAgICAgICAgICAgIC8vIEdpdmUgYXN5bmMgaGFuZGxlciB0aW1lIHRvIHJlc29sdmVcbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMCkpO1xuICAgICAgICAgICAgZXhwZWN0KG1vY2tOZXh0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGNhdGNoIHJlamVjdGVkIHByb21pc2UgYW5kIGNhbGwgbmV4dCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRlc3RFcnJvciA9IG5ldyBFcnJvcignQXN5bmMgZXJyb3InKTtcbiAgICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgdGVzdEVycm9yO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGhhbmRsZXIobW9ja1JlcSBhcyBSZXF1ZXN0LCBtb2NrUmVzIGFzIFJlc3BvbnNlLCBtb2NrTmV4dCk7XG5cbiAgICAgICAgICAgIC8vIEdpdmUgYXN5bmMgaGFuZGxlciB0aW1lIHRvIHJlamVjdFxuICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwKSk7XG4gICAgICAgICAgICBleHBlY3QobW9ja05leHQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHRlc3RFcnJvcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHN5bmNocm9ub3VzIGVycm9ycyBpbiBhc3luYyBmdW5jdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRlc3RFcnJvciA9IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ1N5bmMgZXJyb3IgaW4gYXN5bmMnKTtcbiAgICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgdGVzdEVycm9yO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGhhbmRsZXIobW9ja1JlcSBhcyBSZXF1ZXN0LCBtb2NrUmVzIGFzIFJlc3BvbnNlLCBtb2NrTmV4dCk7XG5cbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMCkpO1xuICAgICAgICAgICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh0ZXN0RXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdub3RGb3VuZEhhbmRsZXInLCAoKSA9PiB7XG4gICAgICAgIGxldCBtb2NrUmVxOiBQYXJ0aWFsPFJlcXVlc3Q+O1xuICAgICAgICBsZXQgbW9ja1JlczogUGFydGlhbDxSZXNwb25zZT47XG4gICAgICAgIGxldCBtb2NrTmV4dDogTmV4dEZ1bmN0aW9uO1xuXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICAgICAgbW9ja1JlcSA9IHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBwYXRoOiAnL2FwaS9ub25leGlzdGVudCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBtb2NrUmVzID0ge307XG4gICAgICAgICAgICBtb2NrTmV4dCA9IGplc3QuZm4oKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgTm90Rm91bmRFcnJvciB3aXRoIHJvdXRlIGluZm8nLCAoKSA9PiB7XG4gICAgICAgICAgICBub3RGb3VuZEhhbmRsZXIobW9ja1JlcSBhcyBSZXF1ZXN0LCBtb2NrUmVzIGFzIFJlc3BvbnNlLCBtb2NrTmV4dCk7XG5cbiAgICAgICAgICAgIGV4cGVjdChtb2NrTmV4dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSAobW9ja05leHQgYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yKS50b0JlSW5zdGFuY2VPZihOb3RGb3VuZEVycm9yKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0NvbnRhaW4oJ1BPU1QnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0NvbnRhaW4oJy9hcGkvbm9uZXhpc3RlbnQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBwYXNzIGVycm9yIHRvIG5leHQgbWlkZGxld2FyZScsICgpID0+IHtcbiAgICAgICAgICAgIG5vdEZvdW5kSGFuZGxlcihtb2NrUmVxIGFzIFJlcXVlc3QsIG1vY2tSZXMgYXMgUmVzcG9uc2UsIG1vY2tOZXh0KTtcblxuICAgICAgICAgICAgZXhwZWN0KG1vY2tOZXh0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IChtb2NrTmV4dCBhcyBqZXN0Lk1vY2spLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvQmVJbnN0YW5jZU9mKE5vdEZvdW5kRXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9