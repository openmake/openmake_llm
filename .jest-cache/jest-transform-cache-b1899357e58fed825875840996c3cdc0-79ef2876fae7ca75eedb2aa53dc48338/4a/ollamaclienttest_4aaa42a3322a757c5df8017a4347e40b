efd9753ff52f0f97116906a279ea4a5a
"use strict";
// ============================================
// Mock Setup (MUST be before OllamaClient import)
// ============================================
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('axios', () => ({
    __esModule: true,
    default: {
        create: jest.fn(() => mockAxiosInstance),
    },
}));
// Mock config
jest.mock('../config', () => ({
    getConfig: () => ({
        ollamaBaseUrl: 'http://localhost:11434',
        ollamaDefaultModel: 'llama3',
        ollamaTimeout: 120000,
    }),
}));
// Mock logger
jest.mock('../utils/logger', () => ({
    createLogger: () => ({
        info: () => { },
        warn: () => { },
        error: () => { },
        debug: () => { },
    }),
}));
// Mock api-key-manager
jest.mock('../ollama/api-key-manager', () => ({
    getApiKeyManager: () => ({
        getAuthHeaders: () => ({}),
        reportSuccess: () => { },
        reportFailure: () => false,
        getCurrentKeyIndex: () => 0,
        getCurrentKey: () => 'test-key',
        getTotalKeys: () => 1,
    }),
    ApiKeyManager: class {
    },
}));
// Mock api-usage-tracker
jest.mock('../ollama/api-usage-tracker', () => ({
    getApiUsageTracker: () => ({
        getQuotaStatus: () => ({
            hourly: { used: 0, limit: 150, remaining: 150 },
            weekly: { used: 0, limit: 2500, remaining: 2500 },
        }),
        recordRequest: () => { },
    }),
}));
// Mock agent-loop
jest.mock('../ollama/agent-loop', () => ({
    runAgentLoop: jest.fn(() => Promise.resolve({ messages: [], iterations: 0, finalResponse: '' })),
}));
// Mock axios
const mockAxiosInstance = {
    get: jest.fn(() => Promise.resolve({ data: {} })),
    post: jest.fn(() => Promise.resolve({ data: {} })),
    interceptors: {
        request: { use: jest.fn(() => { }) },
        response: { use: jest.fn(() => { }) },
    },
};
// ============================================
// Import after mocks
// ============================================
const client_1 = require("../ollama/client");
const quota_exceeded_error_1 = require("../errors/quota-exceeded.error");
// ============================================
// Tests
// ============================================
describe('OllamaClient', () => {
    describe('Constructor', () => {
        it('should initialize with default config from environment', () => {
            const client = new client_1.OllamaClient();
            // Default model comes from environment config
            expect(client.model).toBeDefined();
            expect(typeof client.model).toBe('string');
        });
        it('should merge custom config with defaults', () => {
            const client = new client_1.OllamaClient({ model: 'custom-model' });
            expect(client.model).toBe('custom-model');
        });
        it('should handle cloud model detection in constructor', () => {
            // When model ends with ':cloud', constructor should set baseUrl to OLLAMA_CLOUD_HOST
            // We verify this by ensuring the constructor completes without errors
            const client = new client_1.OllamaClient({ model: 'gemini:cloud' });
            expect(client.model).toBe('gemini:cloud');
        });
        it('should create axios instance with correct config', () => {
            const client = new client_1.OllamaClient({ model: 'test-model' });
            // Verify axios.create was called (mocked)
            expect(mockAxiosInstance).toBeDefined();
        });
    });
    describe('model getter', () => {
        it('should return current model name', () => {
            const client = new client_1.OllamaClient({ model: 'test-model' });
            expect(client.model).toBe('test-model');
        });
        it('should return default model when not specified', () => {
            const client = new client_1.OllamaClient();
            // Default model comes from environment config
            expect(client.model).toBeDefined();
            expect(typeof client.model).toBe('string');
        });
    });
    describe('setModel', () => {
        it('should update model after construction', () => {
            const client = new client_1.OllamaClient({ model: 'initial-model' });
            expect(client.model).toBe('initial-model');
            client.setModel('new-model');
            expect(client.model).toBe('new-model');
        });
        it('should allow setting cloud models', () => {
            const client = new client_1.OllamaClient();
            client.setModel('gemini:cloud');
            expect(client.model).toBe('gemini:cloud');
        });
    });
    describe('clearContext', () => {
        it('should not throw when called', () => {
            const client = new client_1.OllamaClient();
            expect(() => {
                client.clearContext();
            }).not.toThrow();
        });
    });
    describe('createClient helper', () => {
        it('should return an OllamaClient instance', () => {
            const client = (0, client_1.createClient)();
            expect(client).toBeInstanceOf(client_1.OllamaClient);
        });
        it('should accept config parameter', () => {
            const client = (0, client_1.createClient)({ model: 'test-model' });
            expect(client).toBeInstanceOf(client_1.OllamaClient);
            expect(client.model).toBe('test-model');
        });
        it('should use default config when no parameter provided', () => {
            const client = (0, client_1.createClient)();
            // Default model comes from environment config
            expect(client.model).toBeDefined();
            expect(typeof client.model).toBe('string');
        });
    });
});
// ============================================
// QuotaExceededError Tests
// ============================================
describe('QuotaExceededError', () => {
    describe('hourly quota exceeded', () => {
        it('should create error with hourly quota type', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            expect(error.quotaType).toBe('hourly');
            expect(error.used).toBe(150);
            expect(error.limit).toBe(150);
        });
        it('should set retryAfterSeconds to 3600 for hourly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            expect(error.retryAfterSeconds).toBe(3600);
        });
        it('should have correct error message for hourly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            expect(error.message).toBe('API quota exceeded (hourly): 150/150 requests used');
        });
        it('should have correct error name', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            expect(error.name).toBe('QuotaExceededError');
        });
    });
    describe('weekly quota exceeded', () => {
        it('should create error with weekly quota type', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 2500, 2500);
            expect(error.quotaType).toBe('weekly');
            expect(error.used).toBe(2500);
            expect(error.limit).toBe(2500);
        });
        it('should set retryAfterSeconds to 86400 for weekly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 2500, 2500);
            expect(error.retryAfterSeconds).toBe(86400);
        });
        it('should have correct error message for weekly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 2500, 2500);
            expect(error.message).toBe('API quota exceeded (weekly): 2500/2500 requests used');
        });
    });
    describe('both quotas exceeded', () => {
        it('should create error with both quota type', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('both', 2500, 2500);
            expect(error.quotaType).toBe('both');
            expect(error.used).toBe(2500);
            expect(error.limit).toBe(2500);
        });
        it('should set retryAfterSeconds to 86400 for both', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('both', 2500, 2500);
            expect(error.retryAfterSeconds).toBe(86400);
        });
        it('should have correct error message for both', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('both', 2500, 2500);
            expect(error.message).toBe('API quota exceeded (both): 2500/2500 requests used');
        });
    });
    describe('error properties', () => {
        it('should be an instance of Error', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 100, 150);
            expect(error).toBeInstanceOf(Error);
        });
        it('should have all required properties', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 1000, 2500);
            expect(error).toHaveProperty('quotaType');
            expect(error).toHaveProperty('used');
            expect(error).toHaveProperty('limit');
            expect(error).toHaveProperty('retryAfterSeconds');
            expect(error).toHaveProperty('message');
            expect(error).toHaveProperty('name');
        });
        it('should handle partial quota usage', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 75, 150);
            expect(error.used).toBe(75);
            expect(error.limit).toBe(150);
            expect(error.message).toBe('API quota exceeded (hourly): 75/150 requests used');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL19fdGVzdHNfXy9vbGxhbWEtY2xpZW50LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBLCtDQUErQztBQUMvQyxrREFBa0Q7QUFDbEQsK0NBQStDOztBQVcvQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RCLFVBQVUsRUFBRSxJQUFJO0lBQ2hCLE9BQU8sRUFBRTtRQUNMLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLGlCQUFpQixDQUFDO0tBQzNDO0NBQ0osQ0FBQyxDQUFDLENBQUM7QUFFSixjQUFjO0FBQ2QsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMxQixTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNkLGFBQWEsRUFBRSx3QkFBd0I7UUFDdkMsa0JBQWtCLEVBQUUsUUFBUTtRQUM1QixhQUFhLEVBQUUsTUFBTTtLQUN4QixDQUFDO0NBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSixjQUFjO0FBQ2QsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2hDLFlBQVksRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRSxDQUFDO1FBQ2QsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFFLENBQUM7UUFDZCxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUUsQ0FBQztRQUNmLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRSxDQUFDO0tBQ2xCLENBQUM7Q0FDTCxDQUFDLENBQUMsQ0FBQztBQUVKLHVCQUF1QjtBQUN2QixJQUFJLENBQUMsSUFBSSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDMUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FB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QUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL19fdGVzdHNfXy9vbGxhbWEtY2xpZW50LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1vY2sgU2V0dXAgKE1VU1QgYmUgYmVmb3JlIE9sbGFtYUNsaWVudCBpbXBvcnQpXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vLyBNb2NrIGF4aW9zXG5jb25zdCBtb2NrQXhpb3NJbnN0YW5jZSA9IHtcbiAgICBnZXQ6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YToge30gfSkpLFxuICAgIHBvc3Q6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YToge30gfSkpLFxuICAgIGludGVyY2VwdG9yczoge1xuICAgICAgICByZXF1ZXN0OiB7IHVzZTogamVzdC5mbigoKSA9PiB7fSkgfSxcbiAgICAgICAgcmVzcG9uc2U6IHsgdXNlOiBqZXN0LmZuKCgpID0+IHt9KSB9LFxuICAgIH0sXG59O1xuamVzdC5tb2NrKCdheGlvcycsICgpID0+ICh7XG4gICAgX19lc01vZHVsZTogdHJ1ZSxcbiAgICBkZWZhdWx0OiB7XG4gICAgICAgIGNyZWF0ZTogamVzdC5mbigoKSA9PiBtb2NrQXhpb3NJbnN0YW5jZSksXG4gICAgfSxcbn0pKTtcblxuLy8gTW9jayBjb25maWdcbmplc3QubW9jaygnLi4vY29uZmlnJywgKCkgPT4gKHtcbiAgICBnZXRDb25maWc6ICgpID0+ICh7XG4gICAgICAgIG9sbGFtYUJhc2VVcmw6ICdodHRwOi8vbG9jYWxob3N0OjExNDM0JyxcbiAgICAgICAgb2xsYW1hRGVmYXVsdE1vZGVsOiAnbGxhbWEzJyxcbiAgICAgICAgb2xsYW1hVGltZW91dDogMTIwMDAwLFxuICAgIH0pLFxufSkpO1xuXG4vLyBNb2NrIGxvZ2dlclxuamVzdC5tb2NrKCcuLi91dGlscy9sb2dnZXInLCAoKSA9PiAoe1xuICAgIGNyZWF0ZUxvZ2dlcjogKCkgPT4gKHtcbiAgICAgICAgaW5mbzogKCkgPT4ge30sXG4gICAgICAgIHdhcm46ICgpID0+IHt9LFxuICAgICAgICBlcnJvcjogKCkgPT4ge30sXG4gICAgICAgIGRlYnVnOiAoKSA9PiB7fSxcbiAgICB9KSxcbn0pKTtcblxuLy8gTW9jayBhcGkta2V5LW1hbmFnZXJcbmplc3QubW9jaygnLi4vb2xsYW1hL2FwaS1rZXktbWFuYWdlcicsICgpID0+ICh7XG4gICAgZ2V0QXBpS2V5TWFuYWdlcjogKCkgPT4gKHtcbiAgICAgICAgZ2V0QXV0aEhlYWRlcnM6ICgpID0+ICh7fSksXG4gICAgICAgIHJlcG9ydFN1Y2Nlc3M6ICgpID0+IHt9LFxuICAgICAgICByZXBvcnRGYWlsdXJlOiAoKSA9PiBmYWxzZSxcbiAgICAgICAgZ2V0Q3VycmVudEtleUluZGV4OiAoKSA9PiAwLFxuICAgICAgICBnZXRDdXJyZW50S2V5OiAoKSA9PiAndGVzdC1rZXknLFxuICAgICAgICBnZXRUb3RhbEtleXM6ICgpID0+IDEsXG4gICAgfSksXG4gICAgQXBpS2V5TWFuYWdlcjogY2xhc3Mge30sXG59KSk7XG5cbi8vIE1vY2sgYXBpLXVzYWdlLXRyYWNrZXJcbmplc3QubW9jaygnLi4vb2xsYW1hL2FwaS11c2FnZS10cmFja2VyJywgKCkgPT4gKHtcbiAgICBnZXRBcGlVc2FnZVRyYWNrZXI6ICgpID0+ICh7XG4gICAgICAgIGdldFF1b3RhU3RhdHVzOiAoKSA9PiAoe1xuICAgICAgICAgICAgaG91cmx5OiB7IHVzZWQ6IDAsIGxpbWl0OiAxNTAsIHJlbWFpbmluZzogMTUwIH0sXG4gICAgICAgICAgICB3ZWVrbHk6IHsgdXNlZDogMCwgbGltaXQ6IDI1MDAsIHJlbWFpbmluZzogMjUwMCB9LFxuICAgICAgICB9KSxcbiAgICAgICAgcmVjb3JkUmVxdWVzdDogKCkgPT4ge30sXG4gICAgfSksXG59KSk7XG5cbi8vIE1vY2sgYWdlbnQtbG9vcFxuamVzdC5tb2NrKCcuLi9vbGxhbWEvYWdlbnQtbG9vcCcsICgpID0+ICh7XG4gICAgcnVuQWdlbnRMb29wOiBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IG1lc3NhZ2VzOiBbXSwgaXRlcmF0aW9uczogMCwgZmluYWxSZXNwb25zZTogJycgfSkpLFxufSkpO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSW1wb3J0IGFmdGVyIG1vY2tzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgeyBPbGxhbWFDbGllbnQsIGNyZWF0ZUNsaWVudCB9IGZyb20gJy4uL29sbGFtYS9jbGllbnQnO1xuaW1wb3J0IHsgUXVvdGFFeGNlZWRlZEVycm9yIH0gZnJvbSAnLi4vZXJyb3JzL3F1b3RhLWV4Y2VlZGVkLmVycm9yJztcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRlc3RzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5kZXNjcmliZSgnT2xsYW1hQ2xpZW50JywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdDb25zdHJ1Y3RvcicsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHdpdGggZGVmYXVsdCBjb25maWcgZnJvbSBlbnZpcm9ubWVudCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBPbGxhbWFDbGllbnQoKTtcbiAgICAgICAgICAgIC8vIERlZmF1bHQgbW9kZWwgY29tZXMgZnJvbSBlbnZpcm9ubWVudCBjb25maWdcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGNsaWVudC5tb2RlbCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgbWVyZ2UgY3VzdG9tIGNvbmZpZyB3aXRoIGRlZmF1bHRzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE9sbGFtYUNsaWVudCh7IG1vZGVsOiAnY3VzdG9tLW1vZGVsJyB9KTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ2N1c3RvbS1tb2RlbCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBjbG91ZCBtb2RlbCBkZXRlY3Rpb24gaW4gY29uc3RydWN0b3InLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBXaGVuIG1vZGVsIGVuZHMgd2l0aCAnOmNsb3VkJywgY29uc3RydWN0b3Igc2hvdWxkIHNldCBiYXNlVXJsIHRvIE9MTEFNQV9DTE9VRF9IT1NUXG4gICAgICAgICAgICAvLyBXZSB2ZXJpZnkgdGhpcyBieSBlbnN1cmluZyB0aGUgY29uc3RydWN0b3IgY29tcGxldGVzIHdpdGhvdXQgZXJyb3JzXG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBuZXcgT2xsYW1hQ2xpZW50KHsgbW9kZWw6ICdnZW1pbmk6Y2xvdWQnIH0pO1xuICAgICAgICAgICAgZXhwZWN0KGNsaWVudC5tb2RlbCkudG9CZSgnZ2VtaW5pOmNsb3VkJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGF4aW9zIGluc3RhbmNlIHdpdGggY29ycmVjdCBjb25maWcnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBuZXcgT2xsYW1hQ2xpZW50KHsgbW9kZWw6ICd0ZXN0LW1vZGVsJyB9KTtcbiAgICAgICAgICAgIC8vIFZlcmlmeSBheGlvcy5jcmVhdGUgd2FzIGNhbGxlZCAobW9ja2VkKVxuICAgICAgICAgICAgZXhwZWN0KG1vY2tBeGlvc0luc3RhbmNlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdtb2RlbCBnZXR0ZXInLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGN1cnJlbnQgbW9kZWwgbmFtZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBPbGxhbWFDbGllbnQoeyBtb2RlbDogJ3Rlc3QtbW9kZWwnIH0pO1xuICAgICAgICAgICAgZXhwZWN0KGNsaWVudC5tb2RlbCkudG9CZSgndGVzdC1tb2RlbCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBkZWZhdWx0IG1vZGVsIHdoZW4gbm90IHNwZWNpZmllZCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBPbGxhbWFDbGllbnQoKTtcbiAgICAgICAgICAgIC8vIERlZmF1bHQgbW9kZWwgY29tZXMgZnJvbSBlbnZpcm9ubWVudCBjb25maWdcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGNsaWVudC5tb2RlbCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3NldE1vZGVsJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHVwZGF0ZSBtb2RlbCBhZnRlciBjb25zdHJ1Y3Rpb24nLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBuZXcgT2xsYW1hQ2xpZW50KHsgbW9kZWw6ICdpbml0aWFsLW1vZGVsJyB9KTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ2luaXRpYWwtbW9kZWwnKTtcblxuICAgICAgICAgICAgY2xpZW50LnNldE1vZGVsKCduZXctbW9kZWwnKTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ25ldy1tb2RlbCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGFsbG93IHNldHRpbmcgY2xvdWQgbW9kZWxzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE9sbGFtYUNsaWVudCgpO1xuICAgICAgICAgICAgY2xpZW50LnNldE1vZGVsKCdnZW1pbmk6Y2xvdWQnKTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ2dlbWluaTpjbG91ZCcpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdjbGVhckNvbnRleHQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgbm90IHRocm93IHdoZW4gY2FsbGVkJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE9sbGFtYUNsaWVudCgpO1xuICAgICAgICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBjbGllbnQuY2xlYXJDb250ZXh0KCk7XG4gICAgICAgICAgICB9KS5ub3QudG9UaHJvdygpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdjcmVhdGVDbGllbnQgaGVscGVyJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBhbiBPbGxhbWFDbGllbnQgaW5zdGFuY2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBjcmVhdGVDbGllbnQoKTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQpLnRvQmVJbnN0YW5jZU9mKE9sbGFtYUNsaWVudCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgYWNjZXB0IGNvbmZpZyBwYXJhbWV0ZXInLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBjcmVhdGVDbGllbnQoeyBtb2RlbDogJ3Rlc3QtbW9kZWwnIH0pO1xuICAgICAgICAgICAgZXhwZWN0KGNsaWVudCkudG9CZUluc3RhbmNlT2YoT2xsYW1hQ2xpZW50KTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ3Rlc3QtbW9kZWwnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCBjb25maWcgd2hlbiBubyBwYXJhbWV0ZXIgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBjcmVhdGVDbGllbnQoKTtcbiAgICAgICAgICAgIC8vIERlZmF1bHQgbW9kZWwgY29tZXMgZnJvbSBlbnZpcm9ubWVudCBjb25maWdcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGNsaWVudC5tb2RlbCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBRdW90YUV4Y2VlZGVkRXJyb3IgVGVzdHNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmRlc2NyaWJlKCdRdW90YUV4Y2VlZGVkRXJyb3InLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2hvdXJseSBxdW90YSBleGNlZWRlZCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgZXJyb3Igd2l0aCBob3VybHkgcXVvdGEgdHlwZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignaG91cmx5JywgMTUwLCAxNTApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnF1b3RhVHlwZSkudG9CZSgnaG91cmx5Jyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IudXNlZCkudG9CZSgxNTApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLmxpbWl0KS50b0JlKDE1MCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgc2V0IHJldHJ5QWZ0ZXJTZWNvbmRzIHRvIDM2MDAgZm9yIGhvdXJseScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignaG91cmx5JywgMTUwLCAxNTApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnJldHJ5QWZ0ZXJTZWNvbmRzKS50b0JlKDM2MDApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBlcnJvciBtZXNzYWdlIGZvciBob3VybHknLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2hvdXJseScsIDE1MCwgMTUwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdBUEkgcXVvdGEgZXhjZWVkZWQgKGhvdXJseSk6IDE1MC8xNTAgcmVxdWVzdHMgdXNlZCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBlcnJvciBuYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgUXVvdGFFeGNlZWRlZEVycm9yKCdob3VybHknLCAxNTAsIDE1MCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubmFtZSkudG9CZSgnUXVvdGFFeGNlZWRlZEVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3dlZWtseSBxdW90YSBleGNlZWRlZCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgZXJyb3Igd2l0aCB3ZWVrbHkgcXVvdGEgdHlwZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignd2Vla2x5JywgMjUwMCwgMjUwMCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IucXVvdGFUeXBlKS50b0JlKCd3ZWVrbHknKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci51c2VkKS50b0JlKDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLmxpbWl0KS50b0JlKDI1MDApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHNldCByZXRyeUFmdGVyU2Vjb25kcyB0byA4NjQwMCBmb3Igd2Vla2x5JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgUXVvdGFFeGNlZWRlZEVycm9yKCd3ZWVrbHknLCAyNTAwLCAyNTAwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5yZXRyeUFmdGVyU2Vjb25kcykudG9CZSg4NjQwMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IGVycm9yIG1lc3NhZ2UgZm9yIHdlZWtseScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignd2Vla2x5JywgMjUwMCwgMjUwMCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnQVBJIHF1b3RhIGV4Y2VlZGVkICh3ZWVrbHkpOiAyNTAwLzI1MDAgcmVxdWVzdHMgdXNlZCcpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdib3RoIHF1b3RhcyBleGNlZWRlZCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgZXJyb3Igd2l0aCBib3RoIHF1b3RhIHR5cGUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2JvdGgnLCAyNTAwLCAyNTAwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5xdW90YVR5cGUpLnRvQmUoJ2JvdGgnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci51c2VkKS50b0JlKDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLmxpbWl0KS50b0JlKDI1MDApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHNldCByZXRyeUFmdGVyU2Vjb25kcyB0byA4NjQwMCBmb3IgYm90aCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignYm90aCcsIDI1MDAsIDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnJldHJ5QWZ0ZXJTZWNvbmRzKS50b0JlKDg2NDAwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIGNvcnJlY3QgZXJyb3IgbWVzc2FnZSBmb3IgYm90aCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignYm90aCcsIDI1MDAsIDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQmUoJ0FQSSBxdW90YSBleGNlZWRlZCAoYm90aCk6IDI1MDAvMjUwMCByZXF1ZXN0cyB1c2VkJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2Vycm9yIHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgYmUgYW4gaW5zdGFuY2Ugb2YgRXJyb3InLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2hvdXJseScsIDEwMCwgMTUwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoRXJyb3IpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgYWxsIHJlcXVpcmVkIHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ3dlZWtseScsIDEwMDAsIDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yKS50b0hhdmVQcm9wZXJ0eSgncXVvdGFUeXBlJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvSGF2ZVByb3BlcnR5KCd1c2VkJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvSGF2ZVByb3BlcnR5KCdsaW1pdCcpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yKS50b0hhdmVQcm9wZXJ0eSgncmV0cnlBZnRlclNlY29uZHMnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvcikudG9IYXZlUHJvcGVydHkoJ21lc3NhZ2UnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvcikudG9IYXZlUHJvcGVydHkoJ25hbWUnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGFydGlhbCBxdW90YSB1c2FnZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignaG91cmx5JywgNzUsIDE1MCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IudXNlZCkudG9CZSg3NSk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubGltaXQpLnRvQmUoMTUwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdBUEkgcXVvdGEgZXhjZWVkZWQgKGhvdXJseSk6IDc1LzE1MCByZXF1ZXN0cyB1c2VkJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=