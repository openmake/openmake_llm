81463f96c28cc95005630f6fbe8a8e0b
"use strict";
/**
 * MCP Filesystem Module Tests
 * 파일 경로 검증 및 확장자 검증 테스트
 */
Object.defineProperty(exports, "__esModule", { value: true });
const bun_test_1 = require("bun:test");
// UserSandbox 모킹 (bun:test 호환)
bun_test_1.mock.module('../mcp/user-sandbox', () => ({
    UserSandbox: {
        resolvePath: (userId, filePath) => {
            // 기본 동작: 단순 경로 반환 (테스트용)
            if (filePath.includes('..'))
                return null; // 경로 탈출 시도
            if (filePath.startsWith('/'))
                return filePath;
            return `/home/user${userId}/workspace/${filePath}`;
        }
    },
    UserContext: {}
}));
const filesystem_1 = require("../mcp/filesystem");
(0, bun_test_1.describe)('MCP Filesystem Module', () => {
    (0, bun_test_1.describe)('validateFilePath', () => {
        (0, bun_test_1.it)('should validate a simple relative path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'test.txt');
            (0, bun_test_1.expect)(result.valid).toBe(true);
            (0, bun_test_1.expect)(result.resolvedPath).toBe('/home/user1/workspace/test.txt');
            (0, bun_test_1.expect)(result.error).toBeUndefined();
        });
        (0, bun_test_1.it)('should validate an absolute path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '/home/user1/workspace/file.md');
            (0, bun_test_1.expect)(result.valid).toBe(true);
            (0, bun_test_1.expect)(result.resolvedPath).toBe('/home/user1/workspace/file.md');
        });
        (0, bun_test_1.it)('should reject path traversal attempts', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '../../../etc/passwd');
            (0, bun_test_1.expect)(result.valid).toBe(false);
            (0, bun_test_1.expect)(result.resolvedPath).toBeNull();
            (0, bun_test_1.expect)(result.error).toBe('접근 권한이 없는 경로입니다');
        });
        (0, bun_test_1.it)('should reject node_modules path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'node_modules/package.json');
            (0, bun_test_1.expect)(result.valid).toBe(false);
            (0, bun_test_1.expect)(result.error).toBe('접근이 금지된 경로입니다');
        });
        (0, bun_test_1.it)('should reject .git path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '.git/config');
            (0, bun_test_1.expect)(result.valid).toBe(false);
            (0, bun_test_1.expect)(result.error).toBe('접근이 금지된 경로입니다');
        });
        (0, bun_test_1.it)('should reject .env file', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '.env');
            (0, bun_test_1.expect)(result.valid).toBe(false);
            (0, bun_test_1.expect)(result.error).toBe('접근이 금지된 경로입니다');
        });
        (0, bun_test_1.it)('should reject files with password in name', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'my_password.txt');
            (0, bun_test_1.expect)(result.valid).toBe(false);
            (0, bun_test_1.expect)(result.error).toBe('접근이 금지된 경로입니다');
        });
        (0, bun_test_1.it)('should reject files with secret in name', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'api_secret.json');
            (0, bun_test_1.expect)(result.valid).toBe(false);
            (0, bun_test_1.expect)(result.error).toBe('접근이 금지된 경로입니다');
        });
        (0, bun_test_1.it)('should reject files with credentials in name', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'credentials.yaml');
            (0, bun_test_1.expect)(result.valid).toBe(false);
            (0, bun_test_1.expect)(result.error).toBe('접근이 금지된 경로입니다');
        });
    });
    (0, bun_test_1.describe)('isAllowedExtension', () => {
        (0, bun_test_1.describe)('allowed extensions', () => {
            const allowedExtensions = [
                '.txt', '.md', '.json', '.yaml', '.yml', '.xml',
                '.js', '.ts', '.jsx', '.tsx', '.css', '.html',
                '.py', '.java', '.go', '.rs', '.c', '.cpp', '.h',
                '.sh', '.bash', '.zsh', '.fish',
                '.csv', '.log'
                // Note: .env.example은 path.extname이 .example을 반환하므로 별도 테스트
            ];
            allowedExtensions.forEach(ext => {
                (0, bun_test_1.it)(`should allow ${ext} extension`, () => {
                    (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)(`file${ext}`)).toBe(true);
                });
            });
        });
        (0, bun_test_1.it)('should allow files without extension', () => {
            (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)('Makefile')).toBe(true);
            (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)('Dockerfile')).toBe(true);
        });
        (0, bun_test_1.it)('should deny binary extensions', () => {
            (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)('file.exe')).toBe(false);
            (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)('file.dll')).toBe(false);
            (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)('file.so')).toBe(false);
        });
        (0, bun_test_1.it)('should deny image extensions', () => {
            (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)('image.png')).toBe(false);
            (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)('photo.jpg')).toBe(false);
            (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)('icon.gif')).toBe(false);
        });
        (0, bun_test_1.it)('should be case insensitive', () => {
            (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)('FILE.TXT')).toBe(true);
            (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)('file.MD')).toBe(true);
            (0, bun_test_1.expect)((0, filesystem_1.isAllowedExtension)('script.JS')).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL19fdGVzdHNfXy9tY3AtZmlsZXN5c3RlbS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsdUNBQXNEO0FBRXRELCtCQUErQjtBQUMvQixlQUFJLENBQUMsTUFBTSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDdEMsV0FBVyxFQUFFO1FBQ1QsV0FBVyxFQUFFLENBQUMsTUFBdUIsRUFBRSxRQUFnQixFQUFFLEVBQUU7WUFDdkQseUJBQXlCO1lBQ3pCLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7Z0JBQUUsT0FBTyxJQUFJLENBQUMsQ0FBQyxXQUFXO1lBQ3JELElBQUksUUFBUSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUM7Z0JBQUUsT0FBTyxRQUFRLENBQUM7WUFDOUMsT0FBTyxhQUFhLE1BQU0sY0FBYyxRQUFRLEVBQUUsQ0FBQztRQUN2RCxDQUFDO0tBQ0o7SUFDRCxXQUFXLEVBQUUsRUFBRTtDQUNsQixDQUFDLENBQUMsQ0FBQztBQUVKLGtEQUF5RTtBQUV6RSxJQUFBLG1CQUFRLEVBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLElBQUEsbUJBQVEsRUFBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsSUFBQSxhQUFFLEVBQUMsd0NBQXdDLEVBQUUsR0FBRyxFQUFFO1lBQzlDLE1BQU0sTUFBTSxHQUFHLElBQUEsNkJBQWdCLEVBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBRS9DLElBQUEsaUJBQU0sRUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2hDLElBQUEsaUJBQU0sRUFBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7WUFDbkUsSUFBQSxpQkFBTSxFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMs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QUMsS0FBSyxDQUFDLENBQUM7WUFDcEQsSUFBQSxpQkFBTSxFQUFDLElBQUEsK0JBQWtCLEVBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDcEQsSUFBQSxpQkFBTSxFQUFDLElBQUEsK0JBQWtCLEVBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkQsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLGFBQUUsRUFBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUU7WUFDbEMsSUFBQSxpQkFBTSxFQUFDLElBQUEsK0JBQWtCLEVBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEQsSUFBQSxpQkFBTSxFQUFDLElBQUEsK0JBQWtCLEVBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakQsSUFBQSxpQkFBTSxFQUFDLElBQUEsK0JBQWtCLEVBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Wb2x1bWVzL01BQ19BUFAvb3Blbm1ha2VfbGxtL2JhY2tlbmQvYXBpL3NyYy9fX3Rlc3RzX18vbWNwLWZpbGVzeXN0ZW0udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1DUCBGaWxlc3lzdGVtIE1vZHVsZSBUZXN0c1xuICog7YyM7J28IOqyveuhnCDqsoDspp0g67CPIO2ZleyepeyekCDqsoDspp0g7YWM7Iqk7Yq4XG4gKi9cblxuaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIG1vY2sgfSBmcm9tICdidW46dGVzdCc7XG5cbi8vIFVzZXJTYW5kYm94IOuqqO2CuSAoYnVuOnRlc3Qg7Zi47ZmYKVxubW9jay5tb2R1bGUoJy4uL21jcC91c2VyLXNhbmRib3gnLCAoKSA9PiAoe1xuICAgIFVzZXJTYW5kYm94OiB7XG4gICAgICAgIHJlc29sdmVQYXRoOiAodXNlcklkOiBzdHJpbmcgfCBudW1iZXIsIGZpbGVQYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIC8vIOq4sOuzuCDrj5nsnpE6IOuLqOyInCDqsr3roZwg67CY7ZmYICjthYzsiqTtirjsmqkpXG4gICAgICAgICAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJy4uJykpIHJldHVybiBudWxsOyAvLyDqsr3roZwg7YOI7LacIOyLnOuPhFxuICAgICAgICAgICAgaWYgKGZpbGVQYXRoLnN0YXJ0c1dpdGgoJy8nKSkgcmV0dXJuIGZpbGVQYXRoO1xuICAgICAgICAgICAgcmV0dXJuIGAvaG9tZS91c2VyJHt1c2VySWR9L3dvcmtzcGFjZS8ke2ZpbGVQYXRofWA7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFVzZXJDb250ZXh0OiB7fVxufSkpO1xuXG5pbXBvcnQgeyB2YWxpZGF0ZUZpbGVQYXRoLCBpc0FsbG93ZWRFeHRlbnNpb24gfSBmcm9tICcuLi9tY3AvZmlsZXN5c3RlbSc7XG5cbmRlc2NyaWJlKCdNQ1AgRmlsZXN5c3RlbSBNb2R1bGUnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ3ZhbGlkYXRlRmlsZVBhdGgnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYSBzaW1wbGUgcmVsYXRpdmUgcGF0aCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZVBhdGgoMSwgJ3Rlc3QudHh0Jyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnJlc29sdmVkUGF0aCkudG9CZSgnL2hvbWUvdXNlcjEvd29ya3NwYWNlL3Rlc3QudHh0Jyk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYW4gYWJzb2x1dGUgcGF0aCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZVBhdGgoMSwgJy9ob21lL3VzZXIxL3dvcmtzcGFjZS9maWxlLm1kJyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnJlc29sdmVkUGF0aCkudG9CZSgnL2hvbWUvdXNlcjEvd29ya3NwYWNlL2ZpbGUubWQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZWplY3QgcGF0aCB0cmF2ZXJzYWwgYXR0ZW1wdHMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGVQYXRoKDEsICcuLi8uLi8uLi9ldGMvcGFzc3dkJyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5yZXNvbHZlZFBhdGgpLnRvQmVOdWxsKCk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKCfsoJHqt7wg6raM7ZWc7J20IOyXhuuKlCDqsr3roZzsnoXri4jri6QnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZWplY3Qgbm9kZV9tb2R1bGVzIHBhdGgnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGVQYXRoKDEsICdub2RlX21vZHVsZXMvcGFja2FnZS5qc29uJyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgn7KCR6re87J20IOq4iOyngOuQnCDqsr3roZzsnoXri4jri6QnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZWplY3QgLmdpdCBwYXRoJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVGaWxlUGF0aCgxLCAnLmdpdC9jb25maWcnKTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKCfsoJHqt7zsnbQg6riI7KeA65CcIOqyveuhnOyeheuLiOuLpCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlamVjdCAuZW52IGZpbGUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGVQYXRoKDEsICcuZW52Jyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgn7KCR6re87J20IOq4iOyngOuQnCDqsr3roZzsnoXri4jri6QnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZWplY3QgZmlsZXMgd2l0aCBwYXNzd29yZCBpbiBuYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVGaWxlUGF0aCgxLCAnbXlfcGFzc3dvcmQudHh0Jyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgn7KCR6re87J20IOq4iOyngOuQnCDqsr3roZzsnoXri4jri6QnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZWplY3QgZmlsZXMgd2l0aCBzZWNyZXQgaW4gbmFtZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZVBhdGgoMSwgJ2FwaV9zZWNyZXQuanNvbicpO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ+ygkeq3vOydtCDquIjsp4DrkJwg6rK966Gc7J6F64uI64ukJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IGZpbGVzIHdpdGggY3JlZGVudGlhbHMgaW4gbmFtZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZVBhdGgoMSwgJ2NyZWRlbnRpYWxzLnlhbWwnKTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKCfsoJHqt7zsnbQg6riI7KeA65CcIOqyveuhnOyeheuLiOuLpCcpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdpc0FsbG93ZWRFeHRlbnNpb24nLCAoKSA9PiB7XG4gICAgICAgIGRlc2NyaWJlKCdhbGxvd2VkIGV4dGVuc2lvbnMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhbGxvd2VkRXh0ZW5zaW9ucyA9IFtcbiAgICAgICAgICAgICAgICAnLnR4dCcsICcubWQnLCAnLmpzb24nLCAnLnlhbWwnLCAnLnltbCcsICcueG1sJyxcbiAgICAgICAgICAgICAgICAnLmpzJywgJy50cycsICcuanN4JywgJy50c3gnLCAnLmNzcycsICcuaHRtbCcsXG4gICAgICAgICAgICAgICAgJy5weScsICcuamF2YScsICcuZ28nLCAnLnJzJywgJy5jJywgJy5jcHAnLCAnLmgnLFxuICAgICAgICAgICAgICAgICcuc2gnLCAnLmJhc2gnLCAnLnpzaCcsICcuZmlzaCcsXG4gICAgICAgICAgICAgICAgJy5jc3YnLCAnLmxvZydcbiAgICAgICAgICAgICAgICAvLyBOb3RlOiAuZW52LmV4YW1wbGXsnYAgcGF0aC5leHRuYW1l7J20IC5leGFtcGxl7J2EIOuwmO2ZmO2VmOuvgOuhnCDrs4Trj4Qg7YWM7Iqk7Yq4XG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBhbGxvd2VkRXh0ZW5zaW9ucy5mb3JFYWNoKGV4dCA9PiB7XG4gICAgICAgICAgICAgICAgaXQoYHNob3VsZCBhbGxvdyAke2V4dH0gZXh0ZW5zaW9uYCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKGBmaWxlJHtleHR9YCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBmaWxlcyB3aXRob3V0IGV4dGVuc2lvbicsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oJ01ha2VmaWxlJykpLnRvQmUodHJ1ZSk7XG4gICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKCdEb2NrZXJmaWxlJykpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgZGVueSBiaW5hcnkgZXh0ZW5zaW9ucycsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oJ2ZpbGUuZXhlJykpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbignZmlsZS5kbGwnKSkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKCdmaWxlLnNvJykpLnRvQmUoZmFsc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGRlbnkgaW1hZ2UgZXh0ZW5zaW9ucycsICgpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oJ2ltYWdlLnBuZycpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oJ3Bob3RvLmpwZycpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oJ2ljb24uZ2lmJykpLnRvQmUoZmFsc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGJlIGNhc2UgaW5zZW5zaXRpdmUnLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKCdGSUxFLlRYVCcpKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbignZmlsZS5NRCcpKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbignc2NyaXB0LkpTJykpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=