{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/mcp-filesystem.test.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/mcp-filesystem.test.ts"],"sourcesContent":["/**\n * MCP Filesystem Module Tests\n * 파일 경로 검증 및 확장자 검증 테스트\n */\n\nimport { describe, it, expect, mock } from 'bun:test';\n\n// UserSandbox 모킹 (bun:test 호환)\nmock.module('../mcp/user-sandbox', () => ({\n    UserSandbox: {\n        resolvePath: (userId: string | number, filePath: string) => {\n            // 기본 동작: 단순 경로 반환 (테스트용)\n            if (filePath.includes('..')) return null; // 경로 탈출 시도\n            if (filePath.startsWith('/')) return filePath;\n            return `/home/user${userId}/workspace/${filePath}`;\n        }\n    },\n    UserContext: {}\n}));\n\nimport { validateFilePath, isAllowedExtension } from '../mcp/filesystem';\n\ndescribe('MCP Filesystem Module', () => {\n    describe('validateFilePath', () => {\n        it('should validate a simple relative path', () => {\n            const result = validateFilePath(1, 'test.txt');\n\n            expect(result.valid).toBe(true);\n            expect(result.resolvedPath).toBe('/home/user1/workspace/test.txt');\n            expect(result.error).toBeUndefined();\n        });\n\n        it('should validate an absolute path', () => {\n            const result = validateFilePath(1, '/home/user1/workspace/file.md');\n\n            expect(result.valid).toBe(true);\n            expect(result.resolvedPath).toBe('/home/user1/workspace/file.md');\n        });\n\n        it('should reject path traversal attempts', () => {\n            const result = validateFilePath(1, '../../../etc/passwd');\n\n            expect(result.valid).toBe(false);\n            expect(result.resolvedPath).toBeNull();\n            expect(result.error).toBe('접근 권한이 없는 경로입니다');\n        });\n\n        it('should reject node_modules path', () => {\n            const result = validateFilePath(1, 'node_modules/package.json');\n\n            expect(result.valid).toBe(false);\n            expect(result.error).toBe('접근이 금지된 경로입니다');\n        });\n\n        it('should reject .git path', () => {\n            const result = validateFilePath(1, '.git/config');\n\n            expect(result.valid).toBe(false);\n            expect(result.error).toBe('접근이 금지된 경로입니다');\n        });\n\n        it('should reject .env file', () => {\n            const result = validateFilePath(1, '.env');\n\n            expect(result.valid).toBe(false);\n            expect(result.error).toBe('접근이 금지된 경로입니다');\n        });\n\n        it('should reject files with password in name', () => {\n            const result = validateFilePath(1, 'my_password.txt');\n\n            expect(result.valid).toBe(false);\n            expect(result.error).toBe('접근이 금지된 경로입니다');\n        });\n\n        it('should reject files with secret in name', () => {\n            const result = validateFilePath(1, 'api_secret.json');\n\n            expect(result.valid).toBe(false);\n            expect(result.error).toBe('접근이 금지된 경로입니다');\n        });\n\n        it('should reject files with credentials in name', () => {\n            const result = validateFilePath(1, 'credentials.yaml');\n\n            expect(result.valid).toBe(false);\n            expect(result.error).toBe('접근이 금지된 경로입니다');\n        });\n    });\n\n    describe('isAllowedExtension', () => {\n        describe('allowed extensions', () => {\n            const allowedExtensions = [\n                '.txt', '.md', '.json', '.yaml', '.yml', '.xml',\n                '.js', '.ts', '.jsx', '.tsx', '.css', '.html',\n                '.py', '.java', '.go', '.rs', '.c', '.cpp', '.h',\n                '.sh', '.bash', '.zsh', '.fish',\n                '.csv', '.log'\n                // Note: .env.example은 path.extname이 .example을 반환하므로 별도 테스트\n            ];\n\n            allowedExtensions.forEach(ext => {\n                it(`should allow ${ext} extension`, () => {\n                    expect(isAllowedExtension(`file${ext}`)).toBe(true);\n                });\n            });\n        });\n\n        it('should allow files without extension', () => {\n            expect(isAllowedExtension('Makefile')).toBe(true);\n            expect(isAllowedExtension('Dockerfile')).toBe(true);\n        });\n\n        it('should deny binary extensions', () => {\n            expect(isAllowedExtension('file.exe')).toBe(false);\n            expect(isAllowedExtension('file.dll')).toBe(false);\n            expect(isAllowedExtension('file.so')).toBe(false);\n        });\n\n        it('should deny image extensions', () => {\n            expect(isAllowedExtension('image.png')).toBe(false);\n            expect(isAllowedExtension('photo.jpg')).toBe(false);\n            expect(isAllowedExtension('icon.gif')).toBe(false);\n        });\n\n        it('should be case insensitive', () => {\n            expect(isAllowedExtension('FILE.TXT')).toBe(true);\n            expect(isAllowedExtension('file.MD')).toBe(true);\n            expect(isAllowedExtension('script.JS')).toBe(true);\n        });\n    });\n});\n"],"version":3}