{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/utils/error-handler.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/utils/error-handler.ts"],"sourcesContent":["/**\n * Unified Error Handler\n * Standardized error handling across all routes\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport { createLogger } from './logger';\n\nconst logger = createLogger('ErrorHandler');\n\n/**\n * Base application error class\n */\nexport class AppError extends Error {\n    public readonly statusCode: number;\n    public readonly isOperational: boolean;\n    public readonly code?: string;\n\n    constructor(\n        message: string,\n        statusCode: number = 500,\n        isOperational: boolean = true,\n        code?: string\n    ) {\n        super(message);\n        this.statusCode = statusCode;\n        this.isOperational = isOperational;\n        this.code = code;\n        \n        Object.setPrototypeOf(this, new.target.prototype);\n        Error.captureStackTrace(this, this.constructor);\n    }\n}\n\n/**\n * Validation error (400)\n */\nexport class ValidationError extends AppError {\n    constructor(message: string) {\n        super(message, 400, true, 'VALIDATION_ERROR');\n    }\n}\n\n/**\n * Authentication error (401)\n */\nexport class AuthenticationError extends AppError {\n    constructor(message: string = '인증이 필요합니다') {\n        super(message, 401, true, 'AUTHENTICATION_ERROR');\n    }\n}\n\n/**\n * Authorization error (403)\n */\nexport class AuthorizationError extends AppError {\n    constructor(message: string = '권한이 없습니다') {\n        super(message, 403, true, 'AUTHORIZATION_ERROR');\n    }\n}\n\n/**\n * Not found error (404)\n */\nexport class NotFoundError extends AppError {\n    constructor(message: string = '리소스를 찾을 수 없습니다') {\n        super(message, 404, true, 'NOT_FOUND');\n    }\n}\n\n/**\n * Rate limit error (429)\n */\nexport class RateLimitError extends AppError {\n    constructor(message: string = '요청 제한을 초과했습니다') {\n        super(message, 429, true, 'RATE_LIMIT_EXCEEDED');\n    }\n}\n\n/**\n * Database error (500)\n */\nexport class DatabaseError extends AppError {\n    constructor(message: string = '데이터베이스 오류가 발생했습니다') {\n        super(message, 500, true, 'DATABASE_ERROR');\n    }\n}\n\n/**\n * Standard error response interface\n */\nexport interface ErrorResponse {\n    success: false;\n    error: string;\n    code?: string;\n    details?: string[];\n    timestamp: string;\n    stack?: string;\n}\n\n/**\n * Format error for response\n */\nfunction formatError(err: Error, includeStack: boolean): ErrorResponse {\n    const response: ErrorResponse = {\n        success: false,\n        error: err.message,\n        timestamp: new Date().toISOString()\n    };\n\n    if (err instanceof AppError && err.code) {\n        response.code = err.code;\n    }\n\n    if (includeStack && err.stack) {\n        response.stack = err.stack;\n    }\n\n    return response;\n}\n\n/**\n * Global error handler middleware\n * Must be registered LAST after all routes\n */\nexport function errorHandler(\n    err: Error,\n    req: Request,\n    res: Response,\n    _next: NextFunction\n): void {\n    // Log error\n    logger.error(`[${req.method}] ${req.path}: ${err.message}`, {\n        stack: err.stack,\n        body: req.body,\n        query: req.query\n    });\n\n    // Determine status code\n    const statusCode = err instanceof AppError ? err.statusCode : 500;\n    const includeStack = process.env.NODE_ENV === 'development';\n\n    // Send response\n    res.status(statusCode).json(formatError(err, includeStack));\n}\n\n/**\n * Async handler wrapper to catch async errors\n * Wraps async route handlers to forward errors to error middleware\n */\nexport function asyncHandler(\n    fn: (req: Request, res: Response, next: NextFunction) => Promise<unknown>\n) {\n    return (req: Request, res: Response, next: NextFunction): void => {\n        Promise.resolve(fn(req, res, next)).catch(next);\n    };\n}\n\n/**\n * Not found handler for undefined routes\n */\nexport function notFoundHandler(req: Request, res: Response, next: NextFunction): void {\n    next(new NotFoundError(`Route not found: ${req.method} ${req.path}`));\n}\n"],"version":3}