66d9624d2820aa69a1914b1659e925ec
"use strict";
/**
 * Unified Error Handler
 * Standardized error handling across all routes
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.DatabaseError = exports.RateLimitError = exports.NotFoundError = exports.AuthorizationError = exports.AuthenticationError = exports.ValidationError = exports.AppError = void 0;
exports.errorHandler = errorHandler;
exports.asyncHandler = asyncHandler;
exports.notFoundHandler = notFoundHandler;
const logger_1 = require("./logger");
const logger = (0, logger_1.createLogger)('ErrorHandler');
/**
 * Base application error class
 */
class AppError extends Error {
    constructor(message, statusCode = 500, isOperational = true, code) {
        super(message);
        this.statusCode = statusCode;
        this.isOperational = isOperational;
        this.code = code;
        Object.setPrototypeOf(this, new.target.prototype);
        Error.captureStackTrace(this, this.constructor);
    }
}
exports.AppError = AppError;
/**
 * Validation error (400)
 */
class ValidationError extends AppError {
    constructor(message) {
        super(message, 400, true, 'VALIDATION_ERROR');
    }
}
exports.ValidationError = ValidationError;
/**
 * Authentication error (401)
 */
class AuthenticationError extends AppError {
    constructor(message = '인증이 필요합니다') {
        super(message, 401, true, 'AUTHENTICATION_ERROR');
    }
}
exports.AuthenticationError = AuthenticationError;
/**
 * Authorization error (403)
 */
class AuthorizationError extends AppError {
    constructor(message = '권한이 없습니다') {
        super(message, 403, true, 'AUTHORIZATION_ERROR');
    }
}
exports.AuthorizationError = AuthorizationError;
/**
 * Not found error (404)
 */
class NotFoundError extends AppError {
    constructor(message = '리소스를 찾을 수 없습니다') {
        super(message, 404, true, 'NOT_FOUND');
    }
}
exports.NotFoundError = NotFoundError;
/**
 * Rate limit error (429)
 */
class RateLimitError extends AppError {
    constructor(message = '요청 제한을 초과했습니다') {
        super(message, 429, true, 'RATE_LIMIT_EXCEEDED');
    }
}
exports.RateLimitError = RateLimitError;
/**
 * Database error (500)
 */
class DatabaseError extends AppError {
    constructor(message = '데이터베이스 오류가 발생했습니다') {
        super(message, 500, true, 'DATABASE_ERROR');
    }
}
exports.DatabaseError = DatabaseError;
/**
 * Format error for response
 */
function formatError(err, includeStack) {
    const response = {
        success: false,
        error: err.message,
        timestamp: new Date().toISOString()
    };
    if (err instanceof AppError && err.code) {
        response.code = err.code;
    }
    if (includeStack && err.stack) {
        response.stack = err.stack;
    }
    return response;
}
/**
 * Global error handler middleware
 * Must be registered LAST after all routes
 */
function errorHandler(err, req, res, _next) {
    // Log error
    logger.error(`[${req.method}] ${req.path}: ${err.message}`, {
        stack: err.stack,
        body: req.body,
        query: req.query
    });
    // Determine status code
    const statusCode = err instanceof AppError ? err.statusCode : 500;
    const includeStack = process.env.NODE_ENV === 'development';
    // Send response
    res.status(statusCode).json(formatError(err, includeStack));
}
/**
 * Async handler wrapper to catch async errors
 * Wraps async route handlers to forward errors to error middleware
 */
function asyncHandler(fn) {
    return (req, res, next) => {
        Promise.resolve(fn(req, res, next)).catch(next);
    };
}
/**
 * Not found handler for undefined routes
 */
function notFoundHandler(req, res, next) {
    next(new NotFoundError(`Route not found: ${req.method} ${req.path}`));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL3V0aWxzL2Vycm9yLWhhbmRsZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBMEhILG9DQW1CQztBQU1ELG9DQU1DO0FBS0QsMENBRUM7QUE3SkQscUNBQXdDO0FBRXhDLE1BQU0sTUFBTSxHQUFHLElBQUEscUJBQVksRUFBQyxjQUFjLENBQUMsQ0FBQztBQUU1Qzs7R0FFRztBQUNILE1BQWEsUUFBUyxTQUFRLEtBQUs7SUFLL0IsWUFDSSxPQUFlLEVBQ2YsYUFBcUIsR0FBRyxFQUN4QixnQkFBeUIsSUFBSSxFQUM3QixJQUFhO1FBRWIsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDN0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7UUFDbkMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFFakIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNsRCxLQUFLLENBQUMsaUJBQWlCLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNwRCxDQUFDO0NBQ0o7QUFuQkQsNEJBbUJDO0FBRUQ7O0dBRUc7QUFDSCxNQUFhLGVBQWdCLFNBQVEsUUFBUTtJQUN6QyxZQUFZLE9BQWU7UUFDdkIsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLGtCQUFrQixDQUFDLENBQUM7SUFDbEQsQ0FBQztDQUNKO0FBSkQsMENBSUM7QUFFRDs7R0FFRztBQUNILE1BQWEsbUJBQW9CLFNBQVEsUUFBUTtJQUM3QyxZQUFZLFVBQWtCLFdBQVc7UUFDckMsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLHNCQUFzQixDQUFDLENBQUM7SUFDdEQsQ0FBQztDQUNKO0FBSkQsa0RBSUM7QUFF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RDs7R0FFRztBQUNILFNBQWdCLGVBQWUsQ0FBQyxHQUFZLEVBQUUsR0FBYSxFQUFFLElBQWtCO0lBQzNFLElBQUksQ0FBQyxJQUFJLGFBQWEsQ0FBQyxvQkFBb0IsR0FBRyxDQUFDLE1BQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzFFLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL3V0aWxzL2Vycm9yLWhhbmRsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBVbmlmaWVkIEVycm9yIEhhbmRsZXJcbiAqIFN0YW5kYXJkaXplZCBlcnJvciBoYW5kbGluZyBhY3Jvc3MgYWxsIHJvdXRlc1xuICovXG5cbmltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlLCBOZXh0RnVuY3Rpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IGNyZWF0ZUxvZ2dlciB9IGZyb20gJy4vbG9nZ2VyJztcblxuY29uc3QgbG9nZ2VyID0gY3JlYXRlTG9nZ2VyKCdFcnJvckhhbmRsZXInKTtcblxuLyoqXG4gKiBCYXNlIGFwcGxpY2F0aW9uIGVycm9yIGNsYXNzXG4gKi9cbmV4cG9ydCBjbGFzcyBBcHBFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBwdWJsaWMgcmVhZG9ubHkgc3RhdHVzQ29kZTogbnVtYmVyO1xuICAgIHB1YmxpYyByZWFkb25seSBpc09wZXJhdGlvbmFsOiBib29sZWFuO1xuICAgIHB1YmxpYyByZWFkb25seSBjb2RlPzogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICAgICAgc3RhdHVzQ29kZTogbnVtYmVyID0gNTAwLFxuICAgICAgICBpc09wZXJhdGlvbmFsOiBib29sZWFuID0gdHJ1ZSxcbiAgICAgICAgY29kZT86IHN0cmluZ1xuICAgICkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgdGhpcy5zdGF0dXNDb2RlID0gc3RhdHVzQ29kZTtcbiAgICAgICAgdGhpcy5pc09wZXJhdGlvbmFsID0gaXNPcGVyYXRpb25hbDtcbiAgICAgICAgdGhpcy5jb2RlID0gY29kZTtcbiAgICAgICAgXG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBuZXcudGFyZ2V0LnByb3RvdHlwZSk7XG4gICAgICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIHRoaXMuY29uc3RydWN0b3IpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0aW9uIGVycm9yICg0MDApXG4gKi9cbmV4cG9ydCBjbGFzcyBWYWxpZGF0aW9uRXJyb3IgZXh0ZW5kcyBBcHBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UsIDQwMCwgdHJ1ZSwgJ1ZBTElEQVRJT05fRVJST1InKTtcbiAgICB9XG59XG5cbi8qKlxuICogQXV0aGVudGljYXRpb24gZXJyb3IgKDQwMSlcbiAqL1xuZXhwb3J0IGNsYXNzIEF1dGhlbnRpY2F0aW9uRXJyb3IgZXh0ZW5kcyBBcHBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nID0gJ+yduOymneydtCDtlYTsmpTtlanri4jri6QnKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UsIDQwMSwgdHJ1ZSwgJ0FVVEhFTlRJQ0FUSU9OX0VSUk9SJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEF1dGhvcml6YXRpb24gZXJyb3IgKDQwMylcbiAqL1xuZXhwb3J0IGNsYXNzIEF1dGhvcml6YXRpb25FcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcgPSAn6raM7ZWc7J20IOyXhuyKteuLiOuLpCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgNDAzLCB0cnVlLCAnQVVUSE9SSVpBVElPTl9FUlJPUicpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBOb3QgZm91bmQgZXJyb3IgKDQwNClcbiAqL1xuZXhwb3J0IGNsYXNzIE5vdEZvdW5kRXJyb3IgZXh0ZW5kcyBBcHBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nID0gJ+umrOyGjOyKpOulvCDssL7snYQg7IiYIOyXhuyKteuLiOuLpCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgNDA0LCB0cnVlLCAnTk9UX0ZPVU5EJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIFJhdGUgbGltaXQgZXJyb3IgKDQyOSlcbiAqL1xuZXhwb3J0IGNsYXNzIFJhdGVMaW1pdEVycm9yIGV4dGVuZHMgQXBwRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZyA9ICfsmpTssq0g7KCc7ZWc7J2EIOy0iOqzvO2WiOyKteuLiOuLpCcpIHtcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgNDI5LCB0cnVlLCAnUkFURV9MSU1JVF9FWENFRURFRCcpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBEYXRhYmFzZSBlcnJvciAoNTAwKVxuICovXG5leHBvcnQgY2xhc3MgRGF0YWJhc2VFcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcgPSAn642w7J207YSw67Kg7J207IqkIOyYpOulmOqwgCDrsJzsg53tlojsirXri4jri6QnKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UsIDUwMCwgdHJ1ZSwgJ0RBVEFCQVNFX0VSUk9SJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIFN0YW5kYXJkIGVycm9yIHJlc3BvbnNlIGludGVyZmFjZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEVycm9yUmVzcG9uc2Uge1xuICAgIHN1Y2Nlc3M6IGZhbHNlO1xuICAgIGVycm9yOiBzdHJpbmc7XG4gICAgY29kZT86IHN0cmluZztcbiAgICBkZXRhaWxzPzogc3RyaW5nW107XG4gICAgdGltZXN0YW1wOiBzdHJpbmc7XG4gICAgc3RhY2s/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogRm9ybWF0IGVycm9yIGZvciByZXNwb25zZVxuICovXG5mdW5jdGlvbiBmb3JtYXRFcnJvcihlcnI6IEVycm9yLCBpbmNsdWRlU3RhY2s6IGJvb2xlYW4pOiBFcnJvclJlc3BvbnNlIHtcbiAgICBjb25zdCByZXNwb25zZTogRXJyb3JSZXNwb25zZSA9IHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnIubWVzc2FnZSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICB9O1xuXG4gICAgaWYgKGVyciBpbnN0YW5jZW9mIEFwcEVycm9yICYmIGVyci5jb2RlKSB7XG4gICAgICAgIHJlc3BvbnNlLmNvZGUgPSBlcnIuY29kZTtcbiAgICB9XG5cbiAgICBpZiAoaW5jbHVkZVN0YWNrICYmIGVyci5zdGFjaykge1xuICAgICAgICByZXNwb25zZS5zdGFjayA9IGVyci5zdGFjaztcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzcG9uc2U7XG59XG5cbi8qKlxuICogR2xvYmFsIGVycm9yIGhhbmRsZXIgbWlkZGxld2FyZVxuICogTXVzdCBiZSByZWdpc3RlcmVkIExBU1QgYWZ0ZXIgYWxsIHJvdXRlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKFxuICAgIGVycjogRXJyb3IsXG4gICAgcmVxOiBSZXF1ZXN0LFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgX25leHQ6IE5leHRGdW5jdGlvblxuKTogdm9pZCB7XG4gICAgLy8gTG9nIGVycm9yXG4gICAgbG9nZ2VyLmVycm9yKGBbJHtyZXEubWV0aG9kfV0gJHtyZXEucGF0aH06ICR7ZXJyLm1lc3NhZ2V9YCwge1xuICAgICAgICBzdGFjazogZXJyLnN0YWNrLFxuICAgICAgICBib2R5OiByZXEuYm9keSxcbiAgICAgICAgcXVlcnk6IHJlcS5xdWVyeVxuICAgIH0pO1xuXG4gICAgLy8gRGV0ZXJtaW5lIHN0YXR1cyBjb2RlXG4gICAgY29uc3Qgc3RhdHVzQ29kZSA9IGVyciBpbnN0YW5jZW9mIEFwcEVycm9yID8gZXJyLnN0YXR1c0NvZGUgOiA1MDA7XG4gICAgY29uc3QgaW5jbHVkZVN0YWNrID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCc7XG5cbiAgICAvLyBTZW5kIHJlc3BvbnNlXG4gICAgcmVzLnN0YXR1cyhzdGF0dXNDb2RlKS5qc29uKGZvcm1hdEVycm9yKGVyciwgaW5jbHVkZVN0YWNrKSk7XG59XG5cbi8qKlxuICogQXN5bmMgaGFuZGxlciB3cmFwcGVyIHRvIGNhdGNoIGFzeW5jIGVycm9yc1xuICogV3JhcHMgYXN5bmMgcm91dGUgaGFuZGxlcnMgdG8gZm9yd2FyZCBlcnJvcnMgdG8gZXJyb3IgbWlkZGxld2FyZVxuICovXG5leHBvcnQgZnVuY3Rpb24gYXN5bmNIYW5kbGVyKFxuICAgIGZuOiAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pID0+IFByb21pc2U8dW5rbm93bj5cbikge1xuICAgIHJldHVybiAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pOiB2b2lkID0+IHtcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKGZuKHJlcSwgcmVzLCBuZXh0KSkuY2F0Y2gobmV4dCk7XG4gICAgfTtcbn1cblxuLyoqXG4gKiBOb3QgZm91bmQgaGFuZGxlciBmb3IgdW5kZWZpbmVkIHJvdXRlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gbm90Rm91bmRIYW5kbGVyKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKTogdm9pZCB7XG4gICAgbmV4dChuZXcgTm90Rm91bmRFcnJvcihgUm91dGUgbm90IGZvdW5kOiAke3JlcS5tZXRob2R9ICR7cmVxLnBhdGh9YCkpO1xufVxuIl0sInZlcnNpb24iOjN9