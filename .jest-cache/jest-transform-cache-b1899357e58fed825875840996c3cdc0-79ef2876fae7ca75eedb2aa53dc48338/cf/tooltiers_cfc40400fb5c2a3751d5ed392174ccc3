f039f82731d263a7c6ebb16b2e5cac64
"use strict";
/**
 * MCP 도구 등급별 접근 제어
 *
 * 사용자 tier에 따라 접근 가능한 도구를 정의합니다.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.TOOL_TIERS = void 0;
exports.canUseTool = canUseTool;
exports.getToolsForTier = getToolsForTier;
exports.getDefaultTierForRole = getDefaultTierForRole;
const types_1 = require("./types");
/**
 * 등급별 허용 도구 목록
 * - '*' 는 모든 도구 허용
 * - 'tool_*' 패턴은 해당 접두사로 시작하는 모든 도구 허용
 */
exports.TOOL_TIERS = {
    free: [
        'web_search', // 웹 검색
        'vision_ocr', // 이미지 OCR
        'analyze_image', // 이미지 분석
    ],
    pro: [
        'web_search',
        'vision_ocr',
        'analyze_image',
        'run_command', // 명령어 실행
        'firecrawl_*', // Firecrawl 관련 모든 도구
        'sequential_thinking', // Sequential Thinking
    ],
    enterprise: [
        '*', // 모든 도구 허용
    ]
};
/**
 * 특정 tier가 특정 도구에 접근 가능한지 확인
 */
function canUseTool(tier, toolName) {
    const allowedTools = exports.TOOL_TIERS[tier];
    // 모든 도구 허용
    if (allowedTools.includes('*')) {
        return true;
    }
    // 외부 도구 (:: 네임스페이스) — free 등급에서는 접근 불가
    if (toolName.includes(types_1.MCP_NAMESPACE_SEPARATOR)) {
        if (tier === 'free') {
            return false;
        }
        // pro/enterprise: 와일드카드 패턴으로 서버 단위 접근 제어 가능
        // 예: TOOL_TIERS.pro에 "postgres::*" 추가 가능
        for (const pattern of allowedTools) {
            if (pattern.endsWith('*')) {
                const prefix = pattern.slice(0, -1);
                if (toolName.startsWith(prefix)) {
                    return true;
                }
            }
            if (pattern === toolName) {
                return true;
            }
        }
        // pro 등급: 기본적으로 모든 외부 도구 허용
        if (tier === 'pro') {
            return true;
        }
        return false;
    }
    // 정확한 매칭
    if (allowedTools.includes(toolName)) {
        return true;
    }
    // 와일드카드 패턴 매칭 (예: 'firecrawl_*')
    for (const pattern of allowedTools) {
        if (pattern.endsWith('*')) {
            const prefix = pattern.slice(0, -1);
            if (toolName.startsWith(prefix)) {
                return true;
            }
        }
    }
    return false;
}
/**
 * 특정 tier가 접근 가능한 도구 목록 반환
 */
function getToolsForTier(tier, allTools) {
    const allowedTools = exports.TOOL_TIERS[tier];
    // 모든 도구 허용
    if (allowedTools.includes('*')) {
        return allTools;
    }
    return allTools.filter(toolName => canUseTool(tier, toolName));
}
/**
 * 기본 tier 반환 (role 기반)
 */
function getDefaultTierForRole(role) {
    switch (role) {
        case 'admin':
            return 'enterprise';
        case 'user':
            return 'free';
        case 'guest':
            return 'free';
        default:
            return 'free';
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL21jcC90b29sLXRpZXJzLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7OztHQUlHOzs7QUFnQ0gsZ0NBaURDO0FBS0QsMENBU0M7QUFLRCxzREFXQztBQTVHRCxtQ0FBa0Q7QUFFbEQ7Ozs7R0FJRztBQUNVLFFBQUEsVUFBVSxHQUErQjtJQUNsRCxJQUFJLEVBQUU7UUFDRixZQUFZLEVBQVksT0FBTztRQUMvQixZQUFZLEVBQVksVUFBVTtRQUNsQyxlQUFlLEVBQVMsU0FBUztLQUNwQztJQUNELEdBQUcsRUFBRTtRQUNELFlBQVk7UUFDWixZQUFZO1FBQ1osZUFBZTtRQUNmLGFBQWEsRUFBVyxTQUFTO1FBQ2pDLGFBQWEsRUFBVyxxQkFBcUI7UUFDN0MscUJBQXFCLEVBQUcsc0JBQXNCO0tBQ2pEO0lBQ0QsVUFBVSxFQUFFO1FBQ1IsR0FBRyxFQUFxQixXQUFXO0tBQ3RDO0NBQ0osQ0FBQztBQUVGOztHQUVHO0FBQ0gsU0FBZ0IsVUFBVSxDQUFDLElBQWMsRUFBRSxRQUFnQjtJQUN2RCxNQUFNLFlBQVksR0FBRyxrQkFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXRDLFdBQVc7SUFDWCxJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUM3QixPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRUQsdUNBQXVDO0lBQ3ZDLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQywrQkFBdUIsQ0FBQyxFQUFFLENBQUM7UUFDN0MsSUFBSSxJQUFJLEtBQUssTUFBTSxFQUFFLENBQUM7WUFDbEIsT0FBTyxLQUFLLENBQUM7UUFDakIsQ0FBQztRQUNELDRDQUE0QztRQUM1Qyx5Q0FBeUM7UUFDekMsS0FBSyxNQUFNLE9BQU8sSUFBSSxZQUFZLEVBQUUsQ0FBQztZQUNqQyxJQUFJLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDeEIsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDcEMsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7b0JBQzlCLE9BQU8sSUFBSSxDQUFDO2dCQUNoQixDQUFDO1lBQ0wsQ0FBQztZQUNELElBQUksT0FBTyxLQUFLLFFBQVEsRUFBRSxDQUFDO2dCQUN2QixPQUFPLElBQUksQ0FBQztZQUNoQixDQUFDO1FBQ0wsQ0FBQztRQUNELDRCQUE0QjtRQUM1QixJQUFJLElBQUksS0FBSyxLQUFLLEVBQUUsQ0FBQztZQUNqQixPQUFPLElBQUksQ0FBQztRQUNoQixDQUFDO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUVELFNBQVM7SUFDVCxJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztRQUNsQyxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRUQsaUNBQWlDO0lBQ2pDLEtBQUssTUFBTSxPQUFPLElBQUksWUFBWSxFQUFFLENBQUM7UUFDakMsSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDeEIsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwQyxJQUFJLFFBQVEsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztnQkFDOUIsT0FBTyxJQUFJLENBQUM7WUFDaEIsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDO0lBRUQsT0FBTyxLQUFLLENBQUM7QUFDakIsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsZUFBZSxDQUFDLElBQWMsRUFBRSxRQUFrQjtJQUM5RCxNQUFNLFlBQVksR0FBRyxrQkFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXRDLFdBQVc7SUFDWCxJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUM3QixPQUFPLFFBQVEsQ0FBQztJQUNwQixDQUFDO0lBRUQsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO0FBQ25FLENBQUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLHFCQUFxQixDQUFDLElBQWdDO0lBQ2xFLFFBQVEsSUFBSSxFQUFFLENBQUM7UUFDWCxLQUFLLE9BQU87WUFDUixPQUFPLFlBQVksQ0FBQztRQUN4QixLQUFLLE1BQU07WUFDUCxPQUFPLE1BQU0sQ0FBQztRQUNsQixLQUFLLE9BQU87WUFDUixPQUFPLE1BQU0sQ0FBQztRQUNsQjtZQUNJLE9BQU8sTUFBTSxDQUFDO0lBQ3RCLENBQUM7QUFDTCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Wb2x1bWVzL01BQ19BUFAvb3Blbm1ha2VfbGxtL2JhY2tlbmQvYXBpL3NyYy9tY3AvdG9vbC10aWVycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1DUCDrj4Tqtawg65Ox6riJ67OEIOygkeq3vCDsoJzslrRcbiAqIFxuICog7IKs7Jqp7J6QIHRpZXLsl5Ag65Sw6528IOygkeq3vCDqsIDriqXtlZwg64+E6rWs66W8IOygleydmO2VqeuLiOuLpC5cbiAqL1xuXG5pbXBvcnQgeyBVc2VyVGllciB9IGZyb20gJy4uL2RhdGEvdXNlci1tYW5hZ2VyJztcbmltcG9ydCB7IE1DUF9OQU1FU1BBQ0VfU0VQQVJBVE9SIH0gZnJvbSAnLi90eXBlcyc7XG5cbi8qKlxuICog65Ox6riJ67OEIO2XiOyaqSDrj4Tqtawg66qp66GdXG4gKiAtICcqJyDripQg66qo65OgIOuPhOq1rCDtl4jsmqlcbiAqIC0gJ3Rvb2xfKicg7Yyo7YS07J2AIO2VtOuLuSDsoJHrkZDsgqzroZwg7Iuc7J6R7ZWY64qUIOuqqOuToCDrj4Tqtawg7ZeI7JqpXG4gKi9cbmV4cG9ydCBjb25zdCBUT09MX1RJRVJTOiBSZWNvcmQ8VXNlclRpZXIsIHN0cmluZ1tdPiA9IHtcbiAgICBmcmVlOiBbXG4gICAgICAgICd3ZWJfc2VhcmNoJywgICAgICAgICAgIC8vIOybuSDqsoDsg4lcbiAgICAgICAgJ3Zpc2lvbl9vY3InLCAgICAgICAgICAgLy8g7J2066+47KeAIE9DUlxuICAgICAgICAnYW5hbHl6ZV9pbWFnZScsICAgICAgICAvLyDsnbTrr7jsp4Ag67aE7ISdXG4gICAgXSxcbiAgICBwcm86IFtcbiAgICAgICAgJ3dlYl9zZWFyY2gnLFxuICAgICAgICAndmlzaW9uX29jcicsXG4gICAgICAgICdhbmFseXplX2ltYWdlJyxcbiAgICAgICAgJ3J1bl9jb21tYW5kJywgICAgICAgICAgLy8g66qF66C57Ja0IOyLpO2WiVxuICAgICAgICAnZmlyZWNyYXdsXyonLCAgICAgICAgICAvLyBGaXJlY3Jhd2wg6rSA66CoIOuqqOuToCDrj4TqtaxcbiAgICAgICAgJ3NlcXVlbnRpYWxfdGhpbmtpbmcnLCAgLy8gU2VxdWVudGlhbCBUaGlua2luZ1xuICAgIF0sXG4gICAgZW50ZXJwcmlzZTogW1xuICAgICAgICAnKicsICAgICAgICAgICAgICAgICAgICAvLyDrqqjrk6Ag64+E6rWsIO2XiOyaqVxuICAgIF1cbn07XG5cbi8qKlxuICog7Yq57KCVIHRpZXLqsIAg7Yq57KCVIOuPhOq1rOyXkCDsoJHqt7wg6rCA64ql7ZWc7KeAIO2ZleyduFxuICovXG5leHBvcnQgZnVuY3Rpb24gY2FuVXNlVG9vbCh0aWVyOiBVc2VyVGllciwgdG9vbE5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGFsbG93ZWRUb29scyA9IFRPT0xfVElFUlNbdGllcl07XG5cbiAgICAvLyDrqqjrk6Ag64+E6rWsIO2XiOyaqVxuICAgIGlmIChhbGxvd2VkVG9vbHMuaW5jbHVkZXMoJyonKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyDsmbjrtoAg64+E6rWsICg6OiDrhKTsnoTsiqTtjpjsnbTsiqQpIOKAlCBmcmVlIOuTseq4ieyXkOyEnOuKlCDsoJHqt7wg67aI6rCAXG4gICAgaWYgKHRvb2xOYW1lLmluY2x1ZGVzKE1DUF9OQU1FU1BBQ0VfU0VQQVJBVE9SKSkge1xuICAgICAgICBpZiAodGllciA9PT0gJ2ZyZWUnKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcHJvL2VudGVycHJpc2U6IOyZgOydvOuTnOy5tOuTnCDtjKjthLTsnLzroZwg7ISc67KEIOuLqOychCDsoJHqt7wg7KCc7Ja0IOqwgOuKpVxuICAgICAgICAvLyDsmIg6IFRPT0xfVElFUlMucHJv7JeQIFwicG9zdGdyZXM6OipcIiDstpTqsIAg6rCA64qlXG4gICAgICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBhbGxvd2VkVG9vbHMpIHtcbiAgICAgICAgICAgIGlmIChwYXR0ZXJuLmVuZHNXaXRoKCcqJykpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXggPSBwYXR0ZXJuLnNsaWNlKDAsIC0xKTtcbiAgICAgICAgICAgICAgICBpZiAodG9vbE5hbWUuc3RhcnRzV2l0aChwcmVmaXgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwYXR0ZXJuID09PSB0b29sTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHBybyDrk7HquIk6IOq4sOuzuOyggeycvOuhnCDrqqjrk6Ag7Jm467aAIOuPhOq1rCDtl4jsmqlcbiAgICAgICAgaWYgKHRpZXIgPT09ICdwcm8nKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8g7KCV7ZmV7ZWcIOunpOy5rVxuICAgIGlmIChhbGxvd2VkVG9vbHMuaW5jbHVkZXModG9vbE5hbWUpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIOyZgOydvOuTnOy5tOuTnCDtjKjthLQg66ek7LmtICjsmIg6ICdmaXJlY3Jhd2xfKicpXG4gICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGFsbG93ZWRUb29scykge1xuICAgICAgICBpZiAocGF0dGVybi5lbmRzV2l0aCgnKicpKSB7XG4gICAgICAgICAgICBjb25zdCBwcmVmaXggPSBwYXR0ZXJuLnNsaWNlKDAsIC0xKTtcbiAgICAgICAgICAgIGlmICh0b29sTmFtZS5zdGFydHNXaXRoKHByZWZpeCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiDtirnsoJUgdGllcuqwgCDsoJHqt7wg6rCA64ql7ZWcIOuPhOq1rCDrqqnroZ0g67CY7ZmYXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRUb29sc0ZvclRpZXIodGllcjogVXNlclRpZXIsIGFsbFRvb2xzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBhbGxvd2VkVG9vbHMgPSBUT09MX1RJRVJTW3RpZXJdO1xuXG4gICAgLy8g66qo65OgIOuPhOq1rCDtl4jsmqlcbiAgICBpZiAoYWxsb3dlZFRvb2xzLmluY2x1ZGVzKCcqJykpIHtcbiAgICAgICAgcmV0dXJuIGFsbFRvb2xzO1xuICAgIH1cblxuICAgIHJldHVybiBhbGxUb29scy5maWx0ZXIodG9vbE5hbWUgPT4gY2FuVXNlVG9vbCh0aWVyLCB0b29sTmFtZSkpO1xufVxuXG4vKipcbiAqIOq4sOuzuCB0aWVyIOuwmO2ZmCAocm9sZSDquLDrsJgpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0VGllckZvclJvbGUocm9sZTogJ2FkbWluJyB8ICd1c2VyJyB8ICdndWVzdCcpOiBVc2VyVGllciB7XG4gICAgc3dpdGNoIChyb2xlKSB7XG4gICAgICAgIGNhc2UgJ2FkbWluJzpcbiAgICAgICAgICAgIHJldHVybiAnZW50ZXJwcmlzZSc7XG4gICAgICAgIGNhc2UgJ3VzZXInOlxuICAgICAgICAgICAgcmV0dXJuICdmcmVlJztcbiAgICAgICAgY2FzZSAnZ3Vlc3QnOlxuICAgICAgICAgICAgcmV0dXJuICdmcmVlJztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiAnZnJlZSc7XG4gICAgfVxufVxuIl0sInZlcnNpb24iOjN9