{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/config/env.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/config/env.ts"],"sourcesContent":["// 환경 설정 로더\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nexport interface EnvConfig {\n    ollamaBaseUrl: string;\n    ollamaDefaultModel: string;\n    ollamaKoreanModel: string;  // 한국어 특화 모델\n    ollamaTimeout: number;\n    // 로그 레벨\n    logLevel: 'debug' | 'info' | 'warn' | 'error';\n    // Gemini 전용 설정\n    geminiThinkEnabled: boolean;\n    geminiThinkLevel: 'low' | 'medium' | 'high';\n    geminiNumCtx: number;\n    geminiEmbeddingModel: string;\n    geminiWebSearchEnabled: boolean;\n}\n\nconst DEFAULT_CONFIG: EnvConfig = {\n    ollamaBaseUrl: 'http://localhost:11434',\n    ollamaDefaultModel: 'gemini-3-flash-preview:cloud',\n    ollamaKoreanModel: 'gemini-3-flash-preview:cloud',\n    ollamaTimeout: 120000,\n    logLevel: 'info',\n    // Gemini 전용 설정\n    geminiThinkEnabled: true,\n    geminiThinkLevel: 'high' as const,\n    geminiNumCtx: 32768,\n    geminiEmbeddingModel: 'gemini-3-flash-preview:cloud',\n    geminiWebSearchEnabled: true,\n};\n\nfunction parseEnvFile(filePath: string): Record<string, string> {\n    const env: Record<string, string> = {};\n\n    if (!fs.existsSync(filePath)) {\n        return env;\n    }\n\n    const content = fs.readFileSync(filePath, 'utf-8');\n    const lines = content.split('\\n');\n\n    for (const line of lines) {\n        const trimmed = line.trim();\n\n        // 빈 줄이나 주석 건너뛰기\n        if (!trimmed || trimmed.startsWith('#')) {\n            continue;\n        }\n\n        const equalIndex = trimmed.indexOf('=');\n        if (equalIndex > 0) {\n            const key = trimmed.substring(0, equalIndex).trim();\n            const value = trimmed.substring(equalIndex + 1).trim();\n            env[key] = value;\n        }\n    }\n\n    return env;\n}\n\nfunction parseLogLevel(value: string | undefined): 'debug' | 'info' | 'warn' | 'error' {\n    const level = (value || '').toLowerCase();\n    if (level === 'debug' || level === 'info' || level === 'warn' || level === 'error') {\n        return level;\n    }\n    return DEFAULT_CONFIG.logLevel;\n}\n\n/**\n * 필수 환경 변수 검증\n * 런타임 시작 전에 호출하여 설정 오류를 조기에 발견\n */\nexport function validateConfig(config: EnvConfig): void {\n    const errors: string[] = [];\n\n    // URL 검증\n    if (!config.ollamaBaseUrl || !config.ollamaBaseUrl.startsWith('http')) {\n        errors.push(`Invalid OLLAMA_BASE_URL: ${config.ollamaBaseUrl}`);\n    }\n\n    // 모델 이름 검증\n    if (!config.ollamaDefaultModel || config.ollamaDefaultModel.trim() === '') {\n        errors.push('OLLAMA_DEFAULT_MODEL is required');\n    }\n\n    // 타임아웃 검증\n    if (config.ollamaTimeout <= 0 || config.ollamaTimeout > 600000) {\n        errors.push(`Invalid OLLAMA_TIMEOUT: ${config.ollamaTimeout} (must be between 1-600000ms)`);\n    }\n\n    if (errors.length > 0) {\n        throw new Error(`Configuration validation failed:\\n${errors.join('\\n')}`);\n    }\n}\n\nexport function loadConfig(): EnvConfig {\n    // 프로젝트 루트에서 .env 파일 찾기\n    const envPath = path.resolve(process.cwd(), '.env');\n    const projectEnvPath = path.resolve(__dirname, '../../.env');\n\n    // 환경변수 우선순위: process.env > .env 파일 > 기본값\n    const fileEnv = parseEnvFile(fs.existsSync(envPath) ? envPath : projectEnvPath);\n\n    return {\n        ollamaBaseUrl: process.env.OLLAMA_BASE_URL || fileEnv.OLLAMA_BASE_URL || DEFAULT_CONFIG.ollamaBaseUrl,\n        ollamaDefaultModel: process.env.OLLAMA_DEFAULT_MODEL || fileEnv.OLLAMA_DEFAULT_MODEL || DEFAULT_CONFIG.ollamaDefaultModel,\n        ollamaKoreanModel: process.env.OLLAMA_KOREAN_MODEL || fileEnv.OLLAMA_KOREAN_MODEL || DEFAULT_CONFIG.ollamaKoreanModel,\n        ollamaTimeout: parseInt(\n            process.env.OLLAMA_TIMEOUT || fileEnv.OLLAMA_TIMEOUT || String(DEFAULT_CONFIG.ollamaTimeout),\n            10\n        ),\n        logLevel: parseLogLevel(\n            process.env.LOG_LEVEL || fileEnv.LOG_LEVEL\n        ),\n        // Gemini 전용 설정\n        geminiThinkEnabled: (process.env.GEMINI_THINK_ENABLED || fileEnv.GEMINI_THINK_ENABLED || 'true') === 'true',\n        geminiThinkLevel: (process.env.GEMINI_THINK_LEVEL || fileEnv.GEMINI_THINK_LEVEL || 'high') as 'low' | 'medium' | 'high',\n        geminiNumCtx: parseInt(process.env.GEMINI_NUM_CTX || fileEnv.GEMINI_NUM_CTX || '32768', 10),\n        geminiEmbeddingModel: process.env.GEMINI_EMBEDDING_MODEL || fileEnv.GEMINI_EMBEDDING_MODEL || 'gemini-3-flash-preview:cloud',\n        geminiWebSearchEnabled: (process.env.GEMINI_WEB_SEARCH_ENABLED || fileEnv.GEMINI_WEB_SEARCH_ENABLED || 'true') === 'true'\n    };\n}\n\n// 싱글톤 설정 인스턴스\nlet cachedConfig: EnvConfig | null = null;\n\nexport function getConfig(): EnvConfig {\n    if (!cachedConfig) {\n        cachedConfig = loadConfig();\n        // 설정 검증\n        validateConfig(cachedConfig);\n    }\n    return cachedConfig;\n}\n\nexport function resetConfig(): void {\n    cachedConfig = null;\n}\n"],"version":3}