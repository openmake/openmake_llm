{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/filesystem.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/filesystem.ts"],"sourcesContent":["/**\n * Filesystem MCP Server 통합\n * \n * @modelcontextprotocol/server-filesystem 기반\n * 사용자별 격리된 파일시스템 접근 제공\n */\n\nimport * as path from 'path';\nimport * as fs from 'fs/promises';\nimport { UserSandbox, UserContext } from './user-sandbox';\nimport { MCPToolDefinition, MCPToolResult, MCPToolHandler } from './types';\n\n// 허용된 파일 확장자\nconst ALLOWED_EXTENSIONS = new Set([\n    '.txt', '.md', '.json', '.yaml', '.yml', '.xml',\n    '.js', '.ts', '.jsx', '.tsx', '.css', '.html',\n    '.py', '.java', '.go', '.rs', '.c', '.cpp', '.h',\n    '.sh', '.bash', '.zsh', '.fish',\n    '.csv', '.log', '.env.example'\n]);\n\n// 금지된 파일 패턴\nconst FORBIDDEN_PATTERNS = [\n    /node_modules/,\n    /\\.git\\//,\n    /\\.env$/,\n    /\\.ssh/,\n    /\\.gnupg/,\n    /password/i,\n    /secret/i,\n    /credentials/i\n];\n\n/**\n * 파일 경로 검증\n */\nexport function validateFilePath(userId: string | number, filePath: string): {\n    valid: boolean;\n    resolvedPath: string | null;\n    error?: string;\n} {\n    // 1. 경로 탈출 검사\n    const resolved = UserSandbox.resolvePath(userId, filePath);\n    if (!resolved) {\n        return {\n            valid: false,\n            resolvedPath: null,\n            error: '접근 권한이 없는 경로입니다'\n        };\n    }\n\n    // 2. 금지 패턴 검사\n    for (const pattern of FORBIDDEN_PATTERNS) {\n        if (pattern.test(resolved)) {\n            return {\n                valid: false,\n                resolvedPath: null,\n                error: '접근이 금지된 경로입니다'\n            };\n        }\n    }\n\n    return {\n        valid: true,\n        resolvedPath: resolved\n    };\n}\n\n/**\n * 파일 확장자 검증\n */\nexport function isAllowedExtension(filePath: string): boolean {\n    const ext = path.extname(filePath).toLowerCase();\n    return ALLOWED_EXTENSIONS.has(ext) || ext === '';\n}\n\n/**\n * 디렉토리 존재 여부 확인 (비동기)\n */\nasync function directoryExists(dirPath: string): Promise<boolean> {\n    try {\n        await fs.access(dirPath);\n        return true;\n    } catch {\n        return false;\n    }\n}\n\n// ============================================\n// Filesystem MCP 도구 정의\n// ============================================\n\n/**\n * 파일 읽기 도구\n */\nexport const readFileTool: MCPToolDefinition = {\n    tool: {\n        name: 'fs_read_file',\n        description: '파일 내용을 읽습니다. 사용자 작업 디렉토리 내에서만 접근 가능합니다.',\n        inputSchema: {\n            type: 'object',\n            properties: {\n                path: {\n                    type: 'string',\n                    description: '읽을 파일 경로 (상대 경로 권장)'\n                },\n                encoding: {\n                    type: 'string',\n                    description: '인코딩 (기본: utf-8)',\n                    default: 'utf-8'\n                }\n            },\n            required: ['path']\n        }\n    },\n    handler: (async (params: { path: string; encoding?: string }, context?: UserContext): Promise<MCPToolResult> => {\n        if (!context) {\n            return {\n                content: [{ type: 'text', text: '사용자 컨텍스트가 필요합니다' }],\n                isError: true\n            };\n        }\n\n        const validation = validateFilePath(context.userId, params.path);\n        if (!validation.valid) {\n            return {\n                content: [{ type: 'text', text: validation.error || '경로 검증 실패' }],\n                isError: true\n            };\n        }\n\n        try {\n            const encoding = (params.encoding || 'utf-8') as BufferEncoding;\n            const content = await fs.readFile(validation.resolvedPath!, { encoding });\n            return {\n                content: [{ type: 'text', text: content }],\n                isError: false\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `파일 읽기 실패: ${error.message}` }],\n                isError: true\n            };\n        }\n    }) as MCPToolHandler\n};\n\n/**\n * 파일 쓰기 도구\n */\nexport const writeFileTool: MCPToolDefinition = {\n    tool: {\n        name: 'fs_write_file',\n        description: '파일에 내용을 씁니다. 사용자 작업 디렉토리 내에서만 접근 가능합니다.',\n        inputSchema: {\n            type: 'object',\n            properties: {\n                path: {\n                    type: 'string',\n                    description: '쓸 파일 경로 (상대 경로 권장)'\n                },\n                content: {\n                    type: 'string',\n                    description: '파일 내용'\n                },\n                encoding: {\n                    type: 'string',\n                    description: '인코딩 (기본: utf-8)',\n                    default: 'utf-8'\n                }\n            },\n            required: ['path', 'content']\n        }\n    },\n    handler: (async (params: { path: string; content: string; encoding?: string }, context?: UserContext): Promise<MCPToolResult> => {\n        if (!context) {\n            return {\n                content: [{ type: 'text', text: '사용자 컨텍스트가 필요합니다' }],\n                isError: true\n            };\n        }\n\n        const validation = validateFilePath(context.userId, params.path);\n        if (!validation.valid) {\n            return {\n                content: [{ type: 'text', text: validation.error || '경로 검증 실패' }],\n                isError: true\n            };\n        }\n\n        // 확장자 검사\n        if (!isAllowedExtension(params.path)) {\n            return {\n                content: [{ type: 'text', text: '허용되지 않은 파일 확장자입니다' }],\n                isError: true\n            };\n        }\n\n        try {\n            // 디렉토리 생성 (비동기)\n            const dir = path.dirname(validation.resolvedPath!);\n            if (!(await directoryExists(dir))) {\n                await fs.mkdir(dir, { recursive: true });\n            }\n\n            const encoding = (params.encoding || 'utf-8') as BufferEncoding;\n            await fs.writeFile(validation.resolvedPath!, params.content, { encoding });\n            return {\n                content: [{ type: 'text', text: `파일 저장 완료: ${params.path}` }],\n                isError: false\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `파일 쓰기 실패: ${error.message}` }],\n                isError: true\n            };\n        }\n    }) as MCPToolHandler\n};\n\n/**\n * 디렉토리 목록 도구\n */\nexport const listDirectoryTool: MCPToolDefinition = {\n    tool: {\n        name: 'fs_list_directory',\n        description: '디렉토리 내용을 나열합니다. 사용자 작업 디렉토리 내에서만 접근 가능합니다.',\n        inputSchema: {\n            type: 'object',\n            properties: {\n                path: {\n                    type: 'string',\n                    description: '조회할 디렉토리 경로 (기본: 작업 디렉토리)'\n                }\n            }\n        }\n    },\n    handler: (async (params: { path?: string }, context?: UserContext): Promise<MCPToolResult> => {\n        if (!context) {\n            return {\n                content: [{ type: 'text', text: '사용자 컨텍스트가 필요합니다' }],\n                isError: true\n            };\n        }\n\n        const targetPath = params.path || '.';\n        const validation = validateFilePath(context.userId, targetPath);\n        if (!validation.valid) {\n            return {\n                content: [{ type: 'text', text: validation.error || '경로 검증 실패' }],\n                isError: true\n            };\n        }\n\n        try {\n            const items = await fs.readdir(validation.resolvedPath!, { withFileTypes: true });\n            const result = await Promise.all(items.map(async item => {\n                const itemPath = path.join(validation.resolvedPath!, item.name);\n                let size: number | undefined;\n                if (item.isFile()) {\n                    const stat = await fs.stat(itemPath);\n                    size = stat.size;\n                }\n                return {\n                    name: item.name,\n                    type: item.isDirectory() ? 'directory' : 'file',\n                    size\n                };\n            }));\n\n            return {\n                content: [{ type: 'text', text: JSON.stringify(result, null, 2) }],\n                isError: false\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `디렉토리 조회 실패: ${error.message}` }],\n                isError: true\n            };\n        }\n    }) as MCPToolHandler\n};\n\n/**\n * 파일 삭제 도구\n */\nexport const deleteFileTool: MCPToolDefinition = {\n    tool: {\n        name: 'fs_delete_file',\n        description: '파일을 삭제합니다. 사용자 작업 디렉토리 내에서만 접근 가능합니다.',\n        inputSchema: {\n            type: 'object',\n            properties: {\n                path: {\n                    type: 'string',\n                    description: '삭제할 파일 경로'\n                }\n            },\n            required: ['path']\n        }\n    },\n    handler: (async (params: { path: string }, context?: UserContext): Promise<MCPToolResult> => {\n        if (!context) {\n            return {\n                content: [{ type: 'text', text: '사용자 컨텍스트가 필요합니다' }],\n                isError: true\n            };\n        }\n\n        const validation = validateFilePath(context.userId, params.path);\n        if (!validation.valid) {\n            return {\n                content: [{ type: 'text', text: validation.error || '경로 검증 실패' }],\n                isError: true\n            };\n        }\n\n        try {\n            await fs.unlink(validation.resolvedPath!);\n            return {\n                content: [{ type: 'text', text: `파일 삭제 완료: ${params.path}` }],\n                isError: false\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `파일 삭제 실패: ${error.message}` }],\n                isError: true\n            };\n        }\n    }) as MCPToolHandler\n};\n\n// ============================================\n// 도구 목록 내보내기\n// ============================================\n\nexport const filesystemTools: MCPToolDefinition[] = [\n    readFileTool,\n    writeFileTool,\n    listDirectoryTool,\n    deleteFileTool\n];\n"],"version":3}