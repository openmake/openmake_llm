c5493a1b0d1c536c6214837dde7ba36d
"use strict";
/**
 * MCP Filesystem Module Tests
 * 파일 경로 검증 및 확장자 검증 테스트
 */
Object.defineProperty(exports, "__esModule", { value: true });
// UserSandbox 모킹
jest.mock('../mcp/user-sandbox', () => ({
    UserSandbox: {
        resolvePath: (userId, filePath) => {
            // 기본 동작: 단순 경로 반환 (테스트용)
            if (filePath.includes('..'))
                return null; // 경로 탈출 시도
            if (filePath.startsWith('/'))
                return filePath;
            return `/home/user${userId}/workspace/${filePath}`;
        }
    },
    UserContext: {}
}));
const filesystem_1 = require("../mcp/filesystem");
describe('MCP Filesystem Module', () => {
    describe('validateFilePath', () => {
        it('should validate a simple relative path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'test.txt');
            expect(result.valid).toBe(true);
            expect(result.resolvedPath).toBe('/home/user1/workspace/test.txt');
            expect(result.error).toBeUndefined();
        });
        it('should validate an absolute path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '/home/user1/workspace/file.md');
            expect(result.valid).toBe(true);
            expect(result.resolvedPath).toBe('/home/user1/workspace/file.md');
        });
        it('should reject path traversal attempts', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '../../../etc/passwd');
            expect(result.valid).toBe(false);
            expect(result.resolvedPath).toBeNull();
            expect(result.error).toBe('접근 권한이 없는 경로입니다');
        });
        it('should reject node_modules path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'node_modules/package.json');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
        it('should reject .git path', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '.git/config');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
        it('should reject .env file', () => {
            const result = (0, filesystem_1.validateFilePath)(1, '.env');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
        it('should reject files with password in name', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'my_password.txt');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
        it('should reject files with secret in name', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'api_secret.json');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
        it('should reject files with credentials in name', () => {
            const result = (0, filesystem_1.validateFilePath)(1, 'credentials.yaml');
            expect(result.valid).toBe(false);
            expect(result.error).toBe('접근이 금지된 경로입니다');
        });
    });
    describe('isAllowedExtension', () => {
        describe('allowed extensions', () => {
            const allowedExtensions = [
                '.txt', '.md', '.json', '.yaml', '.yml', '.xml',
                '.js', '.ts', '.jsx', '.tsx', '.css', '.html',
                '.py', '.java', '.go', '.rs', '.c', '.cpp', '.h',
                '.sh', '.bash', '.zsh', '.fish',
                '.csv', '.log'
                // Note: .env.example은 path.extname이 .example을 반환하므로 별도 테스트
            ];
            allowedExtensions.forEach(ext => {
                it(`should allow ${ext} extension`, () => {
                    expect((0, filesystem_1.isAllowedExtension)(`file${ext}`)).toBe(true);
                });
            });
        });
        it('should allow files without extension', () => {
            expect((0, filesystem_1.isAllowedExtension)('Makefile')).toBe(true);
            expect((0, filesystem_1.isAllowedExtension)('Dockerfile')).toBe(true);
        });
        it('should deny binary extensions', () => {
            expect((0, filesystem_1.isAllowedExtension)('file.exe')).toBe(false);
            expect((0, filesystem_1.isAllowedExtension)('file.dll')).toBe(false);
            expect((0, filesystem_1.isAllowedExtension)('file.so')).toBe(false);
        });
        it('should deny image extensions', () => {
            expect((0, filesystem_1.isAllowedExtension)('image.png')).toBe(false);
            expect((0, filesystem_1.isAllowedExtension)('photo.jpg')).toBe(false);
            expect((0, filesystem_1.isAllowedExtension)('icon.gif')).toBe(false);
        });
        it('should be case insensitive', () => {
            expect((0, filesystem_1.isAllowedExtension)('FILE.TXT')).toBe(true);
            expect((0, filesystem_1.isAllowedExtension)('file.MD')).toBe(true);
            expect((0, filesystem_1.isAllowedExtension)('script.JS')).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL19fdGVzdHNfXy9tY3AtZmlsZXN5c3RlbS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBRUgsaUJBQWlCO0FBQ2pCLElBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNwQyxXQUFXLEVBQUU7UUFDVCxXQUFXLEVBQUUsQ0FBQyxNQUF1QixFQUFFLFFBQWdCLEVBQUUsRUFBRTtZQUN2RCx5QkFBeUI7WUFDekIsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztnQkFBRSxPQUFPLElBQUksQ0FBQyxDQUFDLFdBQVc7WUFDckQsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQztnQkFBRSxPQUFPLFFBQVEsQ0FBQztZQUM5QyxPQUFPLGFBQWEsTUFBTSxjQUFjLFFBQVEsRUFBRSxDQUFDO1FBQ3ZELENBQUM7S0FDSjtJQUNELFdBQVcsRUFBRSxFQUFFO0NBQ2xCLENBQUMsQ0FBQyxDQUFDO0FBRUosa0RBQXlFO0FBRXpFLFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUM5QixFQUFFLENBQUMsd0NBQXdDLEVBQUUsR0FBRyxFQUFFO1lBQzlDLE1BQU0sTUFBTSxHQUFHLElBQUEsNkJBQWdCLEVBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBRS9DLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7WUFDbkUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztRQUVILEVB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LFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xELE1BQU0sQ0FBQyxJQUFBLCtCQUFrQixFQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2pELE1BQU0sQ0FBQyxJQUFBLCtCQUFrQixFQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZELENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVm9sdW1lcy9NQUNfQVBQL29wZW5tYWtlX2xsbS9iYWNrZW5kL2FwaS9zcmMvX190ZXN0c19fL21jcC1maWxlc3lzdGVtLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNQ1AgRmlsZXN5c3RlbSBNb2R1bGUgVGVzdHNcbiAqIO2MjOydvCDqsr3roZwg6rKA7KadIOuwjyDtmZXsnqXsnpAg6rKA7KadIO2FjOyKpO2KuFxuICovXG5cbi8vIFVzZXJTYW5kYm94IOuqqO2CuVxuamVzdC5tb2NrKCcuLi9tY3AvdXNlci1zYW5kYm94JywgKCkgPT4gKHtcbiAgICBVc2VyU2FuZGJveDoge1xuICAgICAgICByZXNvbHZlUGF0aDogKHVzZXJJZDogc3RyaW5nIHwgbnVtYmVyLCBmaWxlUGF0aDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAvLyDquLDrs7gg64+Z7J6ROiDri6jsiJwg6rK966GcIOuwmO2ZmCAo7YWM7Iqk7Yq47JqpKVxuICAgICAgICAgICAgaWYgKGZpbGVQYXRoLmluY2x1ZGVzKCcuLicpKSByZXR1cm4gbnVsbDsgLy8g6rK966GcIO2DiOy2nCDsi5zrj4RcbiAgICAgICAgICAgIGlmIChmaWxlUGF0aC5zdGFydHNXaXRoKCcvJykpIHJldHVybiBmaWxlUGF0aDtcbiAgICAgICAgICAgIHJldHVybiBgL2hvbWUvdXNlciR7dXNlcklkfS93b3Jrc3BhY2UvJHtmaWxlUGF0aH1gO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBVc2VyQ29udGV4dDoge31cbn0pKTtcblxuaW1wb3J0IHsgdmFsaWRhdGVGaWxlUGF0aCwgaXNBbGxvd2VkRXh0ZW5zaW9uIH0gZnJvbSAnLi4vbWNwL2ZpbGVzeXN0ZW0nO1xuXG5kZXNjcmliZSgnTUNQIEZpbGVzeXN0ZW0gTW9kdWxlJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCd2YWxpZGF0ZUZpbGVQYXRoJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGEgc2ltcGxlIHJlbGF0aXZlIHBhdGgnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGVQYXRoKDEsICd0ZXN0LnR4dCcpO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5yZXNvbHZlZFBhdGgpLnRvQmUoJy9ob21lL3VzZXIxL3dvcmtzcGFjZS90ZXN0LnR4dCcpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGFuIGFic29sdXRlIHBhdGgnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGVQYXRoKDEsICcvaG9tZS91c2VyMS93b3Jrc3BhY2UvZmlsZS5tZCcpO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5yZXNvbHZlZFBhdGgpLnRvQmUoJy9ob21lL3VzZXIxL3dvcmtzcGFjZS9maWxlLm1kJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHBhdGggdHJhdmVyc2FsIGF0dGVtcHRzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVGaWxlUGF0aCgxLCAnLi4vLi4vLi4vZXRjL3Bhc3N3ZCcpO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQucmVzb2x2ZWRQYXRoKS50b0JlTnVsbCgpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgn7KCR6re8IOq2jO2VnOydtCDsl4bripQg6rK966Gc7J6F64uI64ukJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IG5vZGVfbW9kdWxlcyBwYXRoJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVGaWxlUGF0aCgxLCAnbm9kZV9tb2R1bGVzL3BhY2thZ2UuanNvbicpO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ+ygkeq3vOydtCDquIjsp4DrkJwg6rK966Gc7J6F64uI64ukJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IC5naXQgcGF0aCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZVBhdGgoMSwgJy5naXQvY29uZmlnJyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgn7KCR6re87J20IOq4iOyngOuQnCDqsr3roZzsnoXri4jri6QnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZWplY3QgLmVudiBmaWxlJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdGVGaWxlUGF0aCgxLCAnLmVudicpO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ+ygkeq3vOydtCDquIjsp4DrkJwg6rK966Gc7J6F64uI64ukJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IGZpbGVzIHdpdGggcGFzc3dvcmQgaW4gbmFtZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRlRmlsZVBhdGgoMSwgJ215X3Bhc3N3b3JkLnR4dCcpO1xuXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ+ygkeq3vOydtCDquIjsp4DrkJwg6rK966Gc7J6F64uI64ukJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IGZpbGVzIHdpdGggc2VjcmV0IGluIG5hbWUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGVQYXRoKDEsICdhcGlfc2VjcmV0Lmpzb24nKTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKCfsoJHqt7zsnbQg6riI7KeA65CcIOqyveuhnOyeheuLiOuLpCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlamVjdCBmaWxlcyB3aXRoIGNyZWRlbnRpYWxzIGluIG5hbWUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0ZUZpbGVQYXRoKDEsICdjcmVkZW50aWFscy55YW1sJyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcikudG9CZSgn7KCR6re87J20IOq4iOyngOuQnCDqsr3roZzsnoXri4jri6QnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnaXNBbGxvd2VkRXh0ZW5zaW9uJywgKCkgPT4ge1xuICAgICAgICBkZXNjcmliZSgnYWxsb3dlZCBleHRlbnNpb25zJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYWxsb3dlZEV4dGVuc2lvbnMgPSBbXG4gICAgICAgICAgICAgICAgJy50eHQnLCAnLm1kJywgJy5qc29uJywgJy55YW1sJywgJy55bWwnLCAnLnhtbCcsXG4gICAgICAgICAgICAgICAgJy5qcycsICcudHMnLCAnLmpzeCcsICcudHN4JywgJy5jc3MnLCAnLmh0bWwnLFxuICAgICAgICAgICAgICAgICcucHknLCAnLmphdmEnLCAnLmdvJywgJy5ycycsICcuYycsICcuY3BwJywgJy5oJyxcbiAgICAgICAgICAgICAgICAnLnNoJywgJy5iYXNoJywgJy56c2gnLCAnLmZpc2gnLFxuICAgICAgICAgICAgICAgICcuY3N2JywgJy5sb2cnXG4gICAgICAgICAgICAgICAgLy8gTm90ZTogLmVudi5leGFtcGxl7J2AIHBhdGguZXh0bmFtZeydtCAuZXhhbXBsZeydhCDrsJjtmZjtlZjrr4DroZwg67OE64+EIO2FjOyKpO2KuFxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgYWxsb3dlZEV4dGVuc2lvbnMuZm9yRWFjaChleHQgPT4ge1xuICAgICAgICAgICAgICAgIGl0KGBzaG91bGQgYWxsb3cgJHtleHR9IGV4dGVuc2lvbmAsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbihgZmlsZSR7ZXh0fWApKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgYWxsb3cgZmlsZXMgd2l0aG91dCBleHRlbnNpb24nLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKCdNYWtlZmlsZScpKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbignRG9ja2VyZmlsZScpKS50b0JlKHRydWUpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGRlbnkgYmluYXJ5IGV4dGVuc2lvbnMnLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKCdmaWxlLmV4ZScpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oJ2ZpbGUuZGxsJykpLnRvQmUoZmFsc2UpO1xuICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbignZmlsZS5zbycpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBkZW55IGltYWdlIGV4dGVuc2lvbnMnLCAoKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKCdpbWFnZS5wbmcnKSkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKCdwaG90by5qcGcnKSkudG9CZShmYWxzZSk7XG4gICAgICAgICAgICBleHBlY3QoaXNBbGxvd2VkRXh0ZW5zaW9uKCdpY29uLmdpZicpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBiZSBjYXNlIGluc2Vuc2l0aXZlJywgKCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGlzQWxsb3dlZEV4dGVuc2lvbignRklMRS5UWFQnKSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oJ2ZpbGUuTUQnKSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChpc0FsbG93ZWRFeHRlbnNpb24oJ3NjcmlwdC5KUycpKS50b0JlKHRydWUpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9