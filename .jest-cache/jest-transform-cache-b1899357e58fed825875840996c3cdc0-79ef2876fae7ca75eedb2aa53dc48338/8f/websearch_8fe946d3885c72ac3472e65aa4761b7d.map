{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/web-search.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/web-search.ts"],"sourcesContent":["/**\n * Ïõπ Í≤ÄÏÉâ ÎèÑÍµ¨ - Ollama API + Firecrawl + Google + DuckDuckGo\n */\n\nimport { MCPToolDefinition, MCPToolResult } from './types';\nimport { createClient } from '../ollama/client';\nimport { isFirecrawlConfigured } from './firecrawl';\nimport { getConfig } from '../config/env';\n\n// Google API ÏÑ§Ï†ï (ÌôòÍ≤ΩÎ≥ÄÏàò ÌïÑÏàò)\nconst GOOGLE_API_KEY = getConfig().googleApiKey;\nconst GOOGLE_CSE_ID = getConfig().googleCseId;\n\n// API ÌÇ§ ÎØ∏ÏÑ§Ï†ï Í≤ΩÍ≥†\nif (!GOOGLE_API_KEY || !GOOGLE_CSE_ID) {\n    console.warn('[WebSearch] ‚ö†Ô∏è GOOGLE_API_KEY ÎòêÎäî GOOGLE_CSE_IDÍ∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');\n    console.warn('[WebSearch] Google Í≤ÄÏÉâ Í∏∞Îä•Ïù¥ ÎπÑÌôúÏÑ±ÌôîÎê©ÎãàÎã§. .env ÌååÏùºÏóê ÏÑ§Ï†ïÌïòÏÑ∏Ïöî.');\n}\n\n// Í≤ÄÏÉâ Í≤∞Í≥º Ïù∏ÌÑ∞ÌéòÏù¥Ïä§\nexport interface SearchResult {\n    title: string;\n    url: string;\n    snippet: string;\n    source: string;\n    date?: string;\n    qualityScore?: number;\n    category?: string;\n}\n\nexport interface FactCheckResult {\n    claim: string;\n    verdict: string;\n    confidence: number;\n    sources: SearchResult[];\n    explanation: string;\n}\n\nexport interface ResearchResult {\n    topic: string;\n    summary: string;\n    keyFindings: string[];\n    sources: SearchResult[];\n    qualityMetrics: Record<string, unknown>;\n}\n\n/**\n * Ollama Í≥µÏãù Web Search API (Ïö∞ÏÑ† ÏÇ¨Ïö©)\n */\nasync function searchOllamaWebSearch(query: string, maxResults: number = 10): Promise<SearchResult[]> {\n    const results: SearchResult[] = [];\n\n    try {\n        const client = createClient();\n        const response = await client.webSearch(query, maxResults);\n\n        if (response.results && response.results.length > 0) {\n            for (const item of response.results) {\n                results.push({\n                    title: item.title || '',\n                    url: item.url || '',\n                    snippet: item.content || '',\n                    source: 'ollama.com'\n                });\n            }\n            console.log(`[WebSearch] Ollama API: ${results.length}Í∞ú`);\n        }\n    } catch (e) {\n        console.error('[WebSearch] Ollama API Ïã§Ìå®:', e);\n    }\n\n    return results;\n}\n\n/**\n * üî• Firecrawl Search API (ÏΩòÌÖêÏ∏† Ïä§ÌÅ¨ÎûòÌïë Ìè¨Ìï®)\n */\nasync function searchFirecrawl(query: string, maxResults: number = 5): Promise<SearchResult[]> {\n    const results: SearchResult[] = [];\n\n    if (!isFirecrawlConfigured()) {\n        return results;\n    }\n\n    const FIRECRAWL_API_KEY = getConfig().firecrawlApiKey;\n    const FIRECRAWL_API_URL = getConfig().firecrawlApiUrl;\n\n    try {\n        console.log(`[WebSearch] Firecrawl Í≤ÄÏÉâ ÏãúÏûë: \"${query}\"`);\n\n        const response = await fetch(`${FIRECRAWL_API_URL}/search`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${FIRECRAWL_API_KEY}`\n            },\n            body: JSON.stringify({\n                query,\n                limit: maxResults,\n                lang: 'ko',\n                country: 'kr',\n                scrapeOptions: {\n                    formats: ['markdown'],\n                    onlyMainContent: true\n                }\n            })\n        });\n\n        if (!response.ok) {\n            const errorText = await response.text();\n            console.error(`[WebSearch] Firecrawl API Ïò§Î•ò (${response.status}): ${errorText}`);\n            return results;\n        }\n\n        const data = await response.json() as { data?: Array<{ title?: string; url?: string; description?: string; markdown?: string }> };\n\n        if (data.data && Array.isArray(data.data)) {\n            for (const item of data.data) {\n                results.push({\n                    title: item.title || '',\n                    url: item.url || '',\n                    snippet: item.description || item.markdown?.substring(0, 200) || '',\n                    source: 'firecrawl.dev'\n                });\n            }\n        }\n        console.log(`[WebSearch] üî• Firecrawl: ${results.length}Í∞ú`);\n    } catch (e) {\n        console.error('[WebSearch] Firecrawl Ïã§Ìå®:', e);\n    }\n\n    return results;\n}\n\n/**\n * Google Custom Search (Ï†ÑÏÑ∏Í≥Ñ Í≤ÄÏÉâ)\n */\nasync function searchGoogle(query: string, maxResults: number = 10, globalSearch: boolean = true): Promise<SearchResult[]> {\n    const results: SearchResult[] = [];\n\n    if (!GOOGLE_API_KEY || !GOOGLE_CSE_ID) {\n        return results;\n    }\n\n    try {\n        // Ï†ÑÏÑ∏Í≥Ñ Í≤ÄÏÉâ: Ïñ∏Ïñ¥/ÏßÄÏó≠ Ï†úÌïú ÏóÜÏùå\n        // ÌïúÍµ≠Ïñ¥ Í≤ÄÏÉâ: gl=kr&lr=lang_ko Ï∂îÍ∞Ä\n        let url = `https://www.googleapis.com/customsearch/v1?key=${GOOGLE_API_KEY}&cx=${GOOGLE_CSE_ID}&q=${encodeURIComponent(query)}&num=${Math.min(maxResults, 10)}`;\n\n        if (!globalSearch) {\n            url += '&gl=kr&lr=lang_ko';\n        }\n\n        const response = await fetch(url);\n\n        if (!response.ok) {\n            console.error(`[WebSearch] Google API Ïò§Î•ò: ${response.status}`);\n            return results;\n        }\n\n        const data = await response.json() as { items?: Array<{ title?: string; link?: string; snippet?: string; displayLink?: string }> };\n\n        if (data.items) {\n            for (const item of data.items) {\n                results.push({\n                    title: item.title || '',\n                    url: item.link || '',\n                    snippet: item.snippet || '',\n                    source: item.displayLink || 'google.com'\n                });\n            }\n        }\n        console.log(`[WebSearch] Google: ${results.length}Í∞ú`);\n    } catch (e) {\n        console.error('[WebSearch] Google Ïã§Ìå®:', e);\n    }\n\n    return results;\n}\n\n/**\n * Wikipedia API Í≤ÄÏÉâ (Î¨¥Î£å, ÏïàÏ†ïÏ†Å)\n */\nasync function searchWikipedia(query: string): Promise<SearchResult[]> {\n    const results: SearchResult[] = [];\n\n    try {\n        // Wikipedia Í≤ÄÏÉâ API\n        const url = `https://ko.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&srlimit=5&origin=*`;\n\n        const response = await fetch(url);\n        if (!response.ok) return results;\n\n        const data = await response.json() as {\n            query?: {\n                search?: Array<{ title: string; snippet: string; pageid: number }>;\n            };\n        };\n\n        if (data.query?.search) {\n            for (const item of data.query.search) {\n                results.push({\n                    title: item.title,\n                    url: `https://ko.wikipedia.org/wiki/${encodeURIComponent(item.title)}`,\n                    snippet: item.snippet.replace(/<[^>]+>/g, ''),\n                    source: 'wikipedia.org'\n                });\n            }\n        }\n\n        console.log(`[WebSearch] Wikipedia: ${results.length}Í∞ú`);\n    } catch (e) {\n        console.error('[WebSearch] Wikipedia Ïã§Ìå®:', e);\n    }\n\n    return results;\n}\n\n/**\n * Google News RSS Í≤ÄÏÉâ (Î¨¥Î£å, ÏïàÏ†ïÏ†Å) - Í∞úÏÑ†Îêú ÌååÏã±\n */\nasync function searchGoogleNews(query: string): Promise<SearchResult[]> {\n    const results: SearchResult[] = [];\n\n    try {\n        // Google News RSS\n        const url = `https://news.google.com/rss/search?q=${encodeURIComponent(query)}&hl=ko&gl=KR&ceid=KR:ko`;\n\n        const response = await fetch(url);\n        if (!response.ok) return results;\n\n        const xml = await response.text();\n\n        // RSS item Îã®ÏúÑÎ°ú ÌååÏã± (Îçî Ï†ïÌôïÌïú Î∞©Î≤ï)\n        const itemRegex = /<item>([\\s\\S]*?)<\\/item>/g;\n        let itemMatch;\n        let count = 0;\n\n        while ((itemMatch = itemRegex.exec(xml)) !== null && count < 10) {\n            const itemContent = itemMatch[1];\n\n            // ÌÉÄÏù¥ÌãÄ Ï∂îÏ∂ú (ÏùºÎ∞ò + CDATA Î™®Îëê ÏßÄÏõê)\n            let title = '';\n            const titleMatch = itemContent.match(/<title>(?:<!\\[CDATA\\[)?([^\\]<]+)(?:\\]\\]>)?<\\/title>/);\n            if (titleMatch) {\n                title = titleMatch[1].replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&').trim();\n            }\n\n            // ÎßÅÌÅ¨ Ï∂îÏ∂ú\n            let link = '';\n            const linkMatch = itemContent.match(/<link>(https?:\\/\\/[^<]+)<\\/link>/);\n            if (linkMatch) {\n                link = linkMatch[1];\n            }\n\n            // Ï∂úÏ≤ò Ï∂îÏ∂ú\n            let source = 'news.google.com';\n            const sourceMatch = itemContent.match(/<source[^>]*>([^<]+)<\\/source>/);\n            if (sourceMatch) {\n                source = sourceMatch[1];\n            }\n\n            if (title && link) {\n                results.push({\n                    title,\n                    url: link,\n                    snippet: `Ï∂úÏ≤ò: ${source}`,\n                    source: source\n                });\n                count++;\n            }\n        }\n\n        console.log(`[WebSearch] Google News: ${results.length}Í∞ú`);\n    } catch (e) {\n        console.error('[WebSearch] Google News Ïã§Ìå®:', e);\n    }\n\n    return results;\n}\n\n/**\n * DuckDuckGo Instant Answer API (ÏïàÏ†ïÏ†Å)\n */\nasync function searchDuckDuckGoAPI(query: string): Promise<SearchResult[]> {\n    const results: SearchResult[] = [];\n\n    try {\n        const url = `https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_html=1&skip_disambig=1`;\n        const response = await fetch(url);\n        if (!response.ok) return results;\n\n        const data = await response.json() as {\n            Abstract?: string;\n            AbstractURL?: string;\n            AbstractSource?: string;\n            AbstractText?: string;\n            Heading?: string;\n            RelatedTopics?: Array<{ Text?: string; FirstURL?: string }>;\n            Infobox?: { content?: Array<{ label?: string; value?: string }> };\n        };\n\n        // Abstract (Í∞ÄÏû• Ï§ëÏöî)\n        if (data.AbstractText && data.AbstractURL) {\n            results.push({\n                title: data.Heading || data.AbstractSource || 'DuckDuckGo',\n                url: data.AbstractURL,\n                snippet: data.AbstractText,\n                source: 'duckduckgo.com'\n            });\n        }\n\n        // Related Topics\n        if (data.RelatedTopics) {\n            for (const topic of data.RelatedTopics.slice(0, 5)) {\n                if (topic.Text && topic.FirstURL) {\n                    results.push({\n                        title: topic.Text.split(' - ')[0] || topic.Text.substring(0, 80),\n                        url: topic.FirstURL,\n                        snippet: topic.Text,\n                        source: 'duckduckgo.com'\n                    });\n                }\n            }\n        }\n\n        console.log(`[WebSearch] DuckDuckGo API: ${results.length}Í∞ú`);\n    } catch (e) {\n        console.error('[WebSearch] DuckDuckGo API Ïã§Ìå®:', e);\n    }\n\n    return results;\n}\n\n/**\n * ÎÑ§Ïù¥Î≤Ñ Ïã§ÏãúÍ∞Ñ Í≤ÄÏÉâÏñ¥ API (RSS Î∞©Ïãù)\n */\nasync function searchNaverNews(query: string): Promise<SearchResult[]> {\n    const results: SearchResult[] = [];\n\n    try {\n        // ÎÑ§Ïù¥Î≤Ñ Îâ¥Ïä§ Í≤ÄÏÉâ (Î™®Î∞îÏùº ÌéòÏù¥ÏßÄ, Îçî Í∞ÑÎã®Ìïú Íµ¨Ï°∞)\n        const url = `https://m.search.naver.com/search.naver?where=m_news&query=${encodeURIComponent(query)}&sm=mtb_nmr`;\n\n        const response = await fetch(url, {\n            headers: {\n                'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15'\n            }\n        });\n\n        if (!response.ok) return results;\n\n        const html = await response.text();\n\n        // Î™®Î∞îÏùº Îâ¥Ïä§ Í≤∞Í≥º ÌååÏã± (Îçî Îã®ÏàúÌïú Íµ¨Ï°∞)\n        const patterns = [\n            /<a[^>]*class=\"[^\"]*news_tit[^\"]*\"[^>]*href=\"([^\"]+)\"[^>]*>([^<]+)/gi,\n            /<a[^>]*href=\"([^\"]+)\"[^>]*class=\"[^\"]*tit[^\"]*\"[^>]*>([^<]+)/gi\n        ];\n\n        const seenUrls = new Set<string>();\n\n        for (const pattern of patterns) {\n            let match;\n            while ((match = pattern.exec(html)) !== null && results.length < 5) {\n                const linkUrl = match[1];\n                const title = match[2].replace(/&[^;]+;/g, '').trim();\n\n                if (!seenUrls.has(linkUrl) && linkUrl.startsWith('http') && title.length > 5) {\n                    seenUrls.add(linkUrl);\n                    results.push({\n                        title,\n                        url: linkUrl,\n                        snippet: '',\n                        source: 'naver.com'\n                    });\n                }\n            }\n        }\n\n        console.log(`[WebSearch] ÎÑ§Ïù¥Î≤Ñ Îâ¥Ïä§: ${results.length}Í∞ú`);\n    } catch (e) {\n        console.error('[WebSearch] ÎÑ§Ïù¥Î≤Ñ Îâ¥Ïä§ Ïã§Ìå®:', e);\n    }\n\n    return results;\n}\n/**\n * ÌÜµÌï© Ïõπ Í≤ÄÏÉâ (Ollama API Ïö∞ÏÑ†, Ìè¥Î∞±ÏúºÎ°ú Firecrawl + Îã§Ï§ë ÏÜåÏä§)\n */\nexport async function performWebSearch(query: string, options: { maxResults?: number; globalSearch?: boolean; useOllamaFirst?: boolean; useFirecrawl?: boolean } = {}): Promise<SearchResult[]> {\n    const { maxResults = 30, globalSearch = true, useOllamaFirst = true, useFirecrawl = true } = options;\n\n    console.log(`[WebSearch] ÏøºÎ¶¨: ${query}`);\n    console.log(`[WebSearch] Í≤ÄÏÉâ: \"${query}\"`);\n\n    // üöÄ 1Îã®Í≥Ñ: Ollama Í≥µÏãù API Ïö∞ÏÑ† ÏãúÎèÑ\n    if (useOllamaFirst) {\n        const ollamaResults = await searchOllamaWebSearch(query, Math.min(maxResults, 10));\n        if (ollamaResults.length > 0) {\n            console.log(`[WebSearch] ‚úÖ Ollama API ÏÑ±Í≥µ: ${ollamaResults.length}Í∞ú Í≤∞Í≥º`);\n            return ollamaResults;\n        }\n        console.log('[WebSearch] Ollama API Í≤∞Í≥º ÏóÜÏùå, Ìè¥Î∞± Í≤ÄÏÉâ ÏãúÏûë...');\n    }\n\n    // üî• 2Îã®Í≥Ñ: Firecrawl Ïö∞ÏÑ† ÏãúÎèÑ (API ÌÇ§Í∞Ä ÏûàÎäî Í≤ΩÏö∞)\n    if (useFirecrawl && isFirecrawlConfigured()) {\n        const firecrawlResults = await searchFirecrawl(query, Math.min(maxResults, 10));\n        if (firecrawlResults.length > 0) {\n            console.log(`[WebSearch] üî• Firecrawl ÏÑ±Í≥µ: ${firecrawlResults.length}Í∞ú Í≤∞Í≥º`);\n            // Firecrawl Í≤∞Í≥ºÍ∞Ä Ï∂©Î∂ÑÌïòÎ©¥ Î∞îÎ°ú Î∞òÌôò\n            if (firecrawlResults.length >= 5) {\n                return firecrawlResults;\n            }\n        }\n    }\n\n    // üîÑ 3Îã®Í≥Ñ: Ìè¥Î∞± - ÏïàÏ†ïÏ†ÅÏù∏ ÏÜåÏä§ÏóêÏÑú Î≥ëÎ†¨ Í≤ÄÏÉâ (Firecrawl Ìè¨Ìï®)\n    const searchPromises: Promise<SearchResult[]>[] = [\n        searchGoogle(query, 10, globalSearch),\n        searchWikipedia(query),\n        searchGoogleNews(query),\n        searchDuckDuckGoAPI(query),\n        searchNaverNews(query)\n    ];\n\n    // FirecrawlÎèÑ Î≥ëÎ†¨ Í≤ÄÏÉâÏóê Ìè¨Ìï® (ÏïÑÏßÅ ÏãúÎèÑÌïòÏßÄ ÏïäÏïòÍ±∞ÎÇò Í≤∞Í≥ºÍ∞Ä Î∂ÄÏ°±Ìïú Í≤ΩÏö∞)\n    if (useFirecrawl && isFirecrawlConfigured()) {\n        searchPromises.push(searchFirecrawl(query, 5));\n    }\n\n    const allSearchResults = await Promise.all(searchPromises);\n    const [googleResults, wikiResults, newsResults, ddgResults, naverResults, firecrawlResults = []] = allSearchResults;\n\n    // Í≤∞Í≥º Ìï©ÏπòÍ∏∞ (Ïö∞ÏÑ†ÏàúÏúÑ: Firecrawl > Îâ¥Ïä§ > Google > Wikipedia > DDG > Naver)\n    const allResults = [\n        ...firecrawlResults,  // üî• Firecrawl ÏµúÏö∞ÏÑ† (ÏΩòÌÖêÏ∏† Ïä§ÌÅ¨ÎûòÌïë)\n        ...newsResults,       // Îâ¥Ïä§ (ÏµúÏã† ÏÇ¨Ïã§ Ï†ïÎ≥¥)\n        ...naverResults,      // ÎÑ§Ïù¥Î≤Ñ Îâ¥Ïä§ (ÌïúÍµ≠ Îâ¥Ïä§)\n        ...googleResults,     // Google Í≤ÄÏÉâ\n        ...wikiResults,       // Wikipedia (Î∞∞Í≤Ω ÏßÄÏãù)\n        ...ddgResults         // DuckDuckGo\n    ];\n\n    // Ï§ëÎ≥µ Ï†úÍ±∞ (URL Ï†ïÍ∑úÌôî)\n    const seen = new Set<string>();\n    const uniqueResults = allResults.filter(r => {\n        const normalizedUrl = r.url.replace(/\\/$/, '').replace(/^https?:\\/\\//, '').toLowerCase();\n        if (seen.has(normalizedUrl)) return false;\n        seen.add(normalizedUrl);\n        return true;\n    });\n\n    console.log(`[WebSearch] Ï¥ù ${uniqueResults.length}Í∞ú (Firecrawl:${firecrawlResults.length}, Google:${googleResults.length}, Wiki:${wikiResults.length}, News:${newsResults.length}, DDG:${ddgResults.length}, Naver:${naverResults.length})`);\n\n    return uniqueResults.slice(0, maxResults);\n}\n\n\n/**\n * ÏÇ¨Ïã§ Í≤ÄÏ¶ù ÌîÑÎ°¨ÌîÑÌä∏\n */\nexport function createFactCheckPrompt(claim: string, searchResults: SearchResult[]): string {\n    const sources = searchResults.map((r, i) =>\n        `[${i + 1}] ${r.title}\\n   ${r.url}\\n   ${r.snippet}`\n    ).join('\\n\\n');\n\n    return `## Ïõπ Í≤ÄÏÉâ Í≤∞Í≥º (${new Date().toLocaleDateString('ko-KR')})\n${sources || 'Í≤ÄÏÉâ Í≤∞Í≥º ÏóÜÏùå'}\n\n## ÏßàÎ¨∏\n${claim}\n\nÏúÑ Í≤ÄÏÉâ Í≤∞Í≥ºÎ•º Ï∞∏Í≥†ÌïòÏó¨ Ï†ïÌôïÌïòÍ≤å ÎãµÎ≥ÄÌïòÏÑ∏Ïöî.`;\n}\n\n/**\n * Ïõπ Í≤ÄÏÉâ ÎèÑÍµ¨\n */\nexport const webSearchTool: MCPToolDefinition = {\n    tool: {\n        name: 'web_search',\n        description: 'ÏõπÏóêÏÑú ÏµúÏã† Ï†ïÎ≥¥ Í≤ÄÏÉâ',\n        inputSchema: {\n            type: 'object',\n            properties: {\n                query: { type: 'string', description: 'Í≤ÄÏÉâÏñ¥' }\n            },\n            required: ['query']\n        }\n    },\n    handler: async (args): Promise<MCPToolResult> => {\n        const query = args.query as string;\n        const results = await performWebSearch(query);\n\n        if (results.length === 0) {\n            return { content: [{ type: 'text', text: `Í≤ÄÏÉâ Í≤∞Í≥º ÏóÜÏùå: \"${query}\"` }] };\n        }\n\n        let output = `üîç Í≤ÄÏÉâ Í≤∞Í≥º (${results.length}Í∞ú)\\n\\n`;\n        for (let i = 0; i < results.length; i++) {\n            const r = results[i];\n            output += `[${i + 1}] ${r.title}\\n   ${r.url}\\n   ${r.snippet?.substring(0, 100) || ''}...\\n\\n`;\n        }\n\n        return { content: [{ type: 'text', text: output }] };\n    }\n};\n\n/**\n * ÏÇ¨Ïã§ Í≤ÄÏ¶ù ÎèÑÍµ¨\n */\nexport const factCheckTool: MCPToolDefinition = {\n    tool: {\n        name: 'fact_check',\n        description: 'ÏÇ¨Ïã§ Í≤ÄÏ¶ù',\n        inputSchema: {\n            type: 'object',\n            properties: { claim: { type: 'string' } },\n            required: ['claim']\n        }\n    },\n    handler: async (args): Promise<MCPToolResult> => {\n        const claim = args.claim as string;\n        const results = await performWebSearch(claim, { maxResults: 5 });\n\n        let output = `‚úÖ ÏÇ¨Ïã§ Í≤ÄÏ¶ù: \"${claim}\"\\n\\n`;\n        for (const r of results) {\n            output += `‚Ä¢ ${r.title}\\n  ${r.url}\\n`;\n        }\n\n        return { content: [{ type: 'text', text: output }] };\n    }\n};\n\n/**\n * ÏõπÌéòÏù¥ÏßÄ Ï∂îÏ∂ú ÎèÑÍµ¨\n */\nexport const extractWebpageTool: MCPToolDefinition = {\n    tool: {\n        name: 'extract_webpage',\n        description: 'ÏõπÌéòÏù¥ÏßÄ ÏΩòÌÖêÏ∏† Ï∂îÏ∂ú',\n        inputSchema: {\n            type: 'object',\n            properties: { url: { type: 'string' } },\n            required: ['url']\n        }\n    },\n    handler: async (args): Promise<MCPToolResult> => {\n        const url = args.url as string;\n        try {\n            const response = await fetch(url, { headers: { 'User-Agent': 'Mozilla/5.0' } });\n            const html = await response.text();\n            const content = html.replace(/<[^>]+>/g, ' ').replace(/\\s+/g, ' ').trim().substring(0, 3000);\n            return { content: [{ type: 'text', text: content }] };\n        } catch (e) {\n            return { content: [{ type: 'text', text: `Ïò§Î•ò: ${e}` }], isError: true };\n        }\n    }\n};\n\n/**\n * Ïó∞Íµ¨ ÎèÑÍµ¨\n */\nexport const researchTopicTool: MCPToolDefinition = {\n    tool: {\n        name: 'research_topic',\n        description: 'Ï£ºÏ†ú Ïó∞Íµ¨',\n        inputSchema: {\n            type: 'object',\n            properties: { topic: { type: 'string' } },\n            required: ['topic']\n        }\n    },\n    handler: async (args): Promise<MCPToolResult> => {\n        const topic = args.topic as string;\n        const results = await performWebSearch(topic);\n\n        let output = `üìö Ïó∞Íµ¨: \"${topic}\"\\n\\n`;\n        for (const r of results) {\n            output += `‚Ä¢ ${r.title}\\n  ${r.url}\\n`;\n        }\n\n        return { content: [{ type: 'text', text: output }] };\n    }\n};\n\n// ÎèÑÍµ¨ ÎÇ¥Î≥¥ÎÇ¥Í∏∞\nexport const webSearchTools: MCPToolDefinition[] = [\n    webSearchTool,\n    factCheckTool,\n    extractWebpageTool,\n    researchTopicTool\n];\n"],"version":3}