{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/data/user-manager.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/data/user-manager.ts"],"sourcesContent":["/**\n * User Manager\n * backend/apiì—ì„œ ì‚¬ìš©í•˜ëŠ” UserManager ë˜í¼\n * \n * ğŸ”’ ë³´ì•ˆ ê°•í™”: bcryptë¥¼ ì‚¬ìš©í•œ ë¹„ë°€ë²ˆí˜¸ í•´ì‹± ì ìš©\n * ğŸ“¦ PostgreSQL ê¸°ë°˜ (unified-database ì‚¬ìš©)\n */\n\nimport * as bcrypt from 'bcryptjs';\nimport { getPool } from './models/unified-database';\nimport { Pool } from 'pg';\nimport { getConfig } from '../config/env';\n\n// ë¹„ë°€ë²ˆí˜¸ í•´ì‹± ë¼ìš´ë“œ (ë†’ì„ìˆ˜ë¡ ì•ˆì „í•˜ì§€ë§Œ ëŠë¦¼)\nconst BCRYPT_ROUNDS = 12;\n\nexport type UserRole = 'admin' | 'user' | 'guest';\n\n// MCP ë„êµ¬ ì ‘ê·¼ ë“±ê¸‰\nexport type UserTier = 'free' | 'pro' | 'enterprise';\n\nexport interface PublicUser {\n    id: number;\n    email: string;\n    role: UserRole;\n    tier: UserTier;\n    created_at: string;\n    last_login?: string;\n    is_active: boolean;\n}\n\nexport interface CreateUserInput {\n    email: string;\n    password: string;\n    role?: UserRole;\n    tier?: UserTier;\n}\n\ninterface UserRow {\n    id: string;\n    username: string;\n    password_hash: string;\n    email: string | null;\n    role: string;\n    tier: string | null;\n    is_active: boolean;\n    created_at: string;\n    updated_at: string;\n    last_login: string | null;\n}\n\n/**\n * PostgreSQL ê¸°ë°˜ UserManager\n */\nclass UserManagerImpl {\n    constructor() {\n        this.init().catch(err => console.error('[UserManager] Init failed:', err));\n    }\n\n    private async init(): Promise<void> {\n        await this.ensureSchema();\n        await this.ensureAdminUser();\n    }\n\n    private async ensureSchema(): Promise<void> {\n        const pool = getPool();\n        try {\n            await pool.query('ALTER TABLE users ADD COLUMN IF NOT EXISTS tier TEXT DEFAULT \\'free\\'');\n        } catch (_e: unknown) {\n            // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš° ë¬´ì‹œ\n        }\n    }\n\n    private async ensureAdminUser(): Promise<void> {\n        const pool = getPool();\n        const adminEmail = getConfig().defaultAdminEmail || 'admin';\n\n        // ê¸°ì¡´ 'admin' ê³„ì •ì´ ìˆê³  DEFAULT_ADMIN_EMAILì´ ë‹¤ë¥´ë©´ ë§ˆì´ê·¸ë ˆì´ì…˜\n        if (adminEmail !== 'admin') {\n            const legacyAdmin = await pool.query(\n                'SELECT id FROM users WHERE username = $1 AND role = $2',\n                ['admin', 'admin']\n            );\n            const existingEmail = await pool.query(\n                'SELECT id, role FROM users WHERE username = $1',\n                [adminEmail]\n            );\n\n            if (legacyAdmin.rows.length > 0 && existingEmail.rows.length > 0) {\n                // ì´ë©”ì¼ ì‚¬ìš©ìê°€ ì´ë¯¸ ì¡´ì¬í•˜ë©´: admin ê¶Œí•œ ë¶€ì—¬ + ë¹„ë°€ë²ˆí˜¸ ê°±ì‹ , ë ˆê±°ì‹œ admin ì‚­ì œ\n                const cfgAdminPassword = getConfig().adminPassword;\n                if (cfgAdminPassword) {\n                    const passwordHash = bcrypt.hashSync(cfgAdminPassword, BCRYPT_ROUNDS);\n                    await pool.query(\n                        'UPDATE users SET role = $1, tier = $2, password_hash = $3, updated_at = $4 WHERE username = $5',\n                        ['admin', 'enterprise', passwordHash, new Date().toISOString(), adminEmail]\n                    );\n                    await pool.query('DELETE FROM users WHERE username = $1 AND role = $2', ['admin', 'admin']);\n                    console.log(`[UserManager] âœ… ê´€ë¦¬ì ê¶Œí•œ ì´ì „ ì™„ë£Œ: admin ì‚­ì œ, ${adminEmail} â†’ admin ì—­í• `);\n                }\n                return;\n            } else if (legacyAdmin.rows.length > 0) {\n                // ì´ë©”ì¼ ì‚¬ìš©ìê°€ ì—†ìœ¼ë©´: ë ˆê±°ì‹œ adminì˜ usernameì„ ì´ë©”ì¼ë¡œ ë³€ê²½\n                const cfgAdminPassword = getConfig().adminPassword;\n                if (cfgAdminPassword) {\n                    const passwordHash = bcrypt.hashSync(cfgAdminPassword, BCRYPT_ROUNDS);\n                    await pool.query(\n                        'UPDATE users SET username = $1, email = $2, password_hash = $3, updated_at = $4 WHERE username = $5 AND role = $6',\n                        [adminEmail, adminEmail, passwordHash, new Date().toISOString(), 'admin', 'admin']\n                    );\n                    console.log(`[UserManager] âœ… ê´€ë¦¬ì ê³„ì • ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ: admin â†’ ${adminEmail}`);\n                }\n                return;\n            } else if (existingEmail.rows.length > 0) {\n                // ì´ë©”ì¼ ì‚¬ìš©ìë§Œ ìˆìœ¼ë©´: admin ì—­í•  ë¶€ì—¬\n                if (existingEmail.rows[0].role !== 'admin') {\n                    const cfgAdminPassword = getConfig().adminPassword;\n                    if (cfgAdminPassword) {\n                        const passwordHash = bcrypt.hashSync(cfgAdminPassword, BCRYPT_ROUNDS);\n                        await pool.query(\n                            'UPDATE users SET role = $1, tier = $2, password_hash = $3, updated_at = $4 WHERE username = $5',\n                            ['admin', 'enterprise', passwordHash, new Date().toISOString(), adminEmail]\n                        );\n                        console.log(`[UserManager] âœ… ${adminEmail} ê´€ë¦¬ì ì—­í•  ë¶€ì—¬ ì™„ë£Œ`);\n                    }\n                }\n                return;\n            }\n        }\n\n        // DEFAULT_ADMIN_EMAIL ê³„ì •ì´ ì´ë¯¸ ìˆìœ¼ë©´ ìŠ¤í‚µ\n        const result = await pool.query(\n            'SELECT id FROM users WHERE username = $1',\n            [adminEmail]\n        );\n        if (result.rows.length > 0) return;\n\n        // ğŸ”’ ë³´ì•ˆ ê°•í™”: í™˜ê²½ë³€ìˆ˜ í•„ìˆ˜í™”, ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ ì œê±°\n        const cfgAdminPassword = getConfig().adminPassword;\n        if (!cfgAdminPassword) {\n            console.warn('[UserManager] âš ï¸ ADMIN_PASSWORD í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');\n            console.warn('[UserManager] ê¸°ë³¸ ê´€ë¦¬ì ê³„ì •ì´ ìƒì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. .env íŒŒì¼ì— ADMIN_PASSWORDë¥¼ ì„¤ì •í•˜ì„¸ìš”.');\n            if (getConfig().nodeEnv === 'production') {\n                throw new Error('[UserManager] í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ADMIN_PASSWORD í™˜ê²½ë³€ìˆ˜ê°€ í•„ìˆ˜ì…ë‹ˆë‹¤!');\n            }\n            // ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ìƒì„± (ëœë¤)\n            const tempPassword = require('crypto').randomBytes(16).toString('hex');\n            console.warn(`[UserManager] ê°œë°œ í™˜ê²½ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸: ${tempPassword}`);\n            await this.createUser({\n                email: adminEmail,\n                password: tempPassword,\n                role: 'admin'\n            });\n        } else {\n            await this.createUser({\n                email: adminEmail,\n                password: cfgAdminPassword,\n                role: 'admin'\n            });\n        }\n    }\n\n    private async getNextId(): Promise<number> {\n        const pool = getPool();\n        // Filter out non-numeric IDs (e.g. 'admin-default-001' from seed data) before CAST\n        const result = await pool.query(\n            `SELECT MAX(CAST(id AS INTEGER)) as \"maxId\" FROM users WHERE id ~ $1`,\n            ['^\\\\d+$']\n        );\n        return (result.rows[0]?.maxId || 0) + 1;\n    }\n\n    private rowToPublicUser(row: UserRow): PublicUser {\n        return {\n            id: parseInt(row.id, 10),\n            email: row.username,\n            role: row.role as UserRole,\n            tier: (row.tier || 'free') as UserTier,\n            is_active: !!row.is_active,\n            created_at: row.created_at,\n            last_login: row.last_login || undefined\n        };\n    }\n\n    async createUser(input: CreateUserInput): Promise<PublicUser | null> {\n        const pool = getPool();\n\n        // ì¤‘ë³µ username ì²´í¬\n        const existing = await pool.query('SELECT id FROM users WHERE username = $1', [input.email]);\n        if (existing.rows.length > 0) return null;\n\n        const id = await this.getNextId();\n        // admin ì—­í• ì€ ìë™ìœ¼ë¡œ enterprise tier\n        const tier = input.tier || (input.role === 'admin' ? 'enterprise' : 'free');\n\n        // ğŸ”’ bcryptë¡œ ë¹„ë°€ë²ˆí˜¸ í•´ì‹±\n        const passwordHash = bcrypt.hashSync(input.password, BCRYPT_ROUNDS);\n        const now = new Date().toISOString();\n        const role = input.role || 'user';\n\n        await pool.query(\n            `INSERT INTO users (id, username, password_hash, email, role, tier, is_active, created_at, updated_at)\n             VALUES ($1, $2, $3, $4, $5, $6, TRUE, $7, $8)`,\n            [String(id), input.email, passwordHash, input.email, role, tier, now, now]\n        );\n\n        const result = await pool.query('SELECT * FROM users WHERE id = $1', [String(id)]);\n        const row = result.rows[0] as UserRow | undefined;\n        return row ? this.rowToPublicUser(row) : null;\n    }\n\n    async authenticate(email: string, password: string): Promise<PublicUser | null> {\n        const pool = getPool();\n        const result = await pool.query('SELECT * FROM users WHERE username = $1 AND is_active = TRUE', [email]);\n        const row = result.rows[0] as UserRow | undefined;\n        if (!row) return null;\n\n        // ğŸ”’ bcryptë¡œ ë¹„ë°€ë²ˆí˜¸ ë¹„êµ (í•´ì‹œ ë¹„êµ)\n        if (!bcrypt.compareSync(password, row.password_hash)) return null;\n\n        // last_login ì—…ë°ì´íŠ¸\n        const now = new Date().toISOString();\n        await pool.query('UPDATE users SET last_login = $1 WHERE id = $2', [now, row.id]);\n\n        row.last_login = now;\n        return this.rowToPublicUser(row);\n    }\n\n    async getUserById(id: number): Promise<PublicUser | null> {\n        const pool = getPool();\n        const result = await pool.query('SELECT * FROM users WHERE id = $1', [String(id)]);\n        const row = result.rows[0] as UserRow | undefined;\n        return row ? this.rowToPublicUser(row) : null;\n    }\n\n    async getUserByEmail(email: string): Promise<{ id: number; email: string; password: string; role: UserRole } | null> {\n        const pool = getPool();\n        const result = await pool.query('SELECT * FROM users WHERE username = $1', [email]);\n        const row = result.rows[0] as UserRow | undefined;\n        if (!row) return null;\n        return {\n            id: parseInt(row.id, 10),\n            email: row.username,\n            password: row.password_hash,\n            role: row.role as UserRole\n        };\n    }\n\n    async getAllUsers(options?: { page?: number; limit?: number; role?: UserRole; search?: string }): Promise<{ users: PublicUser[]; total: number; page: number; limit: number }> {\n        const pool = getPool();\n        const conditions: string[] = [];\n        const params: (string | number)[] = [];\n        let paramIdx = 1;\n\n        if (options?.role) {\n            conditions.push(`role = $${paramIdx++}`);\n            params.push(options.role);\n        }\n        if (options?.search) {\n            conditions.push(`LOWER(username) LIKE $${paramIdx++}`);\n            params.push(`%${options.search.toLowerCase()}%`);\n        }\n\n        const whereClause = conditions.length > 0 ? `WHERE ${conditions.join(' AND ')}` : '';\n\n        // ì´ ê°œìˆ˜\n        const countResult = await pool.query(`SELECT COUNT(*) as total FROM users ${whereClause}`, params);\n        const total = parseInt(countResult.rows[0].total, 10);\n\n        const page = options?.page || 1;\n        const limit = options?.limit || 20;\n        const offset = (page - 1) * limit;\n\n        const queryParams = [...params, limit, offset];\n        const rows = await pool.query(\n            `SELECT * FROM users ${whereClause} LIMIT $${paramIdx++} OFFSET $${paramIdx++}`,\n            queryParams\n        );\n\n        return {\n            users: (rows.rows as UserRow[]).map(r => this.rowToPublicUser(r)),\n            total,\n            page,\n            limit\n        };\n    }\n\n    async changePassword(userId: number, newPassword: string): Promise<boolean> {\n        const pool = getPool();\n        // ğŸ”’ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë„ í•´ì‹±í•˜ì—¬ ì €ì¥\n        const passwordHash = bcrypt.hashSync(newPassword, BCRYPT_ROUNDS);\n        const result = await pool.query(\n            'UPDATE users SET password_hash = $1, updated_at = $2 WHERE id = $3',\n            [passwordHash, new Date().toISOString(), String(userId)]\n        );\n        return (result.rowCount || 0) > 0;\n    }\n\n    async changeRole(userId: number, newRole: UserRole): Promise<PublicUser | null> {\n        const pool = getPool();\n        const result = await pool.query(\n            'UPDATE users SET role = $1, updated_at = $2 WHERE id = $3',\n            [newRole, new Date().toISOString(), String(userId)]\n        );\n        if ((result.rowCount || 0) === 0) return null;\n\n        const userResult = await pool.query('SELECT * FROM users WHERE id = $1', [String(userId)]);\n        const row = userResult.rows[0] as UserRow | undefined;\n        return row ? this.rowToPublicUser(row) : null;\n    }\n\n    async updateUser(userId: number, updates: { email?: string; role?: UserRole; is_active?: boolean }): Promise<PublicUser | null> {\n        const pool = getPool();\n        const sets: string[] = ['updated_at = $1'];\n        const params: (string | number | boolean)[] = [new Date().toISOString()];\n        let paramIdx = 2;\n\n        if (updates.email !== undefined) {\n            sets.push(`username = $${paramIdx++}`);\n            params.push(updates.email);\n            sets.push(`email = $${paramIdx++}`);\n            params.push(updates.email);\n        }\n        if (updates.role !== undefined) {\n            sets.push(`role = $${paramIdx++}`);\n            params.push(updates.role);\n        }\n        if (updates.is_active !== undefined) {\n            sets.push(`is_active = $${paramIdx++}`);\n            params.push(updates.is_active);\n        }\n\n        params.push(String(userId));\n        const result = await pool.query(`UPDATE users SET ${sets.join(', ')} WHERE id = $${paramIdx}`, params);\n        if ((result.rowCount || 0) === 0) return null;\n\n        const userResult = await pool.query('SELECT * FROM users WHERE id = $1', [String(userId)]);\n        const row = userResult.rows[0] as UserRow | undefined;\n        return row ? this.rowToPublicUser(row) : null;\n    }\n\n    async deleteUser(userId: number): Promise<boolean> {\n        const pool = getPool();\n        const userResult = await pool.query('SELECT * FROM users WHERE id = $1', [String(userId)]);\n        const row = userResult.rows[0] as UserRow | undefined;\n        if (!row) return false;\n\n        if (row.role === 'admin') {\n            const countResult = await pool.query('SELECT COUNT(*) as cnt FROM users WHERE role = \\'admin\\'');\n            if (parseInt(countResult.rows[0].cnt, 10) <= 1) return false;\n        }\n\n        const result = await pool.query('DELETE FROM users WHERE id = $1', [String(userId)]);\n        return (result.rowCount || 0) > 0;\n    }\n\n    async getStats() {\n        const pool = getPool();\n        const totalRow = await pool.query('SELECT COUNT(*) as cnt FROM users');\n        const activeRow = await pool.query('SELECT COUNT(*) as cnt FROM users WHERE is_active = TRUE');\n        const adminRow = await pool.query('SELECT COUNT(*) as cnt FROM users WHERE role = \\'admin\\'');\n        const userRow = await pool.query('SELECT COUNT(*) as cnt FROM users WHERE role = \\'user\\'');\n        const guestRow = await pool.query('SELECT COUNT(*) as cnt FROM users WHERE role = \\'guest\\'');\n        return {\n            totalUsers: parseInt(totalRow.rows[0].cnt, 10),\n            activeUsers: parseInt(activeRow.rows[0].cnt, 10),\n            adminCount: parseInt(adminRow.rows[0].cnt, 10),\n            userCount: parseInt(userRow.rows[0].cnt, 10),\n            guestCount: parseInt(guestRow.rows[0].cnt, 10)\n        };\n    }\n\n    // ì‚¬ìš©ì tier ë³€ê²½\n    async changeTier(userId: number, newTier: UserTier): Promise<PublicUser | null> {\n        const pool = getPool();\n        const result = await pool.query(\n            'UPDATE users SET tier = $1, updated_at = $2 WHERE id = $3',\n            [newTier, new Date().toISOString(), String(userId)]\n        );\n        if ((result.rowCount || 0) === 0) return null;\n\n        const userResult = await pool.query('SELECT * FROM users WHERE id = $1', [String(userId)]);\n        const row = userResult.rows[0] as UserRow | undefined;\n        return row ? this.rowToPublicUser(row) : null;\n    }\n}\n\nlet userManagerInstance: UserManagerImpl | null = null;\n\nexport function getUserManager(): UserManagerImpl {\n    if (!userManagerInstance) userManagerInstance = new UserManagerImpl();\n    return userManagerInstance;\n}\n"],"version":3}