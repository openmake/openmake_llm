3f07cc50ce1b8fda299281151c4bc4ea
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const bun_test_1 = require("bun:test");
// ============================================
// Mock Setup (MUST be before OllamaClient import)
// ============================================
// Mock axios
const mockAxiosInstance = {
    get: (0, bun_test_1.mock)(() => Promise.resolve({ data: {} })),
    post: (0, bun_test_1.mock)(() => Promise.resolve({ data: {} })),
    interceptors: {
        request: { use: (0, bun_test_1.mock)(() => { }) },
        response: { use: (0, bun_test_1.mock)(() => { }) },
    },
};
bun_test_1.mock.module('axios', () => ({
    default: {
        create: (0, bun_test_1.mock)(() => mockAxiosInstance),
    },
}));
// Mock config
bun_test_1.mock.module('../config', () => ({
    getConfig: () => ({
        ollamaBaseUrl: 'http://localhost:11434',
        ollamaDefaultModel: 'llama3',
        ollamaTimeout: 120000,
    }),
}));
// Mock logger
bun_test_1.mock.module('../utils/logger', () => ({
    createLogger: () => ({
        info: () => { },
        warn: () => { },
        error: () => { },
        debug: () => { },
    }),
}));
// Mock api-key-manager
bun_test_1.mock.module('../ollama/api-key-manager', () => ({
    getApiKeyManager: () => ({
        getAuthHeaders: () => ({}),
        reportSuccess: () => { },
        reportFailure: () => false,
        getCurrentKeyIndex: () => 0,
        getCurrentKey: () => 'test-key',
        getTotalKeys: () => 1,
    }),
    ApiKeyManager: class {
    },
}));
// Mock api-usage-tracker
bun_test_1.mock.module('../ollama/api-usage-tracker', () => ({
    getApiUsageTracker: () => ({
        getQuotaStatus: () => ({
            hourly: { used: 0, limit: 150, remaining: 150 },
            weekly: { used: 0, limit: 2500, remaining: 2500 },
        }),
        recordRequest: () => { },
    }),
}));
// Mock agent-loop
bun_test_1.mock.module('../ollama/agent-loop', () => ({
    runAgentLoop: (0, bun_test_1.mock)(() => Promise.resolve({ messages: [], iterations: 0, finalResponse: '' })),
}));
// ============================================
// Import after mocks
// ============================================
const client_1 = require("../ollama/client");
const quota_exceeded_error_1 = require("../errors/quota-exceeded.error");
// ============================================
// Tests
// ============================================
(0, bun_test_1.describe)('OllamaClient', () => {
    (0, bun_test_1.describe)('Constructor', () => {
        (0, bun_test_1.it)('should initialize with default config from environment', () => {
            const client = new client_1.OllamaClient();
            // Default model comes from environment config
            (0, bun_test_1.expect)(client.model).toBeDefined();
            (0, bun_test_1.expect)(typeof client.model).toBe('string');
        });
        (0, bun_test_1.it)('should merge custom config with defaults', () => {
            const client = new client_1.OllamaClient({ model: 'custom-model' });
            (0, bun_test_1.expect)(client.model).toBe('custom-model');
        });
        (0, bun_test_1.it)('should handle cloud model detection in constructor', () => {
            // When model ends with ':cloud', constructor should set baseUrl to OLLAMA_CLOUD_HOST
            // We verify this by ensuring the constructor completes without errors
            const client = new client_1.OllamaClient({ model: 'gemini:cloud' });
            (0, bun_test_1.expect)(client.model).toBe('gemini:cloud');
        });
        (0, bun_test_1.it)('should create axios instance with correct config', () => {
            const client = new client_1.OllamaClient({ model: 'test-model' });
            // Verify axios.create was called (mocked)
            (0, bun_test_1.expect)(mockAxiosInstance).toBeDefined();
        });
    });
    (0, bun_test_1.describe)('model getter', () => {
        (0, bun_test_1.it)('should return current model name', () => {
            const client = new client_1.OllamaClient({ model: 'test-model' });
            (0, bun_test_1.expect)(client.model).toBe('test-model');
        });
        (0, bun_test_1.it)('should return default model when not specified', () => {
            const client = new client_1.OllamaClient();
            // Default model comes from environment config
            (0, bun_test_1.expect)(client.model).toBeDefined();
            (0, bun_test_1.expect)(typeof client.model).toBe('string');
        });
    });
    (0, bun_test_1.describe)('setModel', () => {
        (0, bun_test_1.it)('should update model after construction', () => {
            const client = new client_1.OllamaClient({ model: 'initial-model' });
            (0, bun_test_1.expect)(client.model).toBe('initial-model');
            client.setModel('new-model');
            (0, bun_test_1.expect)(client.model).toBe('new-model');
        });
        (0, bun_test_1.it)('should allow setting cloud models', () => {
            const client = new client_1.OllamaClient();
            client.setModel('gemini:cloud');
            (0, bun_test_1.expect)(client.model).toBe('gemini:cloud');
        });
    });
    (0, bun_test_1.describe)('clearContext', () => {
        (0, bun_test_1.it)('should not throw when called', () => {
            const client = new client_1.OllamaClient();
            (0, bun_test_1.expect)(() => {
                client.clearContext();
            }).not.toThrow();
        });
    });
    (0, bun_test_1.describe)('createClient helper', () => {
        (0, bun_test_1.it)('should return an OllamaClient instance', () => {
            const client = (0, client_1.createClient)();
            (0, bun_test_1.expect)(client).toBeInstanceOf(client_1.OllamaClient);
        });
        (0, bun_test_1.it)('should accept config parameter', () => {
            const client = (0, client_1.createClient)({ model: 'test-model' });
            (0, bun_test_1.expect)(client).toBeInstanceOf(client_1.OllamaClient);
            (0, bun_test_1.expect)(client.model).toBe('test-model');
        });
        (0, bun_test_1.it)('should use default config when no parameter provided', () => {
            const client = (0, client_1.createClient)();
            // Default model comes from environment config
            (0, bun_test_1.expect)(client.model).toBeDefined();
            (0, bun_test_1.expect)(typeof client.model).toBe('string');
        });
    });
});
// ============================================
// QuotaExceededError Tests
// ============================================
(0, bun_test_1.describe)('QuotaExceededError', () => {
    (0, bun_test_1.describe)('hourly quota exceeded', () => {
        (0, bun_test_1.it)('should create error with hourly quota type', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            (0, bun_test_1.expect)(error.quotaType).toBe('hourly');
            (0, bun_test_1.expect)(error.used).toBe(150);
            (0, bun_test_1.expect)(error.limit).toBe(150);
        });
        (0, bun_test_1.it)('should set retryAfterSeconds to 3600 for hourly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            (0, bun_test_1.expect)(error.retryAfterSeconds).toBe(3600);
        });
        (0, bun_test_1.it)('should have correct error message for hourly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            (0, bun_test_1.expect)(error.message).toBe('API quota exceeded (hourly): 150/150 requests used');
        });
        (0, bun_test_1.it)('should have correct error name', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            (0, bun_test_1.expect)(error.name).toBe('QuotaExceededError');
        });
    });
    (0, bun_test_1.describe)('weekly quota exceeded', () => {
        (0, bun_test_1.it)('should create error with weekly quota type', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 2500, 2500);
            (0, bun_test_1.expect)(error.quotaType).toBe('weekly');
            (0, bun_test_1.expect)(error.used).toBe(2500);
            (0, bun_test_1.expect)(error.limit).toBe(2500);
        });
        (0, bun_test_1.it)('should set retryAfterSeconds to 86400 for weekly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 2500, 2500);
            (0, bun_test_1.expect)(error.retryAfterSeconds).toBe(86400);
        });
        (0, bun_test_1.it)('should have correct error message for weekly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 2500, 2500);
            (0, bun_test_1.expect)(error.message).toBe('API quota exceeded (weekly): 2500/2500 requests used');
        });
    });
    (0, bun_test_1.describe)('both quotas exceeded', () => {
        (0, bun_test_1.it)('should create error with both quota type', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('both', 2500, 2500);
            (0, bun_test_1.expect)(error.quotaType).toBe('both');
            (0, bun_test_1.expect)(error.used).toBe(2500);
            (0, bun_test_1.expect)(error.limit).toBe(2500);
        });
        (0, bun_test_1.it)('should set retryAfterSeconds to 86400 for both', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('both', 2500, 2500);
            (0, bun_test_1.expect)(error.retryAfterSeconds).toBe(86400);
        });
        (0, bun_test_1.it)('should have correct error message for both', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('both', 2500, 2500);
            (0, bun_test_1.expect)(error.message).toBe('API quota exceeded (both): 2500/2500 requests used');
        });
    });
    (0, bun_test_1.describe)('error properties', () => {
        (0, bun_test_1.it)('should be an instance of Error', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 100, 150);
            (0, bun_test_1.expect)(error).toBeInstanceOf(Error);
        });
        (0, bun_test_1.it)('should have all required properties', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 1000, 2500);
            (0, bun_test_1.expect)(error).toHaveProperty('quotaType');
            (0, bun_test_1.expect)(error).toHaveProperty('used');
            (0, bun_test_1.expect)(error).toHaveProperty('limit');
            (0, bun_test_1.expect)(error).toHaveProperty('retryAfterSeconds');
            (0, bun_test_1.expect)(error).toHaveProperty('message');
            (0, bun_test_1.expect)(error).toHaveProperty('name');
        });
        (0, bun_test_1.it)('should handle partial quota usage', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 75, 150);
            (0, bun_test_1.expect)(error.used).toBe(75);
            (0, bun_test_1.expect)(error.limit).toBe(150);
            (0, bun_test_1.expect)(error.message).toBe('API quota exceeded (hourly): 75/150 requests used');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL19fdGVzdHNfXy9vbGxhbWEtY2xpZW50LnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx1Q0FBa0U7QUFFbEUsK0NBQStDO0FBQy9DLGtEQUFrRDtBQUNsRCwrQ0FBK0M7QUFFL0MsYUFBYTtBQUNiLE1BQU0saUJBQWlCLEdBQUc7SUFDdEIsR0FBRyxFQUFFLElBQUEsZUFBSSxFQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUM5QyxJQUFJLEVBQUUsSUFBQSxlQUFJLEVBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQy9DLFlBQVksRUFBRTtRQUNWLE9BQU8sRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFBLGVBQUksRUFBQyxHQUFHLEVBQUUsR0FBRSxDQUFDLENBQUMsRUFBRTtRQUNoQyxRQUFRLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBQSxlQUFJLEVBQUMsR0FBRyxFQUFFLEdBQUUsQ0FBQyxDQUFDLEVBQUU7S0FDcEM7Q0FDSixDQUFDO0FBQ0YsZUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN4QixPQUFPLEVBQUU7UUFDTCxNQUFNLEVBQUUsSUFBQSxlQUFJLEVBQUMsR0FBRyxFQUFFLENBQUMsaUJBQWlCLENBQUM7S0FDeEM7Q0FDSixDQUFDLENBQUMsQ0FBQztBQUVKLGNBQWM7QUFDZCxlQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzVCLFNBQVMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2QsYUFBYSxFQUFFLHdCQUF3QjtRQUN2QyxrQkFBa0IsRUFBRSxRQUFRO1FBQzVCLGFBQWEsRUFBRSxNQUFNO0tBQ3hCLENB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QUMsTUFBTSxDQUFDLENBQUM7UUFDekMsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLGFBQUUsRUFBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUU7WUFDekMsTUFBTSxLQUFLLEdBQUcsSUFBSSx5Q0FBa0IsQ0FBQyxRQUFRLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3hELElBQUEsaUJBQU0sRUFBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzVCLElBQUEsaUJBQU0sRUFBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzlCLElBQUEsaUJBQU0sRUFBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLG1EQUFtRCxDQUFDLENBQUM7UUFDcEYsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Wb2x1bWVzL01BQ19BUFAvb3Blbm1ha2VfbGxtL2JhY2tlbmQvYXBpL3NyYy9fX3Rlc3RzX18vb2xsYW1hLWNsaWVudC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBtb2NrLCBiZWZvcmVFYWNoIH0gZnJvbSAnYnVuOnRlc3QnO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTW9jayBTZXR1cCAoTVVTVCBiZSBiZWZvcmUgT2xsYW1hQ2xpZW50IGltcG9ydClcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIE1vY2sgYXhpb3NcbmNvbnN0IG1vY2tBeGlvc0luc3RhbmNlID0ge1xuICAgIGdldDogbW9jaygoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBkYXRhOiB7fSB9KSksXG4gICAgcG9zdDogbW9jaygoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBkYXRhOiB7fSB9KSksXG4gICAgaW50ZXJjZXB0b3JzOiB7XG4gICAgICAgIHJlcXVlc3Q6IHsgdXNlOiBtb2NrKCgpID0+IHt9KSB9LFxuICAgICAgICByZXNwb25zZTogeyB1c2U6IG1vY2soKCkgPT4ge30pIH0sXG4gICAgfSxcbn07XG5tb2NrLm1vZHVsZSgnYXhpb3MnLCAoKSA9PiAoe1xuICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgY3JlYXRlOiBtb2NrKCgpID0+IG1vY2tBeGlvc0luc3RhbmNlKSxcbiAgICB9LFxufSkpO1xuXG4vLyBNb2NrIGNvbmZpZ1xubW9jay5tb2R1bGUoJy4uL2NvbmZpZycsICgpID0+ICh7XG4gICAgZ2V0Q29uZmlnOiAoKSA9PiAoe1xuICAgICAgICBvbGxhbWFCYXNlVXJsOiAnaHR0cDovL2xvY2FsaG9zdDoxMTQzNCcsXG4gICAgICAgIG9sbGFtYURlZmF1bHRNb2RlbDogJ2xsYW1hMycsXG4gICAgICAgIG9sbGFtYVRpbWVvdXQ6IDEyMDAwMCxcbiAgICB9KSxcbn0pKTtcblxuLy8gTW9jayBsb2dnZXJcbm1vY2subW9kdWxlKCcuLi91dGlscy9sb2dnZXInLCAoKSA9PiAoe1xuICAgIGNyZWF0ZUxvZ2dlcjogKCkgPT4gKHtcbiAgICAgICAgaW5mbzogKCkgPT4ge30sXG4gICAgICAgIHdhcm46ICgpID0+IHt9LFxuICAgICAgICBlcnJvcjogKCkgPT4ge30sXG4gICAgICAgIGRlYnVnOiAoKSA9PiB7fSxcbiAgICB9KSxcbn0pKTtcblxuLy8gTW9jayBhcGkta2V5LW1hbmFnZXJcbm1vY2subW9kdWxlKCcuLi9vbGxhbWEvYXBpLWtleS1tYW5hZ2VyJywgKCkgPT4gKHtcbiAgICBnZXRBcGlLZXlNYW5hZ2VyOiAoKSA9PiAoe1xuICAgICAgICBnZXRBdXRoSGVhZGVyczogKCkgPT4gKHt9KSxcbiAgICAgICAgcmVwb3J0U3VjY2VzczogKCkgPT4ge30sXG4gICAgICAgIHJlcG9ydEZhaWx1cmU6ICgpID0+IGZhbHNlLFxuICAgICAgICBnZXRDdXJyZW50S2V5SW5kZXg6ICgpID0+IDAsXG4gICAgICAgIGdldEN1cnJlbnRLZXk6ICgpID0+ICd0ZXN0LWtleScsXG4gICAgICAgIGdldFRvdGFsS2V5czogKCkgPT4gMSxcbiAgICB9KSxcbiAgICBBcGlLZXlNYW5hZ2VyOiBjbGFzcyB7fSxcbn0pKTtcblxuLy8gTW9jayBhcGktdXNhZ2UtdHJhY2tlclxubW9jay5tb2R1bGUoJy4uL29sbGFtYS9hcGktdXNhZ2UtdHJhY2tlcicsICgpID0+ICh7XG4gICAgZ2V0QXBpVXNhZ2VUcmFja2VyOiAoKSA9PiAoe1xuICAgICAgICBnZXRRdW90YVN0YXR1czogKCkgPT4gKHtcbiAgICAgICAgICAgIGhvdXJseTogeyB1c2VkOiAwLCBsaW1pdDogMTUwLCByZW1haW5pbmc6IDE1MCB9LFxuICAgICAgICAgICAgd2Vla2x5OiB7IHVzZWQ6IDAsIGxpbWl0OiAyNTAwLCByZW1haW5pbmc6IDI1MDAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIHJlY29yZFJlcXVlc3Q6ICgpID0+IHt9LFxuICAgIH0pLFxufSkpO1xuXG4vLyBNb2NrIGFnZW50LWxvb3Bcbm1vY2subW9kdWxlKCcuLi9vbGxhbWEvYWdlbnQtbG9vcCcsICgpID0+ICh7XG4gICAgcnVuQWdlbnRMb29wOiBtb2NrKCgpID0+IFByb21pc2UucmVzb2x2ZSh7IG1lc3NhZ2VzOiBbXSwgaXRlcmF0aW9uczogMCwgZmluYWxSZXNwb25zZTogJycgfSkpLFxufSkpO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSW1wb3J0IGFmdGVyIG1vY2tzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgeyBPbGxhbWFDbGllbnQsIGNyZWF0ZUNsaWVudCB9IGZyb20gJy4uL29sbGFtYS9jbGllbnQnO1xuaW1wb3J0IHsgUXVvdGFFeGNlZWRlZEVycm9yIH0gZnJvbSAnLi4vZXJyb3JzL3F1b3RhLWV4Y2VlZGVkLmVycm9yJztcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRlc3RzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5kZXNjcmliZSgnT2xsYW1hQ2xpZW50JywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdDb25zdHJ1Y3RvcicsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHdpdGggZGVmYXVsdCBjb25maWcgZnJvbSBlbnZpcm9ubWVudCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBPbGxhbWFDbGllbnQoKTtcbiAgICAgICAgICAgIC8vIERlZmF1bHQgbW9kZWwgY29tZXMgZnJvbSBlbnZpcm9ubWVudCBjb25maWdcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGNsaWVudC5tb2RlbCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgbWVyZ2UgY3VzdG9tIGNvbmZpZyB3aXRoIGRlZmF1bHRzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE9sbGFtYUNsaWVudCh7IG1vZGVsOiAnY3VzdG9tLW1vZGVsJyB9KTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ2N1c3RvbS1tb2RlbCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBjbG91ZCBtb2RlbCBkZXRlY3Rpb24gaW4gY29uc3RydWN0b3InLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBXaGVuIG1vZGVsIGVuZHMgd2l0aCAnOmNsb3VkJywgY29uc3RydWN0b3Igc2hvdWxkIHNldCBiYXNlVXJsIHRvIE9MTEFNQV9DTE9VRF9IT1NUXG4gICAgICAgICAgICAvLyBXZSB2ZXJpZnkgdGhpcyBieSBlbnN1cmluZyB0aGUgY29uc3RydWN0b3IgY29tcGxldGVzIHdpdGhvdXQgZXJyb3JzXG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBuZXcgT2xsYW1hQ2xpZW50KHsgbW9kZWw6ICdnZW1pbmk6Y2xvdWQnIH0pO1xuICAgICAgICAgICAgZXhwZWN0KGNsaWVudC5tb2RlbCkudG9CZSgnZ2VtaW5pOmNsb3VkJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGF4aW9zIGluc3RhbmNlIHdpdGggY29ycmVjdCBjb25maWcnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBuZXcgT2xsYW1hQ2xpZW50KHsgbW9kZWw6ICd0ZXN0LW1vZGVsJyB9KTtcbiAgICAgICAgICAgIC8vIFZlcmlmeSBheGlvcy5jcmVhdGUgd2FzIGNhbGxlZCAobW9ja2VkKVxuICAgICAgICAgICAgZXhwZWN0KG1vY2tBeGlvc0luc3RhbmNlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdtb2RlbCBnZXR0ZXInLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGN1cnJlbnQgbW9kZWwgbmFtZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBPbGxhbWFDbGllbnQoeyBtb2RlbDogJ3Rlc3QtbW9kZWwnIH0pO1xuICAgICAgICAgICAgZXhwZWN0KGNsaWVudC5tb2RlbCkudG9CZSgndGVzdC1tb2RlbCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBkZWZhdWx0IG1vZGVsIHdoZW4gbm90IHNwZWNpZmllZCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBPbGxhbWFDbGllbnQoKTtcbiAgICAgICAgICAgIC8vIERlZmF1bHQgbW9kZWwgY29tZXMgZnJvbSBlbnZpcm9ubWVudCBjb25maWdcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGNsaWVudC5tb2RlbCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3NldE1vZGVsJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHVwZGF0ZSBtb2RlbCBhZnRlciBjb25zdHJ1Y3Rpb24nLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBuZXcgT2xsYW1hQ2xpZW50KHsgbW9kZWw6ICdpbml0aWFsLW1vZGVsJyB9KTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ2luaXRpYWwtbW9kZWwnKTtcblxuICAgICAgICAgICAgY2xpZW50LnNldE1vZGVsKCduZXctbW9kZWwnKTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ25ldy1tb2RlbCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGFsbG93IHNldHRpbmcgY2xvdWQgbW9kZWxzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE9sbGFtYUNsaWVudCgpO1xuICAgICAgICAgICAgY2xpZW50LnNldE1vZGVsKCdnZW1pbmk6Y2xvdWQnKTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ2dlbWluaTpjbG91ZCcpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdjbGVhckNvbnRleHQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgbm90IHRocm93IHdoZW4gY2FsbGVkJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE9sbGFtYUNsaWVudCgpO1xuICAgICAgICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBjbGllbnQuY2xlYXJDb250ZXh0KCk7XG4gICAgICAgICAgICB9KS5ub3QudG9UaHJvdygpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdjcmVhdGVDbGllbnQgaGVscGVyJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBhbiBPbGxhbWFDbGllbnQgaW5zdGFuY2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBjcmVhdGVDbGllbnQoKTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQpLnRvQmVJbnN0YW5jZU9mKE9sbGFtYUNsaWVudCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgYWNjZXB0IGNvbmZpZyBwYXJhbWV0ZXInLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBjcmVhdGVDbGllbnQoeyBtb2RlbDogJ3Rlc3QtbW9kZWwnIH0pO1xuICAgICAgICAgICAgZXhwZWN0KGNsaWVudCkudG9CZUluc3RhbmNlT2YoT2xsYW1hQ2xpZW50KTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ3Rlc3QtbW9kZWwnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCBjb25maWcgd2hlbiBubyBwYXJhbWV0ZXIgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBjcmVhdGVDbGllbnQoKTtcbiAgICAgICAgICAgIC8vIERlZmF1bHQgbW9kZWwgY29tZXMgZnJvbSBlbnZpcm9ubWVudCBjb25maWdcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIGNsaWVudC5tb2RlbCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBRdW90YUV4Y2VlZGVkRXJyb3IgVGVzdHNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmRlc2NyaWJlKCdRdW90YUV4Y2VlZGVkRXJyb3InLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2hvdXJseSBxdW90YSBleGNlZWRlZCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgZXJyb3Igd2l0aCBob3VybHkgcXVvdGEgdHlwZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignaG91cmx5JywgMTUwLCAxNTApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnF1b3RhVHlwZSkudG9CZSgnaG91cmx5Jyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IudXNlZCkudG9CZSgxNTApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLmxpbWl0KS50b0JlKDE1MCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgc2V0IHJldHJ5QWZ0ZXJTZWNvbmRzIHRvIDM2MDAgZm9yIGhvdXJseScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignaG91cmx5JywgMTUwLCAxNTApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnJldHJ5QWZ0ZXJTZWNvbmRzKS50b0JlKDM2MDApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBlcnJvciBtZXNzYWdlIGZvciBob3VybHknLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2hvdXJseScsIDE1MCwgMTUwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdBUEkgcXVvdGEgZXhjZWVkZWQgKGhvdXJseSk6IDE1MC8xNTAgcmVxdWVzdHMgdXNlZCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBlcnJvciBuYW1lJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgUXVvdGFFeGNlZWRlZEVycm9yKCdob3VybHknLCAxNTAsIDE1MCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubmFtZSkudG9CZSgnUXVvdGFFeGNlZWRlZEVycm9yJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3dlZWtseSBxdW90YSBleGNlZWRlZCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgZXJyb3Igd2l0aCB3ZWVrbHkgcXVvdGEgdHlwZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignd2Vla2x5JywgMjUwMCwgMjUwMCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IucXVvdGFUeXBlKS50b0JlKCd3ZWVrbHknKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci51c2VkKS50b0JlKDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLmxpbWl0KS50b0JlKDI1MDApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHNldCByZXRyeUFmdGVyU2Vjb25kcyB0byA4NjQwMCBmb3Igd2Vla2x5JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgUXVvdGFFeGNlZWRlZEVycm9yKCd3ZWVrbHknLCAyNTAwLCAyNTAwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5yZXRyeUFmdGVyU2Vjb25kcykudG9CZSg4NjQwMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IGVycm9yIG1lc3NhZ2UgZm9yIHdlZWtseScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignd2Vla2x5JywgMjUwMCwgMjUwMCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnQVBJIHF1b3RhIGV4Y2VlZGVkICh3ZWVrbHkpOiAyNTAwLzI1MDAgcmVxdWVzdHMgdXNlZCcpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdib3RoIHF1b3RhcyBleGNlZWRlZCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgZXJyb3Igd2l0aCBib3RoIHF1b3RhIHR5cGUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2JvdGgnLCAyNTAwLCAyNTAwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5xdW90YVR5cGUpLnRvQmUoJ2JvdGgnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci51c2VkKS50b0JlKDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLmxpbWl0KS50b0JlKDI1MDApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHNldCByZXRyeUFmdGVyU2Vjb25kcyB0byA4NjQwMCBmb3IgYm90aCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignYm90aCcsIDI1MDAsIDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnJldHJ5QWZ0ZXJTZWNvbmRzKS50b0JlKDg2NDAwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIGNvcnJlY3QgZXJyb3IgbWVzc2FnZSBmb3IgYm90aCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignYm90aCcsIDI1MDAsIDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQmUoJ0FQSSBxdW90YSBleGNlZWRlZCAoYm90aCk6IDI1MDAvMjUwMCByZXF1ZXN0cyB1c2VkJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2Vycm9yIHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgYmUgYW4gaW5zdGFuY2Ugb2YgRXJyb3InLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2hvdXJseScsIDEwMCwgMTUwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoRXJyb3IpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgYWxsIHJlcXVpcmVkIHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ3dlZWtseScsIDEwMDAsIDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yKS50b0hhdmVQcm9wZXJ0eSgncXVvdGFUeXBlJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvSGF2ZVByb3BlcnR5KCd1c2VkJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvSGF2ZVByb3BlcnR5KCdsaW1pdCcpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yKS50b0hhdmVQcm9wZXJ0eSgncmV0cnlBZnRlclNlY29uZHMnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvcikudG9IYXZlUHJvcGVydHkoJ21lc3NhZ2UnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvcikudG9IYXZlUHJvcGVydHkoJ25hbWUnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGFydGlhbCBxdW90YSB1c2FnZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignaG91cmx5JywgNzUsIDE1MCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IudXNlZCkudG9CZSg3NSk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubGltaXQpLnRvQmUoMTUwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdBUEkgcXVvdGEgZXhjZWVkZWQgKGhvdXJseSk6IDc1LzE1MCByZXF1ZXN0cyB1c2VkJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=