{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/ollama-client.test.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/ollama-client.test.ts"],"sourcesContent":["import { describe, it, expect, mock, beforeEach } from 'bun:test';\n\n// ============================================\n// Mock Setup (MUST be before OllamaClient import)\n// ============================================\n\n// Mock axios\nconst mockAxiosInstance = {\n    get: mock(() => Promise.resolve({ data: {} })),\n    post: mock(() => Promise.resolve({ data: {} })),\n    interceptors: {\n        request: { use: mock(() => {}) },\n        response: { use: mock(() => {}) },\n    },\n};\nmock.module('axios', () => ({\n    default: {\n        create: mock(() => mockAxiosInstance),\n    },\n}));\n\n// Mock config\nmock.module('../config', () => ({\n    getConfig: () => ({\n        ollamaBaseUrl: 'http://localhost:11434',\n        ollamaDefaultModel: 'llama3',\n        ollamaTimeout: 120000,\n    }),\n}));\n\n// Mock logger\nmock.module('../utils/logger', () => ({\n    createLogger: () => ({\n        info: () => {},\n        warn: () => {},\n        error: () => {},\n        debug: () => {},\n    }),\n}));\n\n// Mock api-key-manager\nmock.module('../ollama/api-key-manager', () => ({\n    getApiKeyManager: () => ({\n        getAuthHeaders: () => ({}),\n        reportSuccess: () => {},\n        reportFailure: () => false,\n        getCurrentKeyIndex: () => 0,\n        getCurrentKey: () => 'test-key',\n        getTotalKeys: () => 1,\n    }),\n    ApiKeyManager: class {},\n}));\n\n// Mock api-usage-tracker\nmock.module('../ollama/api-usage-tracker', () => ({\n    getApiUsageTracker: () => ({\n        getQuotaStatus: () => ({\n            hourly: { used: 0, limit: 150, remaining: 150 },\n            weekly: { used: 0, limit: 2500, remaining: 2500 },\n        }),\n        recordRequest: () => {},\n    }),\n}));\n\n// Mock agent-loop\nmock.module('../ollama/agent-loop', () => ({\n    runAgentLoop: mock(() => Promise.resolve({ messages: [], iterations: 0, finalResponse: '' })),\n}));\n\n// ============================================\n// Import after mocks\n// ============================================\n\nimport { OllamaClient, createClient } from '../ollama/client';\nimport { QuotaExceededError } from '../errors/quota-exceeded.error';\n\n// ============================================\n// Tests\n// ============================================\n\ndescribe('OllamaClient', () => {\n    describe('Constructor', () => {\n        it('should initialize with default config from environment', () => {\n            const client = new OllamaClient();\n            // Default model comes from environment config\n            expect(client.model).toBeDefined();\n            expect(typeof client.model).toBe('string');\n        });\n\n        it('should merge custom config with defaults', () => {\n            const client = new OllamaClient({ model: 'custom-model' });\n            expect(client.model).toBe('custom-model');\n        });\n\n        it('should handle cloud model detection in constructor', () => {\n            // When model ends with ':cloud', constructor should set baseUrl to OLLAMA_CLOUD_HOST\n            // We verify this by ensuring the constructor completes without errors\n            const client = new OllamaClient({ model: 'gemini:cloud' });\n            expect(client.model).toBe('gemini:cloud');\n        });\n\n        it('should create axios instance with correct config', () => {\n            const client = new OllamaClient({ model: 'test-model' });\n            // Verify axios.create was called (mocked)\n            expect(mockAxiosInstance).toBeDefined();\n        });\n    });\n\n    describe('model getter', () => {\n        it('should return current model name', () => {\n            const client = new OllamaClient({ model: 'test-model' });\n            expect(client.model).toBe('test-model');\n        });\n\n        it('should return default model when not specified', () => {\n            const client = new OllamaClient();\n            // Default model comes from environment config\n            expect(client.model).toBeDefined();\n            expect(typeof client.model).toBe('string');\n        });\n    });\n\n    describe('setModel', () => {\n        it('should update model after construction', () => {\n            const client = new OllamaClient({ model: 'initial-model' });\n            expect(client.model).toBe('initial-model');\n\n            client.setModel('new-model');\n            expect(client.model).toBe('new-model');\n        });\n\n        it('should allow setting cloud models', () => {\n            const client = new OllamaClient();\n            client.setModel('gemini:cloud');\n            expect(client.model).toBe('gemini:cloud');\n        });\n    });\n\n    describe('clearContext', () => {\n        it('should not throw when called', () => {\n            const client = new OllamaClient();\n            expect(() => {\n                client.clearContext();\n            }).not.toThrow();\n        });\n    });\n\n    describe('createClient helper', () => {\n        it('should return an OllamaClient instance', () => {\n            const client = createClient();\n            expect(client).toBeInstanceOf(OllamaClient);\n        });\n\n        it('should accept config parameter', () => {\n            const client = createClient({ model: 'test-model' });\n            expect(client).toBeInstanceOf(OllamaClient);\n            expect(client.model).toBe('test-model');\n        });\n\n        it('should use default config when no parameter provided', () => {\n            const client = createClient();\n            // Default model comes from environment config\n            expect(client.model).toBeDefined();\n            expect(typeof client.model).toBe('string');\n        });\n    });\n});\n\n// ============================================\n// QuotaExceededError Tests\n// ============================================\n\ndescribe('QuotaExceededError', () => {\n    describe('hourly quota exceeded', () => {\n        it('should create error with hourly quota type', () => {\n            const error = new QuotaExceededError('hourly', 150, 150);\n            expect(error.quotaType).toBe('hourly');\n            expect(error.used).toBe(150);\n            expect(error.limit).toBe(150);\n        });\n\n        it('should set retryAfterSeconds to 3600 for hourly', () => {\n            const error = new QuotaExceededError('hourly', 150, 150);\n            expect(error.retryAfterSeconds).toBe(3600);\n        });\n\n        it('should have correct error message for hourly', () => {\n            const error = new QuotaExceededError('hourly', 150, 150);\n            expect(error.message).toBe('API quota exceeded (hourly): 150/150 requests used');\n        });\n\n        it('should have correct error name', () => {\n            const error = new QuotaExceededError('hourly', 150, 150);\n            expect(error.name).toBe('QuotaExceededError');\n        });\n    });\n\n    describe('weekly quota exceeded', () => {\n        it('should create error with weekly quota type', () => {\n            const error = new QuotaExceededError('weekly', 2500, 2500);\n            expect(error.quotaType).toBe('weekly');\n            expect(error.used).toBe(2500);\n            expect(error.limit).toBe(2500);\n        });\n\n        it('should set retryAfterSeconds to 86400 for weekly', () => {\n            const error = new QuotaExceededError('weekly', 2500, 2500);\n            expect(error.retryAfterSeconds).toBe(86400);\n        });\n\n        it('should have correct error message for weekly', () => {\n            const error = new QuotaExceededError('weekly', 2500, 2500);\n            expect(error.message).toBe('API quota exceeded (weekly): 2500/2500 requests used');\n        });\n    });\n\n    describe('both quotas exceeded', () => {\n        it('should create error with both quota type', () => {\n            const error = new QuotaExceededError('both', 2500, 2500);\n            expect(error.quotaType).toBe('both');\n            expect(error.used).toBe(2500);\n            expect(error.limit).toBe(2500);\n        });\n\n        it('should set retryAfterSeconds to 86400 for both', () => {\n            const error = new QuotaExceededError('both', 2500, 2500);\n            expect(error.retryAfterSeconds).toBe(86400);\n        });\n\n        it('should have correct error message for both', () => {\n            const error = new QuotaExceededError('both', 2500, 2500);\n            expect(error.message).toBe('API quota exceeded (both): 2500/2500 requests used');\n        });\n    });\n\n    describe('error properties', () => {\n        it('should be an instance of Error', () => {\n            const error = new QuotaExceededError('hourly', 100, 150);\n            expect(error).toBeInstanceOf(Error);\n        });\n\n        it('should have all required properties', () => {\n            const error = new QuotaExceededError('weekly', 1000, 2500);\n            expect(error).toHaveProperty('quotaType');\n            expect(error).toHaveProperty('used');\n            expect(error).toHaveProperty('limit');\n            expect(error).toHaveProperty('retryAfterSeconds');\n            expect(error).toHaveProperty('message');\n            expect(error).toHaveProperty('name');\n        });\n\n        it('should handle partial quota usage', () => {\n            const error = new QuotaExceededError('hourly', 75, 150);\n            expect(error.used).toBe(75);\n            expect(error.limit).toBe(150);\n            expect(error.message).toBe('API quota exceeded (hourly): 75/150 requests used');\n        });\n    });\n});\n"],"version":3}