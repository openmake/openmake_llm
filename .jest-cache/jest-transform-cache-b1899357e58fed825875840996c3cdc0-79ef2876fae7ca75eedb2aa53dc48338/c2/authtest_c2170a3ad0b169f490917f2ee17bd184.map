{"file":"/Volumes/MAC_APP/openmake_llm/tests/unit/__tests__/auth.test.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/tests/unit/__tests__/auth.test.ts"],"sourcesContent":["/**\n * #20 개선: Auth 모듈 기초 단위 테스트\n * \n * JWT 토큰 생성/검증, 권한 체크, 블랙리스트를 테스트합니다.\n */\n\nimport {\n    generateToken,\n    verifyToken,\n    generateRefreshToken,\n    verifyRefreshToken,\n    extractToken,\n    hasPermission,\n    isAdmin,\n    blacklistToken,\n    isTokenBlacklisted,\n    getBlacklistStats\n} from '../../../infrastructure/security/auth/index';\n\nimport type { PublicUser } from '../../../infrastructure/security/auth/types';\n\nconst testUser: PublicUser = {\n    id: 'user-test-1',\n    username: 'testuser',\n    email: 'test@example.com',\n    role: 'user',\n    created_at: new Date().toISOString(),\n    is_active: true\n};\n\nconst adminUser: PublicUser = {\n    id: 'admin-test-1',\n    username: 'admin',\n    email: 'admin@example.com',\n    role: 'admin',\n    created_at: new Date().toISOString(),\n    is_active: true\n};\n\ndescribe('Auth Module', () => {\n    // ===== Token Generation =====\n    describe('generateToken', () => {\n        it('should generate a valid JWT string', () => {\n            const token = generateToken(testUser);\n            expect(typeof token).toBe('string');\n            expect(token.split('.').length).toBe(3); // header.payload.signature\n        });\n\n        it('should generate different tokens for different users', () => {\n            const token1 = generateToken(testUser);\n            const token2 = generateToken(adminUser);\n            expect(token1).not.toBe(token2);\n        });\n\n        it('should generate unique tokens (jti) for same user', () => {\n            const token1 = generateToken(testUser);\n            const token2 = generateToken(testUser);\n            expect(token1).not.toBe(token2);\n        });\n    });\n\n    // ===== Token Verification =====\n    describe('verifyToken', () => {\n        it('should verify a valid token and return payload', () => {\n            const token = generateToken(testUser);\n            const payload = verifyToken(token);\n\n            expect(payload).not.toBeNull();\n            expect(payload!.userId).toBe('user-test-1');\n            expect(payload!.email).toBe('test@example.com');\n            expect(payload!.role).toBe('user');\n        });\n\n        it('should return null for invalid token', () => {\n            const payload = verifyToken('invalid.token.here');\n            expect(payload).toBeNull();\n        });\n\n        it('should return null for empty string', () => {\n            const payload = verifyToken('');\n            expect(payload).toBeNull();\n        });\n    });\n\n    // ===== Refresh Token =====\n    describe('Refresh Token', () => {\n        it('should generate and verify a refresh token', () => {\n            const refreshToken = generateRefreshToken(testUser);\n            expect(typeof refreshToken).toBe('string');\n\n            const result = verifyRefreshToken(refreshToken);\n            expect(result).not.toBeNull();\n            expect(result!.userId).toBe('user-test-1');\n        });\n\n        it('should reject a regular access token as refresh token', () => {\n            const accessToken = generateToken(testUser);\n            const result = verifyRefreshToken(accessToken);\n            expect(result).toBeNull();\n        });\n    });\n\n    // ===== Token Extraction =====\n    describe('extractToken', () => {\n        it('should extract token from Bearer header', () => {\n            const token = extractToken('Bearer abc123');\n            expect(token).toBe('abc123');\n        });\n\n        it('should return raw string if no Bearer prefix', () => {\n            const token = extractToken('raw-token');\n            expect(token).toBe('raw-token');\n        });\n\n        it('should return null for undefined input', () => {\n            expect(extractToken(undefined)).toBeNull();\n        });\n    });\n\n    // ===== Role Permissions =====\n    describe('Role Permissions', () => {\n        it('should allow admin access to all roles', () => {\n            expect(hasPermission('admin', 'admin')).toBe(true);\n            expect(hasPermission('admin', 'user')).toBe(true);\n            expect(hasPermission('admin', 'guest')).toBe(true);\n        });\n\n        it('should allow user access to user and guest', () => {\n            expect(hasPermission('user', 'user')).toBe(true);\n            expect(hasPermission('user', 'guest')).toBe(true);\n            expect(hasPermission('user', 'admin')).toBe(false);\n        });\n\n        it('should allow guest access only to guest', () => {\n            expect(hasPermission('guest', 'guest')).toBe(true);\n            expect(hasPermission('guest', 'user')).toBe(false);\n            expect(hasPermission('guest', 'admin')).toBe(false);\n        });\n\n        it('should correctly identify admin role', () => {\n            expect(isAdmin('admin')).toBe(true);\n            expect(isAdmin('user')).toBe(false);\n            expect(isAdmin('guest')).toBe(false);\n        });\n    });\n\n    // ===== Token Blacklist =====\n    describe('Token Blacklist', () => {\n        it('should blacklist a token and detect it', () => {\n            const token = generateToken(testUser);\n            expect(isTokenBlacklisted(token)).toBe(false);\n\n            blacklistToken(token);\n            expect(isTokenBlacklisted(token)).toBe(true);\n        });\n\n        it('should reject blacklisted token in verifyToken', () => {\n            const token = generateToken(testUser);\n            blacklistToken(token);\n\n            const payload = verifyToken(token);\n            expect(payload).toBeNull();\n        });\n\n        it('should report blacklist stats', () => {\n            const stats = getBlacklistStats();\n            expect(typeof stats.count).toBe('number');\n            expect(typeof stats.persisted).toBe('boolean');\n        });\n    });\n});\n"],"version":3}