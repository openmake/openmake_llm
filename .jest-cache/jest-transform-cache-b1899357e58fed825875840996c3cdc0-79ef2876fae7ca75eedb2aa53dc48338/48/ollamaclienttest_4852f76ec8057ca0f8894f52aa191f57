831f78404fb6a6b5c751439862fe9f4b
"use strict";
// ============================================
// Mock Setup (MUST be before OllamaClient import)
// ============================================
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('axios', () => ({
    default: {
        create: jest.fn(() => mockAxiosInstance),
    },
}));
// Mock config
jest.mock('../config', () => ({
    getConfig: () => ({
        ollamaBaseUrl: 'http://localhost:11434',
        ollamaDefaultModel: 'llama3',
        ollamaTimeout: 120000,
    }),
}));
// Mock logger
jest.mock('../utils/logger', () => ({
    createLogger: () => ({
        info: () => { },
        warn: () => { },
        error: () => { },
        debug: () => { },
    }),
}));
// Mock api-key-manager
jest.mock('../ollama/api-key-manager', () => ({
    getApiKeyManager: () => ({
        getAuthHeaders: () => ({}),
        reportSuccess: () => { },
        reportFailure: () => false,
        getCurrentKeyIndex: () => 0,
        getCurrentKey: () => 'test-key',
        getTotalKeys: () => 1,
    }),
    ApiKeyManager: class {
    },
}));
// Mock api-usage-tracker
jest.mock('../ollama/api-usage-tracker', () => ({
    getApiUsageTracker: () => ({
        getQuotaStatus: () => ({
            hourly: { used: 0, limit: 150, remaining: 150 },
            weekly: { used: 0, limit: 2500, remaining: 2500 },
        }),
        recordRequest: () => { },
    }),
}));
// Mock agent-loop
jest.mock('../ollama/agent-loop', () => ({
    runAgentLoop: jest.fn(() => Promise.resolve({ messages: [], iterations: 0, finalResponse: '' })),
}));
// Mock axios
const mockAxiosInstance = {
    get: jest.fn(() => Promise.resolve({ data: {} })),
    post: jest.fn(() => Promise.resolve({ data: {} })),
    interceptors: {
        request: { use: jest.fn(() => { }) },
        response: { use: jest.fn(() => { }) },
    },
};
// ============================================
// Import after mocks
// ============================================
const client_1 = require("../ollama/client");
const quota_exceeded_error_1 = require("../errors/quota-exceeded.error");
// ============================================
// Tests
// ============================================
describe('OllamaClient', () => {
    describe('Constructor', () => {
        it('should initialize with default config from environment', () => {
            const client = new client_1.OllamaClient();
            // Default model comes from environment config
            expect(client.model).toBeDefined();
            expect(typeof client.model).toBe('string');
        });
        it('should merge custom config with defaults', () => {
            const client = new client_1.OllamaClient({ model: 'custom-model' });
            expect(client.model).toBe('custom-model');
        });
        it('should handle cloud model detection in constructor', () => {
            // When model ends with ':cloud', constructor should set baseUrl to OLLAMA_CLOUD_HOST
            // We verify this by ensuring the constructor completes without errors
            const client = new client_1.OllamaClient({ model: 'gemini:cloud' });
            expect(client.model).toBe('gemini:cloud');
        });
        it('should create axios instance with correct config', () => {
            const client = new client_1.OllamaClient({ model: 'test-model' });
            // Verify axios.create was called (mocked)
            expect(mockAxiosInstance).toBeDefined();
        });
    });
    describe('model getter', () => {
        it('should return current model name', () => {
            const client = new client_1.OllamaClient({ model: 'test-model' });
            expect(client.model).toBe('test-model');
        });
        it('should return default model when not specified', () => {
            const client = new client_1.OllamaClient();
            // Default model comes from environment config
            expect(client.model).toBeDefined();
            expect(typeof client.model).toBe('string');
        });
    });
    describe('setModel', () => {
        it('should update model after construction', () => {
            const client = new client_1.OllamaClient({ model: 'initial-model' });
            expect(client.model).toBe('initial-model');
            client.setModel('new-model');
            expect(client.model).toBe('new-model');
        });
        it('should allow setting cloud models', () => {
            const client = new client_1.OllamaClient();
            client.setModel('gemini:cloud');
            expect(client.model).toBe('gemini:cloud');
        });
    });
    describe('clearContext', () => {
        it('should not throw when called', () => {
            const client = new client_1.OllamaClient();
            expect(() => {
                client.clearContext();
            }).not.toThrow();
        });
    });
    describe('createClient helper', () => {
        it('should return an OllamaClient instance', () => {
            const client = (0, client_1.createClient)();
            expect(client).toBeInstanceOf(client_1.OllamaClient);
        });
        it('should accept config parameter', () => {
            const client = (0, client_1.createClient)({ model: 'test-model' });
            expect(client).toBeInstanceOf(client_1.OllamaClient);
            expect(client.model).toBe('test-model');
        });
        it('should use default config when no parameter provided', () => {
            const client = (0, client_1.createClient)();
            // Default model comes from environment config
            expect(client.model).toBeDefined();
            expect(typeof client.model).toBe('string');
        });
    });
});
// ============================================
// QuotaExceededError Tests
// ============================================
describe('QuotaExceededError', () => {
    describe('hourly quota exceeded', () => {
        it('should create error with hourly quota type', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            expect(error.quotaType).toBe('hourly');
            expect(error.used).toBe(150);
            expect(error.limit).toBe(150);
        });
        it('should set retryAfterSeconds to 3600 for hourly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            expect(error.retryAfterSeconds).toBe(3600);
        });
        it('should have correct error message for hourly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            expect(error.message).toBe('API quota exceeded (hourly): 150/150 requests used');
        });
        it('should have correct error name', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 150, 150);
            expect(error.name).toBe('QuotaExceededError');
        });
    });
    describe('weekly quota exceeded', () => {
        it('should create error with weekly quota type', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 2500, 2500);
            expect(error.quotaType).toBe('weekly');
            expect(error.used).toBe(2500);
            expect(error.limit).toBe(2500);
        });
        it('should set retryAfterSeconds to 86400 for weekly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 2500, 2500);
            expect(error.retryAfterSeconds).toBe(86400);
        });
        it('should have correct error message for weekly', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 2500, 2500);
            expect(error.message).toBe('API quota exceeded (weekly): 2500/2500 requests used');
        });
    });
    describe('both quotas exceeded', () => {
        it('should create error with both quota type', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('both', 2500, 2500);
            expect(error.quotaType).toBe('both');
            expect(error.used).toBe(2500);
            expect(error.limit).toBe(2500);
        });
        it('should set retryAfterSeconds to 86400 for both', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('both', 2500, 2500);
            expect(error.retryAfterSeconds).toBe(86400);
        });
        it('should have correct error message for both', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('both', 2500, 2500);
            expect(error.message).toBe('API quota exceeded (both): 2500/2500 requests used');
        });
    });
    describe('error properties', () => {
        it('should be an instance of Error', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 100, 150);
            expect(error).toBeInstanceOf(Error);
        });
        it('should have all required properties', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('weekly', 1000, 2500);
            expect(error).toHaveProperty('quotaType');
            expect(error).toHaveProperty('used');
            expect(error).toHaveProperty('limit');
            expect(error).toHaveProperty('retryAfterSeconds');
            expect(error).toHaveProperty('message');
            expect(error).toHaveProperty('name');
        });
        it('should handle partial quota usage', () => {
            const error = new quota_exceeded_error_1.QuotaExceededError('hourly', 75, 150);
            expect(error.used).toBe(75);
            expect(error.limit).toBe(150);
            expect(error.message).toBe('API quota exceeded (hourly): 75/150 requests used');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL19fdGVzdHNfXy9vbGxhbWEtY2xpZW50LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBLCtDQUErQztBQUMvQyxrREFBa0Q7QUFDbEQsK0NBQStDOztBQVcvQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RCLE9BQU8sRUFBRTtRQUNMLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLGlCQUFpQixDQUFDO0tBQzNDO0NBQ0osQ0FBQyxDQUFDLENBQUM7QUFFSixjQUFjO0FBQ2QsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMxQixTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNkLGFBQWEsRUFBRSx3QkFBd0I7UUFDdkMsa0JBQWtCLEVBQUUsUUFBUTtRQUM1QixhQUFhLEVBQUUsTUFBTTtLQUN4QixDQUFDO0NBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSixjQUFjO0FBQ2QsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2hDLFlBQVksRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRSxDQUFDO1FBQ2QsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFFLENBQUM7UUFDZCxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUUsQ0FBQztRQUNmLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRSxDQUFDO0tBQ2xCLENBQUM7Q0FDTCxDQUFDLENBQUMsQ0FBQztBQUVKLHVCQUF1QjtBQUN2QixJQUFJLENBQUMsSUFBSSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDMUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNyQixjQUFjLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDMUIsYUFBYSxFQUFFLEdBQUcsRUFBRSxHQUFFLENBQUM7UUFDdkIsYUFBYSxFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQUs7UUFDMUIsa0JBQWtCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUMzQixhQUFhLEVBQUUsR0FBRyxFQUFFLENBQUMsVUFBVTtRQUMvQixZQUFZLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztLQUN4QixDQUFDO0lBQ0YsYUFBYSxFQUFFO0tBQVE7Q0FDMUIsQ0FBQyxDQUFDLENBQUM7QUFFSix5QkFBeUI7QUFDekIsSUFBSSxDQUFDLElBQUksQ0FBQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzVDLGtCQUFrQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDdkIsY0FBYyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDbkIsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUU7WUFDL0MsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUU7U0FDcEQsQ0FBQztRQUNGLGFBQWEsRUFBRSxHQUFHLEVBQUUsR0FBRSxDQUFDO0tBQzFCLENBQUM7Q0FDTCxDQUFDLENBQUMsQ0FBQztBQUVKLGtCQUFrQjtBQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDckMsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFFLENBQUMsRUFBRSxhQUFhLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztDQUNuRyxDQUFDLENBQUMsQ0FBQztBQTdESixhQUFhO0FBQ2IsTUFBTSxpQkFBaUIsR0FBRztJQUN0QixHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDakQsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ2xELFlBQVksRUFBRTtRQUNWLE9BQU8sRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFFLENBQUMsQ0FBQyxFQUFFO1FBQ25DLFFBQVEsRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFFLENBQUMsQ0FBQyxFQUFFO0tBQ3ZDO0NBQ0osQ0FBQztBQXVERiwrQ0FBK0M7QUFDL0MscUJBQXFCO0FBQ3JCLCtDQUErQztBQUUvQyw2Q0FBOEQ7QUFDOUQseUVBQW9FO0FBRXBFLCtDQUErQztBQUMvQyxRQUFRO0FBQ1IsK0NBQStDO0FBRS9DLFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO0lBQzFCLFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQ3pCLEVBQUUsQ0FBQyx3REFBd0QsRUFBRSxHQUFHLEVBQUU7WUFDOUQsTUFBTSxNQUFNLEdBQUcsSUFBSSxxQkFBWSxFQUFFLENBQUM7WUFDbEMsOENBQThDO1lBQzlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDbkMsTUFBTSxDQUFDLE9BQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7WUFDaEQsTUFBTSxNQUFNLEdBQUcsSUFBSSxxQkFBWSxDQUFDLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUM7WUFDM0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDOUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0RBQW9ELEVBQUUsR0FBRyxFQUFFO1lBQzFELHFGQUFxRjtZQUNyRixzRUFBc0U7WUFDdEUsTUFBTSxNQUFNLEdBQUcsSUFBSSxxQkFBWSxDQUFDLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxDQUFDLENBQUM7WUFDM0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDOUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0RBQWtELEVBQUUsR0FBRyxFQUFFO1lBQ3hELE1BQU0sTUFBTSxHQUFHLElBQUkscUJBQVksQ0FBQyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDO1lBQ3pELDBDQUEwQztZQUMxQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7UUFDMUIsRUFBRSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtZQUN4QyxNQUFNLE1BQU0sR0FBRyxJQUFJLHFCQUFZLENBQUMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQztZQUN6RCxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxHQUFHLEVBQUU7WUFDdEQsTUFBTSxNQUFNLEdBQUcsSUFBSSxxQkFBWSxFQUFFLENBQUM7WUFDbEMsOENBQThDO1lBQzlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDbkMsTUFBTSxDQUFDLE9BQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUU7UUFDdEIsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEdBQUcsRUFBRTtZQUM5QyxNQUFNLE1BQU0sR0FBRyxJQUFJLHFCQUFZLENBQUMsRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLENBQUMsQ0FBQztZQUM1RCxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUUzQyxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzdCLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtZQUN6QyxNQUFNLE1BQU0sR0FBRyxJQUFJLHFCQUFZLEVBQUUsQ0FBQztZQUNsQyxNQUFNLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQ2hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzlDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtRQUMxQixFQUFFLENBQUMsOEJBQThCLEVBQUUsR0FBRyxFQUFFO1lBQ3BDLE1BQU0sTUFBTSxHQUFHLElBQUkscUJBQVksRUFBRSxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7Z0JBQ1IsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQzFCLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMsd0NBQXdDLEVBQUUsR0FBRyxFQUFFO1lBQzlDLE1BQU0sTUFBTSxHQUFHLElBQUEscUJBQVksR0FBRSxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxjQUFjLENBQUMscUJBQVksQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdDQUFnQyxFQUFFLEdBQUcsRUFBRTtZQUN0QyxNQUFNLE1BQU0sR0FBRyxJQUFBLHFCQUFZLEVBQUMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQztZQUNyRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsY0FBYyxDQUFDLHFCQUFZLENBQUMsQ0FBQztZQUM1QyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUM1QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxzREFBc0QsRUFBRSxHQUFHLEVBQUU7WUFDNUQsTUFBTSxNQUFNLEdBQUcsSUFBQSxxQkFBWSxHQUFFLENBQUM7WUFDOUIsOENBQThDO1lBQzlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDbkMsTUFBTSxDQUFDLE9BQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUM7QUFFSCwrQ0FBK0M7QUFDL0MsMkJBQTJCO0FBQzNCLCtDQUErQztBQUUvQyxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO0lBQ2hDLFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsRUFBRSxDQUFDLDRDQUE0QyxFQUFFLEdBQUcsRUFBRTtZQUNsRCxNQUFNLEtBQUssR0FBRyxJQUFJLHlDQUFrQixDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDekQsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0IsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsaURBQWlELEVBQUUsR0FBRyxFQUFFO1lBQ3ZELE1BQU0sS0FBSyxHQUFHLElBQUkseUNBQWtCLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUN6RCxNQUFNLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEdBQUcsRUFBRTtZQUNwRCxNQUFNLEtBQUssR0FBRyxJQUFJLHlDQUFrQixDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDekQsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsb0RBQW9ELENBQUMsQ0FBQztRQUNyRixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7WUFDdEMsTUFBTSxLQUFLLEdBQUcsSUFBSSx5Q0FBa0IsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3pELE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDbEQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsRUFBRSxDQUFDLDRDQUE0QyxFQUFFLEdBQUcsRUFBRTtZQUNsRCxNQUFNLEtBQUssR0FBRyxJQUFJLHlDQUFrQixDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDM0QsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDOUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0RBQWtELEVBQUUsR0FBRyxFQUFFO1lBQ3hELE1BQU0sS0FBSyxHQUFHLElBQUkseUNBQWtCLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUMzRCxNQUFNLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEdBQUcsRUFBRTtZQUNwRCxNQUFNLEtBQUssR0FBRyxJQUFJLHlDQUFrQixDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDM0QsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsc0RBQXNELENBQUMsQ0FBQztRQUN2RixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtRQUNsQyxFQUFFLENBQUMsMENBQTBDLEVBQUUsR0FBRyxFQUFFO1lBQ2hELE1BQU0sS0FBSyxHQUFHLElBQUkseUNBQWtCLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN6RCxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNyQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM5QixNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxHQUFHLEVBQUU7WUFDdEQsTUFBTSxLQUFLLEdBQUcsSUFBSSx5Q0FBa0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3pELE1BQU0sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNENBQTRDLEVBQUUsR0FBRyxFQUFFO1lBQ2xELE1BQU0sS0FBSyxHQUFHLElBQUkseUNBQWtCLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN6RCxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxvREFBb0QsQ0FBQyxDQUFDO1FBQ3JGLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7WUFDdEMsTUFBTSxLQUFLLEdBQUcsSUFBSSx5Q0FBa0IsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3pELE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO1lBQzNDLE1BQU0sS0FBSyxHQUFHLElBQUkseUNBQWtCLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUMzRCxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDckMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsY0FBYyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDbEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN4QyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtZQUN6QyxNQUFNLEtBQUssR0FBRyxJQUFJLHlDQUFrQixDQUFDLFFBQVEsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDeEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDNUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDOUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsbURBQW1ELENBQUMsQ0FBQztRQUNwRixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1ZvbHVtZXMvTUFDX0FQUC9vcGVubWFrZV9sbG0vYmFja2VuZC9hcGkvc3JjL19fdGVzdHNfXy9vbGxhbWEtY2xpZW50LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1vY2sgU2V0dXAgKE1VU1QgYmUgYmVmb3JlIE9sbGFtYUNsaWVudCBpbXBvcnQpXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vLyBNb2NrIGF4aW9zXG5jb25zdCBtb2NrQXhpb3NJbnN0YW5jZSA9IHtcbiAgICBnZXQ6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YToge30gfSkpLFxuICAgIHBvc3Q6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgZGF0YToge30gfSkpLFxuICAgIGludGVyY2VwdG9yczoge1xuICAgICAgICByZXF1ZXN0OiB7IHVzZTogamVzdC5mbigoKSA9PiB7fSkgfSxcbiAgICAgICAgcmVzcG9uc2U6IHsgdXNlOiBqZXN0LmZuKCgpID0+IHt9KSB9LFxuICAgIH0sXG59O1xuamVzdC5tb2NrKCdheGlvcycsICgpID0+ICh7XG4gICAgZGVmYXVsdDoge1xuICAgICAgICBjcmVhdGU6IGplc3QuZm4oKCkgPT4gbW9ja0F4aW9zSW5zdGFuY2UpLFxuICAgIH0sXG59KSk7XG5cbi8vIE1vY2sgY29uZmlnXG5qZXN0Lm1vY2soJy4uL2NvbmZpZycsICgpID0+ICh7XG4gICAgZ2V0Q29uZmlnOiAoKSA9PiAoe1xuICAgICAgICBvbGxhbWFCYXNlVXJsOiAnaHR0cDovL2xvY2FsaG9zdDoxMTQzNCcsXG4gICAgICAgIG9sbGFtYURlZmF1bHRNb2RlbDogJ2xsYW1hMycsXG4gICAgICAgIG9sbGFtYVRpbWVvdXQ6IDEyMDAwMCxcbiAgICB9KSxcbn0pKTtcblxuLy8gTW9jayBsb2dnZXJcbmplc3QubW9jaygnLi4vdXRpbHMvbG9nZ2VyJywgKCkgPT4gKHtcbiAgICBjcmVhdGVMb2dnZXI6ICgpID0+ICh7XG4gICAgICAgIGluZm86ICgpID0+IHt9LFxuICAgICAgICB3YXJuOiAoKSA9PiB7fSxcbiAgICAgICAgZXJyb3I6ICgpID0+IHt9LFxuICAgICAgICBkZWJ1ZzogKCkgPT4ge30sXG4gICAgfSksXG59KSk7XG5cbi8vIE1vY2sgYXBpLWtleS1tYW5hZ2VyXG5qZXN0Lm1vY2soJy4uL29sbGFtYS9hcGkta2V5LW1hbmFnZXInLCAoKSA9PiAoe1xuICAgIGdldEFwaUtleU1hbmFnZXI6ICgpID0+ICh7XG4gICAgICAgIGdldEF1dGhIZWFkZXJzOiAoKSA9PiAoe30pLFxuICAgICAgICByZXBvcnRTdWNjZXNzOiAoKSA9PiB7fSxcbiAgICAgICAgcmVwb3J0RmFpbHVyZTogKCkgPT4gZmFsc2UsXG4gICAgICAgIGdldEN1cnJlbnRLZXlJbmRleDogKCkgPT4gMCxcbiAgICAgICAgZ2V0Q3VycmVudEtleTogKCkgPT4gJ3Rlc3Qta2V5JyxcbiAgICAgICAgZ2V0VG90YWxLZXlzOiAoKSA9PiAxLFxuICAgIH0pLFxuICAgIEFwaUtleU1hbmFnZXI6IGNsYXNzIHt9LFxufSkpO1xuXG4vLyBNb2NrIGFwaS11c2FnZS10cmFja2VyXG5qZXN0Lm1vY2soJy4uL29sbGFtYS9hcGktdXNhZ2UtdHJhY2tlcicsICgpID0+ICh7XG4gICAgZ2V0QXBpVXNhZ2VUcmFja2VyOiAoKSA9PiAoe1xuICAgICAgICBnZXRRdW90YVN0YXR1czogKCkgPT4gKHtcbiAgICAgICAgICAgIGhvdXJseTogeyB1c2VkOiAwLCBsaW1pdDogMTUwLCByZW1haW5pbmc6IDE1MCB9LFxuICAgICAgICAgICAgd2Vla2x5OiB7IHVzZWQ6IDAsIGxpbWl0OiAyNTAwLCByZW1haW5pbmc6IDI1MDAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIHJlY29yZFJlcXVlc3Q6ICgpID0+IHt9LFxuICAgIH0pLFxufSkpO1xuXG4vLyBNb2NrIGFnZW50LWxvb3Bcbmplc3QubW9jaygnLi4vb2xsYW1hL2FnZW50LWxvb3AnLCAoKSA9PiAoe1xuICAgIHJ1bkFnZW50TG9vcDogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBtZXNzYWdlczogW10sIGl0ZXJhdGlvbnM6IDAsIGZpbmFsUmVzcG9uc2U6ICcnIH0pKSxcbn0pKTtcblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEltcG9ydCBhZnRlciBtb2Nrc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuaW1wb3J0IHsgT2xsYW1hQ2xpZW50LCBjcmVhdGVDbGllbnQgfSBmcm9tICcuLi9vbGxhbWEvY2xpZW50JztcbmltcG9ydCB7IFF1b3RhRXhjZWVkZWRFcnJvciB9IGZyb20gJy4uL2Vycm9ycy9xdW90YS1leGNlZWRlZC5lcnJvcic7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBUZXN0c1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZGVzY3JpYmUoJ09sbGFtYUNsaWVudCcsICgpID0+IHtcbiAgICBkZXNjcmliZSgnQ29uc3RydWN0b3InLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgaW5pdGlhbGl6ZSB3aXRoIGRlZmF1bHQgY29uZmlnIGZyb20gZW52aXJvbm1lbnQnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBuZXcgT2xsYW1hQ2xpZW50KCk7XG4gICAgICAgICAgICAvLyBEZWZhdWx0IG1vZGVsIGNvbWVzIGZyb20gZW52aXJvbm1lbnQgY29uZmlnXG4gICAgICAgICAgICBleHBlY3QoY2xpZW50Lm1vZGVsKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBjbGllbnQubW9kZWwpLnRvQmUoJ3N0cmluZycpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIG1lcmdlIGN1c3RvbSBjb25maWcgd2l0aCBkZWZhdWx0cycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBPbGxhbWFDbGllbnQoeyBtb2RlbDogJ2N1c3RvbS1tb2RlbCcgfSk7XG4gICAgICAgICAgICBleHBlY3QoY2xpZW50Lm1vZGVsKS50b0JlKCdjdXN0b20tbW9kZWwnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2xvdWQgbW9kZWwgZGV0ZWN0aW9uIGluIGNvbnN0cnVjdG9yJywgKCkgPT4ge1xuICAgICAgICAgICAgLy8gV2hlbiBtb2RlbCBlbmRzIHdpdGggJzpjbG91ZCcsIGNvbnN0cnVjdG9yIHNob3VsZCBzZXQgYmFzZVVybCB0byBPTExBTUFfQ0xPVURfSE9TVFxuICAgICAgICAgICAgLy8gV2UgdmVyaWZ5IHRoaXMgYnkgZW5zdXJpbmcgdGhlIGNvbnN0cnVjdG9yIGNvbXBsZXRlcyB3aXRob3V0IGVycm9yc1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE9sbGFtYUNsaWVudCh7IG1vZGVsOiAnZ2VtaW5pOmNsb3VkJyB9KTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ2dlbWluaTpjbG91ZCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBheGlvcyBpbnN0YW5jZSB3aXRoIGNvcnJlY3QgY29uZmlnJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE9sbGFtYUNsaWVudCh7IG1vZGVsOiAndGVzdC1tb2RlbCcgfSk7XG4gICAgICAgICAgICAvLyBWZXJpZnkgYXhpb3MuY3JlYXRlIHdhcyBjYWxsZWQgKG1vY2tlZClcbiAgICAgICAgICAgIGV4cGVjdChtb2NrQXhpb3NJbnN0YW5jZSkudG9CZURlZmluZWQoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnbW9kZWwgZ2V0dGVyJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBjdXJyZW50IG1vZGVsIG5hbWUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBuZXcgT2xsYW1hQ2xpZW50KHsgbW9kZWw6ICd0ZXN0LW1vZGVsJyB9KTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQubW9kZWwpLnRvQmUoJ3Rlc3QtbW9kZWwnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZGVmYXVsdCBtb2RlbCB3aGVuIG5vdCBzcGVjaWZpZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjbGllbnQgPSBuZXcgT2xsYW1hQ2xpZW50KCk7XG4gICAgICAgICAgICAvLyBEZWZhdWx0IG1vZGVsIGNvbWVzIGZyb20gZW52aXJvbm1lbnQgY29uZmlnXG4gICAgICAgICAgICBleHBlY3QoY2xpZW50Lm1vZGVsKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBjbGllbnQubW9kZWwpLnRvQmUoJ3N0cmluZycpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdzZXRNb2RlbCcsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCB1cGRhdGUgbW9kZWwgYWZ0ZXIgY29uc3RydWN0aW9uJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IE9sbGFtYUNsaWVudCh7IG1vZGVsOiAnaW5pdGlhbC1tb2RlbCcgfSk7XG4gICAgICAgICAgICBleHBlY3QoY2xpZW50Lm1vZGVsKS50b0JlKCdpbml0aWFsLW1vZGVsJyk7XG5cbiAgICAgICAgICAgIGNsaWVudC5zZXRNb2RlbCgnbmV3LW1vZGVsJyk7XG4gICAgICAgICAgICBleHBlY3QoY2xpZW50Lm1vZGVsKS50b0JlKCduZXctbW9kZWwnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyBzZXR0aW5nIGNsb3VkIG1vZGVscycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBPbGxhbWFDbGllbnQoKTtcbiAgICAgICAgICAgIGNsaWVudC5zZXRNb2RlbCgnZ2VtaW5pOmNsb3VkJyk7XG4gICAgICAgICAgICBleHBlY3QoY2xpZW50Lm1vZGVsKS50b0JlKCdnZW1pbmk6Y2xvdWQnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnY2xlYXJDb250ZXh0JywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIG5vdCB0aHJvdyB3aGVuIGNhbGxlZCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBPbGxhbWFDbGllbnQoKTtcbiAgICAgICAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY2xpZW50LmNsZWFyQ29udGV4dCgpO1xuICAgICAgICAgICAgfSkubm90LnRvVGhyb3coKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnY3JlYXRlQ2xpZW50IGhlbHBlcicsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gYW4gT2xsYW1hQ2xpZW50IGluc3RhbmNlJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gY3JlYXRlQ2xpZW50KCk7XG4gICAgICAgICAgICBleHBlY3QoY2xpZW50KS50b0JlSW5zdGFuY2VPZihPbGxhbWFDbGllbnQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGFjY2VwdCBjb25maWcgcGFyYW1ldGVyJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gY3JlYXRlQ2xpZW50KHsgbW9kZWw6ICd0ZXN0LW1vZGVsJyB9KTtcbiAgICAgICAgICAgIGV4cGVjdChjbGllbnQpLnRvQmVJbnN0YW5jZU9mKE9sbGFtYUNsaWVudCk7XG4gICAgICAgICAgICBleHBlY3QoY2xpZW50Lm1vZGVsKS50b0JlKCd0ZXN0LW1vZGVsJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgdXNlIGRlZmF1bHQgY29uZmlnIHdoZW4gbm8gcGFyYW1ldGVyIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2xpZW50ID0gY3JlYXRlQ2xpZW50KCk7XG4gICAgICAgICAgICAvLyBEZWZhdWx0IG1vZGVsIGNvbWVzIGZyb20gZW52aXJvbm1lbnQgY29uZmlnXG4gICAgICAgICAgICBleHBlY3QoY2xpZW50Lm1vZGVsKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBjbGllbnQubW9kZWwpLnRvQmUoJ3N0cmluZycpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gUXVvdGFFeGNlZWRlZEVycm9yIFRlc3RzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5kZXNjcmliZSgnUXVvdGFFeGNlZWRlZEVycm9yJywgKCkgPT4ge1xuICAgIGRlc2NyaWJlKCdob3VybHkgcXVvdGEgZXhjZWVkZWQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGVycm9yIHdpdGggaG91cmx5IHF1b3RhIHR5cGUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2hvdXJseScsIDE1MCwgMTUwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5xdW90YVR5cGUpLnRvQmUoJ2hvdXJseScpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnVzZWQpLnRvQmUoMTUwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5saW1pdCkudG9CZSgxNTApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHNldCByZXRyeUFmdGVyU2Vjb25kcyB0byAzNjAwIGZvciBob3VybHknLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2hvdXJseScsIDE1MCwgMTUwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5yZXRyeUFmdGVyU2Vjb25kcykudG9CZSgzNjAwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIGNvcnJlY3QgZXJyb3IgbWVzc2FnZSBmb3IgaG91cmx5JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgUXVvdGFFeGNlZWRlZEVycm9yKCdob3VybHknLCAxNTAsIDE1MCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnQVBJIHF1b3RhIGV4Y2VlZGVkIChob3VybHkpOiAxNTAvMTUwIHJlcXVlc3RzIHVzZWQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIGNvcnJlY3QgZXJyb3IgbmFtZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignaG91cmx5JywgMTUwLCAxNTApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLm5hbWUpLnRvQmUoJ1F1b3RhRXhjZWVkZWRFcnJvcicpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCd3ZWVrbHkgcXVvdGEgZXhjZWVkZWQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGVycm9yIHdpdGggd2Vla2x5IHF1b3RhIHR5cGUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ3dlZWtseScsIDI1MDAsIDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnF1b3RhVHlwZSkudG9CZSgnd2Vla2x5Jyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IudXNlZCkudG9CZSgyNTAwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5saW1pdCkudG9CZSgyNTAwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBzZXQgcmV0cnlBZnRlclNlY29uZHMgdG8gODY0MDAgZm9yIHdlZWtseScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IFF1b3RhRXhjZWVkZWRFcnJvcignd2Vla2x5JywgMjUwMCwgMjUwMCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IucmV0cnlBZnRlclNlY29uZHMpLnRvQmUoODY0MDApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBlcnJvciBtZXNzYWdlIGZvciB3ZWVrbHknLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ3dlZWtseScsIDI1MDAsIDI1MDApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQmUoJ0FQSSBxdW90YSBleGNlZWRlZCAod2Vla2x5KTogMjUwMC8yNTAwIHJlcXVlc3RzIHVzZWQnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnYm90aCBxdW90YXMgZXhjZWVkZWQnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGVycm9yIHdpdGggYm90aCBxdW90YSB0eXBlJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgUXVvdGFFeGNlZWRlZEVycm9yKCdib3RoJywgMjUwMCwgMjUwMCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IucXVvdGFUeXBlKS50b0JlKCdib3RoJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IudXNlZCkudG9CZSgyNTAwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5saW1pdCkudG9CZSgyNTAwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBzZXQgcmV0cnlBZnRlclNlY29uZHMgdG8gODY0MDAgZm9yIGJvdGgnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2JvdGgnLCAyNTAwLCAyNTAwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5yZXRyeUFmdGVyU2Vjb25kcykudG9CZSg4NjQwMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IGVycm9yIG1lc3NhZ2UgZm9yIGJvdGgnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2JvdGgnLCAyNTAwLCAyNTAwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvci5tZXNzYWdlKS50b0JlKCdBUEkgcXVvdGEgZXhjZWVkZWQgKGJvdGgpOiAyNTAwLzI1MDAgcmVxdWVzdHMgdXNlZCcpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdlcnJvciBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIGJlIGFuIGluc3RhbmNlIG9mIEVycm9yJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgUXVvdGFFeGNlZWRlZEVycm9yKCdob3VybHknLCAxMDAsIDE1MCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvQmVJbnN0YW5jZU9mKEVycm9yKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIGFsbCByZXF1aXJlZCBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgUXVvdGFFeGNlZWRlZEVycm9yKCd3ZWVrbHknLCAxMDAwLCAyNTAwKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvcikudG9IYXZlUHJvcGVydHkoJ3F1b3RhVHlwZScpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yKS50b0hhdmVQcm9wZXJ0eSgndXNlZCcpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yKS50b0hhdmVQcm9wZXJ0eSgnbGltaXQnKTtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvcikudG9IYXZlUHJvcGVydHkoJ3JldHJ5QWZ0ZXJTZWNvbmRzJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvSGF2ZVByb3BlcnR5KCdtZXNzYWdlJyk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvSGF2ZVByb3BlcnR5KCduYW1lJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHBhcnRpYWwgcXVvdGEgdXNhZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBRdW90YUV4Y2VlZGVkRXJyb3IoJ2hvdXJseScsIDc1LCAxNTApO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLnVzZWQpLnRvQmUoNzUpO1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yLmxpbWl0KS50b0JlKDE1MCk7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnQVBJIHF1b3RhIGV4Y2VlZGVkIChob3VybHkpOiA3NS8xNTAgcmVxdWVzdHMgdXNlZCcpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9