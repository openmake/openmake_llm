{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/unified-database.test.ts","mappings":"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","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/__tests__/unified-database.test.ts"],"sourcesContent":["// Track all queries for assertion\nlet capturedQueries: Array<{ text: string; params?: any[] }> = [];\nconst mockQueryResult: { rows: any[]; rowCount: number | null } = { rows: [], rowCount: 0 };\n\nconst mockPoolInstance = {\n    query: jest.fn(async (text: string, params?: any[]) => {\n        capturedQueries.push({ text, params });\n        return mockQueryResult;\n    }),\n    connect: jest.fn(async () => ({\n        query: jest.fn(async (text: string, params?: any[]) => {\n            capturedQueries.push({ text, params });\n            return { rows: [], rowCount: 0 };\n        }),\n        release: jest.fn(() => {}),\n    })),\n    end: jest.fn(async () => {}),\n};\n\njest.mock('pg', () => ({\n    Pool: class MockPool {\n        query = mockPoolInstance.query;\n        connect = mockPoolInstance.connect;\n        end = mockPoolInstance.end;\n    },\n}));\n\njest.mock('../../config/env', () => ({\n    getConfig: () => ({ databaseUrl: 'postgresql://localhost:5432/test_db' }),\n    loadConfig: () => ({ databaseUrl: 'postgresql://localhost:5432/test_db' }),\n    validateConfig: () => {},\n}));\n\njest.mock('../../utils/logger', () => ({\n    createLogger: () => ({\n        info: () => {},\n        warn: () => {},\n        error: () => {},\n        debug: () => {},\n    }),\n}));\n\n// Mock retry-wrapper to not actually retry\njest.mock('../retry-wrapper', () => ({\n    withRetry: async (fn: () => Promise<any>) => fn(),\n    withTransaction: async (pool: any, fn: (client: any) => Promise<any>) => {\n        const client = await pool.connect();\n        try {\n            return await fn(client);\n        } finally {\n            client.release();\n        }\n    },\n}));\n\nimport { UnifiedDatabase } from '../data/models/unified-database';\n\ndescribe('UnifiedDatabase', () => {\n    let db: UnifiedDatabase;\n\n    beforeEach(async () => {\n        capturedQueries = [];\n        mockPoolInstance.query.mockClear();\n        mockQueryResult.rows = [];\n        mockQueryResult.rowCount = 0;\n        db = new UnifiedDatabase();\n        await db.ensureReady();\n        // Clear queries from schema init\n        capturedQueries = [];\n    });\n\n    describe('createUser', () => {\n        it('should execute INSERT INTO users query with correct params', async () => {\n            await db.createUser('user-123', 'testuser', 'hash123', 'test@example.com', 'user');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.text).toContain('INSERT INTO users');\n            expect(query.text).toContain('(id, username, password_hash, email, role)');\n            expect(query.params ?? []).toEqual(['user-123', 'testuser', 'hash123', 'test@example.com', 'user']);\n        });\n\n        it('should handle optional email parameter', async () => {\n            await db.createUser('user-456', 'anotheruser', 'hash456');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.params ?? []).toEqual(['user-456', 'anotheruser', 'hash456', undefined, 'user']);\n        });\n\n        it('should use default role when not provided', async () => {\n            await db.createUser('user-789', 'defaultroleuser', 'hash789', 'email@test.com');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect((query.params ?? [])[4]).toBe('user');\n        });\n    });\n\n    describe('getUserByUsername', () => {\n        it('should execute SELECT * FROM users WHERE username = $1', async () => {\n            await db.getUserByUsername('testuser');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.text).toBe('SELECT * FROM users WHERE username = $1');\n            expect(query.params ?? []).toEqual(['testuser']);\n        });\n\n        it('should pass username as first parameter', async () => {\n            await db.getUserByUsername('anotheruser');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect((query.params ?? [])[0]).toBe('anotheruser');\n        });\n    });\n\n    describe('createSession', () => {\n        it('should execute INSERT INTO conversation_sessions query', async () => {\n            await db.createSession('session-123', 'user-123', 'Test Session', { key: 'value' });\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.text).toContain('INSERT INTO conversation_sessions');\n            expect(query.text).toContain('(id, user_id, title, metadata)');\n        });\n\n        it('should stringify metadata as JSON', async () => {\n            const metadata = { key: 'value', nested: { prop: 'test' } };\n            await db.createSession('session-456', 'user-456', 'Another Session', metadata);\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect((query.params ?? [])[3]).toBe(JSON.stringify(metadata));\n        });\n\n        it('should handle null metadata', async () => {\n            await db.createSession('session-789', 'user-789', 'Session with null metadata', null);\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect((query.params ?? [])[3]).toBe(JSON.stringify({}));\n        });\n\n        it('should use default title when not provided', async () => {\n            await db.createSession('session-default', 'user-default');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect((query.params ?? [])[2]).toBe('새 대화');\n        });\n\n        it('should pass all parameters in correct order', async () => {\n            await db.createSession('sess-id', 'user-id', 'Title', { data: 'test' });\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            const params = query.params ?? [];\n            expect(params[0]).toBe('sess-id');\n            expect(params[1]).toBe('user-id');\n            expect(params[2]).toBe('Title');\n            expect(params[3]).toBe(JSON.stringify({ data: 'test' }));\n        });\n    });\n\n    describe('addMessage', () => {\n        it('should execute INSERT INTO conversation_messages query', async () => {\n            await db.addMessage('session-123', 'user', 'Hello world');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.text).toContain('INSERT INTO conversation_messages');\n            expect(query.text).toContain('(session_id, role, content, model, agent_id, thinking, tokens, response_time_ms)');\n        });\n\n        it('should pass basic parameters correctly', async () => {\n            await db.addMessage('session-123', 'assistant', 'Response text');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            const params = query.params ?? [];\n            expect(params[0]).toBe('session-123');\n            expect(params[1]).toBe('assistant');\n            expect(params[2]).toBe('Response text');\n        });\n\n        it('should include optional parameters when provided', async () => {\n            await db.addMessage('session-456', 'user', 'Query', {\n                model: 'gpt-4',\n                agentId: 'agent-123',\n                thinking: 'Internal thoughts',\n                tokens: 150,\n                responseTimeMs: 1500,\n            });\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            const params = query.params ?? [];\n            expect(params[3]).toBe('gpt-4');\n            expect(params[4]).toBe('agent-123');\n            expect(params[5]).toBe('Internal thoughts');\n            expect(params[6]).toBe(150);\n            expect(params[7]).toBe(1500);\n        });\n\n        it('should pass undefined for missing optional parameters', async () => {\n            await db.addMessage('session-789', 'system', 'System message');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            const params = query.params ?? [];\n            expect(params[3]).toBeUndefined();\n            expect(params[4]).toBeUndefined();\n            expect(params[5]).toBeUndefined();\n            expect(params[6]).toBeUndefined();\n            expect(params[7]).toBeUndefined();\n        });\n\n        it('should handle partial optional parameters', async () => {\n            await db.addMessage('session-partial', 'user', 'Message', {\n                model: 'claude-3',\n                tokens: 200,\n            });\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            const params = query.params ?? [];\n            expect(params[3]).toBe('claude-3');\n            expect(params[4]).toBeUndefined();\n            expect(params[5]).toBeUndefined();\n            expect(params[6]).toBe(200);\n            expect(params[7]).toBeUndefined();\n        });\n    });\n\n    describe('deleteSession', () => {\n        it('should execute DELETE FROM conversation_sessions WHERE id = $1', async () => {\n            await db.deleteSession('session-123');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.text).toBe('DELETE FROM conversation_sessions WHERE id = $1');\n            expect(query.params ?? []).toEqual(['session-123']);\n        });\n\n        it('should return object with changes property', async () => {\n            const result = await db.deleteSession('session-456');\n\n            expect(result).toHaveProperty('changes');\n            expect(typeof result.changes).toBe('number');\n        });\n\n        it('should return rowCount as changes', async () => {\n            mockQueryResult.rowCount = 1;\n            const result = await db.deleteSession('session-789');\n\n            expect(result.changes).toBe(1);\n        });\n\n        it('should return 0 changes when rowCount is null', async () => {\n            mockQueryResult.rowCount = 0;\n            const result = await db.deleteSession('session-null');\n\n            expect(result.changes).toBe(0);\n        });\n    });\n\n    describe('getSessionMessages', () => {\n        it('should execute SELECT with ORDER BY and LIMIT', async () => {\n            await db.getSessionMessages('session-123', 50);\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.text).toContain('SELECT * FROM conversation_messages');\n            expect(query.text).toContain('WHERE session_id = $1');\n            expect(query.text).toContain('ORDER BY created_at ASC');\n            expect(query.text).toContain('LIMIT $2');\n        });\n\n        it('should pass sessionId and limit as parameters', async () => {\n            await db.getSessionMessages('session-456', 100);\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.params ?? []).toEqual(['session-456', 100]);\n        });\n\n        it('should use default limit of 100 when not provided', async () => {\n            await db.getSessionMessages('session-default');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect((query.params ?? [])[1]).toBe(100);\n        });\n\n        it('should return array of ConversationMessage objects', async () => {\n            const testRows: any[] = [\n                {\n                    id: 1,\n                    session_id: 'session-123',\n                    role: 'user',\n                    content: 'Hello',\n                    created_at: '2024-01-01T00:00:00Z',\n                },\n            ];\n            mockQueryResult.rows = testRows;\n\n            const result = await db.getSessionMessages('session-123');\n\n            expect(Array.isArray(result)).toBe(true);\n            expect(result.length).toBe(1);\n            expect((result as any)[0].role).toBe('user');\n        });\n    });\n\n    describe('getUserSessions', () => {\n        it('should execute SELECT with user_id filter', async () => {\n            await db.getUserSessions('user-123', 50);\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.text).toContain('SELECT * FROM conversation_sessions');\n            expect(query.text).toContain('WHERE user_id = $1');\n        });\n\n        it('should order by updated_at DESC', async () => {\n            await db.getUserSessions('user-456', 25);\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.text).toContain('ORDER BY updated_at DESC');\n        });\n\n        it('should include LIMIT clause', async () => {\n            await db.getUserSessions('user-789', 75);\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.text).toContain('LIMIT $2');\n        });\n\n        it('should pass userId and limit as parameters', async () => {\n            await db.getUserSessions('user-abc', 30);\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect(query.params ?? []).toEqual(['user-abc', 30]);\n        });\n\n        it('should use default limit of 50 when not provided', async () => {\n            await db.getUserSessions('user-default');\n\n            expect(capturedQueries.length).toBe(1);\n            const query = capturedQueries[0];\n            expect((query.params ?? [])[1]).toBe(50);\n        });\n\n        it('should return array of ConversationSession objects', async () => {\n            mockQueryResult.rows = [\n                {\n                    id: 'session-1',\n                    user_id: 'user-123',\n                    title: 'Session 1',\n                    created_at: '2024-01-01T00:00:00Z',\n                    updated_at: '2024-01-01T00:00:00Z',\n                } as any,\n            ];\n\n            const result = await db.getUserSessions('user-123');\n\n            expect(Array.isArray(result)).toBe(true);\n            expect(result.length).toBe(1);\n            expect((result as any)[0].title).toBe('Session 1');\n        });\n    });\n\n    describe('ensureReady', () => {\n        it('should complete without error', async () => {\n            const db2 = new UnifiedDatabase();\n            expect(db2.ensureReady()).resolves.toBeUndefined();\n        });\n    });\n\n    describe('getPool', () => {\n        it('should return the pool instance', () => {\n            const pool = db.getPool();\n            expect(pool).toBeDefined();\n            expect(pool).toHaveProperty('query');\n            expect(pool).toHaveProperty('connect');\n            expect(pool).toHaveProperty('end');\n        });\n    });\n});\n"],"version":3}