{"file":"/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/tools.ts","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,uCAAyB;AACzB,2CAA6B;AAG7B,+CAA+C;AAC/C,uBAAuB;AACvB,wCAAwC;AACxC,6CAA6C;AAC7C,wEAAwE;AACxE,+CAA+C;AAE/C,WAAW;AACE,QAAA,cAAc,GAAsB;IAC7C,IAAI,EAAE;QACF,IAAI,EAAE,aAAa;QACnB,WAAW,EAAE,kBAAkB;QAC/B,WAAW,EAAE;YACT,IAAI,EAAE,QAAQ;YACd,UAAU,EAAE;gBACR,OAAO,EAAE;oBACL,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,cAAc;iBAC9B;gBACD,SAAS,EAAE;oBACP,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,UAAU;iBAC1B;gBACD,UAAU,EAAE;oBACR,IAAI,EAAE,OAAO;oBACb,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;oBACzB,WAAW,EAAE,gCAAgC;iBAChD;aACJ;YACD,QAAQ,EAAE,CAAC,SAAS,EAAE,WAAW,CAAC;SACrC;KACJ;IACD,OAAO,EAAE,CAAO,IAAI,EAA0B,EAAE;QAC5C,IAAI,CAAC;YACD,MAAM,OAAO,GAAG,IAAI,CAAC,OAAiB,CAAC;YACvC,MAAM,SAAS,GAAG,IAAI,CAAC,SAAmB,CAAC;YAC3C,MAAM,UAAU,GAAI,IAAI,CAAC,UAAuB,IAAI,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;YAEjF,MAAM,OAAO,GAAa,EAAE,CAAC;YAC7B,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;YAExC,SAAS,SAAS,CAAC,GAAW;gBAC1B,MAAM,OAAO,GAAG,EAAE,CAAC,WAAW,CAAC,GAAG,EAAE,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC;gBAE7D,KAAK,MAAM,KAAK,IAAI,OAAO,EAAE,CAAC;oBAC1B,MAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;oBAE5C,IAAI,KAAK,CAAC,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,KAAK,CAAC,IAAI,KAAK,cAAc,EAAE,CAAC;wBACtF,SAAS,CAAC,QAAQ,CAAC,CAAC;oBACxB,CAAC;yBAAM,IAAI,KAAK,CAAC,MAAM,EAAE,EAAE,CAAC;wBACxB,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;wBACrC,IAAI,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;4BAC3B,IAAI,CAAC;gCACD,MAAM,OAAO,GAAG,EAAE,CAAC,YAAY,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;gCACnD,MAAM,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;gCAElC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE;oCAC1B,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;wCACnB,OAAO,CAAC,IAAI,CAAC,GAAG,QAAQ,IAAI,KAAK,GAAG,CAAC,KAAK,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;oCAC7D,CAAC;gCACL,CAAC,CAAC,CAAC;4BACP,CAAC;4BAAC,WAAM,CAAC;gCACL,WAAW;4BACf,CAAC;wBACL,CAAC;oBACL,CAAC;gBACL,CAAC;YACL,CAAC;YAED,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;YAEnC,OAAO;gBACH,OAAO,EAAE,CAAC;wBACN,IAAI,EAAE,MAAM;wBACZ,IAAI,EAAE,OAAO,CAAC,MAAM,GAAG,CAAC;4BACpB,CAAC,CAAC,UAAU,OAAO,CAAC,MAAM,QAAQ,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;4BACnE,CAAC,CAAC,UAAU;qBACnB,CAAC;aACL,CAAC;QACN,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACb,OAAO;gBACH,OAAO,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,EAAE,CAAC;gBACpD,OAAO,EAAE,IAAI;aAChB,CAAC;QACN,CAAC;IACL,CAAC,CAAA;CACJ,CAAC;AAEF,+CAA+C;AAC/C,sCAAsC;AACtC,+CAA+C;AAE/C;;GAEG;AACU,QAAA,aAAa,GAAsB;IAC5C,IAAI,EAAE;QACF,IAAI,EAAE,YAAY;QAClB,WAAW,EAAE,sDAAsD;QACnE,WAAW,EAAE;YACT,IAAI,EAAE,QAAQ;YACd,UAAU,EAAE;gBACR,UAAU,EAAE;oBACR,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,4BAA4B;iBAC5C;gBACD,YAAY,EAAE;oBACV,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,2CAA2C;iBAC3D;gBACD,QAAQ,EAAE;oBACN,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,wCAAwC;iBACxD;aACJ;YACD,QAAQ,EAAE,EAAE;SACf;KACJ;IACD,OAAO,EAAE,CAAO,IAAI,EAA0B,EAAE;QAC5C,sCAAsC;QACtC,6BAA6B;QAC7B,OAAO;YACH,OAAO,EAAE,CAAC;oBACN,IAAI,EAAE,MAAM;oBACZ,IAAI,EAAE,2EAA2E;iBACpF,CAAC;SACL,CAAC;IACN,CAAC,CAAA;CACJ,CAAC;AAEF;;GAEG;AACU,QAAA,gBAAgB,GAAsB;IAC/C,IAAI,EAAE;QACF,IAAI,EAAE,eAAe;QACrB,WAAW,EAAE,8CAA8C;QAC3D,WAAW,EAAE;YACT,IAAI,EAAE,QAAQ;YACd,UAAU,EAAE;gBACR,UAAU,EAAE;oBACR,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,eAAe;iBAC/B;gBACD,YAAY,EAAE;oBACV,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,qBAAqB;iBACrC;gBACD,QAAQ,EAAE;oBACN,IAAI,EAAE,QAAQ;oBACd,WAAW,EAAE,uBAAuB;iBACvC;aACJ;YACD,QAAQ,EAAE,EAAE;SACf;KACJ;IACD,OAAO,EAAE,CAAO,IAAI,EAA0B,EAAE;QAC5C,OAAO;YACH,OAAO,EAAE,CAAC;oBACN,IAAI,EAAE,MAAM;oBACZ,IAAI,EAAE,2CAA2C;iBACpD,CAAC;SACL,CAAC;IACN,CAAC,CAAA;CACJ,CAAC;AAEF,eAAe;AACf,6CAA8C;AAC9C,wBAAwB;AACxB,2CAAoE;AAEpE,6CAA6C;AAC7C,oFAAoF;AACvE,QAAA,YAAY,GAAwB;IAC7C,qBAAa;IACb,wBAAgB;IAChB,GAAG,2BAAc;IACjB,GAAG,CAAC,IAAA,iCAAqB,GAAE,CAAC,CAAC,CAAC,0BAAc,CAAC,CAAC,CAAC,EAAE,CAAC;CACrD,CAAC","names":[],"sources":["/Volumes/MAC_APP/openmake_llm/backend/api/src/mcp/tools.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport { MCPToolDefinition, MCPToolResult } from './types';\n\n// ============================================\n// 🔒 보안 패치 2026-02-07:\n// - run_command: 커맨드 인젝션(RCE) 위험으로 비활성화\n// - read_file/write_file: 샌드박스 미적용 레거시 도구 제거\n//   → mcp/filesystem.ts의 fs_read_file/fs_write_file (UserSandbox 적용) 사용\n// ============================================\n\r\n// 코드 검색 도구\r\nexport const searchCodeTool: MCPToolDefinition = {\r\n    tool: {\r\n        name: 'search_code',\r\n        description: '디렉토리에서 코드를 검색합니다',\r\n        inputSchema: {\r\n            type: 'object',\r\n            properties: {\r\n                pattern: {\r\n                    type: 'string',\r\n                    description: '검색할 패턴 (정규식)'\r\n                },\r\n                directory: {\r\n                    type: 'string',\r\n                    description: '검색할 디렉토리'\r\n                },\r\n                extensions: {\r\n                    type: 'array',\r\n                    items: { type: 'string' },\r\n                    description: '검색할 파일 확장자 (예: [\".ts\", \".js\"])'\r\n                }\r\n            },\r\n            required: ['pattern', 'directory']\r\n        }\r\n    },\r\n    handler: async (args): Promise<MCPToolResult> => {\r\n        try {\r\n            const pattern = args.pattern as string;\r\n            const directory = args.directory as string;\r\n            const extensions = (args.extensions as string[]) || ['.ts', '.js', '.py', '.go'];\r\n\r\n            const results: string[] = [];\r\n            const regex = new RegExp(pattern, 'gi');\r\n\r\n            function searchDir(dir: string): void {\r\n                const entries = fs.readdirSync(dir, { withFileTypes: true });\r\n\r\n                for (const entry of entries) {\r\n                    const fullPath = path.join(dir, entry.name);\r\n\r\n                    if (entry.isDirectory() && !entry.name.startsWith('.') && entry.name !== 'node_modules') {\r\n                        searchDir(fullPath);\r\n                    } else if (entry.isFile()) {\r\n                        const ext = path.extname(entry.name);\r\n                        if (extensions.includes(ext)) {\r\n                            try {\r\n                                const content = fs.readFileSync(fullPath, 'utf-8');\r\n                                const lines = content.split('\\n');\r\n\r\n                                lines.forEach((line, index) => {\r\n                                    if (regex.test(line)) {\r\n                                        results.push(`${fullPath}:${index + 1}: ${line.trim()}`);\r\n                                    }\r\n                                });\r\n                            } catch {\r\n                                // 읽기 실패 무시\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            searchDir(path.resolve(directory));\r\n\r\n            return {\r\n                content: [{\r\n                    type: 'text',\r\n                    text: results.length > 0\r\n                        ? `검색 결과 (${results.length}개):\\n${results.slice(0, 50).join('\\n')}`\r\n                        : '검색 결과 없음'\r\n                }]\r\n            };\r\n        } catch (error) {\r\n            return {\r\n                content: [{ type: 'text', text: `검색 실패: ${error}` }],\r\n                isError: true\r\n            };\r\n        }\r\n    }\r\n};\r\n\r\n// ============================================\r\n// Vision Tools (OCR / Image Analysis)\r\n// ============================================\r\n\r\n/**\r\n * 이미지 OCR 도구 - 이미지에서 텍스트 추출\r\n */\r\nexport const visionOcrTool: MCPToolDefinition = {\r\n    tool: {\r\n        name: 'vision_ocr',\r\n        description: '이미지에서 텍스트를 추출합니다 (OCR). 문서, 스크린샷, 사진 등에서 텍스트를 읽어옵니다.',\r\n        inputSchema: {\r\n            type: 'object',\r\n            properties: {\r\n                image_path: {\r\n                    type: 'string',\r\n                    description: '이미지 파일 경로 (절대 경로 또는 상대 경로)'\r\n                },\r\n                image_base64: {\r\n                    type: 'string',\r\n                    description: 'Base64 인코딩된 이미지 데이터 (image_path 대신 사용 가능)'\r\n                },\r\n                language: {\r\n                    type: 'string',\r\n                    description: '추출할 텍스트 언어 (예: ko, en, ja). 기본값: 자동 감지'\r\n                }\r\n            },\r\n            required: []\r\n        }\r\n    },\r\n    handler: async (args): Promise<MCPToolResult> => {\r\n        // 실제 OCR은 ChatService에서 비전 모델을 통해 처리됨\r\n        // 이 핸들러는 MCP 도구 형식 호환용으로만 사용\r\n        return {\r\n            content: [{\r\n                type: 'text',\r\n                text: 'OCR은 비전 모델을 통해 ChatService에서 직접 처리됩니다. image_path 또는 image_base64를 전달하세요.'\r\n            }]\r\n        };\r\n    }\r\n};\r\n\r\n/**\r\n * 이미지 분석 도구 - 이미지 내용 분석 및 설명\r\n */\r\nexport const analyzeImageTool: MCPToolDefinition = {\r\n    tool: {\r\n        name: 'analyze_image',\r\n        description: '이미지의 내용을 분석하고 설명합니다. 사진, 다이어그램, 차트 등을 분석합니다.',\r\n        inputSchema: {\r\n            type: 'object',\r\n            properties: {\r\n                image_path: {\r\n                    type: 'string',\r\n                    description: '분석할 이미지 파일 경로'\r\n                },\r\n                image_base64: {\r\n                    type: 'string',\r\n                    description: 'Base64 인코딩된 이미지 데이터'\r\n                },\r\n                question: {\r\n                    type: 'string',\r\n                    description: '이미지에 대해 묻고 싶은 질문 (선택)'\r\n                }\r\n            },\r\n            required: []\r\n        }\r\n    },\r\n    handler: async (args): Promise<MCPToolResult> => {\r\n        return {\r\n            content: [{\r\n                type: 'text',\r\n                text: '이미지 분석은 비전 모델을 통해 ChatService에서 직접 처리됩니다.'\r\n            }]\r\n        };\r\n    }\r\n};\r\n\r\n// 웹 검색 도구 가져오기\r\nimport { webSearchTools } from './web-search';\r\n// Firecrawl MCP 도구 가져오기\r\nimport { firecrawlTools, isFirecrawlConfigured } from './firecrawl';\r\n\r\n// 모든 도구 내보내기 (Firecrawl은 API 키가 설정된 경우에만 추가)\n// 🔒 보안 패치 2026-02-07: runCommandTool(RCE), readFileTool/writeFileTool(샌드박스 미적용) 제거\nexport const builtInTools: MCPToolDefinition[] = [\n    visionOcrTool,\n    analyzeImageTool,\n    ...webSearchTools,\n    ...(isFirecrawlConfigured() ? firecrawlTools : []),\n];\n"],"version":3}