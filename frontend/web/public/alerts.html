<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>ì•Œë¦¼ ê´€ë¦¬ - OpenMake.Ai</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/design-tokens.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/layout.css">
    <style>
        .dash-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:var(--space-4); margin-bottom:var(--space-5); }
        .dash-card { background:var(--bg-card); border:1px solid var(--border-light); border-radius:var(--radius-lg); padding:var(--space-5); }
        .dash-card h3 { margin:0 0 var(--space-3); color:var(--text-primary); font-size:1rem; }
        .metric-row { display:flex; justify-content:space-between; padding:var(--space-2) 0; border-bottom:1px solid var(--border-light); font-size:var(--font-size-sm); }
        .metric-row:last-child { border-bottom:none; }
        .metric-label { color:var(--text-muted); }
        .metric-value { color:var(--text-primary); font-weight:var(--font-weight-semibold); }
        .status-on { color:var(--success); font-weight:var(--font-weight-bold); }
        .status-off { color:var(--danger); font-weight:var(--font-weight-bold); }
        .channel-tag { display:inline-block; padding:2px 8px; border-radius:var(--radius-md); font-size:11px; font-weight:var(--font-weight-semibold); background:var(--bg-tertiary); color:var(--text-secondary); margin-right:var(--space-1); }
        .section-title { font-size:1.1rem; font-weight:var(--font-weight-semibold); color:var(--text-primary); margin:var(--space-5) 0 var(--space-4); }
        .filter-tabs { display:flex; gap:var(--space-2); margin-bottom:var(--space-4); }
        .filter-tab { padding:var(--space-2) var(--space-3); background:var(--bg-tertiary); border:1px solid var(--border-light); border-radius:var(--radius-md); cursor:pointer; color:var(--text-secondary); font-size:var(--font-size-sm); }
        .filter-tab.active { background:var(--accent-primary); color:#fff; border-color:var(--accent-primary); }
        .alert-list { display:flex; flex-direction:column; gap:var(--space-3); }
        .alert-item { background:var(--bg-card); border:1px solid var(--border-light); border-radius:var(--radius-lg); padding:var(--space-4); display:flex; gap:var(--space-3); align-items:flex-start; }
        .alert-item:hover { border-color:var(--accent-primary); }
        .alert-icon { font-size:1.5rem; flex-shrink:0; }
        .alert-body { flex:1; min-width:0; }
        .alert-header { display:flex; gap:var(--space-2); align-items:center; flex-wrap:wrap; margin-bottom:var(--space-1); }
        .alert-title { font-weight:var(--font-weight-semibold); color:var(--text-primary); font-size:var(--font-size-sm); }
        .alert-time { font-size:12px; color:var(--text-muted); }
        .alert-msg { font-size:var(--font-size-sm); color:var(--text-muted); line-height:1.5; }
        .badge { display:inline-block; padding:2px 8px; border-radius:var(--radius-md); font-size:11px; font-weight:var(--font-weight-semibold); }
        .badge-info { background:var(--accent-primary); color:#fff; }
        .badge-warning { background:var(--warning); color:#000; }
        .badge-critical { background:var(--danger); color:#fff; }
        .empty-state { text-align:center; padding:var(--space-8); color:var(--text-muted); }
        .toast { position:fixed; bottom:20px; right:20px; padding:var(--space-3) var(--space-5); border-radius:var(--radius-md); color:#fff; z-index:2000; opacity:0; transition:opacity .3s; }
        .toast.show { opacity:1; } .toast.success { background:var(--success); } .toast.error { background:var(--danger); }
    </style>
</head>
<body>
    <div class="layout">
        <aside class="sidebar" id="sidebar"></aside>
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
        <main class="main-content">
            <header class="page-header">
                <button class="mobile-menu-btn" onclick="toggleMobileSidebar(event)">&#9776;</button>
                <h1>ì•Œë¦¼ ê´€ë¦¬</h1>
            </header>
            <div class="content-area">
                <!-- ì‹œìŠ¤í…œ ìƒíƒœ + ì„ê³„ê°’ -->
                <div class="dash-grid">
                    <div class="dash-card">
                        <h3>ì•Œë¦¼ ì‹œìŠ¤í…œ</h3>
                        <div id="systemStatus">
                            <div class="metric-row"><span class="metric-label">ìƒíƒœ</span><span class="metric-value status-on">í™œì„±í™”</span></div>
                            <div class="metric-row"><span class="metric-label">ì±„ë„</span><span class="metric-value"><span class="channel-tag">console</span></span></div>
                            <div class="metric-row"><span class="metric-label">ì´ ì•Œë¦¼</span><span class="metric-value" id="totalAlerts">0</span></div>
                        </div>
                    </div>
                    <div class="dash-card">
                        <h3>ì„ê³„ê°’ ì„¤ì •</h3>
                        <div class="metric-row"><span class="metric-label">í• ë‹¹ëŸ‰ ê²½ê³ </span><span class="metric-value">70%</span></div>
                        <div class="metric-row"><span class="metric-label">í• ë‹¹ëŸ‰ ìœ„í—˜</span><span class="metric-value">90%</span></div>
                        <div class="metric-row"><span class="metric-label">ì‘ë‹µì‹œê°„ ì„ê³„</span><span class="metric-value">5,000ms</span></div>
                        <div class="metric-row"><span class="metric-label">ì—ëŸ¬ìœ¨ ì„ê³„</span><span class="metric-value">10%</span></div>
                        <div class="metric-row"><span class="metric-label">ì¿¨ë‹¤ìš´</span><span class="metric-value">15ë¶„</span></div>
                    </div>
                    <div class="dash-card">
                        <h3>ì•Œë¦¼ ìœ í˜•</h3>
                        <div class="metric-row"><span class="metric-label">í• ë‹¹ëŸ‰ ê²½ê³ </span><span class="metric-value badge badge-warning">warning</span></div>
                        <div class="metric-row"><span class="metric-label">í• ë‹¹ëŸ‰ ìœ„í—˜</span><span class="metric-value badge badge-critical">critical</span></div>
                        <div class="metric-row"><span class="metric-label">í‚¤ ì†Œì§„</span><span class="metric-value badge badge-critical">critical</span></div>
                        <div class="metric-row"><span class="metric-label">ì‘ë‹µì‹œê°„ ê¸‰ì¦</span><span class="metric-value badge badge-warning">warning</span></div>
                        <div class="metric-row"><span class="metric-label">ì—ëŸ¬ìœ¨ ê¸‰ì¦</span><span class="metric-value badge badge-critical">critical</span></div>
                    </div>
                </div>

                <!-- ì•Œë¦¼ íˆìŠ¤í† ë¦¬ -->
                <h3 class="section-title">ì•Œë¦¼ íˆìŠ¤í† ë¦¬</h3>
                <div class="filter-tabs" id="filterTabs">
                    <button class="filter-tab active" data-sev="all">ì „ì²´</button>
                    <button class="filter-tab" data-sev="info">ì •ë³´</button>
                    <button class="filter-tab" data-sev="warning">ê²½ê³ </button>
                    <button class="filter-tab" data-sev="critical">ìœ„í—˜</button>
                </div>
                <div class="alert-list" id="alertList">
                    <div class="empty-state">
                        <h2>ì•Œë¦¼ ì—†ìŒ</h2>
                        <p>ì•„ì§ ë°œìƒí•œ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œì´ ì •ìƒ ìš´ì˜ ì¤‘ì…ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <div id="toast" class="toast"></div>
    <script src="/js/components/sidebar.js"></script>
    <script>
        function authFetch(url, opts = {}) {
            const token = localStorage.getItem('authToken');
            opts.headers = { ...(opts.headers || {}), 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' };
            return fetch(url, opts);
        }
        function showToast(msg, type = 'success') {
            const t = document.getElementById('toast');
            t.textContent = msg; t.className = `toast ${type} show`;
            setTimeout(() => t.classList.remove('show'), 2500);
        }
        function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

        const SEVERITY_ICONS = { info: 'â„¹ï¸', warning: 'âš ï¸', critical: 'ğŸš¨' };
        const SEVERITY_BADGE = { info: 'badge-info', warning: 'badge-warning', critical: 'badge-critical' };
        const TYPE_LABELS = {
            quota_warning: 'í• ë‹¹ëŸ‰ ê²½ê³ ', quota_critical: 'í• ë‹¹ëŸ‰ ìœ„í—˜', api_error: 'API ì˜¤ë¥˜',
            system_overload: 'ì‹œìŠ¤í…œ ê³¼ë¶€í•˜', key_exhausted: 'í‚¤ ì†Œì§„',
            response_time_spike: 'ì‘ë‹µì‹œê°„ ê¸‰ì¦', error_rate_spike: 'ì—ëŸ¬ìœ¨ ê¸‰ì¦'
        };

        let allAlerts = [];
        let currentFilter = 'all';

        // í•„í„° íƒ­
        document.getElementById('filterTabs').addEventListener('click', e => {
            const tab = e.target.closest('.filter-tab');
            if (!tab) return;
            document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            currentFilter = tab.dataset.sev;
            renderAlerts();
        });

        function renderAlerts() {
            const filtered = currentFilter === 'all' ? allAlerts : allAlerts.filter(a => a.severity === currentFilter);
            const el = document.getElementById('alertList');
            if (filtered.length === 0) {
                el.innerHTML = '<div class="empty-state"><h2>ì•Œë¦¼ ì—†ìŒ</h2><p>í•´ë‹¹ í•„í„°ì— ë§ëŠ” ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
                return;
            }
            el.innerHTML = filtered.map(a => `
                <div class="alert-item">
                    <div class="alert-icon">${SEVERITY_ICONS[a.severity] || 'â„¹ï¸'}</div>
                    <div class="alert-body">
                        <div class="alert-header">
                            <span class="badge ${SEVERITY_BADGE[a.severity] || 'badge-info'}">${a.severity}</span>
                            <span class="alert-title">${esc(a.title || TYPE_LABELS[a.type] || a.type)}</span>
                            <span class="alert-time">${new Date(a.timestamp).toLocaleString('ko-KR')}</span>
                        </div>
                        <div class="alert-msg">${esc(a.message)}</div>
                    </div>
                </div>
            `).join('');
        }

        // ì•Œë¦¼ íˆìŠ¤í† ë¦¬ëŠ” í˜„ì¬ ì „ìš© APIê°€ ì—†ìœ¼ë¯€ë¡œ ë°ëª¨ ë°ì´í„° í‘œì‹œ
        // í–¥í›„ GET /api/alerts/history êµ¬í˜„ ì‹œ ì—°ë™
        allAlerts = [];
        document.getElementById('totalAlerts').textContent = allAlerts.length;
        renderAlerts();
    </script>
</body>
</html>
